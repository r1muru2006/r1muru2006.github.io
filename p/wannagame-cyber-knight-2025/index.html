<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="Đây là giải đấu do câu lạc bộ Wanna.W1n tổ chức để tuyển thành viên vào câu lạc bộ."><title>WannaGame Cyber Knight 2025</title><link rel=canonical href=https://r1muru2006.github.io/p/wannagame-cyber-knight-2025/><link rel=stylesheet href=/scss/style.min.6a692fd055deae459f2a9767f57f3855ba80cafd5041317f24f7360f6ca47cdf.css><meta property='og:title' content="WannaGame Cyber Knight 2025"><meta property='og:description' content="Đây là giải đấu do câu lạc bộ Wanna.W1n tổ chức để tuyển thành viên vào câu lạc bộ."><meta property='og:url' content='https://r1muru2006.github.io/p/wannagame-cyber-knight-2025/'><meta property='og:site_name' content='r1muru'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='CTF'><meta property='article:tag' content='Cryptography'><meta property='article:published_time' content='2025-05-16T14:13:38+07:00'><meta property='article:modified_time' content='2025-05-16T14:13:38+07:00'><meta property='og:image' content='https://r1muru2006.github.io/p/wannagame-cyber-knight-2025/w1cyber.png'><meta name=twitter:title content="WannaGame Cyber Knight 2025"><meta name=twitter:description content="Đây là giải đấu do câu lạc bộ Wanna.W1n tổ chức để tuyển thành viên vào câu lạc bộ."><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://r1muru2006.github.io/p/wannagame-cyber-knight-2025/w1cyber.png'><link rel="shortcut icon" href=/favicon.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/r1muru_hu_96d524052e0dfddb.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>r1muru</a></h1><h2 class=site-description>Life is not fair, get used to it!</h2></div></header><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#choose>Choose!</a><ol><li><a href=#phân-tích>Phân tích:</a></li><li><a href=#ý-tưởng>Ý tưởng:</a></li></ol></li><li><a href=#heartbreak>heartbreak</a><ol><li><a href=#part-1>Part 1:</a></li><li><a href=#part-2>Part 2:</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/p/wannagame-cyber-knight-2025/><img src=/p/wannagame-cyber-knight-2025/w1cyber_hu_d1580f94c1b12450.png srcset="/p/wannagame-cyber-knight-2025/w1cyber_hu_d1580f94c1b12450.png 800w, /p/wannagame-cyber-knight-2025/w1cyber_hu_cd9ae9d09d5a50dc.png 1600w" width=800 height=533 loading=lazy alt="Featured image of post WannaGame Cyber Knight 2025"></a></div><div class=article-details><header class=article-category><a href=/categories/ctf-write-up/>CTF Write-Up
</a><a href=/categories/wannagame/>WannaGame</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/wannagame-cyber-knight-2025/>WannaGame Cyber Knight 2025</a></h2><h3 class=article-subtitle>Đây là giải đấu do câu lạc bộ Wanna.W1n tổ chức để tuyển thành viên vào câu lạc bộ.</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>May 16, 2025</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>23 minute read</time></div></footer></div></header><section class=article-content><blockquote><p>Trong giải đấu này, mình đã giải được 1 câu trong phần Cryptography và may mắn đứng thứ 8 trên bảng đến cuối (≧▽≦)
<img src=https://hackmd.io/_uploads/BkKat26egg.png loading=lazy alt=image>
Sau đây là bài mình giải được trong giải đấu và tiếp đó là những bài mà mình chưa làm được khi còn trong giải.</p></blockquote><h2 id=choose>Choose!</h2><p><img src=https://hackmd.io/_uploads/HkBEq3pexl.png loading=lazy alt=image></p><p>Link: <a class=link href="https://www.youtube.com/watch?v=1lqe8eU48HI" target=_blank rel=noopener>https://www.youtube.com/watch?v=1lqe8eU48HI</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># aes.py</span>
</span></span><span class=line><span class=cl><span class=c1>#Implementation from https://github.com/boppreh/aes/blob/master/aes.py</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>s_box</span> <span class=o>=</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x63</span><span class=p>,</span> <span class=mh>0x7C</span><span class=p>,</span> <span class=mh>0x77</span><span class=p>,</span> <span class=mh>0x7B</span><span class=p>,</span> <span class=mh>0xF2</span><span class=p>,</span> <span class=mh>0x6B</span><span class=p>,</span> <span class=mh>0x6F</span><span class=p>,</span> <span class=mh>0xC5</span><span class=p>,</span> <span class=mh>0x30</span><span class=p>,</span> <span class=mh>0x01</span><span class=p>,</span> <span class=mh>0x67</span><span class=p>,</span> <span class=mh>0x2B</span><span class=p>,</span> <span class=mh>0xFE</span><span class=p>,</span> <span class=mh>0xD7</span><span class=p>,</span> <span class=mh>0xAB</span><span class=p>,</span> <span class=mh>0x76</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xCA</span><span class=p>,</span> <span class=mh>0x82</span><span class=p>,</span> <span class=mh>0xC9</span><span class=p>,</span> <span class=mh>0x7D</span><span class=p>,</span> <span class=mh>0xFA</span><span class=p>,</span> <span class=mh>0x59</span><span class=p>,</span> <span class=mh>0x47</span><span class=p>,</span> <span class=mh>0xF0</span><span class=p>,</span> <span class=mh>0xAD</span><span class=p>,</span> <span class=mh>0xD4</span><span class=p>,</span> <span class=mh>0xA2</span><span class=p>,</span> <span class=mh>0xAF</span><span class=p>,</span> <span class=mh>0x9C</span><span class=p>,</span> <span class=mh>0xA4</span><span class=p>,</span> <span class=mh>0x72</span><span class=p>,</span> <span class=mh>0xC0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xB7</span><span class=p>,</span> <span class=mh>0xFD</span><span class=p>,</span> <span class=mh>0x93</span><span class=p>,</span> <span class=mh>0x26</span><span class=p>,</span> <span class=mh>0x36</span><span class=p>,</span> <span class=mh>0x3F</span><span class=p>,</span> <span class=mh>0xF7</span><span class=p>,</span> <span class=mh>0xCC</span><span class=p>,</span> <span class=mh>0x34</span><span class=p>,</span> <span class=mh>0xA5</span><span class=p>,</span> <span class=mh>0xE5</span><span class=p>,</span> <span class=mh>0xF1</span><span class=p>,</span> <span class=mh>0x71</span><span class=p>,</span> <span class=mh>0xD8</span><span class=p>,</span> <span class=mh>0x31</span><span class=p>,</span> <span class=mh>0x15</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x04</span><span class=p>,</span> <span class=mh>0xC7</span><span class=p>,</span> <span class=mh>0x23</span><span class=p>,</span> <span class=mh>0xC3</span><span class=p>,</span> <span class=mh>0x18</span><span class=p>,</span> <span class=mh>0x96</span><span class=p>,</span> <span class=mh>0x05</span><span class=p>,</span> <span class=mh>0x9A</span><span class=p>,</span> <span class=mh>0x07</span><span class=p>,</span> <span class=mh>0x12</span><span class=p>,</span> <span class=mh>0x80</span><span class=p>,</span> <span class=mh>0xE2</span><span class=p>,</span> <span class=mh>0xEB</span><span class=p>,</span> <span class=mh>0x27</span><span class=p>,</span> <span class=mh>0xB2</span><span class=p>,</span> <span class=mh>0x75</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x09</span><span class=p>,</span> <span class=mh>0x83</span><span class=p>,</span> <span class=mh>0x2C</span><span class=p>,</span> <span class=mh>0x1A</span><span class=p>,</span> <span class=mh>0x1B</span><span class=p>,</span> <span class=mh>0x6E</span><span class=p>,</span> <span class=mh>0x5A</span><span class=p>,</span> <span class=mh>0xA0</span><span class=p>,</span> <span class=mh>0x52</span><span class=p>,</span> <span class=mh>0x3B</span><span class=p>,</span> <span class=mh>0xD6</span><span class=p>,</span> <span class=mh>0xB3</span><span class=p>,</span> <span class=mh>0x29</span><span class=p>,</span> <span class=mh>0xE3</span><span class=p>,</span> <span class=mh>0x2F</span><span class=p>,</span> <span class=mh>0x84</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x53</span><span class=p>,</span> <span class=mh>0xD1</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0xED</span><span class=p>,</span> <span class=mh>0x20</span><span class=p>,</span> <span class=mh>0xFC</span><span class=p>,</span> <span class=mh>0xB1</span><span class=p>,</span> <span class=mh>0x5B</span><span class=p>,</span> <span class=mh>0x6A</span><span class=p>,</span> <span class=mh>0xCB</span><span class=p>,</span> <span class=mh>0xBE</span><span class=p>,</span> <span class=mh>0x39</span><span class=p>,</span> <span class=mh>0x4A</span><span class=p>,</span> <span class=mh>0x4C</span><span class=p>,</span> <span class=mh>0x58</span><span class=p>,</span> <span class=mh>0xCF</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xD0</span><span class=p>,</span> <span class=mh>0xEF</span><span class=p>,</span> <span class=mh>0xAA</span><span class=p>,</span> <span class=mh>0xFB</span><span class=p>,</span> <span class=mh>0x43</span><span class=p>,</span> <span class=mh>0x4D</span><span class=p>,</span> <span class=mh>0x33</span><span class=p>,</span> <span class=mh>0x85</span><span class=p>,</span> <span class=mh>0x45</span><span class=p>,</span> <span class=mh>0xF9</span><span class=p>,</span> <span class=mh>0x02</span><span class=p>,</span> <span class=mh>0x7F</span><span class=p>,</span> <span class=mh>0x50</span><span class=p>,</span> <span class=mh>0x3C</span><span class=p>,</span> <span class=mh>0x9F</span><span class=p>,</span> <span class=mh>0xA8</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x51</span><span class=p>,</span> <span class=mh>0xA3</span><span class=p>,</span> <span class=mh>0x40</span><span class=p>,</span> <span class=mh>0x8F</span><span class=p>,</span> <span class=mh>0x92</span><span class=p>,</span> <span class=mh>0x9D</span><span class=p>,</span> <span class=mh>0x38</span><span class=p>,</span> <span class=mh>0xF5</span><span class=p>,</span> <span class=mh>0xBC</span><span class=p>,</span> <span class=mh>0xB6</span><span class=p>,</span> <span class=mh>0xDA</span><span class=p>,</span> <span class=mh>0x21</span><span class=p>,</span> <span class=mh>0x10</span><span class=p>,</span> <span class=mh>0xFF</span><span class=p>,</span> <span class=mh>0xF3</span><span class=p>,</span> <span class=mh>0xD2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xCD</span><span class=p>,</span> <span class=mh>0x0C</span><span class=p>,</span> <span class=mh>0x13</span><span class=p>,</span> <span class=mh>0xEC</span><span class=p>,</span> <span class=mh>0x5F</span><span class=p>,</span> <span class=mh>0x97</span><span class=p>,</span> <span class=mh>0x44</span><span class=p>,</span> <span class=mh>0x17</span><span class=p>,</span> <span class=mh>0xC4</span><span class=p>,</span> <span class=mh>0xA7</span><span class=p>,</span> <span class=mh>0x7E</span><span class=p>,</span> <span class=mh>0x3D</span><span class=p>,</span> <span class=mh>0x64</span><span class=p>,</span> <span class=mh>0x5D</span><span class=p>,</span> <span class=mh>0x19</span><span class=p>,</span> <span class=mh>0x73</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x60</span><span class=p>,</span> <span class=mh>0x81</span><span class=p>,</span> <span class=mh>0x4F</span><span class=p>,</span> <span class=mh>0xDC</span><span class=p>,</span> <span class=mh>0x22</span><span class=p>,</span> <span class=mh>0x2A</span><span class=p>,</span> <span class=mh>0x90</span><span class=p>,</span> <span class=mh>0x88</span><span class=p>,</span> <span class=mh>0x46</span><span class=p>,</span> <span class=mh>0xEE</span><span class=p>,</span> <span class=mh>0xB8</span><span class=p>,</span> <span class=mh>0x14</span><span class=p>,</span> <span class=mh>0xDE</span><span class=p>,</span> <span class=mh>0x5E</span><span class=p>,</span> <span class=mh>0x0B</span><span class=p>,</span> <span class=mh>0xDB</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xE0</span><span class=p>,</span> <span class=mh>0x32</span><span class=p>,</span> <span class=mh>0x3A</span><span class=p>,</span> <span class=mh>0x0A</span><span class=p>,</span> <span class=mh>0x49</span><span class=p>,</span> <span class=mh>0x06</span><span class=p>,</span> <span class=mh>0x24</span><span class=p>,</span> <span class=mh>0x5C</span><span class=p>,</span> <span class=mh>0xC2</span><span class=p>,</span> <span class=mh>0xD3</span><span class=p>,</span> <span class=mh>0xAC</span><span class=p>,</span> <span class=mh>0x62</span><span class=p>,</span> <span class=mh>0x91</span><span class=p>,</span> <span class=mh>0x95</span><span class=p>,</span> <span class=mh>0xE4</span><span class=p>,</span> <span class=mh>0x79</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xE7</span><span class=p>,</span> <span class=mh>0xC8</span><span class=p>,</span> <span class=mh>0x37</span><span class=p>,</span> <span class=mh>0x6D</span><span class=p>,</span> <span class=mh>0x8D</span><span class=p>,</span> <span class=mh>0xD5</span><span class=p>,</span> <span class=mh>0x4E</span><span class=p>,</span> <span class=mh>0xA9</span><span class=p>,</span> <span class=mh>0x6C</span><span class=p>,</span> <span class=mh>0x56</span><span class=p>,</span> <span class=mh>0xF4</span><span class=p>,</span> <span class=mh>0xEA</span><span class=p>,</span> <span class=mh>0x65</span><span class=p>,</span> <span class=mh>0x7A</span><span class=p>,</span> <span class=mh>0xAE</span><span class=p>,</span> <span class=mh>0x08</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xBA</span><span class=p>,</span> <span class=mh>0x78</span><span class=p>,</span> <span class=mh>0x25</span><span class=p>,</span> <span class=mh>0x2E</span><span class=p>,</span> <span class=mh>0x1C</span><span class=p>,</span> <span class=mh>0xA6</span><span class=p>,</span> <span class=mh>0xB4</span><span class=p>,</span> <span class=mh>0xC6</span><span class=p>,</span> <span class=mh>0xE8</span><span class=p>,</span> <span class=mh>0xDD</span><span class=p>,</span> <span class=mh>0x74</span><span class=p>,</span> <span class=mh>0x1F</span><span class=p>,</span> <span class=mh>0x4B</span><span class=p>,</span> <span class=mh>0xBD</span><span class=p>,</span> <span class=mh>0x8B</span><span class=p>,</span> <span class=mh>0x8A</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x70</span><span class=p>,</span> <span class=mh>0x3E</span><span class=p>,</span> <span class=mh>0xB5</span><span class=p>,</span> <span class=mh>0x66</span><span class=p>,</span> <span class=mh>0x48</span><span class=p>,</span> <span class=mh>0x03</span><span class=p>,</span> <span class=mh>0xF6</span><span class=p>,</span> <span class=mh>0x0E</span><span class=p>,</span> <span class=mh>0x61</span><span class=p>,</span> <span class=mh>0x35</span><span class=p>,</span> <span class=mh>0x57</span><span class=p>,</span> <span class=mh>0xB9</span><span class=p>,</span> <span class=mh>0x86</span><span class=p>,</span> <span class=mh>0xC1</span><span class=p>,</span> <span class=mh>0x1D</span><span class=p>,</span> <span class=mh>0x9E</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xE1</span><span class=p>,</span> <span class=mh>0xF8</span><span class=p>,</span> <span class=mh>0x98</span><span class=p>,</span> <span class=mh>0x11</span><span class=p>,</span> <span class=mh>0x69</span><span class=p>,</span> <span class=mh>0xD9</span><span class=p>,</span> <span class=mh>0x8E</span><span class=p>,</span> <span class=mh>0x94</span><span class=p>,</span> <span class=mh>0x9B</span><span class=p>,</span> <span class=mh>0x1E</span><span class=p>,</span> <span class=mh>0x87</span><span class=p>,</span> <span class=mh>0xE9</span><span class=p>,</span> <span class=mh>0xCE</span><span class=p>,</span> <span class=mh>0x55</span><span class=p>,</span> <span class=mh>0x28</span><span class=p>,</span> <span class=mh>0xDF</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x8C</span><span class=p>,</span> <span class=mh>0xA1</span><span class=p>,</span> <span class=mh>0x89</span><span class=p>,</span> <span class=mh>0x0D</span><span class=p>,</span> <span class=mh>0xBF</span><span class=p>,</span> <span class=mh>0xE6</span><span class=p>,</span> <span class=mh>0x42</span><span class=p>,</span> <span class=mh>0x68</span><span class=p>,</span> <span class=mh>0x41</span><span class=p>,</span> <span class=mh>0x99</span><span class=p>,</span> <span class=mh>0x2D</span><span class=p>,</span> <span class=mh>0x0F</span><span class=p>,</span> <span class=mh>0xB0</span><span class=p>,</span> <span class=mh>0x54</span><span class=p>,</span> <span class=mh>0xBB</span><span class=p>,</span> <span class=mh>0x16</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>inv_s_box</span> <span class=o>=</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x52</span><span class=p>,</span> <span class=mh>0x09</span><span class=p>,</span> <span class=mh>0x6A</span><span class=p>,</span> <span class=mh>0xD5</span><span class=p>,</span> <span class=mh>0x30</span><span class=p>,</span> <span class=mh>0x36</span><span class=p>,</span> <span class=mh>0xA5</span><span class=p>,</span> <span class=mh>0x38</span><span class=p>,</span> <span class=mh>0xBF</span><span class=p>,</span> <span class=mh>0x40</span><span class=p>,</span> <span class=mh>0xA3</span><span class=p>,</span> <span class=mh>0x9E</span><span class=p>,</span> <span class=mh>0x81</span><span class=p>,</span> <span class=mh>0xF3</span><span class=p>,</span> <span class=mh>0xD7</span><span class=p>,</span> <span class=mh>0xFB</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x7C</span><span class=p>,</span> <span class=mh>0xE3</span><span class=p>,</span> <span class=mh>0x39</span><span class=p>,</span> <span class=mh>0x82</span><span class=p>,</span> <span class=mh>0x9B</span><span class=p>,</span> <span class=mh>0x2F</span><span class=p>,</span> <span class=mh>0xFF</span><span class=p>,</span> <span class=mh>0x87</span><span class=p>,</span> <span class=mh>0x34</span><span class=p>,</span> <span class=mh>0x8E</span><span class=p>,</span> <span class=mh>0x43</span><span class=p>,</span> <span class=mh>0x44</span><span class=p>,</span> <span class=mh>0xC4</span><span class=p>,</span> <span class=mh>0xDE</span><span class=p>,</span> <span class=mh>0xE9</span><span class=p>,</span> <span class=mh>0xCB</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x54</span><span class=p>,</span> <span class=mh>0x7B</span><span class=p>,</span> <span class=mh>0x94</span><span class=p>,</span> <span class=mh>0x32</span><span class=p>,</span> <span class=mh>0xA6</span><span class=p>,</span> <span class=mh>0xC2</span><span class=p>,</span> <span class=mh>0x23</span><span class=p>,</span> <span class=mh>0x3D</span><span class=p>,</span> <span class=mh>0xEE</span><span class=p>,</span> <span class=mh>0x4C</span><span class=p>,</span> <span class=mh>0x95</span><span class=p>,</span> <span class=mh>0x0B</span><span class=p>,</span> <span class=mh>0x42</span><span class=p>,</span> <span class=mh>0xFA</span><span class=p>,</span> <span class=mh>0xC3</span><span class=p>,</span> <span class=mh>0x4E</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x08</span><span class=p>,</span> <span class=mh>0x2E</span><span class=p>,</span> <span class=mh>0xA1</span><span class=p>,</span> <span class=mh>0x66</span><span class=p>,</span> <span class=mh>0x28</span><span class=p>,</span> <span class=mh>0xD9</span><span class=p>,</span> <span class=mh>0x24</span><span class=p>,</span> <span class=mh>0xB2</span><span class=p>,</span> <span class=mh>0x76</span><span class=p>,</span> <span class=mh>0x5B</span><span class=p>,</span> <span class=mh>0xA2</span><span class=p>,</span> <span class=mh>0x49</span><span class=p>,</span> <span class=mh>0x6D</span><span class=p>,</span> <span class=mh>0x8B</span><span class=p>,</span> <span class=mh>0xD1</span><span class=p>,</span> <span class=mh>0x25</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x72</span><span class=p>,</span> <span class=mh>0xF8</span><span class=p>,</span> <span class=mh>0xF6</span><span class=p>,</span> <span class=mh>0x64</span><span class=p>,</span> <span class=mh>0x86</span><span class=p>,</span> <span class=mh>0x68</span><span class=p>,</span> <span class=mh>0x98</span><span class=p>,</span> <span class=mh>0x16</span><span class=p>,</span> <span class=mh>0xD4</span><span class=p>,</span> <span class=mh>0xA4</span><span class=p>,</span> <span class=mh>0x5C</span><span class=p>,</span> <span class=mh>0xCC</span><span class=p>,</span> <span class=mh>0x5D</span><span class=p>,</span> <span class=mh>0x65</span><span class=p>,</span> <span class=mh>0xB6</span><span class=p>,</span> <span class=mh>0x92</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x6C</span><span class=p>,</span> <span class=mh>0x70</span><span class=p>,</span> <span class=mh>0x48</span><span class=p>,</span> <span class=mh>0x50</span><span class=p>,</span> <span class=mh>0xFD</span><span class=p>,</span> <span class=mh>0xED</span><span class=p>,</span> <span class=mh>0xB9</span><span class=p>,</span> <span class=mh>0xDA</span><span class=p>,</span> <span class=mh>0x5E</span><span class=p>,</span> <span class=mh>0x15</span><span class=p>,</span> <span class=mh>0x46</span><span class=p>,</span> <span class=mh>0x57</span><span class=p>,</span> <span class=mh>0xA7</span><span class=p>,</span> <span class=mh>0x8D</span><span class=p>,</span> <span class=mh>0x9D</span><span class=p>,</span> <span class=mh>0x84</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x90</span><span class=p>,</span> <span class=mh>0xD8</span><span class=p>,</span> <span class=mh>0xAB</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x8C</span><span class=p>,</span> <span class=mh>0xBC</span><span class=p>,</span> <span class=mh>0xD3</span><span class=p>,</span> <span class=mh>0x0A</span><span class=p>,</span> <span class=mh>0xF7</span><span class=p>,</span> <span class=mh>0xE4</span><span class=p>,</span> <span class=mh>0x58</span><span class=p>,</span> <span class=mh>0x05</span><span class=p>,</span> <span class=mh>0xB8</span><span class=p>,</span> <span class=mh>0xB3</span><span class=p>,</span> <span class=mh>0x45</span><span class=p>,</span> <span class=mh>0x06</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xD0</span><span class=p>,</span> <span class=mh>0x2C</span><span class=p>,</span> <span class=mh>0x1E</span><span class=p>,</span> <span class=mh>0x8F</span><span class=p>,</span> <span class=mh>0xCA</span><span class=p>,</span> <span class=mh>0x3F</span><span class=p>,</span> <span class=mh>0x0F</span><span class=p>,</span> <span class=mh>0x02</span><span class=p>,</span> <span class=mh>0xC1</span><span class=p>,</span> <span class=mh>0xAF</span><span class=p>,</span> <span class=mh>0xBD</span><span class=p>,</span> <span class=mh>0x03</span><span class=p>,</span> <span class=mh>0x01</span><span class=p>,</span> <span class=mh>0x13</span><span class=p>,</span> <span class=mh>0x8A</span><span class=p>,</span> <span class=mh>0x6B</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x3A</span><span class=p>,</span> <span class=mh>0x91</span><span class=p>,</span> <span class=mh>0x11</span><span class=p>,</span> <span class=mh>0x41</span><span class=p>,</span> <span class=mh>0x4F</span><span class=p>,</span> <span class=mh>0x67</span><span class=p>,</span> <span class=mh>0xDC</span><span class=p>,</span> <span class=mh>0xEA</span><span class=p>,</span> <span class=mh>0x97</span><span class=p>,</span> <span class=mh>0xF2</span><span class=p>,</span> <span class=mh>0xCF</span><span class=p>,</span> <span class=mh>0xCE</span><span class=p>,</span> <span class=mh>0xF0</span><span class=p>,</span> <span class=mh>0xB4</span><span class=p>,</span> <span class=mh>0xE6</span><span class=p>,</span> <span class=mh>0x73</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x96</span><span class=p>,</span> <span class=mh>0xAC</span><span class=p>,</span> <span class=mh>0x74</span><span class=p>,</span> <span class=mh>0x22</span><span class=p>,</span> <span class=mh>0xE7</span><span class=p>,</span> <span class=mh>0xAD</span><span class=p>,</span> <span class=mh>0x35</span><span class=p>,</span> <span class=mh>0x85</span><span class=p>,</span> <span class=mh>0xE2</span><span class=p>,</span> <span class=mh>0xF9</span><span class=p>,</span> <span class=mh>0x37</span><span class=p>,</span> <span class=mh>0xE8</span><span class=p>,</span> <span class=mh>0x1C</span><span class=p>,</span> <span class=mh>0x75</span><span class=p>,</span> <span class=mh>0xDF</span><span class=p>,</span> <span class=mh>0x6E</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x47</span><span class=p>,</span> <span class=mh>0xF1</span><span class=p>,</span> <span class=mh>0x1A</span><span class=p>,</span> <span class=mh>0x71</span><span class=p>,</span> <span class=mh>0x1D</span><span class=p>,</span> <span class=mh>0x29</span><span class=p>,</span> <span class=mh>0xC5</span><span class=p>,</span> <span class=mh>0x89</span><span class=p>,</span> <span class=mh>0x6F</span><span class=p>,</span> <span class=mh>0xB7</span><span class=p>,</span> <span class=mh>0x62</span><span class=p>,</span> <span class=mh>0x0E</span><span class=p>,</span> <span class=mh>0xAA</span><span class=p>,</span> <span class=mh>0x18</span><span class=p>,</span> <span class=mh>0xBE</span><span class=p>,</span> <span class=mh>0x1B</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xFC</span><span class=p>,</span> <span class=mh>0x56</span><span class=p>,</span> <span class=mh>0x3E</span><span class=p>,</span> <span class=mh>0x4B</span><span class=p>,</span> <span class=mh>0xC6</span><span class=p>,</span> <span class=mh>0xD2</span><span class=p>,</span> <span class=mh>0x79</span><span class=p>,</span> <span class=mh>0x20</span><span class=p>,</span> <span class=mh>0x9A</span><span class=p>,</span> <span class=mh>0xDB</span><span class=p>,</span> <span class=mh>0xC0</span><span class=p>,</span> <span class=mh>0xFE</span><span class=p>,</span> <span class=mh>0x78</span><span class=p>,</span> <span class=mh>0xCD</span><span class=p>,</span> <span class=mh>0x5A</span><span class=p>,</span> <span class=mh>0xF4</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x1F</span><span class=p>,</span> <span class=mh>0xDD</span><span class=p>,</span> <span class=mh>0xA8</span><span class=p>,</span> <span class=mh>0x33</span><span class=p>,</span> <span class=mh>0x88</span><span class=p>,</span> <span class=mh>0x07</span><span class=p>,</span> <span class=mh>0xC7</span><span class=p>,</span> <span class=mh>0x31</span><span class=p>,</span> <span class=mh>0xB1</span><span class=p>,</span> <span class=mh>0x12</span><span class=p>,</span> <span class=mh>0x10</span><span class=p>,</span> <span class=mh>0x59</span><span class=p>,</span> <span class=mh>0x27</span><span class=p>,</span> <span class=mh>0x80</span><span class=p>,</span> <span class=mh>0xEC</span><span class=p>,</span> <span class=mh>0x5F</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x60</span><span class=p>,</span> <span class=mh>0x51</span><span class=p>,</span> <span class=mh>0x7F</span><span class=p>,</span> <span class=mh>0xA9</span><span class=p>,</span> <span class=mh>0x19</span><span class=p>,</span> <span class=mh>0xB5</span><span class=p>,</span> <span class=mh>0x4A</span><span class=p>,</span> <span class=mh>0x0D</span><span class=p>,</span> <span class=mh>0x2D</span><span class=p>,</span> <span class=mh>0xE5</span><span class=p>,</span> <span class=mh>0x7A</span><span class=p>,</span> <span class=mh>0x9F</span><span class=p>,</span> <span class=mh>0x93</span><span class=p>,</span> <span class=mh>0xC9</span><span class=p>,</span> <span class=mh>0x9C</span><span class=p>,</span> <span class=mh>0xEF</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xA0</span><span class=p>,</span> <span class=mh>0xE0</span><span class=p>,</span> <span class=mh>0x3B</span><span class=p>,</span> <span class=mh>0x4D</span><span class=p>,</span> <span class=mh>0xAE</span><span class=p>,</span> <span class=mh>0x2A</span><span class=p>,</span> <span class=mh>0xF5</span><span class=p>,</span> <span class=mh>0xB0</span><span class=p>,</span> <span class=mh>0xC8</span><span class=p>,</span> <span class=mh>0xEB</span><span class=p>,</span> <span class=mh>0xBB</span><span class=p>,</span> <span class=mh>0x3C</span><span class=p>,</span> <span class=mh>0x83</span><span class=p>,</span> <span class=mh>0x53</span><span class=p>,</span> <span class=mh>0x99</span><span class=p>,</span> <span class=mh>0x61</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x17</span><span class=p>,</span> <span class=mh>0x2B</span><span class=p>,</span> <span class=mh>0x04</span><span class=p>,</span> <span class=mh>0x7E</span><span class=p>,</span> <span class=mh>0xBA</span><span class=p>,</span> <span class=mh>0x77</span><span class=p>,</span> <span class=mh>0xD6</span><span class=p>,</span> <span class=mh>0x26</span><span class=p>,</span> <span class=mh>0xE1</span><span class=p>,</span> <span class=mh>0x69</span><span class=p>,</span> <span class=mh>0x14</span><span class=p>,</span> <span class=mh>0x63</span><span class=p>,</span> <span class=mh>0x55</span><span class=p>,</span> <span class=mh>0x21</span><span class=p>,</span> <span class=mh>0x0C</span><span class=p>,</span> <span class=mh>0x7D</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>sub_bytes</span><span class=p>(</span><span class=n>s</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>4</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>4</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=n>s_box</span><span class=p>[</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>inv_sub_bytes</span><span class=p>(</span><span class=n>s</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>4</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>4</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=n>inv_s_box</span><span class=p>[</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>shift_rows</span><span class=p>(</span><span class=n>s</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>2</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>3</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>s</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>2</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>3</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>2</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=mi>2</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>2</span><span class=p>][</span><span class=mi>2</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>3</span><span class=p>][</span><span class=mi>2</span><span class=p>]</span> <span class=o>=</span> <span class=n>s</span><span class=p>[</span><span class=mi>2</span><span class=p>][</span><span class=mi>2</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>3</span><span class=p>][</span><span class=mi>2</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>2</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=mi>2</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>3</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=mi>3</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>2</span><span class=p>][</span><span class=mi>3</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>3</span><span class=p>][</span><span class=mi>3</span><span class=p>]</span> <span class=o>=</span> <span class=n>s</span><span class=p>[</span><span class=mi>3</span><span class=p>][</span><span class=mi>3</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>3</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=mi>3</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>2</span><span class=p>][</span><span class=mi>3</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>inv_shift_rows</span><span class=p>(</span><span class=n>s</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>2</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>3</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>s</span><span class=p>[</span><span class=mi>3</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>2</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>2</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=mi>2</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>2</span><span class=p>][</span><span class=mi>2</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>3</span><span class=p>][</span><span class=mi>2</span><span class=p>]</span> <span class=o>=</span> <span class=n>s</span><span class=p>[</span><span class=mi>2</span><span class=p>][</span><span class=mi>2</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>3</span><span class=p>][</span><span class=mi>2</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>2</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=mi>2</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>3</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=mi>3</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>2</span><span class=p>][</span><span class=mi>3</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>3</span><span class=p>][</span><span class=mi>3</span><span class=p>]</span> <span class=o>=</span> <span class=n>s</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=mi>3</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>2</span><span class=p>][</span><span class=mi>3</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>3</span><span class=p>][</span><span class=mi>3</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>3</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>add_round_key</span><span class=p>(</span><span class=n>s</span><span class=p>,</span> <span class=n>k</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>4</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>4</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span> <span class=o>^=</span> <span class=n>k</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># learned from https://web.archive.org/web/20100626212235/http://cs.ucsb.edu/~koc/cs178/projects/JT/aes.c</span>
</span></span><span class=line><span class=cl><span class=n>xtime</span> <span class=o>=</span> <span class=k>lambda</span> <span class=n>a</span><span class=p>:</span> <span class=p>(((</span><span class=n>a</span> <span class=o>&lt;&lt;</span> <span class=mi>1</span><span class=p>)</span> <span class=o>^</span> <span class=mh>0x1B</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0xFF</span><span class=p>)</span> <span class=k>if</span> <span class=p>(</span><span class=n>a</span> <span class=o>&amp;</span> <span class=mh>0x80</span><span class=p>)</span> <span class=k>else</span> <span class=p>(</span><span class=n>a</span> <span class=o>&lt;&lt;</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>mix_single_column</span><span class=p>(</span><span class=n>a</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># see Sec 4.1.2 in The Design of Rijndael</span>
</span></span><span class=line><span class=cl>    <span class=n>t</span> <span class=o>=</span> <span class=n>a</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>^</span> <span class=n>a</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>^</span> <span class=n>a</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>^</span> <span class=n>a</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>u</span> <span class=o>=</span> <span class=n>a</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>a</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>^=</span> <span class=n>t</span> <span class=o>^</span> <span class=n>xtime</span><span class=p>(</span><span class=n>a</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>^</span> <span class=n>a</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>a</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>^=</span> <span class=n>t</span> <span class=o>^</span> <span class=n>xtime</span><span class=p>(</span><span class=n>a</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>^</span> <span class=n>a</span><span class=p>[</span><span class=mi>2</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>a</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>^=</span> <span class=n>t</span> <span class=o>^</span> <span class=n>xtime</span><span class=p>(</span><span class=n>a</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>^</span> <span class=n>a</span><span class=p>[</span><span class=mi>3</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>a</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>^=</span> <span class=n>t</span> <span class=o>^</span> <span class=n>xtime</span><span class=p>(</span><span class=n>a</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>^</span> <span class=n>u</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>mix_columns</span><span class=p>(</span><span class=n>s</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>4</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>mix_single_column</span><span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>inv_mix_columns</span><span class=p>(</span><span class=n>s</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># see Sec 4.1.3 in The Design of Rijndael</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>4</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>u</span> <span class=o>=</span> <span class=n>xtime</span><span class=p>(</span><span class=n>xtime</span><span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span> <span class=o>^</span> <span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=mi>2</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>        <span class=n>v</span> <span class=o>=</span> <span class=n>xtime</span><span class=p>(</span><span class=n>xtime</span><span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span> <span class=o>^</span> <span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=mi>3</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>        <span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span> <span class=o>^=</span> <span class=n>u</span>
</span></span><span class=line><span class=cl>        <span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span> <span class=o>^=</span> <span class=n>v</span>
</span></span><span class=line><span class=cl>        <span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=mi>2</span><span class=p>]</span> <span class=o>^=</span> <span class=n>u</span>
</span></span><span class=line><span class=cl>        <span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=mi>3</span><span class=p>]</span> <span class=o>^=</span> <span class=n>v</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>mix_columns</span><span class=p>(</span><span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>r_con</span> <span class=o>=</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x01</span><span class=p>,</span> <span class=mh>0x02</span><span class=p>,</span> <span class=mh>0x04</span><span class=p>,</span> <span class=mh>0x08</span><span class=p>,</span> <span class=mh>0x10</span><span class=p>,</span> <span class=mh>0x20</span><span class=p>,</span> <span class=mh>0x40</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x80</span><span class=p>,</span> <span class=mh>0x1B</span><span class=p>,</span> <span class=mh>0x36</span><span class=p>,</span> <span class=mh>0x6C</span><span class=p>,</span> <span class=mh>0xD8</span><span class=p>,</span> <span class=mh>0xAB</span><span class=p>,</span> <span class=mh>0x4D</span><span class=p>,</span> <span class=mh>0x9A</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x2F</span><span class=p>,</span> <span class=mh>0x5E</span><span class=p>,</span> <span class=mh>0xBC</span><span class=p>,</span> <span class=mh>0x63</span><span class=p>,</span> <span class=mh>0xC6</span><span class=p>,</span> <span class=mh>0x97</span><span class=p>,</span> <span class=mh>0x35</span><span class=p>,</span> <span class=mh>0x6A</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xD4</span><span class=p>,</span> <span class=mh>0xB3</span><span class=p>,</span> <span class=mh>0x7D</span><span class=p>,</span> <span class=mh>0xFA</span><span class=p>,</span> <span class=mh>0xEF</span><span class=p>,</span> <span class=mh>0xC5</span><span class=p>,</span> <span class=mh>0x91</span><span class=p>,</span> <span class=mh>0x39</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>bytes2matrix</span><span class=p>(</span><span class=n>text</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Converts a 16-byte array into a 4x4 matrix.  &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>[</span><span class=nb>list</span><span class=p>(</span><span class=n>text</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span><span class=o>+</span><span class=mi>4</span><span class=p>])</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>text</span><span class=p>),</span> <span class=mi>4</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>matrix2bytes</span><span class=p>(</span><span class=n>matrix</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Converts a 4x4 matrix into a 16-byte array.  &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>bytes</span><span class=p>(</span><span class=nb>sum</span><span class=p>(</span><span class=n>matrix</span><span class=p>,</span> <span class=p>[]))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>xor_bytes</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Returns a new byte array with the elements xor&#39;ed. &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>i</span><span class=o>^</span><span class=n>j</span> <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>inc_bytes</span><span class=p>(</span><span class=n>a</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Returns a new byte array with the value increment by 1 &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>out</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>a</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>reversed</span><span class=p>(</span><span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>out</span><span class=p>))):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>out</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>==</span> <span class=mh>0xFF</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>out</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>out</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>out</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>pad</span><span class=p>(</span><span class=n>plaintext</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Pads the given plaintext with PKCS#7 padding to a multiple of 16 bytes.
</span></span></span><span class=line><span class=cl><span class=s2>    Note that if the plaintext size is a multiple of 16,
</span></span></span><span class=line><span class=cl><span class=s2>    a whole block will be added.
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>padding_len</span> <span class=o>=</span> <span class=mi>16</span> <span class=o>-</span> <span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>plaintext</span><span class=p>)</span> <span class=o>%</span> <span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>padding</span> <span class=o>=</span> <span class=nb>bytes</span><span class=p>([</span><span class=n>padding_len</span><span class=p>]</span> <span class=o>*</span> <span class=n>padding_len</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>plaintext</span> <span class=o>+</span> <span class=n>padding</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>unpad</span><span class=p>(</span><span class=n>plaintext</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Removes a PKCS#7 padding, returning the unpadded text and ensuring the
</span></span></span><span class=line><span class=cl><span class=s2>    padding was correct.
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>padding_len</span> <span class=o>=</span> <span class=n>plaintext</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>padding_len</span> <span class=o>&gt;</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=n>message</span><span class=p>,</span> <span class=n>padding</span> <span class=o>=</span> <span class=n>plaintext</span><span class=p>[:</span><span class=o>-</span><span class=n>padding_len</span><span class=p>],</span> <span class=n>plaintext</span><span class=p>[</span><span class=o>-</span><span class=n>padding_len</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>all</span><span class=p>(</span><span class=n>p</span> <span class=o>==</span> <span class=n>padding_len</span> <span class=k>for</span> <span class=n>p</span> <span class=ow>in</span> <span class=n>padding</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>message</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>split_blocks</span><span class=p>(</span><span class=n>message</span><span class=p>,</span> <span class=n>block_size</span><span class=o>=</span><span class=mi>16</span><span class=p>,</span> <span class=n>require_padding</span><span class=o>=</span><span class=kc>True</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>message</span><span class=p>)</span> <span class=o>%</span> <span class=n>block_size</span> <span class=o>==</span> <span class=mi>0</span> <span class=ow>or</span> <span class=ow>not</span> <span class=n>require_padding</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>[</span><span class=n>message</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span><span class=o>+</span><span class=mi>16</span><span class=p>]</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>message</span><span class=p>),</span> <span class=n>block_size</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>AES</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Class for AES-128 encryption with CBC mode and PKCS#7.
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    This is a raw implementation of AES, without key stretching or IV
</span></span></span><span class=line><span class=cl><span class=s2>    management. Unless you need that, please use `encrypt` and `decrypt`.
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>rounds_by_key_size</span> <span class=o>=</span> <span class=p>{</span><span class=mi>16</span><span class=p>:</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>24</span><span class=p>:</span> <span class=mi>12</span><span class=p>,</span> <span class=mi>32</span><span class=p>:</span> <span class=mi>14</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>master_key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        Initializes the object with a given key.
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>master_key</span><span class=p>)</span> <span class=ow>in</span> <span class=n>AES</span><span class=o>.</span><span class=n>rounds_by_key_size</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>n_rounds</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>rounds_by_key_size</span><span class=p>[</span><span class=nb>len</span><span class=p>(</span><span class=n>master_key</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_key_matrices</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_expand_key</span><span class=p>(</span><span class=n>master_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_expand_key</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>master_key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        Expands and returns a list of key matrices for the given master_key.
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># Initialize round keys with raw key material.</span>
</span></span><span class=line><span class=cl>        <span class=n>key_columns</span> <span class=o>=</span> <span class=n>bytes2matrix</span><span class=p>(</span><span class=n>master_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>iteration_size</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>master_key</span><span class=p>)</span> <span class=o>//</span> <span class=mi>4</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>i</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=nb>len</span><span class=p>(</span><span class=n>key_columns</span><span class=p>)</span> <span class=o>&lt;</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>n_rounds</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=mi>4</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># Copy previous word.</span>
</span></span><span class=line><span class=cl>            <span class=n>word</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>key_columns</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1># Perform schedule_core once every &#34;row&#34;.</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>key_columns</span><span class=p>)</span> <span class=o>%</span> <span class=n>iteration_size</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># Circular shift.</span>
</span></span><span class=line><span class=cl>                <span class=n>word</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>word</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=mi>0</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                <span class=c1># Map to S-BOX.</span>
</span></span><span class=line><span class=cl>                <span class=n>word</span> <span class=o>=</span> <span class=p>[</span><span class=n>s_box</span><span class=p>[</span><span class=n>b</span><span class=p>]</span> <span class=k>for</span> <span class=n>b</span> <span class=ow>in</span> <span class=n>word</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                <span class=c1># XOR with first byte of R-CON, since the others bytes of R-CON are 0.</span>
</span></span><span class=line><span class=cl>                <span class=n>word</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>^=</span> <span class=n>r_con</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                <span class=n>i</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            <span class=k>elif</span> <span class=nb>len</span><span class=p>(</span><span class=n>master_key</span><span class=p>)</span> <span class=o>==</span> <span class=mi>32</span> <span class=ow>and</span> <span class=nb>len</span><span class=p>(</span><span class=n>key_columns</span><span class=p>)</span> <span class=o>%</span> <span class=n>iteration_size</span> <span class=o>==</span> <span class=mi>4</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># Run word through S-box in the fourth iteration when using a</span>
</span></span><span class=line><span class=cl>                <span class=c1># 256-bit key.</span>
</span></span><span class=line><span class=cl>                <span class=n>word</span> <span class=o>=</span> <span class=p>[</span><span class=n>s_box</span><span class=p>[</span><span class=n>b</span><span class=p>]</span> <span class=k>for</span> <span class=n>b</span> <span class=ow>in</span> <span class=n>word</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1># XOR with equivalent word from previous iteration.</span>
</span></span><span class=line><span class=cl>            <span class=n>word</span> <span class=o>=</span> <span class=n>xor_bytes</span><span class=p>(</span><span class=n>word</span><span class=p>,</span> <span class=n>key_columns</span><span class=p>[</span><span class=o>-</span><span class=n>iteration_size</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            <span class=n>key_columns</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>word</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Group key words in 4x4 byte matrices.</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>[</span><span class=n>key_columns</span><span class=p>[</span><span class=mi>4</span><span class=o>*</span><span class=n>i</span> <span class=p>:</span> <span class=mi>4</span><span class=o>*</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>)]</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>key_columns</span><span class=p>)</span> <span class=o>//</span> <span class=mi>4</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>encrypt_block</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>plaintext</span><span class=p>,</span> <span class=n>step</span><span class=o>=</span><span class=p>[</span><span class=n>add_round_key</span><span class=p>,</span> <span class=n>sub_bytes</span><span class=p>,</span> <span class=n>shift_rows</span><span class=p>,</span> <span class=n>mix_columns</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        Encrypts a single block of 16 byte long plaintext.
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>plaintext</span><span class=p>)</span> <span class=o>==</span> <span class=mi>16</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>plain_state</span> <span class=o>=</span> <span class=n>bytes2matrix</span><span class=p>(</span><span class=n>plaintext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>step</span><span class=p>[</span><span class=mi>0</span><span class=p>](</span><span class=n>plain_state</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>_key_matrices</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>n_rounds</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>step</span><span class=p>[</span><span class=mi>1</span><span class=p>](</span><span class=n>plain_state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>step</span><span class=p>[</span><span class=mi>2</span><span class=p>](</span><span class=n>plain_state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>step</span><span class=p>[</span><span class=mi>3</span><span class=p>](</span><span class=n>plain_state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>step</span><span class=p>[</span><span class=mi>0</span><span class=p>](</span><span class=n>plain_state</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>_key_matrices</span><span class=p>[</span><span class=n>i</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>step</span><span class=p>[</span><span class=mi>1</span><span class=p>](</span><span class=n>plain_state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>step</span><span class=p>[</span><span class=mi>2</span><span class=p>](</span><span class=n>plain_state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>step</span><span class=p>[</span><span class=mi>0</span><span class=p>](</span><span class=n>plain_state</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>_key_matrices</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>matrix2bytes</span><span class=p>(</span><span class=n>plain_state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>encrypt</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>plaintext</span><span class=p>,</span> <span class=n>step</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>plaintext</span> <span class=o>=</span> <span class=n>pad</span><span class=p>(</span><span class=n>plaintext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>ciphertext</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>block</span> <span class=ow>in</span> <span class=n>split_blocks</span><span class=p>(</span><span class=n>plaintext</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>ciphertext_block</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>encrypt_block</span><span class=p>(</span><span class=n>block</span><span class=p>,</span> <span class=n>step</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>ciphertext</span> <span class=o>+=</span> <span class=n>ciphertext_block</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>ciphertext</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># chall.py</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>aes</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>dumb_step</span><span class=p>(</span><span class=n>s</span><span class=p>,</span> <span class=n>key</span> <span class=o>=</span> <span class=kc>None</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>key</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>urandom</span><span class=p>(</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=p>(</span><span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>init_step</span> <span class=o>=</span> <span class=p>[</span><span class=n>add_round_key</span><span class=p>,</span> <span class=n>sub_bytes</span><span class=p>,</span> <span class=n>shift_rows</span><span class=p>,</span> <span class=n>mix_columns</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=nb>round</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>50</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Round </span><span class=si>{</span><span class=nb>round</span> <span class=o>+</span> <span class=mi>1</span><span class=si>}</span><span class=s2>/50&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>plaintext</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=nb>input</span><span class=p>(</span><span class=s2>&#34;&gt;&gt;&gt; &#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>plaintext</span><span class=p>)</span> <span class=o>&lt;=</span> <span class=mi>16</span> <span class=o>*</span> <span class=mi>3</span><span class=p>,</span> <span class=s2>&#34;Too long!&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>step</span> <span class=o>=</span> <span class=n>init_step</span><span class=p>[:]</span>
</span></span><span class=line><span class=cl>        <span class=n>pos</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>step</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=n>pos</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>step</span><span class=o>.</span><span class=n>insert</span><span class=p>(</span><span class=n>pos</span><span class=p>,</span> <span class=n>dumb_step</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>bit</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>cipher</span><span class=o>.</span><span class=n>encrypt</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=p>[</span><span class=n>init_step</span><span class=p>,</span> <span class=n>step</span><span class=p>][</span><span class=n>bit</span><span class=p>])</span><span class=o>.</span><span class=n>hex</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>int</span><span class=p>(</span><span class=nb>input</span><span class=p>(</span><span class=s2>&#34;&gt;&gt;&gt; &#34;</span><span class=p>))</span> <span class=o>!=</span> <span class=n>bit</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Wrong!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Correct!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Here is your flag !&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=nb>open</span><span class=p>(</span><span class=s2>&#34;WannaGame_CyberKnight/choose/flag.txt&#34;</span><span class=p>,</span> <span class=s2>&#34;r&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>())</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>Bài này đơn giản là về phần mã hóa AES (<a class=link href=https://vi.wikipedia.org/wiki/Advanced_Encryption_Standard target=_blank rel=noopener>Advanced Encryption Standard</a>) và mình có xem lại cấu trúc của nó tại wikipedia và <a class=link href=https://hackmd.io/@r1muru/HJmSbUld1x#Bringing-It-All-Together target=_blank rel=noopener>đây</a> để tiếp cận.</p></blockquote><p><img src=https://hackmd.io/_uploads/rkcm02pxex.png loading=lazy alt=image></p><h3 id=phân-tích>Phân tích:</h3><ul><li>Hàm <code>dumb_step</code> pass 1 phép biển đổi trong 4 phép cần thiết để mã hóa AES.</li><li>Server tạo 50 vòng, trong đó mỗi vòng thực thi nhiệm vụ sau:<ul><li>Nhập 1 đoạn tin có $length\le48$.</li><li>Random bỏ 1 trong 4 bước để tạo <code>step</code> mới chỉ còn 3 bước.</li><li>Random sử dụng <code>init_step</code> gồm 4 bước hay <code>step</code> để mã hóa.</li><li>In ra <code>ciphertext</code> tương ứng.</li><li>Yêu cầu nhập vào:<ul><li>0 nếu dùng <code>init_step</code> (4 bước)</li><li>1 nếu dùng <code>step</code> (3 bước)</li></ul></li></ul></li></ul><p>Bypass được 50 vòng thì ta sẽ nhận được flag.
Đề bài là vậy nên khi bắt tay vào làm và code thì mình đã giải thuật được cho 3 bước rồi nhưng còn bị kẹt lại ở phần <strong>Skip SubBytes</strong>, may sao trong lúc tìm tài liệu thì đã tìm thấy bài <a class=link href=https://wrth.medium.com/cracking-aes-without-any-one-of-its-operations-c42cdfc0452f target=_blank rel=noopener>này</a> và giải quyết được thử thách.</p><h3 id=ý-tưởng>Ý tưởng:</h3><ul><li>Chủ đích của ta là phải từ <code>plaintext</code> nhập vào và <code>ciphertext</code> tương ứng phải biết được nó đã được sử dụng bao nhiêu bước để trả về giá trị đúng trong 50 vòng.</li><li>Yêu cầu của <code>plaintext</code> là 48 bytes (tức 3 khối AES) nhưng nếu để ý kỹ thì nó được <code>padding</code> trước khi mã hóa nên nếu gửi đủ 48 bytes thì <code>plaintext</code> sẽ thêm khối thứ 4 là
<code>b'\x10' * 16</code> và đây cũng là dữ kiện quan trọng để giải bài này.</li><li>Để cho mạch suy nghĩ trôi chảy và dễ code thì ta chia nó làm 5 trường hợp chính và giải quyết như ngay sau đây:</li></ul><ol><li>Skip AddRoundKey
<img src=https://hackmd.io/_uploads/ByNj-Caele.png loading=lazy alt=image>
Đây là phần dễ nhất mà ta chỉ cần encrypt cái <code>plaintext</code> mà mình nhập vào với thuật aes chỉ có 3 bước còn lại vì nó không còn phụ thuộc vào key. Do đó, ta không có điều kiện gì với <code>plaintext</code> nhập vào. Sau đây là script phần này:</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>encrypt_block1</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=n>step</span><span class=o>=</span><span class=p>[</span><span class=n>sub_bytes</span><span class=p>,</span> <span class=n>shift_rows</span><span class=p>,</span> <span class=n>mix_columns</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>plaintext</span><span class=p>)</span> <span class=o>==</span> <span class=mi>16</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>plain_state</span> <span class=o>=</span> <span class=n>bytes2matrix</span><span class=p>(</span><span class=n>plaintext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>n_rounds</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>step</span><span class=p>[</span><span class=mi>0</span><span class=p>](</span><span class=n>plain_state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>step</span><span class=p>[</span><span class=mi>1</span><span class=p>](</span><span class=n>plain_state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>step</span><span class=p>[</span><span class=mi>2</span><span class=p>](</span><span class=n>plain_state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>step</span><span class=p>[</span><span class=mi>0</span><span class=p>](</span><span class=n>plain_state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>step</span><span class=p>[</span><span class=mi>1</span><span class=p>](</span><span class=n>plain_state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>matrix2bytes</span><span class=p>(</span><span class=n>plain_state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>encrypt1</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=n>step</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext</span> <span class=o>=</span> <span class=n>pad</span><span class=p>(</span><span class=n>plaintext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ciphertext</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>block</span> <span class=ow>in</span> <span class=n>split_blocks</span><span class=p>(</span><span class=n>plaintext</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>ciphertext_block</span> <span class=o>=</span> <span class=n>encrypt_block1</span><span class=p>(</span><span class=n>block</span><span class=p>,</span> <span class=n>step</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>ciphertext</span> <span class=o>+=</span> <span class=n>ciphertext_block</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>ciphertext</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=c1># Skip AddRoundKey make weakest</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decrypt1</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>step</span><span class=o>=</span><span class=p>[</span><span class=n>sub_bytes</span><span class=p>,</span> <span class=n>shift_rows</span><span class=p>,</span> <span class=n>mix_columns</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>encrypt1</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=n>step</span><span class=p>)</span> <span class=o>==</span> <span class=n>ciphertext</span><span class=p>:</span> <span class=k>return</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span>
</span></span></code></pre></td></tr></table></div></div><ol start=2><li>Skip SubBytes
<img src=https://hackmd.io/_uploads/Hk9KbC6gxg.png loading=lazy alt=image>
Phần này đối với mình là thử thách nhất vì khi phân tích, mình thấy rằng bỏ <strong>SubBytes</strong> đi sẽ làm cho phần mã hóa với 3 bước còn lại trở thành các bước với chuyển đổi và ma trận khá phức tạp.
Như ta đã biết, nếu bỏ SubBytes đi thì các vòng của AES sẽ trở thành:</li></ol><p>Vòng 0: AddRoundKey</p><p>Vòng 1–9: ShiftRows, MixColumns, AddRoundKey</p><p>Vòng 10: ShiftRows, AddRoundKey</p><p>Để cho gọn thì ta đặt $S, M, k_i$ lần lượt là phép biển đổi ma trận bằng ShiftRows và MixColumns và AddRoundKey ở vòng thứ i. Sau đây là quá trình mã hóa <code>plaintext</code>($P$):</p><p>Vòng 0: $P + k_0$</p><p>Vòng 1: $M(S(P+k_0))+k_1$. Đơn giản hóa bằng cách tính $A =MS$.</p><p>Vòng 2-9: $&mldr;(A(A(A(P+k_0))+k_1)+k_2)+k_3+&mldr;$</p><p>Vòng 10: $S(&mldr;(A(A(A(P+k_0))+k_1)+k_2)+k_3+&mldr;)+k_{10}$</p><p>$=SA^9P+SA^8k_0+..Sk_9+k_{10}=SA^9P+K$</p><p>Ở cuối ta thấy là <code>plaintext</code> gắn với $SA^9=M^9S^{10}$ mà không phụ thuộc gì tới key.
Do đó, để tấn công thì ta có thể nghĩ rằng với cùng 1 key thì $K$ tính được ở trên sẽ như nhau tức là <code>ciphertext</code> đặt là $C$ sẽ cho ra 1 hằng số $K=C-SA^9P$.</p><p>Và để giải quyết phần này thì ta sẽ phải có 2 khối trong phần <code>plaintext</code> ngay trước mã hóa để chứng minh và tính $K$ bằng cách tìm được cả $SA^9$.
Với phần tính $SA^9$ thì không hề đơn giản và mình vẫn đang đọc và tìm hiểu qua bài <a class=link href=https://crypto.stackexchange.com/questions/89596/linear-aes-expression-of-k-in-aesp-apk/89607#89607 target=_blank rel=noopener>này</a>. Còn thuật toán thì mình sẽ sử dụng 1 phần của implement trong <a class=link href=https://wrth.medium.com/cracking-aes-without-any-one-of-its-operations-c42cdfc0452f target=_blank rel=noopener>bài báo</a> cho trên.</p><p>Tiếp theo là phần 2 khối trong <code>plaintext</code> thì mình chọn khối 1 và khối 4 để sử dụng với khối 1 mình đưa vào là: <code>b'\x00' * 16</code> và khối 4 mặc định là: <code>b'\x10' * 16</code>.</p><p>Script:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span><span class=lnt>90
</span><span class=lnt>91
</span><span class=lnt>92
</span><span class=lnt>93
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Skip SubBytes</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>bytes2mat</span><span class=p>(</span><span class=n>b</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>a</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>b</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>tmp</span> <span class=o>=</span> <span class=nb>bin</span><span class=p>(</span><span class=n>i</span><span class=p>)[</span><span class=mi>2</span><span class=p>:]</span><span class=o>.</span><span class=n>zfill</span><span class=p>(</span><span class=mi>8</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=n>tmp</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>a</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>j</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>Matrix</span><span class=p>(</span><span class=n>GF</span><span class=p>(</span><span class=mi>2</span><span class=p>),</span> <span class=n>a</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>mat2bytes</span><span class=p>(</span><span class=n>m</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>a</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>128</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>a</span> <span class=o>+=</span> <span class=nb>str</span><span class=p>(</span><span class=n>m</span><span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=n>i</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>a</span> <span class=o>=</span> <span class=p>[</span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span><span class=o>+</span><span class=mi>8</span><span class=p>]</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>128</span><span class=p>,</span> <span class=mi>8</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    <span class=n>a</span> <span class=o>=</span> <span class=p>[</span><span class=nb>int</span><span class=p>(</span><span class=n>i</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>a</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>a</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decrypt2</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>I</span> <span class=o>=</span> <span class=n>identity_matrix</span><span class=p>(</span><span class=n>GF</span><span class=p>(</span><span class=mi>2</span><span class=p>),</span> <span class=mi>8</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>X</span> <span class=o>=</span> <span class=n>Matrix</span><span class=p>(</span><span class=n>GF</span><span class=p>(</span><span class=mi>2</span><span class=p>),</span> <span class=mi>8</span><span class=p>,</span> <span class=mi>8</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>7</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>X</span><span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=n>X</span><span class=p>[</span><span class=mi>3</span><span class=p>,</span> <span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=n>X</span><span class=p>[</span><span class=mi>4</span><span class=p>,</span> <span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=n>X</span><span class=p>[</span><span class=mi>6</span><span class=p>,</span> <span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=n>X</span><span class=p>[</span><span class=mi>7</span><span class=p>,</span> <span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>C</span> <span class=o>=</span> <span class=n>block_matrix</span><span class=p>([</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>X</span><span class=p>,</span> <span class=n>X</span><span class=o>+</span><span class=n>I</span><span class=p>,</span> <span class=n>I</span><span class=p>,</span> <span class=n>I</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>I</span><span class=p>,</span> <span class=n>X</span><span class=p>,</span> <span class=n>X</span><span class=o>+</span><span class=n>I</span><span class=p>,</span> <span class=n>I</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>I</span><span class=p>,</span> <span class=n>I</span><span class=p>,</span> <span class=n>X</span><span class=p>,</span> <span class=n>X</span><span class=o>+</span><span class=n>I</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>X</span><span class=o>+</span><span class=n>I</span><span class=p>,</span> <span class=n>I</span><span class=p>,</span> <span class=n>I</span><span class=p>,</span> <span class=n>X</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>zeros</span> <span class=o>=</span> <span class=n>Matrix</span><span class=p>(</span><span class=n>GF</span><span class=p>(</span><span class=mi>2</span><span class=p>),</span> <span class=mi>8</span><span class=p>,</span> <span class=mi>8</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>zeros2</span> <span class=o>=</span> <span class=n>Matrix</span><span class=p>(</span><span class=n>GF</span><span class=p>(</span><span class=mi>2</span><span class=p>),</span> <span class=mi>32</span><span class=p>,</span> <span class=mi>32</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>o0</span> <span class=o>=</span> <span class=n>block_matrix</span><span class=p>([</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>I</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>o1</span> <span class=o>=</span> <span class=n>block_matrix</span><span class=p>([</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>I</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>o2</span> <span class=o>=</span> <span class=n>block_matrix</span><span class=p>([</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>I</span><span class=p>,</span> <span class=n>zeros</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>o3</span> <span class=o>=</span> <span class=n>block_matrix</span><span class=p>([</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>I</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>S</span> <span class=o>=</span> <span class=n>block_matrix</span><span class=p>([</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>o0</span><span class=p>,</span> <span class=n>o1</span><span class=p>,</span> <span class=n>o2</span><span class=p>,</span> <span class=n>o3</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>o3</span><span class=p>,</span> <span class=n>o0</span><span class=p>,</span> <span class=n>o1</span><span class=p>,</span> <span class=n>o2</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>o2</span><span class=p>,</span> <span class=n>o3</span><span class=p>,</span> <span class=n>o0</span><span class=p>,</span> <span class=n>o1</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>o1</span><span class=p>,</span> <span class=n>o2</span><span class=p>,</span> <span class=n>o3</span><span class=p>,</span> <span class=n>o0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>M</span> <span class=o>=</span> <span class=n>block_matrix</span><span class=p>([</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>C</span><span class=p>,</span> <span class=n>zeros2</span><span class=p>,</span> <span class=n>zeros2</span><span class=p>,</span> <span class=n>zeros2</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros2</span><span class=p>,</span> <span class=n>C</span><span class=p>,</span> <span class=n>zeros2</span><span class=p>,</span> <span class=n>zeros2</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros2</span><span class=p>,</span> <span class=n>zeros2</span><span class=p>,</span> <span class=n>C</span><span class=p>,</span> <span class=n>zeros2</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros2</span><span class=p>,</span> <span class=n>zeros2</span><span class=p>,</span> <span class=n>zeros2</span><span class=p>,</span> <span class=n>C</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>R</span> <span class=o>=</span> <span class=n>M</span><span class=o>*</span><span class=n>S</span>
</span></span><span class=line><span class=cl>    <span class=n>A</span> <span class=o>=</span> <span class=n>S</span><span class=o>*</span><span class=p>(</span><span class=n>R</span><span class=o>**</span><span class=mi>9</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>pt1</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span> <span class=o>*</span> <span class=mi>16</span>
</span></span><span class=line><span class=cl>    <span class=n>ct1</span> <span class=o>=</span> <span class=n>ciphertext</span><span class=p>[:</span><span class=mi>16</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>pt2</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x10</span><span class=s1>&#39;</span> <span class=o>*</span> <span class=mi>16</span>
</span></span><span class=line><span class=cl>    <span class=n>ct2</span> <span class=o>=</span> <span class=n>ciphertext</span><span class=p>[</span><span class=mi>48</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>    <span class=n>pt2</span> <span class=o>=</span> <span class=n>bytes2mat</span><span class=p>(</span><span class=n>pt2</span><span class=p>)</span><span class=o>.</span><span class=n>transpose</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>ct2</span> <span class=o>=</span> <span class=n>bytes2mat</span><span class=p>(</span><span class=n>ct2</span><span class=p>)</span><span class=o>.</span><span class=n>transpose</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>K</span> <span class=o>=</span> <span class=n>ct2</span> <span class=o>-</span> <span class=n>A</span><span class=o>*</span><span class=n>pt2</span>
</span></span><span class=line><span class=cl>    <span class=n>recv</span> <span class=o>=</span> <span class=n>mat2bytes</span><span class=p>((</span><span class=n>A</span><span class=o>.</span><span class=n>inverse</span><span class=p>()</span> <span class=o>*</span> <span class=p>(</span><span class=n>bytes2mat</span><span class=p>(</span><span class=n>ct1</span><span class=p>)</span><span class=o>.</span><span class=n>transpose</span><span class=p>()</span> <span class=o>-</span> <span class=n>K</span><span class=p>))</span><span class=o>.</span><span class=n>transpose</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>recv</span> <span class=o>==</span> <span class=n>pt1</span><span class=p>:</span> <span class=k>return</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span>
</span></span></code></pre></td></tr></table></div></div><ol start=3><li>Skip ShiftRows
<img src=https://hackmd.io/_uploads/BywObRpglx.png loading=lazy alt=image>
Khi bỏ phần này thì rõ ràng các cột sẽ luôn giữ nguyên vị trí vì khi thực hiện MixColumns xáo cột chỉ làm thay đổi được vị trí của nó chứ không phải những thành phần bên trong đó. Vì vậy ta sẽ chia 1 khối trong <code>plaintext</code> ra thành 4 block và so sánh, nghĩa là hai cặp <code>plaintext - ciphertext</code> ứng với 1 cặp block tương ứng giống nhau ở mỗi phần.
Ở đây, mình sử dụng khối 2 và khối 4 với dữ liệu là: <code>b'\x10' * 4 + b'\x30' * 12</code> và <code>b'\x10' * 16</code> rồi so sánh block đầu của <code>ciphertext</code>.
Script:</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Skip ShiftRows</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decrypt3</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>ciphertext</span><span class=p>[</span><span class=mi>16</span><span class=p>:</span><span class=mi>20</span><span class=p>]</span> <span class=o>==</span> <span class=n>ciphertext</span><span class=p>[</span><span class=mi>48</span><span class=p>:</span><span class=mi>52</span><span class=p>]:</span> <span class=k>return</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=c1># block2: b&#39;\x10&#39; * 4 + b&#39;\x30&#39; * 12</span>
</span></span><span class=line><span class=cl><span class=c1># block4: b&#39;\x10&#39; * 16</span>
</span></span></code></pre></td></tr></table></div></div><ol start=4><li>Skip MixColumns
Ở bước này, nó không những chuyển vị các cột mà còn nhân với 1 hệ số cố định $c(x)$
<img src=https://hackmd.io/_uploads/rkXPbAaele.png loading=lazy alt=image>
Do đó, khi ta bỏ bước MixColumns thì 1 khối 16 byte sẽ được mã hóa theo 16 khối khác nhau ứng với từng byte và không phụ thuộc đôi một vào nhau.
Điều này nghĩa là tồn tại 1 song ánh ứng với 1 byte của <code>plaintext</code> với 1 byte của <code>ciphertext</code> và mình bypass phần này bằng cách xét chỉ 1 byte khác nhau của 2 khối ở <code>plaintext</code> và đếm số lượng khác nhau của chúng ở <code>ciphertext</code>
Ở bài này, mình sử dụng khối 3 và khối 4 với dữ liệu là: <code>b'\x00' + b'\x10' * 15</code> và <code>b'\x10' * 16</code> rồi so sánh count của chúng.
Script:</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Skip MixColumns</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decrypt4</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>ct1</span> <span class=o>=</span> <span class=n>ciphertext</span><span class=p>[</span><span class=mi>32</span><span class=p>:</span><span class=mi>48</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>ct2</span> <span class=o>=</span> <span class=n>ciphertext</span><span class=p>[</span><span class=mi>48</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>    <span class=n>diff_count</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span><span class=n>c1</span> <span class=o>!=</span> <span class=n>c2</span> <span class=k>for</span> <span class=n>c1</span><span class=p>,</span> <span class=n>c2</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span><span class=n>ct1</span><span class=p>,</span> <span class=n>ct2</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>diff_count</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span> <span class=k>return</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=c1># block3: b&#39;\x00&#39; + b&#39;\x10&#39; * 15</span>
</span></span><span class=line><span class=cl><span class=c1># block4: b&#39;\x10&#39; * 16</span>
</span></span></code></pre></td></tr></table></div></div><p>Sau đây là script tổng hợp cả 4 phần và cũng là solution mà mình viết ra được cho chall:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># solution.py</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sage.all</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>aes</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>encrypt_block1</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=n>step</span><span class=o>=</span><span class=p>[</span><span class=n>sub_bytes</span><span class=p>,</span> <span class=n>shift_rows</span><span class=p>,</span> <span class=n>mix_columns</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>plaintext</span><span class=p>)</span> <span class=o>==</span> <span class=mi>16</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>plain_state</span> <span class=o>=</span> <span class=n>bytes2matrix</span><span class=p>(</span><span class=n>plaintext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>10</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>step</span><span class=p>[</span><span class=mi>0</span><span class=p>](</span><span class=n>plain_state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>step</span><span class=p>[</span><span class=mi>1</span><span class=p>](</span><span class=n>plain_state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>step</span><span class=p>[</span><span class=mi>2</span><span class=p>](</span><span class=n>plain_state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>step</span><span class=p>[</span><span class=mi>0</span><span class=p>](</span><span class=n>plain_state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>step</span><span class=p>[</span><span class=mi>1</span><span class=p>](</span><span class=n>plain_state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>matrix2bytes</span><span class=p>(</span><span class=n>plain_state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>encrypt1</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=n>step</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext</span> <span class=o>=</span> <span class=n>pad</span><span class=p>(</span><span class=n>plaintext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ciphertext</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>block</span> <span class=ow>in</span> <span class=n>split_blocks</span><span class=p>(</span><span class=n>plaintext</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>ciphertext_block</span> <span class=o>=</span> <span class=n>encrypt_block1</span><span class=p>(</span><span class=n>block</span><span class=p>,</span> <span class=n>step</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>ciphertext</span> <span class=o>+=</span> <span class=n>ciphertext_block</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>ciphertext</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=c1># Skip AddRoundKey make weakest</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decrypt1</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>step</span><span class=o>=</span><span class=p>[</span><span class=n>sub_bytes</span><span class=p>,</span> <span class=n>shift_rows</span><span class=p>,</span> <span class=n>mix_columns</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>encrypt1</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=n>step</span><span class=p>)</span> <span class=o>==</span> <span class=n>ciphertext</span><span class=p>:</span> <span class=k>return</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Skip SubBytes</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>bytes2mat</span><span class=p>(</span><span class=n>b</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>a</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>b</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>tmp</span> <span class=o>=</span> <span class=nb>bin</span><span class=p>(</span><span class=n>i</span><span class=p>)[</span><span class=mi>2</span><span class=p>:]</span><span class=o>.</span><span class=n>zfill</span><span class=p>(</span><span class=mi>8</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=n>tmp</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>a</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>j</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>Matrix</span><span class=p>(</span><span class=n>GF</span><span class=p>(</span><span class=mi>2</span><span class=p>),</span> <span class=n>a</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>mat2bytes</span><span class=p>(</span><span class=n>m</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>a</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>128</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>a</span> <span class=o>+=</span> <span class=nb>str</span><span class=p>(</span><span class=n>m</span><span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=n>i</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>a</span> <span class=o>=</span> <span class=p>[</span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span><span class=o>+</span><span class=mi>8</span><span class=p>]</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>128</span><span class=p>,</span> <span class=mi>8</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    <span class=n>a</span> <span class=o>=</span> <span class=p>[</span><span class=nb>int</span><span class=p>(</span><span class=n>i</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>a</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>a</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decrypt2</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>I</span> <span class=o>=</span> <span class=n>identity_matrix</span><span class=p>(</span><span class=n>GF</span><span class=p>(</span><span class=mi>2</span><span class=p>),</span> <span class=mi>8</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>X</span> <span class=o>=</span> <span class=n>Matrix</span><span class=p>(</span><span class=n>GF</span><span class=p>(</span><span class=mi>2</span><span class=p>),</span> <span class=mi>8</span><span class=p>,</span> <span class=mi>8</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>7</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>X</span><span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=n>X</span><span class=p>[</span><span class=mi>3</span><span class=p>,</span> <span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=n>X</span><span class=p>[</span><span class=mi>4</span><span class=p>,</span> <span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=n>X</span><span class=p>[</span><span class=mi>6</span><span class=p>,</span> <span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=n>X</span><span class=p>[</span><span class=mi>7</span><span class=p>,</span> <span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>C</span> <span class=o>=</span> <span class=n>block_matrix</span><span class=p>([</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>X</span><span class=p>,</span> <span class=n>X</span><span class=o>+</span><span class=n>I</span><span class=p>,</span> <span class=n>I</span><span class=p>,</span> <span class=n>I</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>I</span><span class=p>,</span> <span class=n>X</span><span class=p>,</span> <span class=n>X</span><span class=o>+</span><span class=n>I</span><span class=p>,</span> <span class=n>I</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>I</span><span class=p>,</span> <span class=n>I</span><span class=p>,</span> <span class=n>X</span><span class=p>,</span> <span class=n>X</span><span class=o>+</span><span class=n>I</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>X</span><span class=o>+</span><span class=n>I</span><span class=p>,</span> <span class=n>I</span><span class=p>,</span> <span class=n>I</span><span class=p>,</span> <span class=n>X</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>zeros</span> <span class=o>=</span> <span class=n>Matrix</span><span class=p>(</span><span class=n>GF</span><span class=p>(</span><span class=mi>2</span><span class=p>),</span> <span class=mi>8</span><span class=p>,</span> <span class=mi>8</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>zeros2</span> <span class=o>=</span> <span class=n>Matrix</span><span class=p>(</span><span class=n>GF</span><span class=p>(</span><span class=mi>2</span><span class=p>),</span> <span class=mi>32</span><span class=p>,</span> <span class=mi>32</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>o0</span> <span class=o>=</span> <span class=n>block_matrix</span><span class=p>([</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>I</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>o1</span> <span class=o>=</span> <span class=n>block_matrix</span><span class=p>([</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>I</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>o2</span> <span class=o>=</span> <span class=n>block_matrix</span><span class=p>([</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>I</span><span class=p>,</span> <span class=n>zeros</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>o3</span> <span class=o>=</span> <span class=n>block_matrix</span><span class=p>([</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>I</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>S</span> <span class=o>=</span> <span class=n>block_matrix</span><span class=p>([</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>o0</span><span class=p>,</span> <span class=n>o1</span><span class=p>,</span> <span class=n>o2</span><span class=p>,</span> <span class=n>o3</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>o3</span><span class=p>,</span> <span class=n>o0</span><span class=p>,</span> <span class=n>o1</span><span class=p>,</span> <span class=n>o2</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>o2</span><span class=p>,</span> <span class=n>o3</span><span class=p>,</span> <span class=n>o0</span><span class=p>,</span> <span class=n>o1</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>o1</span><span class=p>,</span> <span class=n>o2</span><span class=p>,</span> <span class=n>o3</span><span class=p>,</span> <span class=n>o0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>M</span> <span class=o>=</span> <span class=n>block_matrix</span><span class=p>([</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>C</span><span class=p>,</span> <span class=n>zeros2</span><span class=p>,</span> <span class=n>zeros2</span><span class=p>,</span> <span class=n>zeros2</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros2</span><span class=p>,</span> <span class=n>C</span><span class=p>,</span> <span class=n>zeros2</span><span class=p>,</span> <span class=n>zeros2</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros2</span><span class=p>,</span> <span class=n>zeros2</span><span class=p>,</span> <span class=n>C</span><span class=p>,</span> <span class=n>zeros2</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros2</span><span class=p>,</span> <span class=n>zeros2</span><span class=p>,</span> <span class=n>zeros2</span><span class=p>,</span> <span class=n>C</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>R</span> <span class=o>=</span> <span class=n>M</span><span class=o>*</span><span class=n>S</span>
</span></span><span class=line><span class=cl>    <span class=n>A</span> <span class=o>=</span> <span class=n>S</span><span class=o>*</span><span class=p>(</span><span class=n>R</span><span class=o>**</span><span class=mi>9</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>pt1</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span> <span class=o>*</span> <span class=mi>16</span>
</span></span><span class=line><span class=cl>    <span class=n>ct1</span> <span class=o>=</span> <span class=n>ciphertext</span><span class=p>[:</span><span class=mi>16</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>pt2</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x10</span><span class=s1>&#39;</span> <span class=o>*</span> <span class=mi>16</span>
</span></span><span class=line><span class=cl>    <span class=n>ct2</span> <span class=o>=</span> <span class=n>ciphertext</span><span class=p>[</span><span class=mi>48</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>    <span class=n>pt2</span> <span class=o>=</span> <span class=n>bytes2mat</span><span class=p>(</span><span class=n>pt2</span><span class=p>)</span><span class=o>.</span><span class=n>transpose</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>ct2</span> <span class=o>=</span> <span class=n>bytes2mat</span><span class=p>(</span><span class=n>ct2</span><span class=p>)</span><span class=o>.</span><span class=n>transpose</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>K</span> <span class=o>=</span> <span class=n>ct2</span> <span class=o>-</span> <span class=n>A</span><span class=o>*</span><span class=n>pt2</span>
</span></span><span class=line><span class=cl>    <span class=n>recv</span> <span class=o>=</span> <span class=n>mat2bytes</span><span class=p>((</span><span class=n>A</span><span class=o>.</span><span class=n>inverse</span><span class=p>()</span> <span class=o>*</span> <span class=p>(</span><span class=n>bytes2mat</span><span class=p>(</span><span class=n>ct1</span><span class=p>)</span><span class=o>.</span><span class=n>transpose</span><span class=p>()</span> <span class=o>-</span> <span class=n>K</span><span class=p>))</span><span class=o>.</span><span class=n>transpose</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>recv</span> <span class=o>==</span> <span class=n>pt1</span><span class=p>:</span> <span class=k>return</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Skip ShiftRows</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decrypt3</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>ciphertext</span><span class=p>[</span><span class=mi>16</span><span class=p>:</span><span class=mi>20</span><span class=p>]</span> <span class=o>==</span> <span class=n>ciphertext</span><span class=p>[</span><span class=mi>48</span><span class=p>:</span><span class=mi>52</span><span class=p>]:</span> <span class=k>return</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=c1># block2: b&#39;\x10&#39; * 4 + b&#39;\x30&#39; * 12</span>
</span></span><span class=line><span class=cl><span class=c1># block4: b&#39;\x10&#39; * 16</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Skip MixColumns</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decrypt4</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>ct1</span> <span class=o>=</span> <span class=n>ciphertext</span><span class=p>[</span><span class=mi>32</span><span class=p>:</span><span class=mi>48</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>ct2</span> <span class=o>=</span> <span class=n>ciphertext</span><span class=p>[</span><span class=mi>48</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>    <span class=n>diff_count</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span><span class=n>c1</span> <span class=o>!=</span> <span class=n>c2</span> <span class=k>for</span> <span class=n>c1</span><span class=p>,</span> <span class=n>c2</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span><span class=n>ct1</span><span class=p>,</span> <span class=n>ct2</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>diff_count</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span> <span class=k>return</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=c1># block3: b&#39;\x00&#39; + b&#39;\x10&#39; * 15</span>
</span></span><span class=line><span class=cl><span class=c1># block4: b&#39;\x10&#39; * 16</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decrypt</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>type1</span> <span class=o>=</span> <span class=n>decrypt1</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>type2</span> <span class=o>=</span> <span class=n>decrypt2</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>type3</span> <span class=o>=</span> <span class=n>decrypt3</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>type4</span> <span class=o>=</span> <span class=n>decrypt4</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>type1</span> <span class=o>|</span> <span class=n>type2</span> <span class=o>|</span> <span class=n>type3</span> <span class=o>|</span> <span class=n>type4</span> <span class=p>:</span> <span class=k>return</span> <span class=n>type1</span><span class=p>,</span> <span class=n>type2</span><span class=p>,</span> <span class=n>type3</span><span class=p>,</span> <span class=n>type4</span><span class=p>,</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>io</span> <span class=o>=</span> <span class=n>process</span><span class=p>([</span><span class=s2>&#34;python3&#34;</span><span class=p>,</span> <span class=s2>&#34;WannaGame_CyberKnight/choose/chall.py&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span> <span class=o>*</span> <span class=mi>16</span> <span class=o>+</span> <span class=p>(</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x10</span><span class=s1>&#39;</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x30</span><span class=s1>&#39;</span> <span class=o>*</span> <span class=mi>12</span><span class=p>)</span> <span class=o>+</span> <span class=p>(</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x10</span><span class=s1>&#39;</span> <span class=o>*</span> <span class=mi>15</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>50</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>recvline</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;&gt;&gt;&gt; &#34;</span><span class=p>,</span> <span class=n>data</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=n>ciphertext</span> <span class=o>=</span> <span class=n>io</span><span class=o>.</span><span class=n>recvline</span><span class=p>()</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>ct</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>type1</span><span class=p>,</span> <span class=n>type2</span><span class=p>,</span> <span class=n>type3</span><span class=p>,</span> <span class=n>type4</span><span class=p>,</span> <span class=n>bol</span> <span class=o>=</span> <span class=n>decrypt</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>ct</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>bol</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span> <span class=nb>print</span><span class=p>(</span><span class=n>type1</span><span class=p>,</span> <span class=n>type2</span><span class=p>,</span> <span class=n>type3</span><span class=p>,</span> <span class=n>type4</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;&gt;&gt;&gt; &#34;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>bol</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>recvline</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>io</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><pre><code>Flag: W1{aAESEEESaEsaAEaSesEEEsAaseseesaSSEaaASeAAESEESSSaASeAsSSAAAAeAsE_baCsDCbtqU}
</code></pre><h2 id=heartbreak>heartbreak</h2><p><img src=https://hackmd.io/_uploads/HkKwhbQbll.png loading=lazy alt=image></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># chall.py</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.number</span> <span class=kn>import</span> <span class=n>getPrime</span><span class=p>,</span> <span class=n>bytes_to_long</span>
</span></span><span class=line><span class=cl><span class=n>FLAG</span> <span class=o>=</span> <span class=s2>&#34;W1{???}&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>FLAG_PART1</span><span class=p>,</span> <span class=n>FLAG_PART2</span> <span class=o>=</span> <span class=n>FLAG</span><span class=p>[:</span><span class=nb>len</span><span class=p>(</span><span class=n>FLAG</span><span class=p>)</span><span class=o>//</span><span class=mi>2</span><span class=p>],</span> <span class=n>FLAG</span><span class=p>[</span><span class=nb>len</span><span class=p>(</span><span class=n>FLAG</span><span class=p>)</span><span class=o>//</span><span class=mi>2</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>f</span> <span class=o>=</span>  <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;output.txt&#34;</span><span class=p>,</span> <span class=s2>&#34;w&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>part1</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span> <span class=o>=</span> <span class=n>getPrime</span><span class=p>(</span><span class=mi>2048</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>q</span> <span class=o>=</span> <span class=n>getPrime</span><span class=p>(</span><span class=mi>2048</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>e</span> <span class=o>=</span> <span class=mh>0x10001</span>
</span></span><span class=line><span class=cl>    <span class=n>n</span> <span class=o>=</span> <span class=n>p</span> <span class=o>*</span> <span class=n>q</span>
</span></span><span class=line><span class=cl>    <span class=n>d</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=n>e</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=p>(</span><span class=n>p</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=p>(</span><span class=n>q</span><span class=o>-</span><span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>m</span> <span class=o>=</span> <span class=n>bytes_to_long</span><span class=p>(</span><span class=n>FLAG_PART1</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>c</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=n>m</span><span class=p>,</span> <span class=n>e</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=s2>&#34;ct = &#34;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>c</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>hints</span> <span class=o>=</span> <span class=p>[</span><span class=n>p</span><span class=p>,</span> <span class=n>q</span><span class=p>,</span> <span class=n>e</span><span class=p>,</span> <span class=n>n</span><span class=p>,</span> <span class=n>d</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>hints</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>        <span class=n>hints</span><span class=p>[</span><span class=n>_</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>hints</span><span class=p>[</span><span class=n>_</span><span class=p>]</span> <span class=o>*</span> <span class=n>getPrime</span><span class=p>(</span><span class=mi>1024</span><span class=p>))</span> <span class=o>%</span> <span class=n>n</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>hints</span><span class=p>[</span><span class=n>_</span><span class=p>]</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span> <span class=n>hints</span><span class=p>[</span><span class=n>_</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>hints</span><span class=p>[</span><span class=n>_</span><span class=p>]</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>%</span> <span class=n>n</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>Hints = &#34;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>hints</span><span class=p>)</span> <span class=o>+</span> <span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>part2</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>e</span> <span class=o>=</span> <span class=n>getPrime</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span> <span class=o>=</span> <span class=n>getPrime</span><span class=p>(</span><span class=mi>256</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>q</span> <span class=o>=</span> <span class=n>getPrime</span><span class=p>(</span><span class=mi>256</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>n</span> <span class=o>=</span> <span class=n>p</span> <span class=o>*</span> <span class=n>q</span>
</span></span><span class=line><span class=cl>    <span class=c1># print(e)</span>
</span></span><span class=line><span class=cl>    <span class=n>m1</span> <span class=o>=</span> <span class=n>bytes_to_long</span><span class=p>(</span><span class=n>FLAG_PART2</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=n>m2</span> <span class=o>=</span> <span class=n>m1</span> <span class=o>&gt;&gt;</span> <span class=mi>8</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>c1</span><span class=p>,</span> <span class=n>c2</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=n>m1</span><span class=p>,</span> <span class=n>e</span><span class=p>,</span> <span class=n>n</span><span class=p>),</span> <span class=nb>pow</span><span class=p>(</span><span class=n>m2</span><span class=p>,</span> <span class=n>e</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;n = </span><span class=si>{</span><span class=n>n</span><span class=si>}</span><span class=se>\n</span><span class=s2>c1 = </span><span class=si>{</span><span class=n>c1</span><span class=si>}</span><span class=se>\n</span><span class=s2>c2 = </span><span class=si>{</span><span class=n>c2</span><span class=si>}</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>part1</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>part2</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>Flag của thử thách được chia làm 2 và mã hóa bằng 2 phần khác nhau.</p><h3 id=part-1>Part 1:</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>part1</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span> <span class=o>=</span> <span class=n>getPrime</span><span class=p>(</span><span class=mi>2048</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>q</span> <span class=o>=</span> <span class=n>getPrime</span><span class=p>(</span><span class=mi>2048</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>e</span> <span class=o>=</span> <span class=mh>0x10001</span>
</span></span><span class=line><span class=cl>    <span class=n>n</span> <span class=o>=</span> <span class=n>p</span> <span class=o>*</span> <span class=n>q</span>
</span></span><span class=line><span class=cl>    <span class=n>d</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=n>e</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=p>(</span><span class=n>p</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=p>(</span><span class=n>q</span><span class=o>-</span><span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>m</span> <span class=o>=</span> <span class=n>bytes_to_long</span><span class=p>(</span><span class=n>FLAG_PART1</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>c</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=n>m</span><span class=p>,</span> <span class=n>e</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=s2>&#34;ct = &#34;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>c</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>hints</span> <span class=o>=</span> <span class=p>[</span><span class=n>p</span><span class=p>,</span> <span class=n>q</span><span class=p>,</span> <span class=n>e</span><span class=p>,</span> <span class=n>n</span><span class=p>,</span> <span class=n>d</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>hints</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>        <span class=n>hints</span><span class=p>[</span><span class=n>_</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>hints</span><span class=p>[</span><span class=n>_</span><span class=p>]</span> <span class=o>*</span> <span class=n>getPrime</span><span class=p>(</span><span class=mi>1024</span><span class=p>))</span> <span class=o>%</span> <span class=n>n</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>hints</span><span class=p>[</span><span class=n>_</span><span class=p>]</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span> <span class=n>hints</span><span class=p>[</span><span class=n>_</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>hints</span><span class=p>[</span><span class=n>_</span><span class=p>]</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>%</span> <span class=n>n</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>Hints = &#34;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>hints</span><span class=p>)</span> <span class=o>+</span> <span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>Bộ khóa RSA được gửi ra sau khi được nhân với 1 số nguyên tố 1024 bit ngẫu nhiên.</p><p>Chú ý điều kiện: <code>if hints[_] == 0: hints[_] = (hints[_] - 1) % n</code></p><p>=> Từ đây, ta có thể tính được ngay $n = hint(n) + 1$</p><p>Thêm nữa, ta có hệ phương trình:</p>$$
\begin{cases}
p = getPrime(2048) \\
q = getPrime(2048) \\
n = p * q \\
hint(p) = p * getPrime(1024)
\end{cases}
$$<p>Tức là $n$ có 4096 bit, còn <code>hint(p)</code> chỉ có 3072 bit và vì nó bé hơn $n$ nên khi lấy đồng dư thì nó sẽ không thay đổi.
Khi đó, ta hoàn toàn có thể lấy được $p$ bằng cách lấy GCD của <code>(n, hint(p))</code></p><p>Cuối cùng, ta khôi phục dữ liệu cần thiết của bộ khóa và giải mã được part 1.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>Part1</span><span class=p>():</span>
</span></span><span class=line><span class=cl>   <span class=n>e</span> <span class=o>=</span> <span class=mh>0x10001</span>
</span></span><span class=line><span class=cl>   <span class=n>ct</span> <span class=o>=</span> <span class=mi>239991743627005761506047553716973180857493049128968395824678613535924041735819278721655197652704368009118731671080782572692443257002266295841054097811995343407149181564647568019524547331554506022380795516159222363510661688595308307174873885160951837722610012918052195448795081291878933355634383798002056753336540546915811592763747343189324926404600658482137848658910189331650916354541907427173491308413908173314104508974384232290785538938623142120477030045742266779693627293755590884412082209151425384896460777577066084111556036719259982254175935197376972307183776259868229411302259648873045160120795060467866459055693698198316577983136619062944244317116994863470942099523485902299419458583301056211340627830237050622364646501838811516544340499168319955128200158195905283972429746772105746244910156671549456233908152186037286726530314472293814226978595268877619521165090870514287104577960355240428728213124348138646047728851553209042359051265045752603864312856768918350064549850618348693037041311112677351368226231458377933846664981185928405481697006968220556167073996713389716367133156065980195285148700027809062253416860922839857907535460170132744912543758918516134641462581544039400881675553681819294266618981791250077585566821053</span>
</span></span><span class=line><span class=cl>   <span class=n>Hints</span> <span class=o>=</span> <span class=p>[</span><span class=mi>1659380349228980310793195740551091998951133377142727433181233112954301485314646349955561783455759149036476737520702967988760310760312391176774501840210477308343796277178701715703164651184747756453236376960884981254635386807663657355175214655034193946682205904113897156938926175413312324159809831274187894029251371896829385517428693915588566248998565348483747234270329027561433356156355227738138379418717200316600111392671357267757409316691191187929104999221832963378673907868493499459459256894553552195468110517716115678897171373484791903085022119845347228569870830569321957438966030560930098761455953418479618027428739560761186901956751224602703471828674970337530768801203531827467185690264637238603523292728974955840936711823826949100349569805942227432262275344597592991937770320032450419910426614638156263968483514069904464463402987714698220412063100772910040673056263954301063853666792319306234733964442731206579494701823</span><span class=p>,</span> <span class=mi>2473062479389297534384652365580702456631745761133091301459488546735676124432184165907268360691972078275036508838070797476235444908532100862886958054816201240359777405719375503276188588243722655521225159899315126844306119104997283731460041142142861614319514182297180409656236066011186834375282437648078334082114411988739789392926471318552017202390239258487258487037639778148532362214152519137264282830808294108610004403460587358629486534247288993860831438267841520573973916758902637404855712721811250301202405252158590233975917681798839166192235032424495289048875626437256513981936177292903742966118351026329401662519672777610159422234703124064225710846129876359778079390437505753932101501472252131924073957349012610362952003934494293369977045255000415066563914471132856401071867358687200638320541179048296074882945411664474157308113874183763200469775985802906031999934356545932354932945475129644344782759659758587119586377699</span><span class=p>,</span> <span class=mi>10811389778781749507848369001995006527965136627134898173336798777178617924322548317218123003648199959431162146218350234488676047952720517043381973357960494027353001493321216082118308994614655309535481054291078777020047697030175144901965025751169815034274454689657181813765988172412194436669592236745329922983348687</span><span class=p>,</span> <span class=mi>302270795345262652787049603034608860428203534578338699389744017410286806560707153186173595970011317749221953776227374491075684575774328458397778789729965544452010822737225229627108698874874960910965283322537095645241316756015118860396297708799504427117968454341778975073542738740964812664233075630257595196115893498655587491091126391722042679460013562303363850840912825755508680428829444388842951146482726568654418889598972824414109879370032604627990857015975495697530048397401132619555923308480516678981072029040306410523264480829688927798146165580384683689546853438820269495274502502143436234210825345362323042888891473423488116618918996618482754420372481893339222050268599796400452566639228520072261554594477336671016198833620427171498256007475831231524217372147783123617237105584613811522861590112133798309937116024168109605161059186745904038968516182034441583819409524470833832445513001764653452246905494902592731421744692331296978104865554556383417129664683066891729999411036376957753554228948901872115141778394712481069999501808719302346670855531871069366050528261442730651167165455031776639195754458920584910014448480393554851269958179362536781346169282601003523441289868134223507188615919092337658908484201829621953970243126</span><span class=p>,</span> <span class=mi>292884935929549246643624576832991010496540593142708150947518571090956754050658797955786741707549303442499542376031718493862827439931968289137063776270385766876597819025272388601563339731026897291119786098658019861515084557432779618732711248671531045529170282246847559014298960824095511448557742476351035447816620523706582563446012744989424367197536652910056457067991830630881476241325631891896455745762634189112349619740103725259844111996043190764424736601828139403024375351372351763169837210283497390177391509068689722596094161210899552103572279045474893618035695053640281885367691987326728488743356438444158731410968935525788220429173044772188634219137052045984284351149340419125628533953328666109489959225736888258255952666488686965689900369280599239198825803111830614815595803322570878359992207842211026468967074229662081167123002174445268278747577520774432781623852071789431202030569577689851124794177654088403580945598530502231516822280930459410373890257129917535480957183190120541342731664708767982764672591340622307503858396934095635519503588136203556304925670734741505400274178108097309035870578129722954864083937813328351751442713938490297629659866083082398939022316220801556516785394083566880368038684968532814902807429836</span><span class=p>]</span>
</span></span><span class=line><span class=cl>   <span class=n>xp</span><span class=p>,</span> <span class=n>xn</span> <span class=o>=</span> <span class=n>Hints</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>Hints</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span>
</span></span><span class=line><span class=cl>   <span class=n>n</span> <span class=o>=</span> <span class=n>xn</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>   <span class=n>p</span> <span class=o>=</span> <span class=n>GCD</span><span class=p>(</span><span class=n>n</span><span class=p>,</span> <span class=n>xp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=n>q</span> <span class=o>=</span> <span class=n>n</span> <span class=o>//</span> <span class=n>p</span>
</span></span><span class=line><span class=cl>   <span class=n>PhiN</span> <span class=o>=</span> <span class=p>(</span><span class=n>p</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=p>(</span><span class=n>q</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=n>d</span> <span class=o>=</span> <span class=n>inverse_mod</span><span class=p>(</span><span class=n>e</span><span class=p>,</span> <span class=n>PhiN</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=n>pt</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=n>ct</span><span class=p>,</span> <span class=n>d</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=k>return</span> <span class=n>long_to_bytes</span><span class=p>(</span><span class=n>pt</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=part-2>Part 2:</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>part2</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>e</span> <span class=o>=</span> <span class=n>getPrime</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span> <span class=o>=</span> <span class=n>getPrime</span><span class=p>(</span><span class=mi>256</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>q</span> <span class=o>=</span> <span class=n>getPrime</span><span class=p>(</span><span class=mi>256</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>n</span> <span class=o>=</span> <span class=n>p</span> <span class=o>*</span> <span class=n>q</span>
</span></span><span class=line><span class=cl>    <span class=c1># print(e)</span>
</span></span><span class=line><span class=cl>    <span class=n>m1</span> <span class=o>=</span> <span class=n>bytes_to_long</span><span class=p>(</span><span class=n>FLAG_PART2</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=n>m2</span> <span class=o>=</span> <span class=n>m1</span> <span class=o>&gt;&gt;</span> <span class=mi>8</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>c1</span><span class=p>,</span> <span class=n>c2</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=n>m1</span><span class=p>,</span> <span class=n>e</span><span class=p>,</span> <span class=n>n</span><span class=p>),</span> <span class=nb>pow</span><span class=p>(</span><span class=n>m2</span><span class=p>,</span> <span class=n>e</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;n = </span><span class=si>{</span><span class=n>n</span><span class=si>}</span><span class=se>\n</span><span class=s2>c1 = </span><span class=si>{</span><span class=n>c1</span><span class=si>}</span><span class=se>\n</span><span class=s2>c2 = </span><span class=si>{</span><span class=n>c2</span><span class=si>}</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>Với $e$ nhỏ, thì ta nghĩ ngay tới <code>Low public exponent attack</code> và khi tìm hiểu thì ta thấy bài này tương đồng với kiểu <a class=link href=https://en.wikipedia.org/wiki/Coppersmith%27s_attack#Franklin%E2%80%93Reiter_related-message_attack target=_blank rel=noopener>Franklin–Reiter related-message attack</a></p><p>Cụ thể hơn, $m_2 = m _1 &#187; 8 \Leftrightarrow m_1 = m_2 * (1 &#187; 8) + k$.
Mặt khác, ta biết rằng $m_1$ là Part2 của flag tức là phần tử cuối trong 8 bit của nó khi quy về bảng mã ASCII sẽ là <code>}</code> tương đương với giá trị <code>125</code></p><p>=> $m_1=256*m_2+125$</p><p>Sau đó, ta viết lại dưới dạng đa thức $f(x)$ và $g(x)$ là:</p>$$
\begin{cases}
f(x) = x^e-c_1, f(m_1) =0 \\
g(x) = x^e-c_2, f(m_2) =0
\end{cases}
\Leftrightarrow
\begin{cases}
f(x) = (256*x+125)^e-c_1, f(m_2) =0 \\
g(x) = x^e-c_2, g(m_2) =0
\end{cases}
$$<p>Hai đa thức này có nghiệm chung là $m_2$ nên khi lấy GCD của chúng và nếu nó tuyến tính thì ta sẽ lấy được $m_2$, tính $m_1$ và lấy được Part2 của flag.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>Part2</span><span class=p>():</span>
</span></span><span class=line><span class=cl>   <span class=n>n</span> <span class=o>=</span> <span class=mi>3942322022657678598973964668297464188690492529227912763243818849286024502988170927049337618748813366973108404930787214396933140242919629931061653981563183</span>
</span></span><span class=line><span class=cl>   <span class=n>c1</span> <span class=o>=</span> <span class=mi>711628464933911477721875076362382562533209928505813633932265201230108117662370018036520970813120568151605229871541865330790006742825947411425842775387464</span>
</span></span><span class=line><span class=cl>   <span class=n>c2</span> <span class=o>=</span> <span class=mi>199593868713063917388131306750677766968978918100656918000052209242691143624414286755644005020481267183225454134184719235765273635594459821952870709463733</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   <span class=k>def</span> <span class=nf>my_gcd</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>):</span> 
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=n>a</span><span class=o>.</span><span class=n>monic</span><span class=p>()</span> <span class=k>if</span> <span class=n>b</span> <span class=o>==</span> <span class=mi>0</span> <span class=k>else</span> <span class=n>my_gcd</span><span class=p>(</span><span class=n>b</span><span class=p>,</span> <span class=n>a</span> <span class=o>%</span> <span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   <span class=n>x</span> <span class=o>=</span> <span class=n>PolynomialRing</span><span class=p>(</span><span class=n>Zmod</span><span class=p>(</span><span class=n>n</span><span class=p>),</span> <span class=s1>&#39;x&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>gen</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   <span class=k>for</span> <span class=n>e</span> <span class=ow>in</span> <span class=n>trange</span><span class=p>(</span><span class=mi>2</span><span class=o>**</span><span class=mi>9</span><span class=p>,</span> <span class=mi>2</span><span class=o>**</span><span class=mi>10</span><span class=p>):</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=ow>not</span> <span class=n>is_prime</span><span class=p>(</span><span class=n>e</span><span class=p>)</span> <span class=ow>or</span> <span class=n>e</span><span class=o>.</span><span class=n>bit_length</span><span class=p>()</span> <span class=o>!=</span> <span class=mi>10</span><span class=p>:</span>
</span></span><span class=line><span class=cl>         <span class=k>continue</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=n>fx</span> <span class=o>=</span> <span class=p>(</span><span class=mi>256</span> <span class=o>*</span> <span class=n>x</span> <span class=o>+</span> <span class=mi>125</span><span class=p>)</span> <span class=o>**</span> <span class=n>e</span> <span class=o>-</span> <span class=n>c1</span>
</span></span><span class=line><span class=cl>      <span class=n>gx</span> <span class=o>=</span> <span class=n>x</span> <span class=o>**</span> <span class=n>e</span> <span class=o>-</span> <span class=n>c2</span>
</span></span><span class=line><span class=cl>      <span class=n>sol</span> <span class=o>=</span> <span class=n>my_gcd</span><span class=p>(</span><span class=n>fx</span><span class=p>,</span> <span class=n>gx</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=n>sol</span><span class=o>.</span><span class=n>degree</span><span class=p>()</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>         <span class=n>m2</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=o>-</span><span class=n>sol</span><span class=o>.</span><span class=n>coefficients</span><span class=p>()[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>         <span class=n>m1</span> <span class=o>=</span> <span class=mi>256</span> <span class=o>*</span> <span class=n>m2</span> <span class=o>+</span> <span class=mi>125</span>
</span></span><span class=line><span class=cl>         <span class=k>return</span> <span class=n>long_to_bytes</span><span class=p>(</span><span class=n>m1</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>Script:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># solution.py</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sage.all</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.number</span> <span class=kn>import</span> <span class=n>long_to_bytes</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>tqdm</span> <span class=kn>import</span> <span class=n>trange</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Part 1</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>Part1</span><span class=p>():</span>
</span></span><span class=line><span class=cl>   <span class=n>e</span> <span class=o>=</span> <span class=mh>0x10001</span>
</span></span><span class=line><span class=cl>   <span class=n>ct</span> <span class=o>=</span> <span class=mi>239991743627005761506047553716973180857493049128968395824678613535924041735819278721655197652704368009118731671080782572692443257002266295841054097811995343407149181564647568019524547331554506022380795516159222363510661688595308307174873885160951837722610012918052195448795081291878933355634383798002056753336540546915811592763747343189324926404600658482137848658910189331650916354541907427173491308413908173314104508974384232290785538938623142120477030045742266779693627293755590884412082209151425384896460777577066084111556036719259982254175935197376972307183776259868229411302259648873045160120795060467866459055693698198316577983136619062944244317116994863470942099523485902299419458583301056211340627830237050622364646501838811516544340499168319955128200158195905283972429746772105746244910156671549456233908152186037286726530314472293814226978595268877619521165090870514287104577960355240428728213124348138646047728851553209042359051265045752603864312856768918350064549850618348693037041311112677351368226231458377933846664981185928405481697006968220556167073996713389716367133156065980195285148700027809062253416860922839857907535460170132744912543758918516134641462581544039400881675553681819294266618981791250077585566821053</span>
</span></span><span class=line><span class=cl>   <span class=n>Hints</span> <span class=o>=</span> <span class=p>[</span><span class=mi>1659380349228980310793195740551091998951133377142727433181233112954301485314646349955561783455759149036476737520702967988760310760312391176774501840210477308343796277178701715703164651184747756453236376960884981254635386807663657355175214655034193946682205904113897156938926175413312324159809831274187894029251371896829385517428693915588566248998565348483747234270329027561433356156355227738138379418717200316600111392671357267757409316691191187929104999221832963378673907868493499459459256894553552195468110517716115678897171373484791903085022119845347228569870830569321957438966030560930098761455953418479618027428739560761186901956751224602703471828674970337530768801203531827467185690264637238603523292728974955840936711823826949100349569805942227432262275344597592991937770320032450419910426614638156263968483514069904464463402987714698220412063100772910040673056263954301063853666792319306234733964442731206579494701823</span><span class=p>,</span> <span class=mi>2473062479389297534384652365580702456631745761133091301459488546735676124432184165907268360691972078275036508838070797476235444908532100862886958054816201240359777405719375503276188588243722655521225159899315126844306119104997283731460041142142861614319514182297180409656236066011186834375282437648078334082114411988739789392926471318552017202390239258487258487037639778148532362214152519137264282830808294108610004403460587358629486534247288993860831438267841520573973916758902637404855712721811250301202405252158590233975917681798839166192235032424495289048875626437256513981936177292903742966118351026329401662519672777610159422234703124064225710846129876359778079390437505753932101501472252131924073957349012610362952003934494293369977045255000415066563914471132856401071867358687200638320541179048296074882945411664474157308113874183763200469775985802906031999934356545932354932945475129644344782759659758587119586377699</span><span class=p>,</span> <span class=mi>10811389778781749507848369001995006527965136627134898173336798777178617924322548317218123003648199959431162146218350234488676047952720517043381973357960494027353001493321216082118308994614655309535481054291078777020047697030175144901965025751169815034274454689657181813765988172412194436669592236745329922983348687</span><span class=p>,</span> <span class=mi>302270795345262652787049603034608860428203534578338699389744017410286806560707153186173595970011317749221953776227374491075684575774328458397778789729965544452010822737225229627108698874874960910965283322537095645241316756015118860396297708799504427117968454341778975073542738740964812664233075630257595196115893498655587491091126391722042679460013562303363850840912825755508680428829444388842951146482726568654418889598972824414109879370032604627990857015975495697530048397401132619555923308480516678981072029040306410523264480829688927798146165580384683689546853438820269495274502502143436234210825345362323042888891473423488116618918996618482754420372481893339222050268599796400452566639228520072261554594477336671016198833620427171498256007475831231524217372147783123617237105584613811522861590112133798309937116024168109605161059186745904038968516182034441583819409524470833832445513001764653452246905494902592731421744692331296978104865554556383417129664683066891729999411036376957753554228948901872115141778394712481069999501808719302346670855531871069366050528261442730651167165455031776639195754458920584910014448480393554851269958179362536781346169282601003523441289868134223507188615919092337658908484201829621953970243126</span><span class=p>,</span> <span class=mi>292884935929549246643624576832991010496540593142708150947518571090956754050658797955786741707549303442499542376031718493862827439931968289137063776270385766876597819025272388601563339731026897291119786098658019861515084557432779618732711248671531045529170282246847559014298960824095511448557742476351035447816620523706582563446012744989424367197536652910056457067991830630881476241325631891896455745762634189112349619740103725259844111996043190764424736601828139403024375351372351763169837210283497390177391509068689722596094161210899552103572279045474893618035695053640281885367691987326728488743356438444158731410968935525788220429173044772188634219137052045984284351149340419125628533953328666109489959225736888258255952666488686965689900369280599239198825803111830614815595803322570878359992207842211026468967074229662081167123002174445268278747577520774432781623852071789431202030569577689851124794177654088403580945598530502231516822280930459410373890257129917535480957183190120541342731664708767982764672591340622307503858396934095635519503588136203556304925670734741505400274178108097309035870578129722954864083937813328351751442713938490297629659866083082398939022316220801556516785394083566880368038684968532814902807429836</span><span class=p>]</span>
</span></span><span class=line><span class=cl>   <span class=n>xp</span><span class=p>,</span> <span class=n>xn</span> <span class=o>=</span> <span class=n>Hints</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>Hints</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span>
</span></span><span class=line><span class=cl>   <span class=n>n</span> <span class=o>=</span> <span class=n>xn</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>   <span class=n>p</span> <span class=o>=</span> <span class=n>GCD</span><span class=p>(</span><span class=n>n</span><span class=p>,</span> <span class=n>xp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=n>q</span> <span class=o>=</span> <span class=n>n</span> <span class=o>//</span> <span class=n>p</span>
</span></span><span class=line><span class=cl>   <span class=n>PhiN</span> <span class=o>=</span> <span class=p>(</span><span class=n>p</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=p>(</span><span class=n>q</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=n>d</span> <span class=o>=</span> <span class=n>inverse_mod</span><span class=p>(</span><span class=n>e</span><span class=p>,</span> <span class=n>PhiN</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=n>pt</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=n>ct</span><span class=p>,</span> <span class=n>d</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=k>return</span> <span class=n>long_to_bytes</span><span class=p>(</span><span class=n>pt</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#Part 2</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>Part2</span><span class=p>():</span>
</span></span><span class=line><span class=cl>   <span class=n>n</span> <span class=o>=</span> <span class=mi>3942322022657678598973964668297464188690492529227912763243818849286024502988170927049337618748813366973108404930787214396933140242919629931061653981563183</span>
</span></span><span class=line><span class=cl>   <span class=n>c1</span> <span class=o>=</span> <span class=mi>711628464933911477721875076362382562533209928505813633932265201230108117662370018036520970813120568151605229871541865330790006742825947411425842775387464</span>
</span></span><span class=line><span class=cl>   <span class=n>c2</span> <span class=o>=</span> <span class=mi>199593868713063917388131306750677766968978918100656918000052209242691143624414286755644005020481267183225454134184719235765273635594459821952870709463733</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   <span class=k>def</span> <span class=nf>my_gcd</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>):</span> 
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=n>a</span><span class=o>.</span><span class=n>monic</span><span class=p>()</span> <span class=k>if</span> <span class=n>b</span> <span class=o>==</span> <span class=mi>0</span> <span class=k>else</span> <span class=n>my_gcd</span><span class=p>(</span><span class=n>b</span><span class=p>,</span> <span class=n>a</span> <span class=o>%</span> <span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   <span class=n>x</span> <span class=o>=</span> <span class=n>PolynomialRing</span><span class=p>(</span><span class=n>Zmod</span><span class=p>(</span><span class=n>n</span><span class=p>),</span> <span class=s1>&#39;x&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>gen</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   <span class=k>for</span> <span class=n>e</span> <span class=ow>in</span> <span class=n>trange</span><span class=p>(</span><span class=mi>2</span><span class=o>**</span><span class=mi>9</span><span class=p>,</span> <span class=mi>2</span><span class=o>**</span><span class=mi>10</span><span class=p>):</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=ow>not</span> <span class=n>is_prime</span><span class=p>(</span><span class=n>e</span><span class=p>)</span> <span class=ow>or</span> <span class=n>e</span><span class=o>.</span><span class=n>bit_length</span><span class=p>()</span> <span class=o>!=</span> <span class=mi>10</span><span class=p>:</span>
</span></span><span class=line><span class=cl>         <span class=k>continue</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=n>fx</span> <span class=o>=</span> <span class=p>(</span><span class=mi>256</span> <span class=o>*</span> <span class=n>x</span> <span class=o>+</span> <span class=mi>125</span><span class=p>)</span> <span class=o>**</span> <span class=n>e</span> <span class=o>-</span> <span class=n>c1</span>
</span></span><span class=line><span class=cl>      <span class=n>gx</span> <span class=o>=</span> <span class=n>x</span> <span class=o>**</span> <span class=n>e</span> <span class=o>-</span> <span class=n>c2</span>
</span></span><span class=line><span class=cl>      <span class=n>sol</span> <span class=o>=</span> <span class=n>my_gcd</span><span class=p>(</span><span class=n>fx</span><span class=p>,</span> <span class=n>gx</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=n>sol</span><span class=o>.</span><span class=n>degree</span><span class=p>()</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>         <span class=n>m2</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=o>-</span><span class=n>sol</span><span class=o>.</span><span class=n>coefficients</span><span class=p>()[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>         <span class=n>m1</span> <span class=o>=</span> <span class=mi>256</span> <span class=o>*</span> <span class=n>m2</span> <span class=o>+</span> <span class=mi>125</span>
</span></span><span class=line><span class=cl>         <span class=k>return</span> <span class=n>long_to_bytes</span><span class=p>(</span><span class=n>m1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>   <span class=n>PART1</span> <span class=o>=</span> <span class=n>Part1</span><span class=p>()</span>
</span></span><span class=line><span class=cl>   <span class=n>PART2</span> <span class=o>=</span> <span class=n>Part2</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=n>PART1</span> <span class=o>+</span> <span class=n>PART2</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>flag</span><span class=o>.</span><span class=n>decode</span><span class=p>())</span>
</span></span></code></pre></td></tr></table></div></div><pre><code>Flag: W1{https://www.youtube.com/results?search_query=p0lyn0m1als+9c4+is+good+isn%27t+it+?flag=tru4}
</code></pre></section><footer class=article-footer><section class=article-tags><a href=/tags/ctf/>CTF</a>
<a href=/tags/cryptography/>Cryptography</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css integrity=sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js integrity=sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8 crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector(".main-article");renderMathInElement(e,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],ignoredClasses:["gist"]})})</script></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/wannagame-nmlt/><div class=article-details><h2 class=article-title>WannaGame NMLT</h2></div></a></article><article class=has-image><a href=/p/imaginaryctf-2025/><div class=article-image><img src=/p/imaginaryctf-2025/imaginary.e9de644d192de193f46c90c0d02a4680_hu_3b6bafe821b2d8e6.jpg width=250 height=150 loading=lazy alt="Featured image of post ImaginaryCTF 2025" data-hash="md5-6d5kTRkt4ZP0bJDA0CpGgA=="></div><div class=article-details><h2 class=article-title>ImaginaryCTF 2025</h2></div></a></article><article class=has-image><a href=/p/holactf-2025/><div class=article-image><img src=/p/holactf-2025/holactf.9c863f56f24ea2049dc35dc145a8456b_hu_3189ab400ea0ac9b.jpg width=250 height=150 loading=lazy alt="Featured image of post HOLACTF 2025" data-hash="md5-nIY/VvJOogSdw13BRahFaw=="></div><div class=article-details><h2 class=article-title>HOLACTF 2025</h2></div></a></article><article class=has-image><a href=/p/nahamcon-ctf-2025/><div class=article-image><img src=/p/nahamcon-ctf-2025/Certificate.7f8c046c663f2b1fa34b68d95d010fdf_hu_bba9b22fc0efc29c.png width=250 height=150 loading=lazy alt="Featured image of post NahamCon CTF 2025" data-hash="md5-f4wEbGY/Kx+jS2jZXQEP3w=="></div><div class=article-details><h2 class=article-title>NahamCon CTF 2025</h2></div></a></article><article class=has-image><a href=/p/dicectf-2025/><div class=article-image><img src=/p/dicectf-2025/dicectf.6d8ee4df8edecb6635d487f03ca4cc4c_hu_649dec51335a5483.png width=250 height=150 loading=lazy alt="Featured image of post DiceCTF 2025" data-hash="md5-bY7k347ey2Y11IfwPKTMTA=="></div><div class=article-details><h2 class=article-title>DiceCTF 2025</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//hugo-theme-stack.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2025 r1muru</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.31.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>