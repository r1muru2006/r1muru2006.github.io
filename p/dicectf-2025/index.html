<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="Giải này mình làm được 2 bài misc và 1 bài crypto ngay phút chót @@ nên viết writeup để tổng kết lại cuối tuần này."><title>DiceCTF 2025</title><link rel=canonical href=https://r1muru2006.github.io/p/dicectf-2025/><link rel=stylesheet href=/scss/style.min.6a692fd055deae459f2a9767f57f3855ba80cafd5041317f24f7360f6ca47cdf.css><meta property='og:title' content="DiceCTF 2025"><meta property='og:description' content="Giải này mình làm được 2 bài misc và 1 bài crypto ngay phút chót @@ nên viết writeup để tổng kết lại cuối tuần này."><meta property='og:url' content='https://r1muru2006.github.io/p/dicectf-2025/'><meta property='og:site_name' content='r1muru'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='CTF'><meta property='article:tag' content='Cryptography'><meta property='article:tag' content='Miscellaneous'><meta property='article:published_time' content='2025-03-26T09:31:43+07:00'><meta property='article:modified_time' content='2025-03-26T09:31:43+07:00'><meta property='og:image' content='https://r1muru2006.github.io/p/dicectf-2025/dicectf.png'><meta name=twitter:title content="DiceCTF 2025"><meta name=twitter:description content="Giải này mình làm được 2 bài misc và 1 bài crypto ngay phút chót @@ nên viết writeup để tổng kết lại cuối tuần này."><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://r1muru2006.github.io/p/dicectf-2025/dicectf.png'><link rel="shortcut icon" href=/favicon.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/r1muru_hu_96d524052e0dfddb.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>r1muru</a></h1><h2 class=site-description>Life is not fair, get used to it!</h2></div></header><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#misc>Misc</a><ol><li><a href=#bcu-binding>bcu-binding</a></li><li><a href=#dicecap>dicecap</a></li></ol></li><li><a href=#crypto>Crypto</a><ol><li><a href=#vorpal-sword>vorpal-sword</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/p/dicectf-2025/><img src=/p/dicectf-2025/dicectf_hu_5380cb0d0a0a6980.png srcset="/p/dicectf-2025/dicectf_hu_5380cb0d0a0a6980.png 800w, /p/dicectf-2025/dicectf_hu_ba22a362d3b27e2b.png 1600w" width=800 height=265 loading=lazy alt="Featured image of post DiceCTF 2025"></a></div><div class=article-details><header class=article-category><a href=/categories/ctf-write-up/>CTF Write-Up</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/dicectf-2025/>DiceCTF 2025</a></h2><h3 class=article-subtitle>Giải này mình làm được 2 bài misc và 1 bài crypto ngay phút chót @@ nên viết writeup để tổng kết lại cuối tuần này.</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Mar 26, 2025</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>9 minute read</time></div></footer></div></header><section class=article-content><h2 id=misc>Misc</h2><h3 id=bcu-binding>bcu-binding</h3><p><img src=https://hackmd.io/_uploads/BJ2tcJv61e.png loading=lazy alt=image></p><p>Tải file về thì ta search thử &lsquo;dice{&rsquo; để tìm flag và nó ra thật @@
Có vẻ như nó được giấu trong phần nền trắng để không thể nhìn thấy&mldr;</p><p><img src=https://hackmd.io/_uploads/HyXwoyPTJx.png loading=lazy alt="Screenshot 2025-03-29 213449"></p><pre><code>Flag: dice{r3ad1ng_th4_d0cs_71ccd}
</code></pre><h3 id=dicecap>dicecap</h3><p><img src=https://hackmd.io/_uploads/SJIsi1wake.png loading=lazy alt=image></p><p>Đề cho ta 1 file pcap nên ta mở nó lên bằng wireshark và xem thử:
<img src=https://hackmd.io/_uploads/HJg7hyDTkx.png loading=lazy alt="Screenshot 2025-03-29 215831"></p><p>Thử tìm theo từ khóa thì ta ra được 2 kênh khả nghi chứa flag theo protocol FTP-DATA.
Export file ra thì ta được 1 file main theo định dạng ELF cùng 1 tệp zip cần mật khẩu mà trong đó chứa flag.txt có thể lấy flag.</p><p>File main được định dạng ELF nên ta mở IDA để đọc code của nó
<img src=https://hackmd.io/_uploads/rkmmR1Dpkg.png loading=lazy alt="Screenshot 2025-03-29 223714"></p><p>Ở đây file main khởi tạo mật khẩu và nó có thể được dùng để giải nén file zip. Đọc rõ hơn:</p><ol><li>Lấy thời gian hiện tại và làm tròn theo phút là được s</li><li>Lấy 5 ký tự đầu tiên của locale (dest)</li><li>Ghép username (v3)</li><li>Kết hợp tất cả thành mật khẩu (v6)</li></ol><p>Đầu tiên, khi ta xem lại thì gói main nằm ở No.168 và khi tra lại thì ta lấy được thời gian v1 rồi sau đó tính theo công thức để lấy s.
<img src=https://hackmd.io/_uploads/HkktlxD61x.png loading=lazy alt=image></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>v1</span> <span class=o>=</span> <span class=mi>1743126530</span>
</span></span><span class=line><span class=cl><span class=n>s</span> <span class=o>=</span> <span class=n>v1</span> <span class=o>-</span> <span class=n>v1</span> <span class=o>%</span> <span class=mi>60</span>
</span></span><span class=line><span class=cl><span class=c1># 1743126480</span>
</span></span></code></pre></td></tr></table></div></div><p>Thứ hai về locate thì ta lấy mặc định là <code>en_US.UTF-8</code> nhưng chỉ lấy 5 kí tự đầu cho dest là: <code>en_US</code></p><p>Cuối cùng, username ta sẽ có được bằng cách tìm kiếm những request được gửi lên thông qua gói tin mà ta có thể xem được và đây là kết quả:
<img src=https://hackmd.io/_uploads/r1dCpyvTke.png loading=lazy alt=image></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># solution.py</span>
</span></span><span class=line><span class=cl><span class=n>v1</span> <span class=o>=</span> <span class=mi>1743126530</span>
</span></span><span class=line><span class=cl><span class=n>s</span> <span class=o>=</span> <span class=n>v1</span> <span class=o>-</span> <span class=n>v1</span> <span class=o>%</span> <span class=mi>60</span>
</span></span><span class=line><span class=cl><span class=n>locale_str</span> <span class=o>=</span> <span class=s2>&#34;en_US&#34;</span>
</span></span><span class=line><span class=cl><span class=n>username</span> <span class=o>=</span> <span class=s2>&#34;hacker&#34;</span>
</span></span><span class=line><span class=cl><span class=n>password</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>s</span><span class=si>}{</span><span class=n>locale_str</span><span class=si>}{</span><span class=n>username</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>password</span><span class=p>)</span> <span class=c1>#1743126480en_UShacker</span>
</span></span></code></pre></td></tr></table></div></div><p>Giải nén file zip và lấy flag thôi:</p><p><img src=https://hackmd.io/_uploads/Bkm0GxDTyl.png loading=lazy alt=image></p><pre><code>Flag: dice{5k1d_y0ur_w@y_t0_v1ct0ry_t0d4y!!!}
</code></pre><h2 id=crypto>Crypto</h2><h3 id=vorpal-sword>vorpal-sword</h3><p><img src=https://hackmd.io/_uploads/SkrisLv6yx.png loading=lazy alt=image></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># server.py</span>
</span></span><span class=line><span class=cl><span class=c1>#!/usr/local/bin/python</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>secrets</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.PublicKey</span> <span class=kn>import</span> <span class=n>RSA</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>DEATH_CAUSES</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;a fever&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;dysentery&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;measles&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;cholera&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;typhoid&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;exhaustion&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;a snakebite&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;a broken leg&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;a broken arm&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;drowning&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>run_ot</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>msg0</span><span class=p>,</span> <span class=n>msg1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    https://en.wikipedia.org/wiki/Oblivious_transfer#1–2_oblivious_transfer
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>x0</span> <span class=o>=</span> <span class=n>secrets</span><span class=o>.</span><span class=n>randbelow</span><span class=p>(</span><span class=n>key</span><span class=o>.</span><span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>x1</span> <span class=o>=</span> <span class=n>secrets</span><span class=o>.</span><span class=n>randbelow</span><span class=p>(</span><span class=n>key</span><span class=o>.</span><span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;n: </span><span class=si>{</span><span class=n>key</span><span class=o>.</span><span class=n>n</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;e: </span><span class=si>{</span><span class=n>key</span><span class=o>.</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;x0: </span><span class=si>{</span><span class=n>x0</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;x1: </span><span class=si>{</span><span class=n>x1</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>v</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=nb>input</span><span class=p>(</span><span class=s2>&#34;v: &#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=mi>0</span> <span class=o>&lt;=</span> <span class=n>v</span> <span class=o>&lt;</span> <span class=n>key</span><span class=o>.</span><span class=n>n</span><span class=p>,</span> <span class=s2>&#34;invalid value&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>k0</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=n>v</span> <span class=o>-</span> <span class=n>x0</span><span class=p>,</span> <span class=n>key</span><span class=o>.</span><span class=n>d</span><span class=p>,</span> <span class=n>key</span><span class=o>.</span><span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>k1</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=n>v</span> <span class=o>-</span> <span class=n>x1</span><span class=p>,</span> <span class=n>key</span><span class=o>.</span><span class=n>d</span><span class=p>,</span> <span class=n>key</span><span class=o>.</span><span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>m0</span> <span class=o>=</span> <span class=nb>int</span><span class=o>.</span><span class=n>from_bytes</span><span class=p>(</span><span class=n>msg0</span><span class=o>.</span><span class=n>encode</span><span class=p>(),</span> <span class=s2>&#34;big&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>m1</span> <span class=o>=</span> <span class=nb>int</span><span class=o>.</span><span class=n>from_bytes</span><span class=p>(</span><span class=n>msg1</span><span class=o>.</span><span class=n>encode</span><span class=p>(),</span> <span class=s2>&#34;big&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>c0</span> <span class=o>=</span> <span class=p>(</span><span class=n>m0</span> <span class=o>+</span> <span class=n>k0</span><span class=p>)</span> <span class=o>%</span> <span class=n>key</span><span class=o>.</span><span class=n>n</span>
</span></span><span class=line><span class=cl>    <span class=n>c1</span> <span class=o>=</span> <span class=p>(</span><span class=n>m1</span> <span class=o>+</span> <span class=n>k1</span><span class=p>)</span> <span class=o>%</span> <span class=n>key</span><span class=o>.</span><span class=n>n</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;c0: </span><span class=si>{</span><span class=n>c0</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;c1: </span><span class=si>{</span><span class=n>c1</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;flag.txt&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>flag</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>()</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=== CHOOSE YOUR OWN ADVENTURE: Vorpal Sword Edition ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;you enter a cave.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>64</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;the tunnel forks ahead. do you take the left or right path?&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>key</span> <span class=o>=</span> <span class=n>RSA</span><span class=o>.</span><span class=n>generate</span><span class=p>(</span><span class=mi>1024</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>msgs</span> <span class=o>=</span> <span class=p>[</span><span class=kc>None</span><span class=p>,</span> <span class=kc>None</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>page</span> <span class=o>=</span> <span class=n>secrets</span><span class=o>.</span><span class=n>randbits</span><span class=p>(</span><span class=mi>32</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>live</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;you continue walking. turn to page </span><span class=si>{</span><span class=n>page</span><span class=si>}</span><span class=s2>.&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>die</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;you die of </span><span class=si>{</span><span class=n>secrets</span><span class=o>.</span><span class=n>choice</span><span class=p>(</span><span class=n>DEATH_CAUSES</span><span class=p>)</span><span class=si>}</span><span class=s2>.&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>msgs</span> <span class=o>=</span> <span class=p>(</span><span class=n>live</span><span class=p>,</span> <span class=n>die</span><span class=p>)</span> <span class=k>if</span> <span class=n>secrets</span><span class=o>.</span><span class=n>randbits</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=k>else</span> <span class=p>(</span><span class=n>die</span><span class=p>,</span> <span class=n>live</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>run_ot</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=o>*</span><span class=n>msgs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>page_guess</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=nb>input</span><span class=p>(</span><span class=s2>&#34;turn to page: &#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>page_guess</span> <span class=o>!=</span> <span class=n>page</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>exit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;you find a chest containing </span><span class=si>{</span><span class=n>flag</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>Theo thử thách, bài này nói về <a class=link href=https://en.wikipedia.org/wiki/Oblivious_transfer#1%E2%80%932_oblivious_transfer target=_blank rel=noopener>1-2 oblivious transfer</a> nên mình cũng lên mạng tìm hiểu và đây là các bước mà giao thức này thực hiện:</p><ol><li>Alice có tin nhắn $m_0, m_1$ và 1 cặp khóa RSA $(e, d, N)$.
Bob biết được khóa công khai $(e, N)$ của Alice và muốn tin nhắn $m_c$ , với $c \in {0, 1}$.</li><li>Alice tạo ngẫu nhiên 2 số $x_0, x_1$ và gửi cho Bob.</li><li>Bob tạo ngẫu nhiên 1 số $k$ và gửi $v = b+k^e \mod N$ cho Alice.</li><li>Alice tính $k_0 = (v-x_0)^d\mod N$ và $k_1 = (v-x_1)^d\mod N$ rồi gửi $m_0&rsquo;=m_0+k_0\mod N$ và $m_1&rsquo;=m_1+k_1\mod N$ cho Bob.</li><li>Bob tính và lấy được $m_c=m_c&rsquo;-k\mod N$ và không lấy được thông tin gì từ $m_{1-c}$</li></ol><p>Đọc file server thì ta thấy là hàm <code>run_ot</code> đúng là đang thực hiện giống như 4 bước đầu trong giao thức trên. Và khi ta truy ngược lại thì ta cần biết được <code>page</code> mà được giấu trong tin nhắn <code>live</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>live</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;you continue walking. turn to page </span><span class=si>{</span><span class=n>page</span><span class=si>}</span><span class=s2>.&#34;</span>
</span></span><span class=line><span class=cl><span class=n>die</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;you die of </span><span class=si>{</span><span class=n>secrets</span><span class=o>.</span><span class=n>choice</span><span class=p>(</span><span class=n>DEATH_CAUSES</span><span class=p>)</span><span class=si>}</span><span class=s2>.&#34;</span>
</span></span><span class=line><span class=cl><span class=n>msgs</span> <span class=o>=</span> <span class=p>(</span><span class=n>live</span><span class=p>,</span> <span class=n>die</span><span class=p>)</span> <span class=k>if</span> <span class=n>secrets</span><span class=o>.</span><span class=n>randbits</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=k>else</span> <span class=p>(</span><span class=n>die</span><span class=p>,</span> <span class=n>live</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>run_ot</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=o>*</span><span class=n>msgs</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>page_guess</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=nb>input</span><span class=p>(</span><span class=s2>&#34;turn to page: &#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>page_guess</span> <span class=o>!=</span> <span class=n>page</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>exit</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>Tuy nhiên vì <code>msgs</code> được random giữa <code>(live,die)</code> và <code>(die, live)</code>, cùng với việc ta phải nhập đúng <code>page</code> trong 64 lần liên tiếp thì rõ ràng việc làm như Bob là lấy được 1 trong 2 tin nhắn không khả thi(vì xác suất trúng được hết chỉ là $\dfrac{1}{2^{64}}$)
Hơn nữa, ta đã biết được list của các <code>DEATH_CAUSES</code> nên ta cũng có thể tính được hết tất cả các <code>die</code> của chall, tức là ta có thể phân biệt được đâu là <code>live</code> và đâu là <code>die</code>.</p><p>Nhận thấy, ta đã biết $c_0, c_1$, 1 trong hai giá trị $m_0, m_1$ thì việc tìm ra được giá trị còn lại phải dựa vào 1 biểu thức tuyến tính giữa 4 biến này xảy ra.
Nói rõ hơn:</p>$$
c_0\equiv m_0+k_0\mod n
$$$$
c_1\equiv m_1+k_1\mod n
$$$$
\Leftrightarrow a c_0 -bc_1\equiv am_0-bm_1 +(ak_0 -bk_1)\mod n \ \ \ \ \ (*)
$$<p>Có nghĩa là ta phải tìm v làm sao mà $ak_0-bk_1 \equiv 0 \mod n$, với a,b bất kỳ</p><p>Điều này tương đương với: $(v-x_0)^d\equiv k(v-x_1)^d \mod n$</p>$$
\Leftrightarrow (v-x_0)^{de}\equiv k^e(v-x_1)^{de}\mod n
$$<p>Chọn v có điều kiện $\gcd(v-x_0, n) = 1$ và sử dụng định lý Euler cùng $de\equiv 1\mod \phi(n)$</p>$$
\Leftrightarrow v-x_0\equiv k^e(v-x_1)\mod n
$$$$
\Leftrightarrow (k^e - 1)(v-x_1)\equiv x_1-x_0\mod n
$$<p>Thử $k=1,-1$ đều không thỏa nên ta thử $k = 2$</p><p>Lúc này, $k^e-1=2^{65537}-1$ là 1 số Mersenne nên các ước nguyên tố của nó có <a class=link href=https://vi.wikipedia.org/wiki/S%E1%BB%91_nguy%C3%AAn_t%E1%BB%91_Mersenne#C%C3%A1c_%C4%91%E1%BB%8Bnh_l%C3%BD_v%E1%BB%81_s%E1%BB%91_nguy%C3%AAn_t%E1%BB%91_Mersenne target=_blank rel=noopener>tính chất</a>: Nếu q là một số nguyên tố của 1 số Mersenne: $q\equiv 1\mod 65537, q\equiv \pm1\mod 8$</p><p>Mặt khác, $n$ là một số nguyên tố 1024 bit nằm trong khoảng $2^{1023}$ đến $2^{1024}-1$ và là rất lớn so với ước nguyên tố điển hình của $2^{65537}-1$.</p><p>Hơn nữa, theo <a class=link href=https://vi.wikipedia.org/wiki/%C4%90%E1%BB%8Bnh_l%C3%BD_s%E1%BB%91_nguy%C3%AAn_t%E1%BB%91 target=_blank rel=noopener>Định lý số nguyên tố</a> thì có thể có khoảng $\dfrac{2^{1023}}{ln(2^{1023})} \approx \dfrac{2^{1023}}{709}$ số nguyên tố 1024 bit. Do đó với 1 số nguyên tố 1024 bit ngẫu nhiên, gần như chắc chắn là số đó không có khả năng là ước của $2^{65537}-1$</p><p>Vì vậy, $\gcd(k^e-1,n)=1$ tương đương với tồn tại nghịch đảo modulo n của $2^{65537}-1$</p>$$
\Leftrightarrow v-x_1\equiv (k^e - 1)^{-1}(x_1-x_0)\mod n
$$$$
\Leftrightarrow v\equiv (k^e - 1)^{-1}(x_1-x_0) + x_1\mod n
$$<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>e</span> <span class=o>=</span> <span class=mi>65537</span>
</span></span><span class=line><span class=cl><span class=n>k</span> <span class=o>=</span> <span class=mi>2</span><span class=o>**</span><span class=n>e</span> <span class=o>-</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>sol_v</span><span class=p>(</span><span class=n>n</span><span class=p>,</span> <span class=n>k</span><span class=p>,</span> <span class=n>x0</span><span class=p>,</span> <span class=n>x1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>d</span> <span class=o>=</span> <span class=n>inverse</span><span class=p>(</span><span class=n>k</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(</span><span class=n>x1</span> <span class=o>+</span> <span class=n>d</span><span class=o>*</span><span class=p>(</span><span class=n>x1</span><span class=o>-</span><span class=n>x0</span><span class=p>))</span> <span class=o>%</span> <span class=n>n</span>
</span></span></code></pre></td></tr></table></div></div><p>Bây giờ trở lại với $(*)$ thì ta được biểu thức tuyến tính sau:</p>$$
\Leftrightarrow c_0 -2c_1\equiv m_0-2m_1\mod n \ \ \ \ \ (**)
$$<p>Lúc này, ta chia 2 trường hợp rõ ràng:</p><ol><li>nếu <code>page</code> nằm trong <code>live</code> của $m_0$:
$$
(**)\Leftrightarrow m_0\equiv c_0 -2c_1+2m_1\mod n
$$</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>case_m0</span><span class=p>(</span><span class=n>n</span><span class=p>,</span> <span class=n>c0</span><span class=p>,</span> <span class=n>c1</span><span class=p>,</span> <span class=n>lst</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>page</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>lst</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>k</span> <span class=o>=</span> <span class=p>(</span><span class=n>c0</span> <span class=o>-</span> <span class=mi>2</span><span class=o>*</span><span class=n>c1</span> <span class=o>+</span> <span class=mi>2</span><span class=o>*</span><span class=n>i</span><span class=p>)</span> <span class=o>%</span> <span class=n>n</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>res</span> <span class=o>=</span> <span class=n>long_to_bytes</span><span class=p>(</span><span class=n>k</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>ValueError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>continue</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>res</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;you continue walking. turn to page &#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>page</span> <span class=o>=</span> <span class=n>res</span><span class=p>[</span><span class=mi>35</span><span class=p>:</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>page</span><span class=o>.</span><span class=n>isdigit</span><span class=p>():</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>page</span>
</span></span></code></pre></td></tr></table></div></div><ol start=2><li>nếu <code>page</code> nằm trong <code>live</code> của $m_1$:
$$
(**)\Leftrightarrow m_1\equiv (m_0-c_0+2c_1)\times 2^{-1}\mod n
$$</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>case_m1</span><span class=p>(</span><span class=n>n</span><span class=p>,</span> <span class=n>c0</span><span class=p>,</span> <span class=n>c1</span><span class=p>,</span> <span class=n>lst</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>page</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=n>inv</span> <span class=o>=</span> <span class=n>inverse</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=n>lst</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>k</span> <span class=o>=</span> <span class=p>(</span><span class=n>j</span> <span class=o>-</span> <span class=n>c0</span> <span class=o>+</span> <span class=mi>2</span><span class=o>*</span><span class=n>c1</span><span class=p>)</span><span class=o>*</span><span class=n>inv</span> <span class=o>%</span> <span class=n>n</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>res</span> <span class=o>=</span> <span class=n>long_to_bytes</span><span class=p>(</span><span class=n>k</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>ValueError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>continue</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>res</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;you continue walking. turn to page &#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>page</span> <span class=o>=</span> <span class=n>res</span><span class=p>[</span><span class=mi>35</span><span class=p>:</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>page</span><span class=o>.</span><span class=n>isdigit</span><span class=p>():</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>page</span>
</span></span></code></pre></td></tr></table></div></div><p>Đến đây rồi thì, ta brute-force hết cái list của <code>die</code> thì ta sẽ biết được trường hợp nào là thỏa và tìm được <code>page</code>. Remote tới server và nhận flag thôi :333</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># solution.py</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.number</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>sys</span>
</span></span><span class=line><span class=cl><span class=n>sys</span><span class=o>.</span><span class=n>set_int_max_str_digits</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>DEATH_CAUSES</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;a fever&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;dysentery&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;measles&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;cholera&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;typhoid&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;exhaustion&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;a snakebite&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;a broken leg&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;a broken arm&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;drowning&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>lst</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>DEATH_CAUSES</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>die</span> <span class=o>=</span> <span class=sa>f</span><span class=s1>&#39;you die of </span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s1>.&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span> <span class=o>=</span> <span class=nb>int</span><span class=o>.</span><span class=n>from_bytes</span><span class=p>(</span><span class=n>die</span><span class=o>.</span><span class=n>encode</span><span class=p>(),</span> <span class=s1>&#39;big&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>lst</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>rev_data</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>int</span><span class=p>(</span><span class=n>io</span><span class=o>.</span><span class=n>recvline</span><span class=p>()</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span><span class=o>.</span><span class=n>decode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>take_data1</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s2>&#34;n: &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>n</span> <span class=o>=</span> <span class=n>rev_data</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s2>&#34;x0: &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>x0</span> <span class=o>=</span> <span class=n>rev_data</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s2>&#34;x1: &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>x1</span> <span class=o>=</span> <span class=n>rev_data</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>n</span><span class=p>,</span> <span class=n>x0</span><span class=p>,</span> <span class=n>x1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>e</span> <span class=o>=</span> <span class=mi>65537</span>
</span></span><span class=line><span class=cl><span class=n>k</span> <span class=o>=</span> <span class=mi>2</span><span class=o>**</span><span class=n>e</span> <span class=o>-</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>sol_v</span><span class=p>(</span><span class=n>n</span><span class=p>,</span> <span class=n>k</span><span class=p>,</span> <span class=n>x0</span><span class=p>,</span> <span class=n>x1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>d</span> <span class=o>=</span> <span class=n>inverse</span><span class=p>(</span><span class=n>k</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(</span><span class=n>x1</span> <span class=o>+</span> <span class=n>d</span><span class=o>*</span><span class=p>(</span><span class=n>x1</span><span class=o>-</span><span class=n>x0</span><span class=p>))</span> <span class=o>%</span> <span class=n>n</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>take_data2</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s2>&#34;c0: &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>c0</span> <span class=o>=</span> <span class=n>rev_data</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s2>&#34;c1: &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>c1</span> <span class=o>=</span> <span class=n>rev_data</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>c0</span><span class=p>,</span> <span class=n>c1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>case_m0</span><span class=p>(</span><span class=n>n</span><span class=p>,</span> <span class=n>c0</span><span class=p>,</span> <span class=n>c1</span><span class=p>,</span> <span class=n>lst</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>page</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>lst</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>k</span> <span class=o>=</span> <span class=p>(</span><span class=n>c0</span> <span class=o>-</span> <span class=mi>2</span><span class=o>*</span><span class=n>c1</span> <span class=o>+</span> <span class=mi>2</span><span class=o>*</span><span class=n>i</span><span class=p>)</span> <span class=o>%</span> <span class=n>n</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>res</span> <span class=o>=</span> <span class=n>long_to_bytes</span><span class=p>(</span><span class=n>k</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>ValueError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>continue</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>res</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;you continue walking. turn to page &#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>page</span> <span class=o>=</span> <span class=n>res</span><span class=p>[</span><span class=mi>35</span><span class=p>:</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>page</span><span class=o>.</span><span class=n>isdigit</span><span class=p>():</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>page</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>case_m1</span><span class=p>(</span><span class=n>n</span><span class=p>,</span> <span class=n>c0</span><span class=p>,</span> <span class=n>c1</span><span class=p>,</span> <span class=n>lst</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>page</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=n>inv</span> <span class=o>=</span> <span class=n>inverse</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=n>lst</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>k</span> <span class=o>=</span> <span class=p>(</span><span class=n>j</span> <span class=o>-</span> <span class=n>c0</span> <span class=o>+</span> <span class=mi>2</span><span class=o>*</span><span class=n>c1</span><span class=p>)</span><span class=o>*</span><span class=n>inv</span> <span class=o>%</span> <span class=n>n</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>res</span> <span class=o>=</span> <span class=n>long_to_bytes</span><span class=p>(</span><span class=n>k</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>ValueError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>continue</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>res</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;you continue walking. turn to page &#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>page</span> <span class=o>=</span> <span class=n>res</span><span class=p>[</span><span class=mi>35</span><span class=p>:</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>page</span><span class=o>.</span><span class=n>isdigit</span><span class=p>():</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>page</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>io</span> <span class=o>=</span> <span class=n>remote</span><span class=p>(</span><span class=s2>&#34;dicec.tf&#34;</span><span class=p>,</span> <span class=mi>31001</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>64</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>n</span><span class=p>,</span> <span class=n>x0</span><span class=p>,</span> <span class=n>x1</span> <span class=o>=</span> <span class=n>take_data1</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>v</span> <span class=o>=</span> <span class=n>sol_v</span><span class=p>(</span><span class=n>n</span><span class=p>,</span> <span class=n>k</span><span class=p>,</span> <span class=n>x0</span><span class=p>,</span> <span class=n>x1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s2>&#34;v: &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>v</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>c0</span><span class=p>,</span> <span class=n>c1</span> <span class=o>=</span> <span class=n>take_data2</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>page</span> <span class=o>=</span> <span class=n>case_m0</span><span class=p>(</span><span class=n>n</span><span class=p>,</span> <span class=n>c0</span><span class=p>,</span> <span class=n>c1</span><span class=p>,</span> <span class=n>lst</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>page</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>page</span> <span class=o>=</span> <span class=n>case_m1</span><span class=p>(</span><span class=n>n</span><span class=p>,</span> <span class=n>c0</span><span class=p>,</span> <span class=n>c1</span><span class=p>,</span> <span class=n>lst</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s2>&#34;turn to page: &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=n>page</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=n>io</span><span class=o>.</span><span class=n>recvall</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>io</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><pre><code>Flag: dice{gl3am1ng_g0ld_doubl00n}
</code></pre></section><footer class=article-footer><section class=article-tags><a href=/tags/ctf/>CTF</a>
<a href=/tags/cryptography/>Cryptography</a>
<a href=/tags/miscellaneous/>Miscellaneous</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css integrity=sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js integrity=sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8 crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector(".main-article");renderMathInElement(e,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],ignoredClasses:["gist"]})})</script></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/p/holactf-2025/><div class=article-image><img src=/p/holactf-2025/holactf.9c863f56f24ea2049dc35dc145a8456b_hu_3189ab400ea0ac9b.jpg width=250 height=150 loading=lazy alt="Featured image of post HOLACTF 2025" data-hash="md5-nIY/VvJOogSdw13BRahFaw=="></div><div class=article-details><h2 class=article-title>HOLACTF 2025</h2></div></a></article><article class=has-image><a href=/p/imaginaryctf-2025/><div class=article-image><img src=/p/imaginaryctf-2025/imaginary.e9de644d192de193f46c90c0d02a4680_hu_3b6bafe821b2d8e6.jpg width=250 height=150 loading=lazy alt="Featured image of post ImaginaryCTF 2025" data-hash="md5-6d5kTRkt4ZP0bJDA0CpGgA=="></div><div class=article-details><h2 class=article-title>ImaginaryCTF 2025</h2></div></a></article><article class=has-image><a href=/p/nahamcon-ctf-2025/><div class=article-image><img src=/p/nahamcon-ctf-2025/Certificate.7f8c046c663f2b1fa34b68d95d010fdf_hu_bba9b22fc0efc29c.png width=250 height=150 loading=lazy alt="Featured image of post NahamCon CTF 2025" data-hash="md5-f4wEbGY/Kx+jS2jZXQEP3w=="></div><div class=article-details><h2 class=article-title>NahamCon CTF 2025</h2></div></a></article><article class=has-image><a href=/p/wannagame-cyber-knight-2025/><div class=article-image><img src=/p/wannagame-cyber-knight-2025/w1cyber.a4069297ed7a29deb08708dacbe2eab2_hu_20105d278e73481c.png width=250 height=150 loading=lazy alt="Featured image of post WannaGame Cyber Knight 2025" data-hash="md5-pAaSl+16Kd6whwjay+Lqsg=="></div><div class=article-details><h2 class=article-title>WannaGame Cyber Knight 2025</h2></div></a></article><article><a href=/p/wannagame-nmlt/><div class=article-details><h2 class=article-title>WannaGame NMLT</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//hugo-theme-stack.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2025 r1muru</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.31.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>