<!doctype html>
<html
  lang="en-us" 
  data-theme-mode="auto"
  >
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=45075&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8" />
<meta
  name="viewport"
  content="width=device-width, initial-scale=1, shrink-to-fit=no"
/><title>
  Crack Random Modules | r1muru
</title>
<meta name="description" content="Bạn muốn thắng Vietlott, blog này là dành cho bạn..."/><script>
  window.siteConfig = JSON.parse("{\"anchor_icon\":null,\"base\":\"http://localhost:45075/\",\"clipboard\":{\"copyright\":{\"count\":50,\"enable\":false,\"license_type\":\"by-nc-sa\"},\"fail\":{\"en\":\"Copy failed (ﾟ⊿ﾟ)ﾂ\",\"ja\":\"コピー失敗 (ﾟ⊿ﾟ)ﾂ\",\"pt-br\":\"Falha ao copiar (ﾟ⊿ﾟ)ﾂ\",\"zh-cn\":\"复制失败 (ﾟ⊿ﾟ)ﾂ\",\"zh-tw\":\"複製失敗 (ﾟ⊿ﾟ)ﾂ\"},\"success\":{\"en\":\"Copy successfully (*^▽^*)\",\"ja\":\"コピー成功 (*^▽^*)\",\"pt-br\":\"Copiado com sucesso (*^▽^*)\",\"zh-cn\":\"复制成功 (*^▽^*)\",\"zh-tw\":\"複製成功 (*^▽^*)\"}},\"code_block\":{\"expand\":true},\"icon_font\":false,\"outdate\":{\"daysago\":180,\"enable\":false,\"message\":{\"en\":\"This article was last updated on {time}. Please note that the content may no longer be applicable.\",\"ja\":\"この記事は最終更新日：{time}。記載内容が現在有効でない可能性がありますのでご注意ください。\",\"pt-br\":\"Este artigo foi atualizado pela última vez em {time}. Observe que o conteúdo pode não ser mais aplicável.\",\"zh-cn\":\"本文最后更新于 {time}，请注意文中内容可能已不适用。\",\"zh-tw\":\"本文最後更新於 {time}，請注意文中內容可能已不適用。\"}}}");
  
</script>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link
  rel="preload"
  as="style"
  href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7cNoto%20Serif%20SC:400,400italic,700,700italic%7c&amp;display=swap"
/>
<link
  rel="stylesheet"
  href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7cNoto%20Serif%20SC:400,400italic,700,700italic%7c&amp;display=swap"
  media="print"
  onload="this.media='all'"
/>
<link
    rel="stylesheet"
    href="https://npm.webcache.cn/@fortawesome/fontawesome-free@7.1.0/css/regular.min.css"
    integrity="sha384-4qYppzjH8EiA&#43;cGdaubu2vL7Rk8WGiqCSj7oRuP1uwtFWkfKNHD20lPfcrbQc8dU" crossorigin="anonymous"/><link
    rel="stylesheet"
    href="https://npm.webcache.cn/@fortawesome/fontawesome-free@7.1.0/css/solid.min.css"
    integrity="sha384-wbMWab3UDSPm2kvIgVOn/d9KPTecgPU1&#43;Nb3zoQrm/oVu0EkPL6IaKinjbwW0rum" crossorigin="anonymous"/><link
    rel="preload"
    as="style"
    href="https://npm.webcache.cn/@fortawesome/fontawesome-free@7.1.0/css/brands.min.css"
    integrity="sha384-KTGeC2hIMzpeQakhsmzB9bZfhCD5xZZCgI1iZH6f/O457SxzlkzTQg/WXFNoi3ih" crossorigin="anonymous"onload="this.onload=null;this.rel='stylesheet'"
  /><link
    rel="preload"
    as="style"
    href="https://npm.webcache.cn/@fortawesome/fontawesome-free@7.1.0/css/v5-font-face.min.css"
    integrity="sha384-nJ1ThfldViXoLpJ6jlKcP2beas8BMbYq26SG9Hi8cH89bZi4RZ644v7helMCqJxd" crossorigin="anonymous"onload="this.onload=null;this.rel='stylesheet'"
  /><link
    rel="preload"
    as="style"
    href="https://npm.webcache.cn/@fortawesome/fontawesome-free@7.1.0/css/v4-font-face.min.css"
    integrity="sha384-UlkrhOIvZxJFd4MElSUp7ow6/RUeYKi/orfCZIRRiOENFuQPIAA3T3HjYfmBRhNq" crossorigin="anonymous"onload="this.onload=null;this.rel='stylesheet'"
  /><link rel="stylesheet" href="/css/loader.css" />
<meta property="og:type" content="website" />
  <meta property="og:title" content="Crack Random Modules | r1muru" />
  <meta
    property="og:description"
    content="Bạn muốn thắng Vietlott, blog này là dành cho bạn..."
  />
  <meta property="og:url" content="http://localhost:45075/post/crackrandommodule/" />
  <meta
    property="og:site_name"
    content="r1muru&#39;s blog"
  />
  <meta
    property="og:image"
    content="/images/random.webp"
  />
  <meta property="article:author" content="r1muru" />
  <meta property="article:published_time" content="2025-09-15T20:31:17&#43;07:00" />
  <meta property="article:modified_time" content="2025-09-15T20:31:17&#43;07:00" /><meta property="article:tag" content="CTFCryptographyResearch" /><meta name="twitter:card" content="summary" />
  <meta name="twitter:image" content="/images/random.webp" />
<link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/css/main.css" />
<link
    rel="preload"
    as="style"
    href="https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe.css"
    integrity="sha384-IfxC36XL/toUyJ939C73PcgMuRzAZuIzZxE38drsmO5p6jD7ei&#43;Zx/1oA/0l8ysE" crossorigin="anonymous"onload="this.onload=null;this.rel='stylesheet'"
  /><link
    rel="preload"
    as="style"
    href="https://npm.webcache.cn/katex@0.16.24/dist/katex.min.css"
    integrity="sha384-tTgKLjMYmJr94v8qu2PE5MUGSMbyN2xiH266JUB3gpm8vnnJywd1dWSOEfrFz&#43;YI" crossorigin="anonymous"onload="this.onload=null;this.rel='stylesheet'"
  /><script
    src="https://npm.webcache.cn/pace-js@1.2.4/pace.min.js"
    integrity="sha384-k6YtvFUEIuEFBdrLKJ3YAUbBki333tj1CSUisai5Cswsg9wcLNaPzsTHDswp4Az8" crossorigin="anonymous"></script><link
    rel="stylesheet"
    href="https://npm.webcache.cn/@reimujs/aos@0.1.2/dist/aos.css"
    integrity="sha384-GMRP93c6Hkz9JVKGAuRR3nTS7M07RwPgTFenXiosjq2VbVgvdDNcz1g6Mkj8AONa" crossorigin="anonymous"/><link
    rel="stylesheet"
    href="https://npm.webcache.cn/aplayer@1.10.1/dist/APlayer.min.css"
    integrity="sha384-tLMkTWh2pfXNWGFlUS0w1TFtRG5xZ9lPWFOooj&#43;vDDLIL&#43;xBGQU/voDBY5XE2lVh" crossorigin="anonymous"/></head>
  <body><div id='loader'>
    <div class="loading-left-bg loading-bg"></div>
    <div class="loading-right-bg loading-bg"></div>
    <div class="spinner-box">
      <div class="loading-taichi rotate"><img src="/images/loading.svg" alt="loading" /></div><div class="loading-word">Loading...</div>
    </div>
  </div>
  </div>
  <script>
    var time = null;
    var loaderEl = document.getElementById('loader');
    var startLoading = () => {
      time = Date.now();
      loaderEl.classList.remove("loading");
    }
    var hideLoader = () => {
      document.body.style.overflow = 'auto';
      loader.classList.add('loading');
    };

    var endLoading = () => {
      if (!time) {
        hideLoader();
      } else {
        if (Date.now() - time > 500) {
          time = null;
          hideLoader();
        } else {
          setTimeout(endLoading, 500 - (Date.now() - time));
          time = null;
        }
      }
    }
    window.addEventListener('DOMContentLoaded', endLoading);
    loaderEl.addEventListener('click', endLoading);
  </script><div id="copy-tooltip"></div>
<div id="lang-tooltip">
This article does not have a corresponding language version
</div>
<div id="heatmap-tooltip"></div><div id="container">
      <div id="wrap"><div id="header-nav">
  <nav id="main-nav" aria-label="Primary navigation"><a class="main-nav-link-wrap" href="/">
        <div class='main-nav-icon icon '>&#xf015;</div>
        <span class="main-nav-link">Home</span>
      </a><a class="main-nav-link-wrap" href="/archives">
        <div class='main-nav-icon icon '>&#xf187;</div>
        <span class="main-nav-link">Archives</span>
      </a><a class="main-nav-link-wrap" href="/about">
        <div class='main-nav-icon icon '>&#xf007;</div>
        <span class="main-nav-link">About</span>
      </a><a id="main-nav-toggle" class="nav-icon" aria-label="Toggle navigation" role="button"></a>
  </nav>
  <nav id="sub-nav" aria-label="Secondary navigation"><a id="nav-search-btn" class="nav-icon popup-trigger" title="Search" aria-label="Search"></a></nav></div>
<header id="header" aria-label="Site header"><picture></picture>
    <img  fetchpriority="high" src="/images/random.webp" alt="Crack Random Modules"><div id="header-outer">
    <div id="header-title"><span id="logo">
            <h1 data-aos="slide-up">Crack Random Modules</h1>
          </span><h2 id="subtitle-wrap" data-aos="slide-down"></h2></div>
  </div>
</header><div id="content"
          aria-label="Page content"
          class="sidebar-left"
            ><aside id="sidebar" aria-label="Sidebar"><div class="sidebar-wrapper-container sticky"><meting-js
        theme="var(--color-link)"
        id="8668604226"server="netease"type="playlist"fixed="false"autoplay="true"loop="all"order="list"preload="auto"volume="0.7"list-folded="false">
      </meting-js><div class="sidebar-wrapper">
    <div
      class="sidebar-wrap"
      data-aos="fade-up"
    ><div class="sidebar-toc-sidebar"><h3 class="toc-title">Contents</h3>
<div class="sidebar-toc-wrapper toc-div-class">
  <nav id="TableOfContents">
  <ul>
    <li><a href="#1-python">1. Python</a>
      <ul>
        <li><a href="#mersenne-twister">Mersenne Twister</a></li>
        <li><a href="#khôi-phục-từ-đầu-ra-đầy-đủ-32-bit">Khôi phục từ đầu ra đầy đủ 32-bit</a></li>
      </ul>
    </li>
    <li><a href="#2-javascript">2. Javascript</a>
      <ul>
        <li><a href="#khôi-phục-trạng-thái-từ-một-lượng-giá-trị-ngẫu-nhiên-được-cho">Khôi phục trạng thái từ một lượng giá trị ngẫu nhiên được cho</a></li>
      </ul>
    </li>
    <li><a href="#3-cc">3. C/C++</a>
      <ul>
        <li><a href="#thuật-toán">Thuật toán</a></li>
        <li><a href="#khôi-phục">Khôi phục</a></li>
      </ul>
    </li>
    <li><a href="#4-golang">4. Golang</a>
      <ul>
        <li><a href="#thuật-toán-1">Thuật toán</a></li>
        <li><a href="#khôi-phục-1">Khôi phục</a></li>
      </ul>
    </li>
    <li><a href="#5-bash">5. Bash</a>
      <ul>
        <li><a href="#thuật-toán-2">Thuật toán</a></li>
        <li><a href="#khôi-phục-2">Khôi phục</a></li>
      </ul>
    </li>
    <li><a href="#all-code-in-github">All code in Github</a></li>
    <li><a href="#tài-liệu">Tài liệu</a></li>
  </ul>
</nav>
</div></div>
          <div class="sidebar-common-sidebar hidden"><div class="sidebar-author">
  <img
    data-src="/avatar/avatar.png"
    data-sizes="auto"
    alt="r1muru"
    class="lazyload"
  />
  <div class="sidebar-author-name">r1muru</div>
  <div class="sidebar-description">Life is not fair, get used to it</div>
</div>
<div class="sidebar-state">
  <div class="sidebar-state-article">
    <div>Posts</div><div class="sidebar-state-number">11</div>
  </div>
  <a class="sidebar-state-category" href="/categories/" aria-label="sidebar-state-category-link">
    <div>Categories</div>
    <div class="sidebar-state-number">
      3
    </div>
  </a>
  <a class="sidebar-state-tag" href="/tags/" aria-label="sidebar-state-tag-link">
    <div>Tags</div>
    <div class="sidebar-state-number">8</div>
  </a>
</div>
<div class="sidebar-social"><div class="icon-discord sidebar-social-icon">
      <a
        href="https://discordapp.com/users/r1muru2006"
        itemprop="url"
        target="_blank"
        aria-label="discord"
        rel="noopener nofollow noreferrer"
      ></a>
    </div><div class="icon-email sidebar-social-icon">
      <a
        href="cuongchu200@gmail.com"
        itemprop="url"
        target="_blank"
        aria-label="email"
        rel="noopener nofollow noreferrer"
      ></a>
    </div><div class="icon-facebook sidebar-social-icon">
      <a
        href="https://www.facebook.com/chu.cuong.732399"
        itemprop="url"
        target="_blank"
        aria-label="facebook"
        rel="noopener nofollow noreferrer"
      ></a>
    </div><div class="icon-github sidebar-social-icon">
      <a
        href="https://github.com/r1muru2006"
        itemprop="url"
        target="_blank"
        aria-label="github"
        rel="noopener nofollow noreferrer"
      ></a>
    </div><div class="icon-instagram sidebar-social-icon">
      <a
        href="https://www.instagram.com/r1murun0pr0"
        itemprop="url"
        target="_blank"
        aria-label="instagram"
        rel="noopener nofollow noreferrer"
      ></a>
    </div></div>
<div class="sidebar-menu"><div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/"
        aria-label="Home"
      ></a>
      <div class='sidebar-menu-icon icon '>&#xf015;</div>
      <div class="sidebar-menu-link">Home</div>
    </div><div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/archives"
        aria-label="Archives"
      ></a>
      <div class='sidebar-menu-icon icon '>&#xf187;</div>
      <div class="sidebar-menu-link">Archives</div>
    </div><div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/about"
        aria-label="About"
      ></a>
      <div class='sidebar-menu-icon icon '>&#xf007;</div>
      <div class="sidebar-menu-link">About</div>
    </div></div>
</div><div class="sidebar-btn-wrapper" style="position:static">
            <div class="sidebar-toc-btn current"></div>
            <div class="sidebar-common-btn"></div>
          </div></div>
  </div><div class="sidebar-widget"></div></div></aside>
<section id="main" aria-label="Main content"><article
  class="h-entry article"
  itemscope
  itemtype="https://schema.org/BlogPosting"
>
  <div
    class="article-inner"
    data-aos="fade-up"
  >
    <div class="article-meta"><div class="article-date">
  <span
    class="article-date-link icon-calendar"
    data-aos="zoom-in"
  >
    <time datetime="2025-09-15 20:31:17 &#43;0700 &#43;07" itemprop="datePublished"
      >2025-09-15</time
    >
    <time style="display: none;" id="post-update-time"
      >2025-09-15</time
    >
  </span></div>
<div class="article-category"><a
      class="article-category-link"
      href="/categories/learning"
      data-aos="zoom-in"
      >LEARNING</a
    ></div>
</div><div class="hr-line"></div><div class="e-content article-entry" itemprop="articleBody"><p>Khởi động nhẹ nhàng: <a href="https://www.youtube.com/watch?v=-h_rj2-HP2E">How To Predict Random Numbers Generated By Computers</a></p>
<h2 id="1-python">
<a class="header-anchor" href="#1-python"></a>
1. Python
</h2><p>Hàm random của Python sử dụng thuật toán <a href="https://en.wikipedia.org/wiki/Mersenne_Twister">Mersenne Twister</a> - với 624 số nguyên 32 bit làm trạng thái, sau đó cứ mỗi lần xuất ra một số nguyên 32 bit, nó sẽ thay đổi trạng thái.</p>
<h3 id="mersenne-twister">
<a class="header-anchor" href="#mersenne-twister"></a>
Mersenne Twister
</h3><p>Ta sẽ phân tích thuật toán tạo số ngẫu nhiên trong khoảng <code>[0,0xffffffff]</code>: <a href="https://github.com/python/cpython/blob/23362f8c301f72bbf261b56e1af93e8c52f5b6cf/Modules/_randommodule.c">Link</a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cm">/* Period parameters -- These are all magic.  Don&#39;t change. */</span>
</span></span><span class="line"><span class="cl"><span class="cp">#define N 624
</span></span></span><span class="line"><span class="cl"><span class="cp">#define M 397
</span></span></span><span class="line"><span class="cl"><span class="cp">#define MATRIX_A 0x9908b0dfU    </span><span class="cm">/* constant vector a */</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#define UPPER_MASK 0x80000000U  </span><span class="cm">/* most significant w-r bits */</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#define LOWER_MASK 0x7fffffffU  </span><span class="cm">/* least significant r bits */</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">static</span> <span class="kt">uint32_t</span>
</span></span><span class="line"><span class="cl"><span class="nf">genrand_uint32</span><span class="p">(</span><span class="n">RandomObject</span> <span class="o">*</span><span class="n">self</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint32_t</span> <span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">static</span> <span class="k">const</span> <span class="kt">uint32_t</span> <span class="n">mag01</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x0U</span><span class="p">,</span> <span class="n">MATRIX_A</span><span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* mag01[x] = x * MATRIX_A  for x=0,1 */</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">mt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">mt</span> <span class="o">=</span> <span class="n">self</span><span class="o">-&gt;</span><span class="n">state</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">self</span><span class="o">-&gt;</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="n">N</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* generate N words at one time */</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">kk</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="n">kk</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">kk</span><span class="o">&lt;</span><span class="n">N</span><span class="o">-</span><span class="n">M</span><span class="p">;</span><span class="n">kk</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">mt</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span><span class="n">ANDUPPER_MASK</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">mt</span><span class="p">[</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="n">ANDLOWER_MASK</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">mt</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> <span class="o">=</span> <span class="n">mt</span><span class="p">[</span><span class="n">kk</span><span class="o">+</span><span class="n">M</span><span class="p">]</span> <span class="o">^</span> <span class="p">(</span><span class="n">y</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">^</span> <span class="n">mag01</span><span class="p">[</span><span class="n">y</span> <span class="n">AND</span> <span class="mh">0x1U</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="p">(;</span><span class="n">kk</span><span class="o">&lt;</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span><span class="n">kk</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">mt</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span><span class="n">ANDUPPER_MASK</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">mt</span><span class="p">[</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="n">ANDLOWER_MASK</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">mt</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> <span class="o">=</span> <span class="n">mt</span><span class="p">[</span><span class="n">kk</span><span class="o">+</span><span class="p">(</span><span class="n">M</span><span class="o">-</span><span class="n">N</span><span class="p">)]</span> <span class="o">^</span> <span class="p">(</span><span class="n">y</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">^</span> <span class="n">mag01</span><span class="p">[</span><span class="n">y</span> <span class="n">AND</span> <span class="mh">0x1U</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">mt</span><span class="p">[</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="n">ANDUPPER_MASK</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">mt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="n">ANDLOWER_MASK</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">mt</span><span class="p">[</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">mt</span><span class="p">[</span><span class="n">M</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">^</span> <span class="p">(</span><span class="n">y</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">^</span> <span class="n">mag01</span><span class="p">[</span><span class="n">y</span> <span class="n">AND</span> <span class="mh">0x1U</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">self</span><span class="o">-&gt;</span><span class="n">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">y</span> <span class="o">=</span> <span class="n">mt</span><span class="p">[</span><span class="n">self</span><span class="o">-&gt;</span><span class="n">index</span><span class="o">++</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="n">y</span> <span class="o">^=</span> <span class="p">(</span><span class="n">y</span> <span class="o">&gt;&gt;</span> <span class="mi">11</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">y</span> <span class="o">^=</span> <span class="p">(</span><span class="n">y</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">)</span> <span class="n">AND</span> <span class="mh">0x9d2c5680U</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">y</span> <span class="o">^=</span> <span class="p">(</span><span class="n">y</span> <span class="o">&lt;&lt;</span> <span class="mi">15</span><span class="p">)</span> <span class="n">AND</span> <span class="mh">0xefc60000U</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">y</span> <span class="o">^=</span> <span class="p">(</span><span class="n">y</span> <span class="o">&gt;&gt;</span> <span class="mi">18</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Nếu <code>index &gt;= N (= 624)</code>, nghĩa là đã dùng hết số trong mảng <code>mt[]</code> và do đó phải tạo lại 624 số tiếp theo. Mảng <code>mt[]</code> được thay đổi bằng quá trình sau:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">mt</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> <span class="n">AND</span> <span class="n">UPPER_MASK</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">mt</span><span class="p">[(</span><span class="n">kk</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">N</span><span class="p">]</span> <span class="n">AND</span> <span class="n">LOWER_MASK</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">mt</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> <span class="o">=</span> <span class="n">mt</span><span class="p">[(</span><span class="n">kk</span> <span class="o">+</span> <span class="n">M</span><span class="p">)</span> <span class="o">%</span> <span class="n">N</span><span class="p">]</span> <span class="o">^</span> <span class="p">(</span><span class="n">y</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">^</span> <span class="n">mag01</span><span class="p">[</span><span class="n">y</span> <span class="n">AND</span> <span class="mh">0x1U</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">mt</span><span class="p">[</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="n">ANDUPPER_MASK</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">mt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="n">ANDLOWER_MASK</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">mt</span><span class="p">[</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">mt</span><span class="p">[</span><span class="n">M</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">^</span> <span class="p">(</span><span class="n">y</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">^</span> <span class="n">mag01</span><span class="p">[</span><span class="n">y</span> <span class="n">AND</span> <span class="mh">0x1U</span><span class="p">];</span>
</span></span></code></pre></div><p>Sau đó, số <code>y</code> ngẫu nhiên được tạo như sau:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">y</span> <span class="o">=</span> <span class="n">mt</span><span class="p">[</span><span class="n">self</span><span class="o">-&gt;</span><span class="n">index</span><span class="o">++</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="n">y</span> <span class="o">^=</span> <span class="p">(</span><span class="n">y</span> <span class="o">&gt;&gt;</span> <span class="mi">11</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">y</span> <span class="o">^=</span> <span class="p">(</span><span class="n">y</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">)</span> <span class="n">AND</span> <span class="mh">0x9d2c5680U</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">y</span> <span class="o">^=</span> <span class="p">(</span><span class="n">y</span> <span class="o">&lt;&lt;</span> <span class="mi">15</span><span class="p">)</span> <span class="n">AND</span> <span class="mh">0xefc60000U</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">y</span> <span class="o">^=</span> <span class="p">(</span><span class="n">y</span> <span class="o">&gt;&gt;</span> <span class="mi">18</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">return</span> <span class="n">y</span><span class="p">;</span>
</span></span></code></pre></div><p>Do đó, nếu ta có thể đảo ngược được quá trình này thì ta có thể dự đoán giá trị tiếp theo khi biết được 624 đầu ra 32 bit.</p>
<h3 id="khôi-phục-từ-đầu-ra-đầy-đủ-32-bit">
<a class="header-anchor" href="#kh%c3%b4i-ph%e1%bb%a5c-t%e1%bb%ab-%c4%91%e1%ba%a7u-ra-%c4%91%e1%ba%a7y-%c4%91%e1%bb%a7-32-bit"></a>
Khôi phục từ đầu ra đầy đủ 32-bit
</h3><p>Sau đây là các bước đảo ngược chi tiết:
<code>y ^= (y &gt;&gt; 18)</code></p>
<p>Đây là dịch phải 18 bit, ảnh hưởng từ bit cao tới bit thấp và sau bước này thì bit cao không thay đổi cùng với việc $18*2 = 36 > 32$ nên ta chỉ cần 1 lần đảo là được.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Step 1</span>
</span></span><span class="line"><span class="cl"><span class="n">y</span> <span class="o">^=</span> <span class="p">(</span><span class="n">y</span> <span class="o">&gt;&gt;</span> <span class="mi">18</span><span class="p">)</span>
</span></span></code></pre></div><p><code>y ^= (y &lt;&lt; 15) AND 0xefc60000</code></p>
<p>Ở đây, mask 0xefc60000 có cấu trúc đặc biệt với làm phép biển đổi trở thành 1 hàm tự nghịch đảo, nghĩa là $f(f(x))=x$, với $f(x) = x \oplus ((x << 15)$ AND 0xefc60000). Chứng minh:</p>
<ul>
<li>Đặt A = 0xefc60000. Khi đó:</li>
</ul>
<p>$f(y)=f(f(x)) = f(x \oplus ((x << 15) AND \ A))$</p>
<p>$= (x \oplus ((x << 15) AND \ A)) \oplus (((x \oplus ((x << 15) AND \ A)) << 15) AND \ A)$</p>
<p>$= (x \oplus ((x << 15) AND \ A)) \oplus (((x << 15) AND \ A) \oplus((x << 30) AND (A << 15) AND \ A))$</p>
<p>$= x \oplus (((x << 15) AND \ A) \oplus ((x << 15) AND \ A)) \oplus((x << 30) AND (A << 15) \ AND \ A) = x$</p>
<p>(vì tính chất $P \oplus P = 0$ và $A$ có 17 bit thấp là 0 nên nếu dịch trái 15 bit thì 32 bit cuối của $A << 15$ sẽ đều là 0 nên $(A << 15) AND \ A = 0$)</p>
<p>Do đó, để đảo ngược thì ta chỉ cần 1 lần biến đổi hàm nữa:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Step 2</span>
</span></span><span class="line"><span class="cl"><span class="n">y</span> <span class="o">^=</span> <span class="p">(</span><span class="n">y</span> <span class="o">&lt;&lt;</span> <span class="mi">15</span><span class="p">)</span> <span class="n">AND</span> <span class="mh">0xefc60000</span>
</span></span></code></pre></div><p><code>y ^= (y &lt;&lt; 7) AND 0x9d2c5680</code></p>
<p>Ở bước này thì ta sẽ thiết lập một hàm dịch bit gần tương tự như bước trên:</p>
<ul>
<li>Đặt B = 0x9d2c5680.
Với $y = x \oplus ((x << 7) AND \ B)$
, ta sẽ dùng hàm $f(x') = y \oplus ((x' << 7) AND \ B)$
Khi đó:</li>
</ul>
<p>$f_4(y) = f_4(x \oplus ((x << 7) AND \ B)) = f_3(y \oplus (((x \oplus ((x << 7) AND \ B)) << 7)AND \ B))$</p>
<p>$= f_3(x \oplus (((x << 7) AND \ B) \oplus ((x << 7) AND \ B)) \oplus((x << (7\times2))AND (B << 7) AND \ B))$</p>
<p>$= f_3(x \oplus((x << (7\times2))AND (B << 7) AND \ B))$</p>
<p>$= f_2(x \oplus((x << (7\times3))AND (B << (7\times2)) AND (B << 7) AND \ B))$</p>
<p>$= f(x \oplus((x << (7\times4))AND (B<< (7\times3)) AND (B << (7\times2)) AND (B << 7) AND \ B))$</p>
<p>$= x \oplus((x << (7\times5))AND (B<< (7\times4)) AND (B<< (7\times3)) AND (B << (7\times2)) AND (B << 7) AND \ B)$</p>
<p>$=x$</p>
<p>(vì B có 7 bit thấp là 0 nên nếu dịch trái 28 bit thì 32 bit cuối của $B << 28$ sẽ đều là 0 nên đẳng thức trên xảy ra.)</p>
<p>Do đó, để đảo ngược thì ta chỉ cần 4 lần biến đổi hàm như sau:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Step 3</span>
</span></span><span class="line"><span class="cl"><span class="n">res</span> <span class="o">=</span> <span class="n">y</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">res</span> <span class="o">=</span> <span class="n">y</span> <span class="o">^</span> <span class="p">(</span><span class="n">res</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">)</span> <span class="n">AND</span> <span class="mh">0x9d2c5680</span>
</span></span><span class="line"><span class="cl"><span class="n">y</span> <span class="o">=</span> <span class="n">res</span>
</span></span></code></pre></div><p><code>y ^= (y &gt;&gt; 11)</code>
Đây là dịch phải 11 bit, ảnh hưởng từ bit cao tới bit thấp và sau bước này thì bit cao không thay đổi cùng với việc $11*3 = 33 > 32$ nên ta chỉ cần 2 lần đảo để khôi phục từ bit cao đến bit thấp.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Step 4</span>
</span></span><span class="line"><span class="cl"><span class="n">res</span> <span class="o">=</span> <span class="n">y</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">res</span> <span class="o">=</span> <span class="n">y</span> <span class="o">^</span> <span class="p">(</span><span class="n">res</span> <span class="o">&gt;&gt;</span> <span class="mi">11</span><span class="p">)</span>
</span></span></code></pre></div><p>Tổng hợp lại thì ta có hàm đảo (untemper):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">untemper</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 1. Rev: y ^= (y &gt;&gt; 18)</span>
</span></span><span class="line"><span class="cl">    <span class="n">y</span> <span class="o">^=</span> <span class="p">(</span><span class="n">y</span> <span class="o">&gt;&gt;</span> <span class="mi">18</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 2. Rev: y ^= (y &lt;&lt; 15) AND 0xefc60000</span>
</span></span><span class="line"><span class="cl">    <span class="n">y</span> <span class="o">^=</span> <span class="p">(</span><span class="n">y</span> <span class="o">&lt;&lt;</span> <span class="mi">15</span><span class="p">)</span> <span class="n">AND</span> <span class="mh">0xefc60000</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 3. Rev: y ^= (y &lt;&lt; 7) AND 0x9d2c5680</span>
</span></span><span class="line"><span class="cl">    <span class="n">temp</span> <span class="o">=</span> <span class="n">y</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">temp</span> <span class="o">=</span> <span class="n">y</span> <span class="o">^</span> <span class="p">(</span><span class="n">temp</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">)</span> <span class="n">AND</span> <span class="mh">0x9d2c5680</span>
</span></span><span class="line"><span class="cl">    <span class="n">y</span> <span class="o">=</span> <span class="n">temp</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 4. Rev: y ^= (y &gt;&gt; 11);</span>
</span></span><span class="line"><span class="cl">    <span class="n">temp</span> <span class="o">=</span> <span class="n">y</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">temp</span> <span class="o">=</span> <span class="n">y</span> <span class="o">^</span> <span class="p">(</span><span class="n">temp</span> <span class="o">&gt;&gt;</span> <span class="mi">11</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">y</span> <span class="o">=</span> <span class="n">temp</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">y</span>
</span></span></code></pre></div><p>Ví dụ cụ thể:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">random</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">state</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">getstate</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">outputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">getrandbits</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl"><span class="n">recovered_state</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">untemper</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">outputs</span><span class="p">[:</span><span class="mi">624</span><span class="p">]]</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="kc">None</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">random</span><span class="o">.</span><span class="n">setstate</span><span class="p">(</span><span class="n">recovered_state</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">assert</span> <span class="n">outputs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">random</span><span class="o">.</span><span class="n">getrandbits</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
</span></span></code></pre></div><ul>
<li>State được phục hồi có 3 phần tử:</li>
</ul>
<ol>
<li>Số nguyên 3, là chỉ số &ldquo;vị trí trạng thái&rdquo; được module random của Python sử dụng để chỉ ra vị trí của bộ tạo trong mảng trạng thái.</li>
<li>Bộ dữ liệu gồm 624 số nguyên, biểu diễn mảng trạng thái đã phục hồi.</li>
<li>None là &ldquo;giá trị giữ chỗ&rdquo; để đảm bảo tính tương thích với định dạng trạng thái mà module random của Python mong đợi.</li>
</ol>
<p>Khi chạy đoạn kiểm thử trên thì dòng lệnh đối chiếu với <code>assert</code> không bị lỗi, chứng tỏ đã khôi phục thành công state ban đầu.</p>
<h2 id="2-javascript">
<a class="header-anchor" href="#2-javascript"></a>
2. Javascript
</h2><p>Phương thức tĩnh <code>Math.random()</code> trả về một số dấu phẩy động, ngẫu nhiên lớn hơn hoặc bằng 0 và nhỏ hơn 1, với phân phối gần như đồng đều trong phạm vi đó — sau đó bạn có thể điều chỉnh theo phạm vi mong muốn. Việc triển khai sẽ chọn <code>seed</code> ban đầu cho thuật toán tạo số ngẫu nhiên; người dùng không thể chọn hoặc đặt lại <code>seed</code> này.</p>
<ul>
<li>XorShift128 trả về trạng thái 128-bit qua <code>state0, state1</code> và được triển khai như sau:</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">xs128</span><span class="p">(</span><span class="n">state0</span><span class="p">,</span> <span class="n">state1</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">64</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="n">s1</span> <span class="o">=</span> <span class="n">state0</span> <span class="n">AND</span> <span class="n">mask</span>
</span></span><span class="line"><span class="cl">    <span class="n">s0</span> <span class="o">=</span> <span class="n">state1</span> <span class="n">AND</span> <span class="n">mask</span>
</span></span><span class="line"><span class="cl">    <span class="n">s1</span> <span class="o">^=</span> <span class="p">(</span><span class="n">s1</span> <span class="o">&lt;&lt;</span> <span class="mi">23</span><span class="p">)</span> <span class="n">AND</span> <span class="n">mask</span>
</span></span><span class="line"><span class="cl">    <span class="n">s1</span> <span class="o">^=</span> <span class="p">(</span><span class="n">s1</span> <span class="o">&gt;&gt;</span> <span class="mi">17</span><span class="p">)</span> <span class="n">AND</span> <span class="n">mask</span>
</span></span><span class="line"><span class="cl">    <span class="n">s1</span> <span class="o">^=</span> <span class="n">s0</span>
</span></span><span class="line"><span class="cl">    <span class="n">s1</span> <span class="o">^=</span> <span class="p">(</span><span class="n">s0</span> <span class="o">&gt;&gt;</span> <span class="mi">26</span><span class="p">)</span> <span class="n">AND</span> <span class="n">mask</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">s0</span><span class="p">,</span> <span class="n">s1</span>
</span></span></code></pre></div><ul>
<li>Khi <code>cache</code> trống, 1 chuỗi 64 giá trị ngẫu nhiên mới sẽ được tạo thành qua xs128 và lưu trữ trong <code>cache</code> với chỉ số được đặt ở cuối.</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">_refill</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Refill the Math.random cache using xs128.
</span></span></span><span class="line"><span class="cl"><span class="s2">    Can only be used when Math.random cache is empty.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    A new 64-long list of random values is stored in cache.
</span></span></span><span class="line"><span class="cl"><span class="s2">    The cache_idx is set to the last index of the cache (63).
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache_idx</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="bp">self</span><span class="o">.</span><span class="n">cache</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">64</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">state0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state1</span> <span class="o">=</span> <span class="n">xs128</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="bp">self</span><span class="o">.</span><span class="n">cache_idx</span> <span class="o">=</span> <span class="mi">63</span>
</span></span></code></pre></div><ul>
<li>Lúc gọi <code>Math.random()</code> thì  <code>next()</code> được gọi và đưa ra 1 giá trị thập phân từ 0.0 đến 1.0. Ở đây thì v8 chuyển đổi số từ xs128 sang double bằng cách bỏ 12 bit cuối, còn 52 bit thì đưa vào phần Mantissa của số double trong chuẩn IEEE754. Sau đó trừ đi 1 và có được giá trị thập phân từ 0.0 đến 1.0.
<img src="https://hackmd.io/_uploads/HyR0w9nFel.png" alt="image"></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">v8_to_double</span><span class="p">(</span><span class="n">state0</span><span class="p">,</span> <span class="n">debug</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="n">state0</span> <span class="o">&gt;&gt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x3ff0000000000000</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">r</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;Q&#39;</span><span class="p">,</span> <span class="n">r</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache_idx</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">_refill</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">val</span> <span class="o">=</span> <span class="n">v8_to_double</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cache_idx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="bp">self</span><span class="o">.</span><span class="n">cache_idx</span> <span class="o">-=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">val</span>
</span></span></code></pre></div><h3 id="khôi-phục-trạng-thái-từ-một-lượng-giá-trị-ngẫu-nhiên-được-cho">
<a class="header-anchor" href="#kh%c3%b4i-ph%e1%bb%a5c-tr%e1%ba%a1ng-th%c3%a1i-t%e1%bb%ab-m%e1%bb%99t-l%c6%b0%e1%bb%a3ng-gi%c3%a1-tr%e1%bb%8b-ng%e1%ba%abu-nhi%c3%aan-%c4%91%c6%b0%e1%bb%a3c-cho"></a>
Khôi phục trạng thái từ một lượng giá trị ngẫu nhiên được cho
</h3><p><code>Math.random()</code> của V8 sử dụng <code>xs128</code> gồm các biểu thức tuyến tính trong hệ GF(2). Do đó, ta có thể xây dựng một hệ các phương trình tuyến tính trên GF(2) với 1 lượng giá trị ngẫu nhiên cho trước vừa đủ và từ đó, ta được nghiệm của hệ này là hai trạng thái ban đầu (seed) của thuật toán và dự đoán được giá trị ngẫu nhiên tiếp theo.</p>
<p>Chúng ta sẽ xây dựng hệ như sau:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">numbers</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="mf">0.20850633840727073</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="mf">0.28382289045651743</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="mf">0.4071416957057805</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="mf">0.3101367279739642</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="mf">0.6813711566813534</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="mf">0.8365880507655776</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="mf">0.2238039081275922</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="mf">0.014754643967695324</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="mf">0.44290438850282876</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="mf">0.5473214381957232</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="mf">0.40023560591139606</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="mf">0.14837298522461473</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="mf">0.12321774476187275</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="mf">0.8501766788936596</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="mf">0.9212308144118708</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="mf">0.8099337802981195</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="mf">0.06047989985671265</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="mf">0.6552969701254443</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="mf">0.5803218168252511</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="mf">0.41915921494443964</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="mf">0.9153038363744563</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="mf">0.7403989120318095</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="mf">0.6630141727527132</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="mf">0.5230661117641415</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></div><ul>
<li>Đây là những giá trị ngẫu nhiên cho trước</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">gf2bv</span> <span class="kn">import</span> <span class="n">LinearSystem</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">lin</span> <span class="o">=</span> <span class="n">LinearSystem</span><span class="p">([</span><span class="mi">64</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">state0</span><span class="p">,</span> <span class="n">state1</span> <span class="o">=</span> <span class="n">lin</span><span class="o">.</span><span class="n">gens</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Random</span> <span class="o">=</span> <span class="n">MathRandom</span><span class="p">(</span><span class="n">state0</span><span class="p">,</span> <span class="n">state1</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">out</span> <span class="o">=</span> <span class="p">[</span><span class="n">Random</span><span class="o">.</span><span class="n">next</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">numbers</span><span class="p">))]</span>
</span></span></code></pre></div><ul>
<li><code>state0, state1</code> là hai <code>symbolic unknown</code> có 64-bit và nằm trong hệ tuyến tính. <code>Random</code> sẽ tạo những biểu thức tuyến tính chính là <code>out</code> với ẩn là <code>state0, state1</code> để xây dựng hệ.</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">zeros</span><span class="o">=</span><span class="p">[(</span><span class="n">v8_from_double</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">12</span> <span class="o">|</span> <span class="mh">0x3ff0000000000000</span><span class="p">)</span> <span class="o">^</span> <span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">numbers</span><span class="p">,</span> <span class="n">out</span><span class="p">)]</span>
</span></span></code></pre></div><ul>
<li>Với mỗi cặp giá trị và phương trình ẩn, ta khôi phục 52 bit mantissa của đầu ra và đưa về chuẩn IEEE754 cho dạng double + 1.0 rồi XOR với biểu thức ẩn đã cho.</li>
<li>Nếu biểu thức này trùng với giá trị đầu ra thì sau khi XOR sẽ bằng 0. Vậy là ta đã có hệ tuyến tính ẩn <code>state0, state1</code>, giải hệ này và ta nhận được trạng thái ban đầu.</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">sol</span> <span class="o">=</span> <span class="n">lin</span><span class="o">.</span><span class="n">solve_one</span><span class="p">(</span><span class="n">zeros</span><span class="p">)</span>
</span></span></code></pre></div><h2 id="3-cc">
<a class="header-anchor" href="#3-cc"></a>
3. C/C++
</h2><p>Bên ngôn ngữ C/C++, hàm rand() xây dựng dựa trên <a href="https://www.mscs.dal.ca/~selinger/random/">GLIBC random number generator</a></p>
<p>Hàm <code>random()</code> của thư viện GNU C cung cấp các số giả ngẫu nhiên thông qua phương pháp phản hồi cộng tuyến tính. Phản hồi này tuyến tính theo modulo $2^{32}$. Tính phi tuyến tính nhỏ duy nhất xuất hiện trong giai đoạn <code>seeding</code>, do phép này được thực hiện theo modulo $2^{31} - 1$ chứ không phải modulo $2^{31}$ hay $2^{32}$. Điều này có nghĩa là, mặc dù mỗi số ngẫu nhiên được tạo ra phụ thuộc tuyến tính vào các số trước đó trong chuỗi, nhưng toàn bộ các số ngẫu nhiên không phụ thuộc tuyến tính vào <code>seed</code>.</p>
<h3 id="thuật-toán">
<a class="header-anchor" href="#thu%e1%ba%adt-to%c3%a1n"></a>
Thuật toán
</h3><p>Như mô tả ở trên, ta có: $2147483647 = 2^{31} - 1$ và $4294967296 = 2^{32}$</p>
<p>Với mỗi <code>seed</code> cho trước, 1 <code>initialization vector</code> (iv) $r_0...r_{33}$ được tính như sau:</p>
<ul>
<li>$r_0$ = <code>seed</code></li>
<li>$r_i\equiv (16807 * r_{i-1}) \mod 2147483647 \ ( i \in [1,30])$</li>
<li>$r_i=r_{i-31}\ (i\in [31, 33])$</li>
</ul>
<p>Sau đó, 1 chuỗi các số ngẫu nhiên $r_{34}...$ được tạo bằng vòng lặp phản hồi tuyến tính:</p>
<ul>
<li>$r_i\equiv r_{i-3}+r_{i-31}\mod 4294967296 \ (i \ge 34)$</li>
</ul>
<p>$r_0...r_{343}$ không được sử dụng mà đầu ra $o_i$ của hàm <code>rand()</code> là: $o_i =r_{i+344} \gg 1$</p>
<p>Code in C:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#define MAX 1000
</span></span></span><span class="line"><span class="cl"><span class="cp">#define seed 1
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">r</span><span class="p">[</span><span class="n">MAX</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">seed</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">31</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">16807LL</span> <span class="o">*</span> <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">%</span> <span class="mi">2147483647</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">2147483647</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">31</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">34</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">31</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">34</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">344</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">31</span><span class="p">]</span> <span class="o">+</span> <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">3</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">344</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">MAX</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">31</span><span class="p">]</span> <span class="o">+</span> <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">3</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;%d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="p">((</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="khôi-phục">
<a class="header-anchor" href="#kh%c3%b4i-ph%e1%bb%a5c"></a>
Khôi phục
</h3><p>Phân tích thuật toán trên thì ta thấy rằng:</p>
<ul>
<li>Từ $i\ge34$, $r_i\equiv r_{i-3}+r_{i-31}$ là tuyến tính và có nghĩa là khi ta biết được 2 trong 3 giá trị thì sẽ suy ra được giá trị còn lại.</li>
<li>Với đầu ra $o_i =r_{i+344} \gg 1$, nghĩa là nó có 31 bit và mất bit bên phải ngoài cùng $r_{i+344}$</li>
<li>Nghĩa là nếu ta có đủ đầu ra liên tiếp thì hoàn toàn có thể lan truyền để khôi phục lại mảng trạng thái ban đầu (iv).</li>
</ul>
<p>Các bước để khôi phục iv như sau:</p>
<ol>
<li>Đoán bit thấp bị bỏ rồi ghép thành một phần trạng thái:</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">crack</span><span class="p">(</span><span class="n">outputs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">states</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">outputs</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">31</span> <span class="ow">and</span> 
</span></span><span class="line"><span class="cl">            <span class="n">outputs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>      <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span>
</span></span><span class="line"><span class="cl">            <span class="n">outputs</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">31</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> 
</span></span><span class="line"><span class="cl">            <span class="n">outputs</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">3</span><span class="p">]</span>  <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> 
</span></span><span class="line"><span class="cl">            <span class="n">outputs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="p">(</span><span class="n">outputs</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">31</span><span class="p">]</span> <span class="o">+</span> <span class="n">outputs</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">3</span><span class="p">])</span> <span class="n">AND</span> <span class="mh">0x7fffffff</span>
</span></span><span class="line"><span class="cl">        <span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">states</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">31</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">outputs</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">31</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">            <span class="n">states</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">3</span><span class="p">]</span>  <span class="o">=</span> <span class="p">(</span><span class="n">outputs</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">3</span><span class="p">]</span>  <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">            <span class="n">states</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">outputs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">states</span>
</span></span></code></pre></div><p>Nếu ta có $o_i, o_{i-31},o_{i-3}$ và chúng không thỏa:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">outputs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="n">outputs</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">31</span><span class="p">]</span> <span class="o">+</span> <span class="n">outputs</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">3</span><span class="p">])</span> <span class="n">AND</span> <span class="mh">0x7fffffff</span>
</span></span></code></pre></div><p>Đoán trạng thái của nỏ ở dạng:
</p>
$$
\begin{cases}
s_{i-31} = o_{i-31} << 1 + 1 \\
s_{i-3} = o_{i-3} << 1 + 1 \\
s_i = o_i << 1 + 0
\end{cases}
$$<p>Nếu không, gắn $s_i =$ None vì chưa biết dạng chuẩn.</p>
<ol start="2">
<li>Khôi phục trạng thái:</li>
</ol>
<p>Chạy ngược công thức cộng để khôi phục các giá trị (nếu có) trong 344 giá trị đầu</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">states</span> <span class="o">=</span> <span class="n">crack</span><span class="p">(</span><span class="n">outputs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">init</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="mi">344</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">343</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">s31</span> <span class="o">=</span> <span class="n">states</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">31</span> <span class="o">-</span> <span class="mi">344</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">31</span> <span class="o">&gt;=</span> <span class="mi">344</span> <span class="k">else</span> <span class="n">init</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">31</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">s28</span> <span class="o">=</span> <span class="n">states</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">28</span> <span class="o">-</span> <span class="mi">344</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">28</span> <span class="o">&gt;=</span> <span class="mi">344</span> <span class="k">else</span> <span class="n">init</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">28</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">s31</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">s28</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">init</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">s31</span> <span class="o">-</span> <span class="n">s28</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="o">**</span><span class="mi">32</span>
</span></span></code></pre></div><p>Nếu có 1 giá trị trong khoảng 31 giá trị đầu, ta có thể tính tất cả các giá trị còn lại vì tính chất tuyến tính bằng công thức:
$r_i\equiv (16807 * r_{i-1}) \mod 2147483647 \Leftrightarrow r_{i-1}\equiv (16807^{-1} * r_i) \mod 2147483647$</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">base_idx</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">31</span><span class="p">)</span> <span class="k">if</span> <span class="n">init</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">base_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">31</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">init</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">init</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="mi">16807</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="n">base_idx</span><span class="p">,</span> <span class="mi">2147483647</span><span class="p">)</span> <span class="o">*</span> <span class="n">init</span><span class="p">[</span><span class="n">base_idx</span><span class="p">]</span> <span class="o">%</span> <span class="mi">2147483647</span>
</span></span></code></pre></div><p>Vì tính chất tuyến tính $r_i \equiv r_{i-3}+r_{i-31}, \forall i \ge 34$ nên nếu ta biết 2 giá trị thì suy ra được giá trị còn lại. Do đó, ta viết hàm lặp đến khi không thể khôi phục giá trị nào nữa để điền tất cả các giá trị còn thiếu.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">self_recover</span><span class="p">(</span><span class="n">states</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">MOD</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">32</span>
</span></span><span class="line"><span class="cl">    <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">states</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">updated</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">34</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">s_i</span> <span class="o">=</span> <span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="n">s_31</span> <span class="o">=</span> <span class="n">states</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">31</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="n">s_3</span> <span class="o">=</span> <span class="n">states</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">3</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">s_i</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">s_3</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">s_31</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">states</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">31</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">s_i</span> <span class="o">-</span> <span class="n">s_3</span><span class="p">)</span> <span class="o">%</span> <span class="n">MOD</span>
</span></span><span class="line"><span class="cl">                <span class="n">updated</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">elif</span> <span class="n">s_i</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">s_31</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">s_3</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">states</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">s_i</span> <span class="o">-</span> <span class="n">s_31</span><span class="p">)</span> <span class="o">%</span> <span class="n">MOD</span>
</span></span><span class="line"><span class="cl">                <span class="n">updated</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">elif</span> <span class="n">s_i</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">s_3</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">s_31</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">s_3</span> <span class="o">+</span> <span class="n">s_31</span><span class="p">)</span> <span class="o">%</span> <span class="n">MOD</span>
</span></span><span class="line"><span class="cl">                <span class="n">updated</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="n">updated</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="cl">             
</span></span><span class="line"><span class="cl"><span class="n">all_states</span> <span class="o">=</span> <span class="n">init</span> <span class="o">+</span> <span class="n">states</span>
</span></span><span class="line"><span class="cl"><span class="n">self_recover</span><span class="p">(</span><span class="n">all_states</span><span class="p">)</span>
</span></span></code></pre></div><p>Điền 3 giá trị đầu bằng các sao chép từ thứ tự 31 và lấy được <code>seed</code> ban đầu:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">all_states</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_states</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">31</span><span class="p">]</span>
</span></span></code></pre></div><p>Full code ở <a href="https://github.com/r1muru2006/Crack_random/blob/main/glibc_random/crack.py">đây</a>&hellip;</p>
<h2 id="4-golang">
<a class="header-anchor" href="#4-golang"></a>
4. Golang
</h2><p>PRNG của Golang xây dựng dựa trên Lagged Fibonacci Generator.</p>
<h3 id="thuật-toán-1">
<a class="header-anchor" href="#thu%e1%ba%adt-to%c3%a1n-1"></a>
Thuật toán
</h3><p>Hàm tạo <code>seed</code> cho rng: $x_{n+1} = 48271 * x_n \mod (2^{31} - 1)$</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">seedrand</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">A</span> <span class="o">=</span> <span class="mi">48271</span>
</span></span><span class="line"><span class="cl">    <span class="n">Q</span> <span class="o">=</span> <span class="mi">44488</span>
</span></span><span class="line"><span class="cl">    <span class="n">R</span> <span class="o">=</span> <span class="mi">3399</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">hi</span> <span class="o">=</span> <span class="n">x</span> <span class="o">//</span> <span class="n">Q</span>
</span></span><span class="line"><span class="cl">    <span class="n">lo</span> <span class="o">=</span> <span class="n">x</span> <span class="o">%</span> <span class="n">Q</span>
</span></span><span class="line"><span class="cl">    <span class="n">x</span> <span class="o">=</span> <span class="n">A</span> <span class="o">*</span> <span class="n">lo</span> <span class="o">-</span> <span class="n">R</span> <span class="o">*</span> <span class="n">hi</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">x</span> <span class="o">+=</span> <span class="n">INT32_MAX</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">x</span>
</span></span></code></pre></div><p>Để tránh tràn số thì code dùng Schrage’s Method (hi = x // Q, lo = x % Q).</p>
<p>Tiếp theo, ta có class <code>RNGSource</code> là PRNG chính.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="bp">self</span><span class="o">.</span><span class="n">tap</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="bp">self</span><span class="o">.</span><span class="n">feed</span> <span class="o">=</span> <span class="n">RNG_LEN</span> <span class="o">-</span> <span class="n">RNG_TAP</span>   <span class="c1"># 607 - 273 = 334</span>
</span></span></code></pre></div><p>Hai con trỏ là <code>tap</code> và <code>feed</code> chạy ngược nhau, thực hiện phép cộng sinh số ngẫu nhiên rồi sau đó lưu trữ trạng thái này vào mảng <code>vec</code>, tổng 607 phần tử 64-bit.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">seed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="bp">self</span><span class="o">.</span><span class="n">tap</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="bp">self</span><span class="o">.</span><span class="n">feed</span> <span class="o">=</span> <span class="n">RNG_LEN</span> <span class="o">-</span> <span class="n">RNG_TAP</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">seed</span> <span class="o">%=</span> <span class="n">INT32_MAX</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">seed</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">seed</span> <span class="o">+=</span> <span class="n">INT32_MAX</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">seed</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">seed</span> <span class="o">=</span> <span class="mi">89482311</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="n">RNG_LEN</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">x</span> <span class="o">=</span> <span class="n">seedrand</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">u</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">40</span><span class="p">)</span> <span class="n">AND</span> <span class="mh">0xFFFFFFFFFFFFFFFF</span>
</span></span><span class="line"><span class="cl">            <span class="n">x</span> <span class="o">=</span> <span class="n">seedrand</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">u</span> <span class="o">^=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">20</span><span class="p">)</span> <span class="n">AND</span> <span class="mh">0xFFFFFFFFFFFFFFFF</span>
</span></span><span class="line"><span class="cl">            <span class="n">x</span> <span class="o">=</span> <span class="n">seedrand</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">u</span> <span class="o">^=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">u</span> <span class="o">^=</span> <span class="n">rng_cooked</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">vec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span>
</span></span></code></pre></div><p>Hàm <code>seed()</code> sẽ nhận giá trị <code>seed</code> và tạo ra mảng trạng thái <code>vec</code> như sau:</p>
<ol>
<li>x được gọi <code>seedrand()</code> 20 lần để tạo số ngẫu nhiên.</li>
<li>Ghép 3 giá trị 31-bit thành số 64-bit qua hàm <code>seedrand()</code> với $x << 40, x << 20, x$.</li>
<li>XOR với 1 giá trị trong bảng <code>rng_cooked[]</code>.</li>
</ol>
<p>Tiếp theo, ta sẽ sinh số ngẫu nhiên 64-bit qua <code>vec</code> bằng hàm <code>uint64()</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">uint64</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="bp">self</span><span class="o">.</span><span class="n">tap</span> <span class="o">-=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tap</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">tap</span> <span class="o">+=</span> <span class="n">RNG_LEN</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="bp">self</span><span class="o">.</span><span class="n">feed</span> <span class="o">-=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">feed</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">feed</span> <span class="o">+=</span> <span class="n">RNG_LEN</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vec</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">feed</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">vec</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tap</span><span class="p">])</span> <span class="n">AND</span> <span class="mh">0xFFFFFFFFFFFFFFFF</span>
</span></span><span class="line"><span class="cl">    <span class="bp">self</span><span class="o">.</span><span class="n">vec</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">feed</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">x</span>
</span></span></code></pre></div><ul>
<li>Hai con trỏ <code>tap</code> và <code>feed</code> đi lùi trong vòng có độ dài 607.</li>
<li>Theo đó là công thức Additive Lagged-Fibonacci Generator:
$$
vec_{feed}=(vec_{feed} + vec_{tap}) AND 0xFFFFFFFFFFFFFFFF
$$</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vec</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">feed</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">vec</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tap</span><span class="p">])</span> <span class="n">AND</span> <span class="mh">0xFFFFFFFFFFFFFFFF</span>
</span></span><span class="line"><span class="cl"><span class="bp">self</span><span class="o">.</span><span class="n">vec</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">feed</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
</span></span></code></pre></div><h3 id="khôi-phục-1">
<a class="header-anchor" href="#kh%c3%b4i-ph%e1%bb%a5c-1"></a>
Khôi phục
</h3><p>Như ta thấy, trong golang thì từ sau giai đoạn sinh <code>seed</code>, giai đoạn sinh số ngẫu nhiên chỉ gồm phép cộng tuyến tính trên chuỗi <code>seed</code> lấy được. Nghĩa là nếu ta có chuỗi đầu ra đủ dài, ta có thể xây dựng hệ phương trình tuyến tính để tính chuỗi <code>seed</code> ban đầu.</p>
<p>Để xây dựng được hệ như vậy, mình nghĩ ngay tới z3-solver và sau đây là phần crack:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rng</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">z3</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">s</span> <span class="o">=</span> <span class="n">Solver</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">NUM_TEST</span> <span class="o">=</span> <span class="mi">700</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">vec</span> <span class="o">=</span> <span class="p">[</span><span class="n">BitVec</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;vec_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="mi">64</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">RNG_LEN</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl"><span class="n">rng_equation</span> <span class="o">=</span> <span class="n">RngSource</span><span class="p">(</span><span class="n">vec</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">equations</span> <span class="o">=</span> <span class="p">[</span><span class="n">rng_equation</span><span class="o">.</span><span class="n">uint64</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NUM_TEST</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">rng_value</span> <span class="o">=</span> <span class="n">RngSource</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">rng_value</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&#34;Enter seed: &#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl"><span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">rng_value</span><span class="o">.</span><span class="n">uint64</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NUM_TEST</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NUM_TEST</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">equations</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;99%...&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">check</span><span class="p">()</span> <span class="o">==</span> <span class="n">sat</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">model</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">array_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">vec</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">as_long</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">RNG_LEN</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">    <span class="n">rng</span> <span class="o">=</span> <span class="n">RngSource</span><span class="p">(</span><span class="n">array_values</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NUM_TEST</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">res</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">uint64</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">rng</span><span class="o">.</span><span class="n">uint64</span><span class="p">(),</span> <span class="n">rng_value</span><span class="o">.</span><span class="n">uint64</span><span class="p">())</span>
</span></span></code></pre></div><h2 id="5-bash">
<a class="header-anchor" href="#5-bash"></a>
5. Bash
</h2><p>Bash dùng linear congruential generator (LCG) là biến thể của thuật toán Park–Miller “minimal standard” để tạo số ngẫu nhiên 31-bit.</p>
<h3 id="thuật-toán-2">
<a class="header-anchor" href="#thu%e1%ba%adt-to%c3%a1n-2"></a>
Thuật toán
</h3><p>Hàm <code>next_seed</code> sinh <code>seed</code> mới bằng cách áp dụng công thức Park-Miller LCG:
</p>
$$
X_{k+1}=(a\times X_k)\mod m
$$<p>với $a = 16807,\ m = 2^{31} - 1$</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">next_seed</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="mi">123459876</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">//</span> <span class="mi">127773</span>
</span></span><span class="line"><span class="cl">    <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">-</span> <span class="p">(</span><span class="mi">127773</span> <span class="o">*</span> <span class="n">h</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">t</span> <span class="o">=</span> <span class="mi">16807</span> <span class="o">*</span> <span class="n">l</span> <span class="o">-</span> <span class="mi">2836</span> <span class="o">*</span> <span class="n">h</span>
</span></span><span class="line"><span class="cl">    <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="mh">0x7fffffff</span><span class="p">)</span> <span class="k">if</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">t</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span>
</span></span></code></pre></div><p>Giống Golang, nhằm tránh bị tràn số thì ta dùng Schrage’s Method để tách h và l.</p>
<p>Với <code>seed</code> đó, ta sinh giá trị ngẫu nhiên bằng hàm <code>next_16</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">next_16</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="bp">self</span><span class="o">.</span><span class="n">next_seed</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_old</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Bash 5.0 and earlier</span>
</span></span><span class="line"><span class="cl">        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="n">AND</span> <span class="n">BASH_RAND_MAX</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Bash 5.1 and later</span>
</span></span><span class="line"><span class="cl">        <span class="n">result</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">^</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="n">AND</span> <span class="mh">0xffff</span><span class="p">))</span> <span class="n">AND</span> <span class="n">BASH_RAND_MAX</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Skip if same as last</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">last</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_16</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="o">=</span> <span class="n">result</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">result</span>
</span></span></code></pre></div><p>Có 2 phiên bản khác nhau:</p>
<ul>
<li>Từ bản Bash 5.0 trở xuống, ta chỉ lấy 15 bit thấp.</li>
<li>Bash 5.1 trở lên: XOR 2 giá trị 16 bit cao và 16 bit thấp của <code>seed</code> rồi trả về 15 bit cuối.</li>
</ul>
<p>Bên cạnh đó, nếu số mới giống số cũ, ta bỏ qua và tính số mới.</p>
<h3 id="khôi-phục-2">
<a class="header-anchor" href="#kh%c3%b4i-ph%e1%bb%a5c-2"></a>
Khôi phục
</h3><p>Vì ở đây, ta không có được trực tiếp $X_n$ mà chỉ lấy được giá trị của nó sau hàm <code>next_16</code> nên không thể truy ngược được Park-Miller LCG. Do đó, kỹ thuật mình có thể sử dụng ở đây để crack là brute-force.</p>
<p>Mặt khác <code>output</code> chỉ cho 15 bit, trong khi <code>state</code> có 31 bit, thế nên chắc chắn có rất nhiều <code>state</code> cho ra cùng 1 giá trị <code>output</code>. Để lọc được <code>state</code> phù hợp, ta cần nhiều giá trị <code>output</code> liên tiếp để chắc chắn tìm được duy nhất 1 <code>state.</code> Nếu không có nhiều <code>output</code> như vậy, ta có thể tìm những <code>state</code> phù hợp để thử và tìm ra kết quả cuối cùng.</p>
<p>Do <code>seed</code> có 32 bit, ta nên sử dụng nhiều luồng nhằm chia các khoảng của nó và chạy các task song song để giảm thời gian thực hiện và tối ưu hóa bộ nhớ. Ở đây, mình sử dụng Pool của thư viện multiprocessing trong Python để chia luồng, rồi thực hiện các task duyệt, so sánh với đầu ra cho trước và trả về <code>seed</code> nếu khớp.
Full code ở <a href="https://github.com/R1MURUN0PR0/Crack_random/blob/main/bash_random/crack.py">đây</a>&hellip;</p>
<h2 id="all-code-in-github">
<a class="header-anchor" href="#all-code-in-github"></a>
All code in Github
</h2><p><a href="https://github.com/R1MURUN0PR0/Crack_random/tree/main">https://github.com/R1MURUN0PR0/Crack_random/tree/main</a></p>
<h2 id="tài-liệu">
<a class="header-anchor" href="#t%c3%a0i-li%e1%bb%87u"></a>
Tài liệu
</h2><ol>
<li><a href="https://soon.haari.me/import-random/">https://soon.haari.me/import-random/</a></li>
<li><a href="https://rbtree.blog/posts/2021-05-18-breaking-python-random-module/">https://rbtree.blog/posts/2021-05-18-breaking-python-random-module/</a></li>
<li><a href="https://github.com/JorianWoltjer/BashRandomCracker?tab=readme-ov-file">https://github.com/JorianWoltjer/BashRandomCracker?tab=readme-ov-file</a></li>
<li><a href="https://en.wikipedia.org/wiki/Xorshift">https://en.wikipedia.org/wiki/Xorshift</a></li>
<li><a href="https://github.com/maple3142/gf2bv">https://github.com/maple3142/gf2bv</a></li>
<li><a href="https://www.mscs.dal.ca/~selinger/random/">https://www.mscs.dal.ca/~selinger/random/</a></li>
<li><a href="https://github.com/d0nutptr/v8_rand_buster">https://github.com/d0nutptr/v8_rand_buster</a></li>
</ol>
</div>
    <footer class="article-footer"><blockquote class="article-copyright"><p><strong><span class="icon-user icon"></span>Author: </strong>r1muru</p><p>
      <strong><span class="icon-link icon"></span>Permalink: </strong><a href="http://localhost:45075/post/crackrandommodule/">http://localhost:45075/post/crackrandommodule/</a>
    </p><p>
      
      <strong><span class="icon-copyright icon"></span>License: </strong>
      All articles on this blog are licensed under the <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener nofollow noreferrer" target="_blank"><span class="icon-creative-commons"></span>BY-NC-SA</a> license agreement unless otherwise stated. Please indicate the source when reprinting!
    </p>
    <span class="icon-creative-commons article-copyright-bg"></span></blockquote>
<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item" data-aos="zoom-in">
      <a
        class="article-tag-list-link"
        href="/tags/ctf"
        rel="tag"
        >CTF</a
      >
    </li><li class="article-tag-list-item" data-aos="zoom-in">
      <a
        class="article-tag-list-link"
        href="/tags/cryptography"
        rel="tag"
        >CRYPTOGRAPHY</a
      >
    </li><li class="article-tag-list-item" data-aos="zoom-in">
      <a
        class="article-tag-list-link"
        href="/tags/research"
        rel="tag"
        >RESEARCH</a
      >
    </li></ul>
</footer>
  </div><nav
    id="article-nav"
    aria-label="Article navigation"
    data-aos="fade-up"
  ><div class="article-nav-link-wrap left"><img
            data-src="/images/imaginary.jpg"
            data-sizes="auto"
            alt="ImaginaryCTF 2025"
            class="lazyload"
          /><a
          href="/post/imaginaryctf2025/"
          aria-label="Prev:ImaginaryCTF 2025"
          title="Prev:ImaginaryCTF 2025"
        ></a>
        <div class="article-nav-caption">Prev</div>
        <h3 class="article-nav-title">ImaginaryCTF 2025</h3>
      </div><div class="article-nav-link-wrap right"><img
            data-src="/images/mctf/mctf.png"
            data-sizes="auto"
            alt="M*CTF Quals 2025"
            class="lazyload"
          /><a
          href="/post/mctfquals2025/"
          aria-label="Next:M*CTF Quals 2025"
          title="Next:M*CTF Quals 2025"
        ></a>
        <div class="article-nav-caption">Next</div>
        <h3 class="article-nav-title">M*CTF Quals 2025</h3>
      </div></nav></article></section>
        </div><footer id="footer" aria-label="Site footer">
  <div style="width: 100%; overflow: hidden">
    <div class="footer-line"></div>
  </div>
  <div id="footer-info"><div>
      <span class="icon-copyright"></span>2024-2025<span class="footer-info-sep rotate"></span>
      r1muru
    </div><div>
        Powered by&nbsp;<a
          href="https://gohugo.io/"
          target="_blank"
          rel="noopener nofollow noreferrer"
          >Hugo</a
        >&nbsp; Theme.<a
          href="https://github.com/D-Sketon/hugo-theme-reimu"
          target="_blank"
          rel="noopener nofollow noreferrer"
          >Reimu</a
        >
      </div><div>
        <span class="icon-brush"
          >&nbsp;30.1k</span
        >
        &nbsp;|&nbsp;
        <span class="icon-coffee">&nbsp;02:27</span>
      </div><div>
        <span class="icon-eye"></span>
        <span id="busuanzi_container_site_pv"
          >Number of visits&nbsp;<span
            id="busuanzi_value_site_pv"
          ></span
        ></span>
        &nbsp;|&nbsp;
        <span class="icon-user"></span>
        <span id="busuanzi_container_site_uv"
          >Number of visitors&nbsp;<span
            id="busuanzi_value_site_uv"
          ></span
        ></span>
      </div></div>
</footer>
<div class="sidebar-top">
            <div class="sidebar-top-taichi rotate"></div>
            <div class="arrow-up"></div>
          </div><div id="mask" class="hide"></div>
      </div><nav id="mobile-nav" aria-label="Mobile navigation">
  <div class="sidebar-wrap"><div class="sidebar-toc-sidebar"><h3 class="toc-title">Contents</h3>
<div class="sidebar-toc-wrapper toc-div-class">
  <nav id="TableOfContents">
  <ul>
    <li><a href="#1-python">1. Python</a>
      <ul>
        <li><a href="#mersenne-twister">Mersenne Twister</a></li>
        <li><a href="#khôi-phục-từ-đầu-ra-đầy-đủ-32-bit">Khôi phục từ đầu ra đầy đủ 32-bit</a></li>
      </ul>
    </li>
    <li><a href="#2-javascript">2. Javascript</a>
      <ul>
        <li><a href="#khôi-phục-trạng-thái-từ-một-lượng-giá-trị-ngẫu-nhiên-được-cho">Khôi phục trạng thái từ một lượng giá trị ngẫu nhiên được cho</a></li>
      </ul>
    </li>
    <li><a href="#3-cc">3. C/C++</a>
      <ul>
        <li><a href="#thuật-toán">Thuật toán</a></li>
        <li><a href="#khôi-phục">Khôi phục</a></li>
      </ul>
    </li>
    <li><a href="#4-golang">4. Golang</a>
      <ul>
        <li><a href="#thuật-toán-1">Thuật toán</a></li>
        <li><a href="#khôi-phục-1">Khôi phục</a></li>
      </ul>
    </li>
    <li><a href="#5-bash">5. Bash</a>
      <ul>
        <li><a href="#thuật-toán-2">Thuật toán</a></li>
        <li><a href="#khôi-phục-2">Khôi phục</a></li>
      </ul>
    </li>
    <li><a href="#all-code-in-github">All code in Github</a></li>
    <li><a href="#tài-liệu">Tài liệu</a></li>
  </ul>
</nav>
</div></div>
        <div class="sidebar-common-sidebar hidden"><div class="sidebar-author">
  <img
    data-src="/avatar/avatar.png"
    data-sizes="auto"
    alt="r1muru"
    class="lazyload"
  />
  <div class="sidebar-author-name">r1muru</div>
  <div class="sidebar-description">Life is not fair, get used to it</div>
</div>
<div class="sidebar-state">
  <div class="sidebar-state-article">
    <div>Posts</div><div class="sidebar-state-number">11</div>
  </div>
  <a class="sidebar-state-category" href="/categories/" aria-label="sidebar-state-category-link">
    <div>Categories</div>
    <div class="sidebar-state-number">
      3
    </div>
  </a>
  <a class="sidebar-state-tag" href="/tags/" aria-label="sidebar-state-tag-link">
    <div>Tags</div>
    <div class="sidebar-state-number">8</div>
  </a>
</div>
<div class="sidebar-social"><div class="icon-discord sidebar-social-icon">
      <a
        href="https://discordapp.com/users/r1muru2006"
        itemprop="url"
        target="_blank"
        aria-label="discord"
        rel="noopener nofollow noreferrer"
      ></a>
    </div><div class="icon-email sidebar-social-icon">
      <a
        href="cuongchu200@gmail.com"
        itemprop="url"
        target="_blank"
        aria-label="email"
        rel="noopener nofollow noreferrer"
      ></a>
    </div><div class="icon-facebook sidebar-social-icon">
      <a
        href="https://www.facebook.com/chu.cuong.732399"
        itemprop="url"
        target="_blank"
        aria-label="facebook"
        rel="noopener nofollow noreferrer"
      ></a>
    </div><div class="icon-github sidebar-social-icon">
      <a
        href="https://github.com/r1muru2006"
        itemprop="url"
        target="_blank"
        aria-label="github"
        rel="noopener nofollow noreferrer"
      ></a>
    </div><div class="icon-instagram sidebar-social-icon">
      <a
        href="https://www.instagram.com/r1murun0pr0"
        itemprop="url"
        target="_blank"
        aria-label="instagram"
        rel="noopener nofollow noreferrer"
      ></a>
    </div></div>
<div class="sidebar-menu"><div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/"
        aria-label="Home"
      ></a>
      <div class='sidebar-menu-icon icon '>&#xf015;</div>
      <div class="sidebar-menu-link">Home</div>
    </div><div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/archives"
        aria-label="Archives"
      ></a>
      <div class='sidebar-menu-icon icon '>&#xf187;</div>
      <div class="sidebar-menu-link">Archives</div>
    </div><div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/about"
        aria-label="About"
      ></a>
      <div class='sidebar-menu-icon icon '>&#xf007;</div>
      <div class="sidebar-menu-link">About</div>
    </div></div>
</div></div><div class="sidebar-btn-wrapper">
        <div class="sidebar-toc-btn current"></div>
        <div class="sidebar-common-btn"></div>
      </div></nav>
</div><div class="site-search">
        <div class="reimu-popup popup">
          <div class="reimu-search">
            <div class="reimu-search-input-icon"></div>
            <div id="reimu-search-input"></div>
            <div class="popup-btn-close"></div>
          </div>
          <div class="reimu-results">
            <div id="reimu-stats"></div>
            <div id="reimu-hits"></div>
            <div id="reimu-pagination" class="reimu-pagination"></div>
          </div>
          <img class="reimu-bg" src="/images/reimu.png" />
        </div>
      </div><script
    src="https://npm.webcache.cn/lazysizes@5.3.2/lazysizes.min.js"
    integrity="sha384-3gT/vsepWkfz/ff7PpWNUeMzeWoH3cDhm/A8jM7ouoAK0/fP/9bcHHR5kHq2nf&#43;e" crossorigin="anonymous"></script><script
    src="https://npm.webcache.cn/clipboard@2.0.11/dist/clipboard.min.js"
    integrity="sha384-J08i8An/QeARD9ExYpvphB8BsyOj3Gh2TSh1aLINKO3L0cMSH2dN3E22zFoXEi0Q" crossorigin="anonymous"></script><script src="/js/main.js" ></script><script src="/js/aos.js" ></script><script>
    var aosInit = () => {
      AOS.init({
        duration: 1000,
        easing: "ease",
        once: true,
        offset: 50,
      });
    };
    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", aosInit);
    } else {
      aosInit();
    }
  </script><script src="/js/pjax_main.js" data-pjax></script><script>
    var ALGOLIA_CONFIG = {
      logo: '\/images\/algolia_logo.svg',
      algolia: {
        applicationID: "RAY96S32HW",
        apiKey: "53e71efc7b6ca695cdb630e780aeae50",
        indexName: "my-blog",
        hits: {
          "per_page": parseInt("10")
        },
        labels: {
          "input_placeholder": 'Search.....',
          "hits_empty": 'No results found for 「${query}」',
          "hits_stats": 'Found ${hits} results (in ${time} ms)'
        }
      }
    };
  </script><script
    src="https://npm.webcache.cn/algoliasearch@4.17.1/dist/algoliasearch-lite.umd.js"
    deferintegrity="sha384-xvLS0jfKuoREs7pqkRI/OI8GcqohO5S&#43;jQz7ZBtQXnsXmD&#43;9jDOOY4cL6dCPzlrk" crossorigin="anonymous"></script><script
    src="https://npm.webcache.cn/@reimujs/instantsearch.js@4.57.0-beta.1/dist/instantsearch.production.min.js"
    deferintegrity="sha384-aagKMe8nkqaP2DYQc8kkYOL5l&#43;M5Q2WH/Uhr4teOh0Ybp0RZj0kUSDm45qPikMjK" crossorigin="anonymous"></script><script src="/js/algolia_search.js" ></script><script
    src="https://npm.webcache.cn/mouse-firework@0.1.1/dist/index.umd.js"
    integrity="sha384-8LyaidD9GPxQQgLJO/WRw/O2h3BoNq/ApI/ecpvM6RsrCz2qP2ppBXUKihP4V/2d" crossorigin="anonymous"></script><script>
  if (! false  || !window.matchMedia('(max-width: 768px)').matches) {
    if (window.firework) {
      const options = JSON.parse("{\"excludeelements\":[\"a\",\"button\"],\"particles\":[{\"colors\":[\"var(--red-1)\",\"var(--red-2)\",\"var(--red-3)\",\"var(--red-4)\"],\"duration\":[1200,1800],\"easing\":\"easeOutExpo\",\"move\":[\"emit\"],\"number\":20,\"shape\":\"circle\",\"shapeOptions\":{\"alpha\":[0.3,0.5],\"radius\":[16,32]}},{\"colors\":[\"var(--red-0)\"],\"duration\":[1200,1800],\"easing\":\"easeOutExpo\",\"move\":[\"diffuse\"],\"number\":1,\"shape\":\"circle\",\"shapeOptions\":{\"alpha\":[0.2,0.5],\"lineWidth\":6,\"radius\":20}}]}");
      options.excludeElements = options.excludeelements;
      delete options.excludeelements;
      window.firework(options);
    }
  }
</script><script
    src="https://npm.webcache.cn/theme-shokax-pjax@0.0.3/dist/index.umd.js"
    integrity="sha384-xneY1WY8hOfUzswrE4CrYq35N4BdVcxqxwHPr9zawE/jMSCxD&#43;jAPU55x/jj3wlf" crossorigin="anonymous"></script><script src="/js/pjax.js" ></script>

<div id="lazy-script">
  <div><script data-pjax>
        window.REIMU_POST = {
          author: "r1muru",
          title: "Crack Random Modules",
          url: "http:\/\/localhost:45075\/post\/crackrandommodule\/",
          description: "Bạn muốn thắng Vietlott, blog này là dành cho bạn...",
          cover: "http:\/\/localhost:45075\/images\/random.webp",
        };
      </script><script src="/js/insert_highlight.js" data-pjax></script><script src="/js/tabs.js" data-pjax></script><script type="module" data-pjax>const PhotoSwipeLightbox = (await safeImport("https:\/\/npm.webcache.cn\/photoswipe@5.4.4\/dist\/photoswipe-lightbox.esm.min.js", "sha384-DiL6M\/gG\u002bwmTxmCRZyD1zee6lIhawn5TGvED0FOh7fXcN9B0aZ9dexSF\/N6lrZi\/")).default;const initPswp = (gallery, children) => {
          if (_$$(`${gallery} ${children}`).length > 0) {
            new PhotoSwipeLightbox({
              gallery,
              children,pswpModule: () => safeImport("https:\/\/npm.webcache.cn\/photoswipe@5.4.4\/dist\/photoswipe.esm.min.js", "sha384-WkkO3GCmgkC3VQWpaV8DqhKJqpzpF9JoByxDmnV8\u002boTJ7m3DfYEWX1fu1scuS4\u002bs")}).init();
          }
        }
        const pswp = () => {
          initPswp('.article-entry', 'a.article-gallery-item');
          initPswp('.article-gallery', 'a.article-gallery-item');
          window.lightboxStatus = 'done';
          window.removeEventListener('lightbox:ready', pswp);
        }
        if(window.lightboxStatus === 'ready') {
          pswp()
        } else {
          window.addEventListener('lightbox:ready', pswp);
        }
      </script><script
    src="https://npm.webcache.cn/katex@0.16.24/dist/katex.min.js"
    data-pjaxintegrity="sha384-MWNUH0WmtsYGhn2cbH6ELRCbf9LG3QDqCC&#43;gqPB3IBNO35xjZK3Ejb6oONRpDbPg" crossorigin="anonymous"></script><script
    src="https://npm.webcache.cn/katex@0.16.24/dist/contrib/auto-render.min.js"
    data-pjaxintegrity="sha384-hCXGrW6PitJEwbkoStFjeJxv&#43;fSOOQKOPbJxSfM6G5sWZjAyWhXiTIIAmQqnlLlh" crossorigin="anonymous"></script><script data-pjax>
          var renderMath = () => {
            if (!window.renderMathInElement) return;
            window.renderMathInElement(_$("article"), {
              delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "\\[", right: "\\]", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
              ],
            });
          };
          if (document.readyState === "loading") {
            document.addEventListener("DOMContentLoaded", renderMath, { once: true });
          } else {
            renderMath();
          }
        </script></div>
</div><script
    src="https://npm.webcache.cn/busuanzi@2.3.0/bsz.pure.mini.js"
    asyncintegrity="sha384-0M75wtSkhjIInv4coYlaJU83&#43;OypaRCIq2SukQVQX04eGTCBXJDuWAbJet56id&#43;S" crossorigin="anonymous"></script><script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.getRegistrations().then((registrations) => {
        for (let registration of registrations) {
          registration.unregister();
        }
      });
    }
  </script><script>
  const reimuCopyright = String.raw`
   ______     ______     __     __    __     __  __    
  /\  == \   /\  ___\   /\ \   /\ "-./  \   /\ \/\ \   
  \ \  __<   \ \  __\   \ \ \  \ \ \-./\ \  \ \ \_\ \  
   \ \_\ \_\  \ \_____\  \ \_\  \ \_\ \ \_\  \ \_____\ 
    \/_/ /_/   \/_____/   \/_/   \/_/  \/_/   \/_____/ 
                                                    
  `;
  console.log(String.raw`%c ${reimuCopyright}`, "color: #ff5252;");
  console.log(
    "%c Theme.Reimu" + " %c https://github.com/D-Sketon/hugo-theme-reimu ",
    "color: white; background: #ff5252; padding:5px 0;",
    "padding:4px;border:1px solid #ff5252;",
  );
</script><script
    src="https://npm.webcache.cn/aplayer@1.10.1/dist/APlayer.min.js"
    integrity="sha384-gdGYZwHnfJM54evoZhpO0s6ZF5BQiybkiyW7VXr&#43;h5UfruuRL/aORyw&#43;5&#43;HZoU6e" crossorigin="anonymous"></script><script>
    if (! false  || !window.matchMedia('(max-width: 768px)').matches) {
      if (window.matchMedia('(max-width: 959px)').matches) {
        const meting = _$('meting-js');
        if (meting) {
          meting.setAttribute('fixed', 'true');
          const aside = meting.parentNode?.parentNode;
          if (aside?.tagName === 'ASIDE') {
            meting.parentNode.removeChild(meting);
            document.body.appendChild(meting);
          }
        }
      }
      const script = document.createElement('script');
      script.src = "https:\/\/npm.webcache.cn\/meting@2.0.1\/dist\/Meting.min.js";
      script.integrity = "sha384-ASVlpKF80A22OXTK3tfEjZm1EL6uFMKIC4p8\u002b0maanw1S\/IyB\u002bY4JG\u002bZDU7GpKE8";
      script.crossOrigin = "anonymous";
      document.body.appendChild(script);
    }
  </script></body>
</html>
