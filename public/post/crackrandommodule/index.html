<!doctype html>
<html
  lang="en-us" 
  data-theme-mode="auto"
  >
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8" />
<meta
  name="viewport"
  content="width=device-width, initial-scale=1, shrink-to-fit=no"
/><title>
  Crack Random Modules | r1muru
</title>
<meta name="description" content="Bạn muốn thắng Vietlott, blog này là dành cho bạn..."/><script>
  window.siteConfig = JSON.parse("{\"anchor_icon\":null,\"base\":\"http://localhost:1313/\",\"clipboard\":{\"copyright\":{\"count\":50,\"enable\":false,\"license_type\":\"by-nc-sa\"},\"fail\":{\"en\":\"Copy failed (ﾟ⊿ﾟ)ﾂ\",\"ja\":\"コピー失敗 (ﾟ⊿ﾟ)ﾂ\",\"pt-br\":\"Falha ao copiar (ﾟ⊿ﾟ)ﾂ\",\"zh-cn\":\"复制失败 (ﾟ⊿ﾟ)ﾂ\",\"zh-tw\":\"複製失敗 (ﾟ⊿ﾟ)ﾂ\"},\"success\":{\"en\":\"Copy successfully (*^▽^*)\",\"ja\":\"コピー成功 (*^▽^*)\",\"pt-br\":\"Copiado com sucesso (*^▽^*)\",\"zh-cn\":\"复制成功 (*^▽^*)\",\"zh-tw\":\"複製成功 (*^▽^*)\"}},\"code_block\":{\"expand\":true},\"icon_font\":\"4552607_4k4bc36ef96\",\"outdate\":{\"daysago\":180,\"enable\":false,\"message\":{\"en\":\"This article was last updated on {time}. Please note that the content may no longer be applicable.\",\"ja\":\"この記事は最終更新日：{time}。記載内容が現在有効でない可能性がありますのでご注意ください。\",\"pt-br\":\"Este artigo foi atualizado pela última vez em {time}. Observe que o conteúdo pode não ser mais aplicável.\",\"zh-cn\":\"本文最后更新于 {time}，请注意文中内容可能已不适用。\",\"zh-tw\":\"本文最後更新於 {time}，請注意文中內容可能已不適用。\"}}}");
  
</script>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link
  rel="preload"
  as="style"
  href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7cNoto%20Serif%20SC:400,400italic,700,700italic%7c&amp;display=swap"
/>
<link
  rel="stylesheet"
  href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7cNoto%20Serif%20SC:400,400italic,700,700italic%7c&amp;display=swap"
  media="print"
  onload="this.media='all'"
/>
<link
    rel="preload"
    href="//at.alicdn.com/t/c/font_4552607_4k4bc36ef96.woff2"
    as="font"
    type="font/woff2"
    crossorigin="anonymous"
  /><link rel="stylesheet" href="/css/loader.css" />
<meta property="og:type" content="website" />
  <meta property="og:title" content="Crack Random Modules | r1muru" />
  <meta
    property="og:description"
    content="Bạn muốn thắng Vietlott, blog này là dành cho bạn..."
  />
  <meta property="og:url" content="http://localhost:1313/post/crackrandommodule/" />
  <meta
    property="og:site_name"
    content="Welcome to my world"
  />
  <meta
    property="og:image"
    content="/images/random.webp"
  />
  <meta property="article:author" content="r1muru" />
  <meta property="article:published_time" content="2025-09-15T20:31:17&#43;07:00" />
  <meta property="article:modified_time" content="2025-09-15T20:31:17&#43;07:00" /><meta property="article:tag" content="CTFCryptographyResearch" /><meta name="twitter:card" content="summary" />
  <meta name="twitter:image" content="/images/random.webp" />
<link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/css/main.css" />
<link
    rel="preload"
    as="style"
    href="https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe.css"
    integrity="sha384-IfxC36XL/toUyJ939C73PcgMuRzAZuIzZxE38drsmO5p6jD7ei&#43;Zx/1oA/0l8ysE" crossorigin="anonymous"onload="this.onload=null;this.rel='stylesheet'"
  /><link
    rel="preload"
    as="style"
    href="https://npm.webcache.cn/katex@0.16.24/dist/katex.min.css"
    integrity="sha384-tTgKLjMYmJr94v8qu2PE5MUGSMbyN2xiH266JUB3gpm8vnnJywd1dWSOEfrFz&#43;YI" crossorigin="anonymous"onload="this.onload=null;this.rel='stylesheet'"
  /><script
    src="https://npm.webcache.cn/pace-js@1.2.4/pace.min.js"
    integrity="sha384-k6YtvFUEIuEFBdrLKJ3YAUbBki333tj1CSUisai5Cswsg9wcLNaPzsTHDswp4Az8" crossorigin="anonymous"></script><link
    rel="stylesheet"
    href="https://npm.webcache.cn/@reimujs/aos@0.1.2/dist/aos.css"
    integrity="sha384-GMRP93c6Hkz9JVKGAuRR3nTS7M07RwPgTFenXiosjq2VbVgvdDNcz1g6Mkj8AONa" crossorigin="anonymous"/></head>
  <body><div id='loader'>
    <div class="loading-left-bg loading-bg"></div>
    <div class="loading-right-bg loading-bg"></div>
    <div class="spinner-box">
      <div class="loading-taichi rotate"><svg width="150" height="150" viewBox="0 0 1024 1024" class="icon" version="1.1" xmlns="https://www.w3.org/2000/svg" shape-rendering="geometricPrecision">
            <path d="M303.5 432A80 80 0 0 1 291.5 592A80 80 0 0 1 303.5 432z" fill="var(--red-1, #ff5252)" />
            <path d="M512 65A447 447 0 0 1 512 959L512 929A417 417 0 0 0 512 95A417 417 0 0 0 512 929L512 959A447 447 0 0 1 512 65z 
          M512 95A417 417 0 0 1 929 512A208.5 208.5 0 0 1 720.5 720.5L720.5 592A80 80 0 0 0 720.5 432A80 80 0 0 0 720.5 592L720.5 720.5A208.5 208.5 0 0 1 512 512A208.5 208.5 0 0 0 303.5 303.5A208.5 208.5 0 0 0 95 512A417 417 0 0 1 512 95z" fill="var(--red-1, #ff5252)" />
          </svg></div><div class="loading-word">Loading...</div>
    </div>
  </div>
  </div>
  <script>
    var time = null;
    var loaderEl = document.getElementById('loader');
    var startLoading = () => {
      time = Date.now();
      loaderEl.classList.remove("loading");
    }
    var hideLoader = () => {
      document.body.style.overflow = 'auto';
      loader.classList.add('loading');
    };

    var endLoading = () => {
      if (!time) {
        hideLoader();
      } else {
        if (Date.now() - time > 500) {
          time = null;
          hideLoader();
        } else {
          setTimeout(endLoading, 500 - (Date.now() - time));
          time = null;
        }
      }
    }
    window.addEventListener('DOMContentLoaded', endLoading);
    loaderEl.addEventListener('click', endLoading);
  </script><div id="copy-tooltip"></div>
<div id="lang-tooltip">
This article does not have a corresponding language version
</div>
<div id="heatmap-tooltip"></div><div id="container">
      <div id="wrap"><div id="header-nav">
  <nav id="main-nav" aria-label="Primary navigation"><a class="main-nav-link-wrap" href="/">
        <div class='main-nav-icon icon rotate'>&#xe62b;</div>
        <span class="main-nav-link">Home</span>
      </a><a class="main-nav-link-wrap" href="/archives">
        <div class='main-nav-icon icon rotate'>&#xe62b;</div>
        <span class="main-nav-link">Archives</span>
      </a><a class="main-nav-link-wrap" href="/about">
        <div class='main-nav-icon icon rotate'>&#xe62b;</div>
        <span class="main-nav-link">About</span>
      </a><a class="main-nav-link-wrap" href="/friend">
        <div class='main-nav-icon icon rotate'>&#xe62b;</div>
        <span class="main-nav-link">Friend</span>
      </a><a id="main-nav-toggle" class="nav-icon" aria-label="Toggle navigation" role="button"></a>
  </nav>
  <nav id="sub-nav" aria-label="Secondary navigation"></nav></div>
<header id="header" aria-label="Site header"><picture></picture>
    <img  fetchpriority="high" src="/images/random.webp" alt="Crack Random Modules"><div id="header-outer">
    <div id="header-title"><span id="logo">
            <h1 data-aos="slide-up">Crack Random Modules</h1>
          </span><h2 id="subtitle-wrap" data-aos="slide-down"></h2></div>
  </div>
</header><div id="content"
          aria-label="Page content"
          
          class="sidebar-right"  ><aside id="sidebar" aria-label="Sidebar"><div class="sidebar-wrapper-container sticky"><div class="sidebar-wrapper">
    <div
      class="sidebar-wrap"
      data-aos="fade-up"
    ><div class="sidebar-toc-sidebar"><h3 class="toc-title">Contents</h3>
<div class="sidebar-toc-wrapper toc-div-class">
  <nav id="TableOfContents">
  <ul>
    <li><a href="#1-python">1. Python</a>
      <ul>
        <li><a href="#mersenne-twister">Mersenne Twister</a></li>
        <li><a href="#khôi-phục-từ-đầu-ra-đầy-đủ-32-bit">Khôi phục từ đầu ra đầy đủ 32-bit</a></li>
      </ul>
    </li>
    <li><a href="#2-javascript">2. Javascript</a>
      <ul>
        <li><a href="#khôi-phục-trạng-thái-từ-một-lượng-giá-trị-ngẫu-nhiên-được-cho">Khôi phục trạng thái từ một lượng giá trị ngẫu nhiên được cho</a></li>
      </ul>
    </li>
    <li><a href="#3-cc">3. C/C++</a>
      <ul>
        <li><a href="#thuật-toán">Thuật toán</a></li>
        <li><a href="#khôi-phục">Khôi phục</a></li>
      </ul>
    </li>
    <li><a href="#4-golang">4. Golang</a>
      <ul>
        <li><a href="#thuật-toán-1">Thuật toán</a></li>
        <li><a href="#khôi-phục-1">Khôi phục</a></li>
      </ul>
    </li>
    <li><a href="#5-bash">5. Bash</a>
      <ul>
        <li><a href="#thuật-toán-2">Thuật toán</a></li>
        <li><a href="#khôi-phục-2">Khôi phục</a></li>
      </ul>
    </li>
    <li><a href="#all-code-in-github">All code in Github</a></li>
    <li><a href="#tài-liệu">Tài liệu</a></li>
  </ul>
</nav>
</div></div>
          <div class="sidebar-common-sidebar hidden"><div class="sidebar-author">
  <img
    data-src="/avatar/avatar.webp"
    data-sizes="auto"
    alt="r1muru"
    class="lazyload"
  />
  <div class="sidebar-author-name">r1muru</div>
  <div class="sidebar-description">Life is not fair, get used to it</div>
</div>
<div class="sidebar-state">
  <div class="sidebar-state-article">
    <div>Posts</div><div class="sidebar-state-number">9</div>
  </div>
  <a class="sidebar-state-category" href="/categories/" aria-label="sidebar-state-category-link">
    <div>Categories</div>
    <div class="sidebar-state-number">
      3
    </div>
  </a>
  <a class="sidebar-state-tag" href="/tags/" aria-label="sidebar-state-tag-link">
    <div>Tags</div>
    <div class="sidebar-state-number">7</div>
  </a>
</div>
<div class="sidebar-social"></div>
<div class="sidebar-menu"><div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/"
        aria-label="Home"
      ></a>
      <div class='sidebar-menu-icon icon rotate'>&#xe62b;</div>
      <div class="sidebar-menu-link">Home</div>
    </div><div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/archives"
        aria-label="Archives"
      ></a>
      <div class='sidebar-menu-icon icon rotate'>&#xe62b;</div>
      <div class="sidebar-menu-link">Archives</div>
    </div><div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/about"
        aria-label="About"
      ></a>
      <div class='sidebar-menu-icon icon rotate'>&#xe62b;</div>
      <div class="sidebar-menu-link">About</div>
    </div><div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/friend"
        aria-label="Friend"
      ></a>
      <div class='sidebar-menu-icon icon rotate'>&#xe62b;</div>
      <div class="sidebar-menu-link">Friend</div>
    </div></div>
</div><div class="sidebar-btn-wrapper" style="position:static">
            <div class="sidebar-toc-btn current"></div>
            <div class="sidebar-common-btn"></div>
          </div></div>
  </div><div class="sidebar-widget"></div></div></aside>
<section id="main" aria-label="Main content"><article
  class="h-entry article"
  itemscope
  itemtype="https://schema.org/BlogPosting"
>
  <div
    class="article-inner"
    data-aos="fade-up"
  >
    <div class="article-meta"><div class="article-date">
  <span
    class="article-date-link icon-calendar"
    data-aos="zoom-in"
  >
    <time datetime="2025-09-15 20:31:17 &#43;0700 &#43;07" itemprop="datePublished"
      >2025-09-15</time
    >
    <time style="display: none;" id="post-update-time"
      >2025-09-15</time
    >
  </span></div>
<div class="article-category"><a
      class="article-category-link"
      href="/categories/learning"
      data-aos="zoom-in"
      >LEARNING</a
    ></div>
</div><div class="hr-line"></div><div class="e-content article-entry" itemprop="articleBody"><p>Khởi động nhẹ nhàng: <a href="https://www.youtube.com/watch?v=-h_rj2-HP2E">How To Predict Random Numbers Generated By Computers</a></p>
<h2 id="1-python">
<a class="header-anchor" href="#1-python"></a>
1. Python
</h2><p>Hàm random của Python sử dụng thuật toán <a href="https://en.wikipedia.org/wiki/Mersenne_Twister">Mersenne Twister</a> - với 624 số nguyên 32 bit làm trạng thái, sau đó cứ mỗi lần xuất ra một số nguyên 32 bit, nó sẽ thay đổi trạng thái.</p>
<h3 id="mersenne-twister">
<a class="header-anchor" href="#mersenne-twister"></a>
Mersenne Twister
</h3><p>Ta sẽ phân tích thuật toán tạo số ngẫu nhiên trong khoảng <code>[0,0xffffffff]</code>: <a href="https://github.com/python/cpython/blob/23362f8c301f72bbf261b56e1af93e8c52f5b6cf/Modules/_randommodule.c">Link</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">/* Period parameters -- These are all magic.  Don&#39;t change. */</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#define N 624
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define M 397
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define MATRIX_A 0x9908b0dfU    </span><span style="color:#75715e">/* constant vector a */</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define UPPER_MASK 0x80000000U  </span><span style="color:#75715e">/* most significant w-r bits */</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define LOWER_MASK 0x7fffffffU  </span><span style="color:#75715e">/* least significant r bits */</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">static</span> <span style="color:#66d9ef">uint32_t</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">genrand_uint32</span>(RandomObject <span style="color:#f92672">*</span>self)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">uint32_t</span> y;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">uint32_t</span> mag01[<span style="color:#ae81ff">2</span>] <span style="color:#f92672">=</span> {<span style="color:#ae81ff">0x0U</span>, MATRIX_A};
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/* mag01[x] = x * MATRIX_A  for x=0,1 */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">uint32_t</span> <span style="color:#f92672">*</span>mt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    mt <span style="color:#f92672">=</span> self<span style="color:#f92672">-&gt;</span>state;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (self<span style="color:#f92672">-&gt;</span>index <span style="color:#f92672">&gt;=</span> N) { <span style="color:#75715e">/* generate N words at one time */</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> kk;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (kk<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>;kk<span style="color:#f92672">&lt;</span>N<span style="color:#f92672">-</span>M;kk<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>            y <span style="color:#f92672">=</span> (mt[kk]ANDUPPER_MASK)<span style="color:#f92672">|</span>(mt[kk<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>]ANDLOWER_MASK);
</span></span><span style="display:flex;"><span>            mt[kk] <span style="color:#f92672">=</span> mt[kk<span style="color:#f92672">+</span>M] <span style="color:#f92672">^</span> (y <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">^</span> mag01[y AND <span style="color:#ae81ff">0x1U</span>];
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (;kk<span style="color:#f92672">&lt;</span>N<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;kk<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>            y <span style="color:#f92672">=</span> (mt[kk]ANDUPPER_MASK)<span style="color:#f92672">|</span>(mt[kk<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>]ANDLOWER_MASK);
</span></span><span style="display:flex;"><span>            mt[kk] <span style="color:#f92672">=</span> mt[kk<span style="color:#f92672">+</span>(M<span style="color:#f92672">-</span>N)] <span style="color:#f92672">^</span> (y <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">^</span> mag01[y AND <span style="color:#ae81ff">0x1U</span>];
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        y <span style="color:#f92672">=</span> (mt[N<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]ANDUPPER_MASK)<span style="color:#f92672">|</span>(mt[<span style="color:#ae81ff">0</span>]ANDLOWER_MASK);
</span></span><span style="display:flex;"><span>        mt[N<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> mt[M<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">^</span> (y <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">^</span> mag01[y AND <span style="color:#ae81ff">0x1U</span>];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">-&gt;</span>index <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    y <span style="color:#f92672">=</span> mt[self<span style="color:#f92672">-&gt;</span>index<span style="color:#f92672">++</span>];
</span></span><span style="display:flex;"><span>    y <span style="color:#f92672">^=</span> (y <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">11</span>);
</span></span><span style="display:flex;"><span>    y <span style="color:#f92672">^=</span> (y <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">7</span>) AND <span style="color:#ae81ff">0x9d2c5680U</span>;
</span></span><span style="display:flex;"><span>    y <span style="color:#f92672">^=</span> (y <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">15</span>) AND <span style="color:#ae81ff">0xefc60000U</span>;
</span></span><span style="display:flex;"><span>    y <span style="color:#f92672">^=</span> (y <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">18</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> y;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Nếu <code>index &gt;= N (= 624)</code>, nghĩa là đã dùng hết số trong mảng <code>mt[]</code> và do đó phải tạo lại 624 số tiếp theo. Mảng <code>mt[]</code> được thay đổi bằng quá trình sau:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>y <span style="color:#f92672">=</span> (mt[kk] AND UPPER_MASK) <span style="color:#f92672">|</span> (mt[(kk <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">%</span> N] AND LOWER_MASK)
</span></span><span style="display:flex;"><span>mt[kk] <span style="color:#f92672">=</span> mt[(kk <span style="color:#f92672">+</span> M) <span style="color:#f92672">%</span> N] <span style="color:#f92672">^</span> (y <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">^</span> mag01[y AND <span style="color:#ae81ff">0x1U</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>y <span style="color:#f92672">=</span> (mt[N<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]ANDUPPER_MASK)<span style="color:#f92672">|</span>(mt[<span style="color:#ae81ff">0</span>]ANDLOWER_MASK);
</span></span><span style="display:flex;"><span>mt[N<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> mt[M<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">^</span> (y <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">^</span> mag01[y AND <span style="color:#ae81ff">0x1U</span>];
</span></span></code></pre></div><p>Sau đó, số <code>y</code> ngẫu nhiên được tạo như sau:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>y <span style="color:#f92672">=</span> mt[self<span style="color:#f92672">-&gt;</span>index<span style="color:#f92672">++</span>];
</span></span><span style="display:flex;"><span>y <span style="color:#f92672">^=</span> (y <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">11</span>);
</span></span><span style="display:flex;"><span>y <span style="color:#f92672">^=</span> (y <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">7</span>) AND <span style="color:#ae81ff">0x9d2c5680U</span>;
</span></span><span style="display:flex;"><span>y <span style="color:#f92672">^=</span> (y <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">15</span>) AND <span style="color:#ae81ff">0xefc60000U</span>;
</span></span><span style="display:flex;"><span>y <span style="color:#f92672">^=</span> (y <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">18</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">return</span> y;
</span></span></code></pre></div><p>Do đó, nếu ta có thể đảo ngược được quá trình này thì ta có thể dự đoán giá trị tiếp theo khi biết được 624 đầu ra 32 bit.</p>
<h3 id="khôi-phục-từ-đầu-ra-đầy-đủ-32-bit">
<a class="header-anchor" href="#kh%c3%b4i-ph%e1%bb%a5c-t%e1%bb%ab-%c4%91%e1%ba%a7u-ra-%c4%91%e1%ba%a7y-%c4%91%e1%bb%a7-32-bit"></a>
Khôi phục từ đầu ra đầy đủ 32-bit
</h3><p>Sau đây là các bước đảo ngược chi tiết:
<code>y ^= (y &gt;&gt; 18)</code></p>
<p>Đây là dịch phải 18 bit, ảnh hưởng từ bit cao tới bit thấp và sau bước này thì bit cao không thay đổi cùng với việc $18*2 = 36 &gt; 32$ nên ta chỉ cần 1 lần đảo là được.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Step 1</span>
</span></span><span style="display:flex;"><span>y <span style="color:#f92672">^=</span> (y <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">18</span>)
</span></span></code></pre></div><p><code>y ^= (y &lt;&lt; 15) AND 0xefc60000</code></p>
<p>Ở đây, mask 0xefc60000 có cấu trúc đặc biệt với làm phép biển đổi trở thành 1 hàm tự nghịch đảo, nghĩa là $f(f(x))=x$, với $f(x) = x \oplus ((x &laquo; 15)$ AND 0xefc60000). Chứng minh:</p>
<ul>
<li>Đặt A = 0xefc60000. Khi đó:</li>
</ul>
<p>$f(y)=f(f(x)) = f(x \oplus ((x &laquo; 15) AND \ A))$</p>
<p>$= (x \oplus ((x &laquo; 15) AND \ A)) \oplus (((x \oplus ((x &laquo; 15) AND \ A)) &laquo; 15) AND \ A)$</p>
<p>$= (x \oplus ((x &laquo; 15) AND \ A)) \oplus (((x &laquo; 15) AND \ A) \oplus((x &laquo; 30) AND (A &laquo; 15) AND \ A))$</p>
<p>$= x \oplus (((x &laquo; 15) AND \ A) \oplus ((x &laquo; 15) AND \ A)) \oplus((x &laquo; 30) AND (A &laquo; 15) \ AND \ A) = x$</p>
<p>(vì tính chất $P \oplus P = 0$ và $A$ có 17 bit thấp là 0 nên nếu dịch trái 15 bit thì 32 bit cuối của $A &laquo; 15$ sẽ đều là 0 nên $(A &laquo; 15) AND \ A = 0$)</p>
<p>Do đó, để đảo ngược thì ta chỉ cần 1 lần biến đổi hàm nữa:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Step 2</span>
</span></span><span style="display:flex;"><span>y <span style="color:#f92672">^=</span> (y <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">15</span>) AND <span style="color:#ae81ff">0xefc60000</span>
</span></span></code></pre></div><p><code>y ^= (y &lt;&lt; 7) AND 0x9d2c5680</code></p>
<p>Ở bước này thì ta sẽ thiết lập một hàm dịch bit gần tương tự như bước trên:</p>
<ul>
<li>Đặt B = 0x9d2c5680.
Với $y = x \oplus ((x &laquo; 7) AND \ B)$
, ta sẽ dùng hàm $f(x&rsquo;) = y \oplus ((x&rsquo; &laquo; 7) AND \ B)$
Khi đó:</li>
</ul>
<p>$f_4(y) = f_4(x \oplus ((x &laquo; 7) AND \ B)) = f_3(y \oplus (((x \oplus ((x &laquo; 7) AND \ B)) &laquo; 7)AND \ B))$</p>
<p>$= f_3(x \oplus (((x &laquo; 7) AND \ B) \oplus ((x &laquo; 7) AND \ B)) \oplus((x &laquo; (7\times2))AND (B &laquo; 7) AND \ B))$</p>
<p>$= f_3(x \oplus((x &laquo; (7\times2))AND (B &laquo; 7) AND \ B))$</p>
<p>$= f_2(x \oplus((x &laquo; (7\times3))AND (B &laquo; (7\times2)) AND (B &laquo; 7) AND \ B))$</p>
<p>$= f(x \oplus((x &laquo; (7\times4))AND (B&laquo; (7\times3)) AND (B &laquo; (7\times2)) AND (B &laquo; 7) AND \ B))$</p>
<p>$= x \oplus((x &laquo; (7\times5))AND (B&laquo; (7\times4)) AND (B&laquo; (7\times3)) AND (B &laquo; (7\times2)) AND (B &laquo; 7) AND \ B)$</p>
<p>$=x$</p>
<p>(vì B có 7 bit thấp là 0 nên nếu dịch trái 28 bit thì 32 bit cuối của $B &laquo; 28$ sẽ đều là 0 nên đẳng thức trên xảy ra.)</p>
<p>Do đó, để đảo ngược thì ta chỉ cần 4 lần biến đổi hàm như sau:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Step 3</span>
</span></span><span style="display:flex;"><span>res <span style="color:#f92672">=</span> y
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">4</span>):
</span></span><span style="display:flex;"><span>    res <span style="color:#f92672">=</span> y <span style="color:#f92672">^</span> (res <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">7</span>) AND <span style="color:#ae81ff">0x9d2c5680</span>
</span></span><span style="display:flex;"><span>y <span style="color:#f92672">=</span> res
</span></span></code></pre></div><p><code>y ^= (y &gt;&gt; 11)</code>
Đây là dịch phải 11 bit, ảnh hưởng từ bit cao tới bit thấp và sau bước này thì bit cao không thay đổi cùng với việc $11*3 = 33 &gt; 32$ nên ta chỉ cần 2 lần đảo để khôi phục từ bit cao đến bit thấp.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Step 4</span>
</span></span><span style="display:flex;"><span>res <span style="color:#f92672">=</span> y
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">2</span>):
</span></span><span style="display:flex;"><span>    res <span style="color:#f92672">=</span> y <span style="color:#f92672">^</span> (res <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">11</span>)
</span></span></code></pre></div><p>Tổng hợp lại thì ta có hàm đảo (untemper):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">untemper</span>(y):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 1. Rev: y ^= (y &gt;&gt; 18)</span>
</span></span><span style="display:flex;"><span>    y <span style="color:#f92672">^=</span> (y <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">18</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 2. Rev: y ^= (y &lt;&lt; 15) AND 0xefc60000</span>
</span></span><span style="display:flex;"><span>    y <span style="color:#f92672">^=</span> (y <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">15</span>) AND <span style="color:#ae81ff">0xefc60000</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 3. Rev: y ^= (y &lt;&lt; 7) AND 0x9d2c5680</span>
</span></span><span style="display:flex;"><span>    temp <span style="color:#f92672">=</span> y
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">4</span>):
</span></span><span style="display:flex;"><span>        temp <span style="color:#f92672">=</span> y <span style="color:#f92672">^</span> (temp <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">7</span>) AND <span style="color:#ae81ff">0x9d2c5680</span>
</span></span><span style="display:flex;"><span>    y <span style="color:#f92672">=</span> temp
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 4. Rev: y ^= (y &gt;&gt; 11);</span>
</span></span><span style="display:flex;"><span>    temp <span style="color:#f92672">=</span> y
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">2</span>):
</span></span><span style="display:flex;"><span>        temp <span style="color:#f92672">=</span> y <span style="color:#f92672">^</span> (temp <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">11</span>)
</span></span><span style="display:flex;"><span>    y <span style="color:#f92672">=</span> temp
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> y
</span></span></code></pre></div><p>Ví dụ cụ thể:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> random
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>state <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>getstate()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>outputs <span style="color:#f92672">=</span> [random<span style="color:#f92672">.</span>getrandbits(<span style="color:#ae81ff">32</span>) <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1000</span>)]
</span></span><span style="display:flex;"><span>recovered_state <span style="color:#f92672">=</span> (<span style="color:#ae81ff">3</span>, tuple([untemper(v) <span style="color:#66d9ef">for</span> v <span style="color:#f92672">in</span> outputs[:<span style="color:#ae81ff">624</span>]] <span style="color:#f92672">+</span> [<span style="color:#ae81ff">0</span>]), <span style="color:#66d9ef">None</span>)
</span></span><span style="display:flex;"><span>random<span style="color:#f92672">.</span>setstate(recovered_state)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1000</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">assert</span> outputs[i] <span style="color:#f92672">==</span> random<span style="color:#f92672">.</span>getrandbits(<span style="color:#ae81ff">32</span>)
</span></span></code></pre></div><ul>
<li>State được phục hồi có 3 phần tử:</li>
</ul>
<ol>
<li>Số nguyên 3, là chỉ số &ldquo;vị trí trạng thái&rdquo; được module random của Python sử dụng để chỉ ra vị trí của bộ tạo trong mảng trạng thái.</li>
<li>Bộ dữ liệu gồm 624 số nguyên, biểu diễn mảng trạng thái đã phục hồi.</li>
<li>None là &ldquo;giá trị giữ chỗ&rdquo; để đảm bảo tính tương thích với định dạng trạng thái mà module random của Python mong đợi.</li>
</ol>
<p>Khi chạy đoạn kiểm thử trên thì dòng lệnh đối chiếu với <code>assert</code> không bị lỗi, chứng tỏ đã khôi phục thành công state ban đầu.</p>
<h2 id="2-javascript">
<a class="header-anchor" href="#2-javascript"></a>
2. Javascript
</h2><p>Phương thức tĩnh <code>Math.random()</code> trả về một số dấu phẩy động, ngẫu nhiên lớn hơn hoặc bằng 0 và nhỏ hơn 1, với phân phối gần như đồng đều trong phạm vi đó — sau đó bạn có thể điều chỉnh theo phạm vi mong muốn. Việc triển khai sẽ chọn <code>seed</code> ban đầu cho thuật toán tạo số ngẫu nhiên; người dùng không thể chọn hoặc đặt lại <code>seed</code> này.</p>
<ul>
<li>XorShift128 trả về trạng thái 128-bit qua <code>state0, state1</code> và được triển khai như sau:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">xs128</span>(state0, state1):
</span></span><span style="display:flex;"><span>    mask <span style="color:#f92672">=</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">64</span>) <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    s1 <span style="color:#f92672">=</span> state0 AND mask
</span></span><span style="display:flex;"><span>    s0 <span style="color:#f92672">=</span> state1 AND mask
</span></span><span style="display:flex;"><span>    s1 <span style="color:#f92672">^=</span> (s1 <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">23</span>) AND mask
</span></span><span style="display:flex;"><span>    s1 <span style="color:#f92672">^=</span> (s1 <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">17</span>) AND mask
</span></span><span style="display:flex;"><span>    s1 <span style="color:#f92672">^=</span> s0
</span></span><span style="display:flex;"><span>    s1 <span style="color:#f92672">^=</span> (s0 <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">26</span>) AND mask
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> s0, s1
</span></span></code></pre></div><ul>
<li>Khi <code>cache</code> trống, 1 chuỗi 64 giá trị ngẫu nhiên mới sẽ được tạo thành qua xs128 và lưu trữ trong <code>cache</code> với chỉ số được đặt ở cuối.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_refill</span>(self):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Refill the Math.random cache using xs128.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Can only be used when Math.random cache is empty.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    A new 64-long list of random values is stored in cache.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    The cache_idx is set to the last index of the cache (63).
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">assert</span> self<span style="color:#f92672">.</span>cache_idx <span style="color:#f92672">==</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    self<span style="color:#f92672">.</span>cache <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">64</span>):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>state0, self<span style="color:#f92672">.</span>state1 <span style="color:#f92672">=</span> xs128(self<span style="color:#f92672">.</span>state0, self<span style="color:#f92672">.</span>state1)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>cache<span style="color:#f92672">.</span>append(self<span style="color:#f92672">.</span>state0)
</span></span><span style="display:flex;"><span>    self<span style="color:#f92672">.</span>cache_idx <span style="color:#f92672">=</span> <span style="color:#ae81ff">63</span>
</span></span></code></pre></div><ul>
<li>Lúc gọi <code>Math.random()</code> thì  <code>next()</code> được gọi và đưa ra 1 giá trị thập phân từ 0.0 đến 1.0. Ở đây thì v8 chuyển đổi số từ xs128 sang double bằng cách bỏ 12 bit cuối, còn 52 bit thì đưa vào phần Mantissa của số double trong chuẩn IEEE754. Sau đó trừ đi 1 và có được giá trị thập phân từ 0.0 đến 1.0.
<img src="https://hackmd.io/_uploads/HyR0w9nFel.png" alt="image"></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">v8_to_double</span>(state0, debug):
</span></span><span style="display:flex;"><span>    r <span style="color:#f92672">=</span> (state0 <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">12</span>) <span style="color:#f92672">|</span> <span style="color:#ae81ff">0x3ff0000000000000</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> debug:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> r
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> struct<span style="color:#f92672">.</span>unpack(<span style="color:#e6db74">&#39;d&#39;</span>, struct<span style="color:#f92672">.</span>pack(<span style="color:#e6db74">&#39;&lt;Q&#39;</span>, r))[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">next</span>(self):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>cache_idx <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>_refill()
</span></span><span style="display:flex;"><span>    val <span style="color:#f92672">=</span> v8_to_double(self<span style="color:#f92672">.</span>cache[self<span style="color:#f92672">.</span>cache_idx], self<span style="color:#f92672">.</span>debug)
</span></span><span style="display:flex;"><span>    self<span style="color:#f92672">.</span>cache_idx <span style="color:#f92672">-=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> val
</span></span></code></pre></div><h3 id="khôi-phục-trạng-thái-từ-một-lượng-giá-trị-ngẫu-nhiên-được-cho">
<a class="header-anchor" href="#kh%c3%b4i-ph%e1%bb%a5c-tr%e1%ba%a1ng-th%c3%a1i-t%e1%bb%ab-m%e1%bb%99t-l%c6%b0%e1%bb%a3ng-gi%c3%a1-tr%e1%bb%8b-ng%e1%ba%abu-nhi%c3%aan-%c4%91%c6%b0%e1%bb%a3c-cho"></a>
Khôi phục trạng thái từ một lượng giá trị ngẫu nhiên được cho
</h3><p><code>Math.random()</code> của V8 sử dụng <code>xs128</code> gồm các biểu thức tuyến tính trong hệ GF(2). Do đó, ta có thể xây dựng một hệ các phương trình tuyến tính trên GF(2) với 1 lượng giá trị ngẫu nhiên cho trước vừa đủ và từ đó, ta được nghiệm của hệ này là hai trạng thái ban đầu (seed) của thuật toán và dự đoán được giá trị ngẫu nhiên tiếp theo.</p>
<p>Chúng ta sẽ xây dựng hệ như sau:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>numbers <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0.20850633840727073</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0.28382289045651743</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0.4071416957057805</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0.3101367279739642</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0.6813711566813534</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0.8365880507655776</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0.2238039081275922</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0.014754643967695324</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0.44290438850282876</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0.5473214381957232</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0.40023560591139606</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0.14837298522461473</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0.12321774476187275</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0.8501766788936596</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0.9212308144118708</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0.8099337802981195</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0.06047989985671265</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0.6552969701254443</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0.5803218168252511</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0.41915921494443964</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0.9153038363744563</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0.7403989120318095</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0.6630141727527132</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0.5230661117641415</span>
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><ul>
<li>Đây là những giá trị ngẫu nhiên cho trước</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> gf2bv <span style="color:#f92672">import</span> LinearSystem
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>lin <span style="color:#f92672">=</span> LinearSystem([<span style="color:#ae81ff">64</span>] <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>state0, state1 <span style="color:#f92672">=</span> lin<span style="color:#f92672">.</span>gens()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Random <span style="color:#f92672">=</span> MathRandom(state0, state1, <span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>out <span style="color:#f92672">=</span> [Random<span style="color:#f92672">.</span>next() <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(len(numbers))]
</span></span></code></pre></div><ul>
<li><code>state0, state1</code> là hai <code>symbolic unknown</code> có 64-bit và nằm trong hệ tuyến tính. <code>Random</code> sẽ tạo những biểu thức tuyến tính chính là <code>out</code> với ẩn là <code>state0, state1</code> để xây dựng hệ.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>zeros<span style="color:#f92672">=</span>[(v8_from_double(x) <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">12</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">0x3ff0000000000000</span>) <span style="color:#f92672">^</span> y <span style="color:#66d9ef">for</span> x,y <span style="color:#f92672">in</span> zip(numbers, out)]
</span></span></code></pre></div><ul>
<li>Với mỗi cặp giá trị và phương trình ẩn, ta khôi phục 52 bit mantissa của đầu ra và đưa về chuẩn IEEE754 cho dạng double + 1.0 rồi XOR với biểu thức ẩn đã cho.</li>
<li>Nếu biểu thức này trùng với giá trị đầu ra thì sau khi XOR sẽ bằng 0. Vậy là ta đã có hệ tuyến tính ẩn <code>state0, state1</code>, giải hệ này và ta nhận được trạng thái ban đầu.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>sol <span style="color:#f92672">=</span> lin<span style="color:#f92672">.</span>solve_one(zeros)
</span></span></code></pre></div><h2 id="3-cc">
<a class="header-anchor" href="#3-cc"></a>
3. C/C++
</h2><p>Bên ngôn ngữ C/C++, hàm rand() xây dựng dựa trên <a href="https://www.mscs.dal.ca/~selinger/random/">GLIBC random number generator</a></p>
<p>Hàm <code>random()</code> của thư viện GNU C cung cấp các số giả ngẫu nhiên thông qua phương pháp phản hồi cộng tuyến tính. Phản hồi này tuyến tính theo modulo $2^{32}$. Tính phi tuyến tính nhỏ duy nhất xuất hiện trong giai đoạn <code>seeding</code>, do phép này được thực hiện theo modulo $2^{31} - 1$ chứ không phải modulo $2^{31}$ hay $2^{32}$. Điều này có nghĩa là, mặc dù mỗi số ngẫu nhiên được tạo ra phụ thuộc tuyến tính vào các số trước đó trong chuỗi, nhưng toàn bộ các số ngẫu nhiên không phụ thuộc tuyến tính vào <code>seed</code>.</p>
<h3 id="thuật-toán">
<a class="header-anchor" href="#thu%e1%ba%adt-to%c3%a1n"></a>
Thuật toán
</h3><p>Như mô tả ở trên, ta có: $2147483647 = 2^{31} - 1$ và $4294967296 = 2^{32}$</p>
<p>Với mỗi <code>seed</code> cho trước, 1 <code>initialization vector</code> (iv) $r_0&hellip;r_{33}$ được tính như sau:</p>
<ul>
<li>$r_0$ = <code>seed</code></li>
<li>$r_i\equiv (16807 * r_{i-1}) \mod 2147483647 \ ( i \in [1,30])$</li>
<li>$r_i=r_{i-31}\ (i\in [31, 33])$</li>
</ul>
<p>Sau đó, 1 chuỗi các số ngẫu nhiên $r_{34}&hellip;$ được tạo bằng vòng lặp phản hồi tuyến tính:</p>
<ul>
<li>$r_i\equiv r_{i-3}+r_{i-31}\mod 4294967296 \ (i \ge 34)$</li>
</ul>
<p>$r_0&hellip;r_{343}$ không được sử dụng mà đầu ra $o_i$ của hàm <code>rand()</code> là: $o_i =r_{i+344} \gg 1$</p>
<p>Code in C:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C" data-lang="C"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#define MAX 1000
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define seed 1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> r[MAX];
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> i;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  r[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> seed;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (i<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>; i<span style="color:#f92672">&lt;</span><span style="color:#ae81ff">31</span>; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>    r[i] <span style="color:#f92672">=</span> (<span style="color:#ae81ff">16807LL</span> <span style="color:#f92672">*</span> r[i<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]) <span style="color:#f92672">%</span> <span style="color:#ae81ff">2147483647</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (r[i] <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>      r[i] <span style="color:#f92672">+=</span> <span style="color:#ae81ff">2147483647</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (i<span style="color:#f92672">=</span><span style="color:#ae81ff">31</span>; i<span style="color:#f92672">&lt;</span><span style="color:#ae81ff">34</span>; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>    r[i] <span style="color:#f92672">=</span> r[i<span style="color:#f92672">-</span><span style="color:#ae81ff">31</span>];
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (i<span style="color:#f92672">=</span><span style="color:#ae81ff">34</span>; i<span style="color:#f92672">&lt;</span><span style="color:#ae81ff">344</span>; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>    r[i] <span style="color:#f92672">=</span> r[i<span style="color:#f92672">-</span><span style="color:#ae81ff">31</span>] <span style="color:#f92672">+</span> r[i<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>];
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (i<span style="color:#f92672">=</span><span style="color:#ae81ff">344</span>; i<span style="color:#f92672">&lt;</span>MAX; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>    r[i] <span style="color:#f92672">=</span> r[i<span style="color:#f92672">-</span><span style="color:#ae81ff">31</span>] <span style="color:#f92672">+</span> r[i<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;%d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, ((<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span>)r[i]) <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="khôi-phục">
<a class="header-anchor" href="#kh%c3%b4i-ph%e1%bb%a5c"></a>
Khôi phục
</h3><p>Phân tích thuật toán trên thì ta thấy rằng:</p>
<ul>
<li>Từ $i\ge34$, $r_i\equiv r_{i-3}+r_{i-31}$ là tuyến tính và có nghĩa là khi ta biết được 2 trong 3 giá trị thì sẽ suy ra được giá trị còn lại.</li>
<li>Với đầu ra $o_i =r_{i+344} \gg 1$, nghĩa là nó có 31 bit và mất bit bên phải ngoài cùng $r_{i+344}$</li>
<li>Nghĩa là nếu ta có đủ đầu ra liên tiếp thì hoàn toàn có thể lan truyền để khôi phục lại mảng trạng thái ban đầu (iv).</li>
</ul>
<p>Các bước để khôi phục iv như sau:</p>
<ol>
<li>Đoán bit thấp bị bỏ rồi ghép thành một phần trạng thái:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">crack</span>(outputs):
</span></span><span style="display:flex;"><span>    states <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(outputs)):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (i <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">31</span> <span style="color:#f92672">and</span> 
</span></span><span style="display:flex;"><span>            outputs[i]      <span style="color:#f92672">!=</span> <span style="color:#66d9ef">None</span> <span style="color:#f92672">and</span>
</span></span><span style="display:flex;"><span>            outputs[i <span style="color:#f92672">-</span> <span style="color:#ae81ff">31</span>] <span style="color:#f92672">!=</span> <span style="color:#66d9ef">None</span> <span style="color:#f92672">and</span> 
</span></span><span style="display:flex;"><span>            outputs[i <span style="color:#f92672">-</span> <span style="color:#ae81ff">3</span>]  <span style="color:#f92672">!=</span> <span style="color:#66d9ef">None</span> <span style="color:#f92672">and</span> 
</span></span><span style="display:flex;"><span>            outputs[i] <span style="color:#f92672">!=</span> (outputs[i <span style="color:#f92672">-</span> <span style="color:#ae81ff">31</span>] <span style="color:#f92672">+</span> outputs[i <span style="color:#f92672">-</span> <span style="color:#ae81ff">3</span>]) AND <span style="color:#ae81ff">0x7fffffff</span>
</span></span><span style="display:flex;"><span>        ):
</span></span><span style="display:flex;"><span>            states[i <span style="color:#f92672">-</span> <span style="color:#ae81ff">31</span>] <span style="color:#f92672">=</span> (outputs[i <span style="color:#f92672">-</span> <span style="color:#ae81ff">31</span>] <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>            states[i <span style="color:#f92672">-</span> <span style="color:#ae81ff">3</span>]  <span style="color:#f92672">=</span> (outputs[i <span style="color:#f92672">-</span> <span style="color:#ae81ff">3</span>]  <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>            states<span style="color:#f92672">.</span>append((outputs[i] <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">+</span> <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            states<span style="color:#f92672">.</span>append(<span style="color:#66d9ef">None</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> states
</span></span></code></pre></div><p>Nếu ta có $o_i, o_{i-31},o_{i-3}$ và chúng không thỏa:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>outputs[i] <span style="color:#f92672">==</span> (outputs[i <span style="color:#f92672">-</span> <span style="color:#ae81ff">31</span>] <span style="color:#f92672">+</span> outputs[i <span style="color:#f92672">-</span> <span style="color:#ae81ff">3</span>]) AND <span style="color:#ae81ff">0x7fffffff</span>
</span></span></code></pre></div><p>Đoán trạng thái của nỏ ở dạng:
$$
\begin{cases}
s_{i-31} = o_{i-31} &laquo; 1 + 1 \
s_{i-3} = o_{i-3} &laquo; 1 + 1 \
s_i = o_i &laquo; 1 + 0
\end{cases}
$$</p>
<p>Nếu không, gắn $s_i =$ None vì chưa biết dạng chuẩn.</p>
<ol start="2">
<li>Khôi phục trạng thái:</li>
</ol>
<p>Chạy ngược công thức cộng để khôi phục các giá trị (nếu có) trong 344 giá trị đầu</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>states <span style="color:#f92672">=</span> crack(outputs)
</span></span><span style="display:flex;"><span>init <span style="color:#f92672">=</span> [<span style="color:#66d9ef">None</span>] <span style="color:#f92672">*</span> <span style="color:#ae81ff">344</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">343</span>, <span style="color:#ae81ff">2</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>):
</span></span><span style="display:flex;"><span>    s31 <span style="color:#f92672">=</span> states[i <span style="color:#f92672">+</span> <span style="color:#ae81ff">31</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">344</span>] <span style="color:#66d9ef">if</span> i <span style="color:#f92672">+</span> <span style="color:#ae81ff">31</span> <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">344</span> <span style="color:#66d9ef">else</span> init[i <span style="color:#f92672">+</span> <span style="color:#ae81ff">31</span>]
</span></span><span style="display:flex;"><span>    s28 <span style="color:#f92672">=</span> states[i <span style="color:#f92672">+</span> <span style="color:#ae81ff">28</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">344</span>] <span style="color:#66d9ef">if</span> i <span style="color:#f92672">+</span> <span style="color:#ae81ff">28</span> <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">344</span> <span style="color:#66d9ef">else</span> init[i <span style="color:#f92672">+</span> <span style="color:#ae81ff">28</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> s31 <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> <span style="color:#66d9ef">None</span> <span style="color:#f92672">and</span> s28 <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>        init[i] <span style="color:#f92672">=</span> (s31 <span style="color:#f92672">-</span> s28) <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">32</span>
</span></span></code></pre></div><p>Nếu có 1 giá trị trong khoảng 31 giá trị đầu, ta có thể tính tất cả các giá trị còn lại vì tính chất tuyến tính bằng công thức:
$r_i\equiv (16807 * r_{i-1}) \mod 2147483647 \Leftrightarrow r_{i-1}\equiv (16807^{-1} * r_i) \mod 2147483647$</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>base_idx <span style="color:#f92672">=</span> next((i <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">31</span>) <span style="color:#66d9ef">if</span> init[i] <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> <span style="color:#66d9ef">None</span>), <span style="color:#66d9ef">None</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> base_idx <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">31</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> init[i] <span style="color:#f92672">is</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>            init[i] <span style="color:#f92672">=</span> pow(<span style="color:#ae81ff">16807</span>, i <span style="color:#f92672">-</span> base_idx, <span style="color:#ae81ff">2147483647</span>) <span style="color:#f92672">*</span> init[base_idx] <span style="color:#f92672">%</span> <span style="color:#ae81ff">2147483647</span>
</span></span></code></pre></div><p>Vì tính chất tuyến tính $r_i \equiv r_{i-3}+r_{i-31}, \forall i \ge 34$ nên nếu ta biết 2 giá trị thì suy ra được giá trị còn lại. Do đó, ta viết hàm lặp đến khi không thể khôi phục giá trị nào nữa để điền tất cả các giá trị còn thiếu.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">self_recover</span>(states):
</span></span><span style="display:flex;"><span>    MOD <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">**</span> <span style="color:#ae81ff">32</span>
</span></span><span style="display:flex;"><span>    length <span style="color:#f92672">=</span> len(states)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>        updated <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">34</span>, length):
</span></span><span style="display:flex;"><span>            s_i <span style="color:#f92672">=</span> states[i]
</span></span><span style="display:flex;"><span>            s_31 <span style="color:#f92672">=</span> states[i <span style="color:#f92672">-</span> <span style="color:#ae81ff">31</span>]
</span></span><span style="display:flex;"><span>            s_3 <span style="color:#f92672">=</span> states[i <span style="color:#f92672">-</span> <span style="color:#ae81ff">3</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> s_i <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> <span style="color:#66d9ef">None</span> <span style="color:#f92672">and</span> s_3 <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> <span style="color:#66d9ef">None</span> <span style="color:#f92672">and</span> s_31 <span style="color:#f92672">is</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>                states[i <span style="color:#f92672">-</span> <span style="color:#ae81ff">31</span>] <span style="color:#f92672">=</span> (s_i <span style="color:#f92672">-</span> s_3) <span style="color:#f92672">%</span> MOD
</span></span><span style="display:flex;"><span>                updated <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">elif</span> s_i <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> <span style="color:#66d9ef">None</span> <span style="color:#f92672">and</span> s_31 <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> <span style="color:#66d9ef">None</span> <span style="color:#f92672">and</span> s_3 <span style="color:#f92672">is</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>                states[i <span style="color:#f92672">-</span> <span style="color:#ae81ff">3</span>] <span style="color:#f92672">=</span> (s_i <span style="color:#f92672">-</span> s_31) <span style="color:#f92672">%</span> MOD
</span></span><span style="display:flex;"><span>                updated <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">elif</span> s_i <span style="color:#f92672">is</span> <span style="color:#66d9ef">None</span> <span style="color:#f92672">and</span> s_3 <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> <span style="color:#66d9ef">None</span> <span style="color:#f92672">and</span> s_31 <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>                states[i] <span style="color:#f92672">=</span> (s_3 <span style="color:#f92672">+</span> s_31) <span style="color:#f92672">%</span> MOD
</span></span><span style="display:flex;"><span>                updated <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> updated:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>             
</span></span><span style="display:flex;"><span>all_states <span style="color:#f92672">=</span> init <span style="color:#f92672">+</span> states
</span></span><span style="display:flex;"><span>self_recover(all_states)
</span></span></code></pre></div><p>Điền 3 giá trị đầu bằng các sao chép từ thứ tự 31 và lấy được <code>seed</code> ban đầu:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">3</span>):
</span></span><span style="display:flex;"><span>    all_states[i] <span style="color:#f92672">=</span> all_states[i <span style="color:#f92672">+</span> <span style="color:#ae81ff">31</span>]
</span></span></code></pre></div><p>Full code ở <a href="https://github.com/r1muru2006/Crack_random/blob/main/glibc_random/crack.py">đây</a>&hellip;</p>
<h2 id="4-golang">
<a class="header-anchor" href="#4-golang"></a>
4. Golang
</h2><p>PRNG của Golang xây dựng dựa trên Lagged Fibonacci Generator.</p>
<h3 id="thuật-toán-1">
<a class="header-anchor" href="#thu%e1%ba%adt-to%c3%a1n-1"></a>
Thuật toán
</h3><p>Hàm tạo <code>seed</code> cho rng: $x_{n+1} = 48271 * x_n \mod (2^{31} - 1)$</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">seedrand</span>(x):
</span></span><span style="display:flex;"><span>    A <span style="color:#f92672">=</span> <span style="color:#ae81ff">48271</span>
</span></span><span style="display:flex;"><span>    Q <span style="color:#f92672">=</span> <span style="color:#ae81ff">44488</span>
</span></span><span style="display:flex;"><span>    R <span style="color:#f92672">=</span> <span style="color:#ae81ff">3399</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    hi <span style="color:#f92672">=</span> x <span style="color:#f92672">//</span> Q
</span></span><span style="display:flex;"><span>    lo <span style="color:#f92672">=</span> x <span style="color:#f92672">%</span> Q
</span></span><span style="display:flex;"><span>    x <span style="color:#f92672">=</span> A <span style="color:#f92672">*</span> lo <span style="color:#f92672">-</span> R <span style="color:#f92672">*</span> hi
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> x <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>        x <span style="color:#f92672">+=</span> INT32_MAX
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> x
</span></span></code></pre></div><p>Để tránh tràn số thì code dùng Schrage’s Method (hi = x // Q, lo = x % Q).</p>
<p>Tiếp theo, ta có class <code>RNGSource</code> là PRNG chính.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>self<span style="color:#f92672">.</span>tap <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>self<span style="color:#f92672">.</span>feed <span style="color:#f92672">=</span> RNG_LEN <span style="color:#f92672">-</span> RNG_TAP   <span style="color:#75715e"># 607 - 273 = 334</span>
</span></span></code></pre></div><p>Hai con trỏ là <code>tap</code> và <code>feed</code> chạy ngược nhau, thực hiện phép cộng sinh số ngẫu nhiên rồi sau đó lưu trữ trạng thái này vào mảng <code>vec</code>, tổng 607 phần tử 64-bit.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">seed</span>(self, seed):
</span></span><span style="display:flex;"><span>    self<span style="color:#f92672">.</span>tap <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    self<span style="color:#f92672">.</span>feed <span style="color:#f92672">=</span> RNG_LEN <span style="color:#f92672">-</span> RNG_TAP
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    seed <span style="color:#f92672">%=</span> INT32_MAX
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> seed <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>        seed <span style="color:#f92672">+=</span> INT32_MAX
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> seed <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>        seed <span style="color:#f92672">=</span> <span style="color:#ae81ff">89482311</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    x <span style="color:#f92672">=</span> int(seed)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#f92672">-</span><span style="color:#ae81ff">20</span>, RNG_LEN):
</span></span><span style="display:flex;"><span>        x <span style="color:#f92672">=</span> seedrand(x)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> i <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>            u <span style="color:#f92672">=</span> (int(x) <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">40</span>) AND <span style="color:#ae81ff">0xFFFFFFFFFFFFFFFF</span>
</span></span><span style="display:flex;"><span>            x <span style="color:#f92672">=</span> seedrand(x)
</span></span><span style="display:flex;"><span>            u <span style="color:#f92672">^=</span> (int(x) <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">20</span>) AND <span style="color:#ae81ff">0xFFFFFFFFFFFFFFFF</span>
</span></span><span style="display:flex;"><span>            x <span style="color:#f92672">=</span> seedrand(x)
</span></span><span style="display:flex;"><span>            u <span style="color:#f92672">^=</span> int(x)
</span></span><span style="display:flex;"><span>            u <span style="color:#f92672">^=</span> rng_cooked[i]
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>vec[i] <span style="color:#f92672">=</span> u
</span></span></code></pre></div><p>Hàm <code>seed()</code> sẽ nhận giá trị <code>seed</code> và tạo ra mảng trạng thái <code>vec</code> như sau:</p>
<ol>
<li>x được gọi <code>seedrand()</code> 20 lần để tạo số ngẫu nhiên.</li>
<li>Ghép 3 giá trị 31-bit thành số 64-bit qua hàm <code>seedrand()</code> với $x &laquo; 40, x &laquo; 20, x$.</li>
<li>XOR với 1 giá trị trong bảng <code>rng_cooked[]</code>.</li>
</ol>
<p>Tiếp theo, ta sẽ sinh số ngẫu nhiên 64-bit qua <code>vec</code> bằng hàm <code>uint64()</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">uint64</span>(self):
</span></span><span style="display:flex;"><span>    self<span style="color:#f92672">.</span>tap <span style="color:#f92672">-=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>tap <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>tap <span style="color:#f92672">+=</span> RNG_LEN
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    self<span style="color:#f92672">.</span>feed <span style="color:#f92672">-=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>feed <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>feed <span style="color:#f92672">+=</span> RNG_LEN
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    x <span style="color:#f92672">=</span> (self<span style="color:#f92672">.</span>vec[self<span style="color:#f92672">.</span>feed] <span style="color:#f92672">+</span> self<span style="color:#f92672">.</span>vec[self<span style="color:#f92672">.</span>tap]) AND <span style="color:#ae81ff">0xFFFFFFFFFFFFFFFF</span>
</span></span><span style="display:flex;"><span>    self<span style="color:#f92672">.</span>vec[self<span style="color:#f92672">.</span>feed] <span style="color:#f92672">=</span> x
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> x
</span></span></code></pre></div><ul>
<li>Hai con trỏ <code>tap</code> và <code>feed</code> đi lùi trong vòng có độ dài 607.</li>
<li>Theo đó là công thức Additive Lagged-Fibonacci Generator:
$$
vec_{feed}=(vec_{feed} + vec_{tap}) AND 0xFFFFFFFFFFFFFFFF
$$</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>x <span style="color:#f92672">=</span> (self<span style="color:#f92672">.</span>vec[self<span style="color:#f92672">.</span>feed] <span style="color:#f92672">+</span> self<span style="color:#f92672">.</span>vec[self<span style="color:#f92672">.</span>tap]) AND <span style="color:#ae81ff">0xFFFFFFFFFFFFFFFF</span>
</span></span><span style="display:flex;"><span>self<span style="color:#f92672">.</span>vec[self<span style="color:#f92672">.</span>feed] <span style="color:#f92672">=</span> x
</span></span></code></pre></div><h3 id="khôi-phục-1">
<a class="header-anchor" href="#kh%c3%b4i-ph%e1%bb%a5c-1"></a>
Khôi phục
</h3><p>Như ta thấy, trong golang thì từ sau giai đoạn sinh <code>seed</code>, giai đoạn sinh số ngẫu nhiên chỉ gồm phép cộng tuyến tính trên chuỗi <code>seed</code> lấy được. Nghĩa là nếu ta có chuỗi đầu ra đủ dài, ta có thể xây dựng hệ phương trình tuyến tính để tính chuỗi <code>seed</code> ban đầu.</p>
<p>Để xây dựng được hệ như vậy, mình nghĩ ngay tới z3-solver và sau đây là phần crack:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> rng <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> z3 <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>s <span style="color:#f92672">=</span> Solver()
</span></span><span style="display:flex;"><span>NUM_TEST <span style="color:#f92672">=</span> <span style="color:#ae81ff">700</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>vec <span style="color:#f92672">=</span> [BitVec(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;vec_</span><span style="color:#e6db74">{</span>i<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>, <span style="color:#ae81ff">64</span>) <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(RNG_LEN)]
</span></span><span style="display:flex;"><span>rng_equation <span style="color:#f92672">=</span> RngSource(vec)
</span></span><span style="display:flex;"><span>equations <span style="color:#f92672">=</span> [rng_equation<span style="color:#f92672">.</span>uint64() <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(NUM_TEST)]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>rng_value <span style="color:#f92672">=</span> RngSource()
</span></span><span style="display:flex;"><span>rng_value<span style="color:#f92672">.</span>seed(int(input(<span style="color:#e6db74">&#34;Enter seed: &#34;</span>)))
</span></span><span style="display:flex;"><span>vals <span style="color:#f92672">=</span> [rng_value<span style="color:#f92672">.</span>uint64() <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(NUM_TEST)]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(NUM_TEST):
</span></span><span style="display:flex;"><span>    s<span style="color:#f92672">.</span>add(equations[i] <span style="color:#f92672">==</span> vals[i])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;99%...&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> s<span style="color:#f92672">.</span>check() <span style="color:#f92672">==</span> sat:
</span></span><span style="display:flex;"><span>    model <span style="color:#f92672">=</span> s<span style="color:#f92672">.</span>model()
</span></span><span style="display:flex;"><span>    array_values <span style="color:#f92672">=</span> [model<span style="color:#f92672">.</span>evaluate(vec[i])<span style="color:#f92672">.</span>as_long() <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(RNG_LEN)]
</span></span><span style="display:flex;"><span>    rng <span style="color:#f92672">=</span> RngSource(array_values)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(NUM_TEST):
</span></span><span style="display:flex;"><span>        res <span style="color:#f92672">=</span> rng<span style="color:#f92672">.</span>uint64()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">10</span>):
</span></span><span style="display:flex;"><span>        print(rng<span style="color:#f92672">.</span>uint64(), rng_value<span style="color:#f92672">.</span>uint64())
</span></span></code></pre></div><h2 id="5-bash">
<a class="header-anchor" href="#5-bash"></a>
5. Bash
</h2><p>Bash dùng linear congruential generator (LCG) là biến thể của thuật toán Park–Miller “minimal standard” để tạo số ngẫu nhiên 31-bit.</p>
<h3 id="thuật-toán-2">
<a class="header-anchor" href="#thu%e1%ba%adt-to%c3%a1n-2"></a>
Thuật toán
</h3><p>Hàm <code>next_seed</code> sinh <code>seed</code> mới bằng cách áp dụng công thức Park-Miller LCG:
$$
X_{k+1}=(a\times X_k)\mod m
$$</p>
<p>với $a = 16807,\ m = 2^{31} - 1$</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">next_seed</span>(self) <span style="color:#f92672">-&gt;</span> int:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>seed <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>seed <span style="color:#f92672">=</span> <span style="color:#ae81ff">123459876</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    h <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>seed <span style="color:#f92672">//</span> <span style="color:#ae81ff">127773</span>
</span></span><span style="display:flex;"><span>    l <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>seed <span style="color:#f92672">-</span> (<span style="color:#ae81ff">127773</span> <span style="color:#f92672">*</span> h)
</span></span><span style="display:flex;"><span>    t <span style="color:#f92672">=</span> <span style="color:#ae81ff">16807</span> <span style="color:#f92672">*</span> l <span style="color:#f92672">-</span> <span style="color:#ae81ff">2836</span> <span style="color:#f92672">*</span> h
</span></span><span style="display:flex;"><span>    self<span style="color:#f92672">.</span>seed <span style="color:#f92672">=</span> (t <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x7fffffff</span>) <span style="color:#66d9ef">if</span> t <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">else</span> t
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>seed
</span></span></code></pre></div><p>Giống Golang, nhằm tránh bị tràn số thì ta dùng Schrage’s Method để tách h và l.</p>
<p>Với <code>seed</code> đó, ta sinh giá trị ngẫu nhiên bằng hàm <code>next_16</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">next_16</span>(self) <span style="color:#f92672">-&gt;</span> int:
</span></span><span style="display:flex;"><span>    self<span style="color:#f92672">.</span>next_seed()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>is_old:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Bash 5.0 and earlier</span>
</span></span><span style="display:flex;"><span>        result <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>seed AND BASH_RAND_MAX
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Bash 5.1 and later</span>
</span></span><span style="display:flex;"><span>        result <span style="color:#f92672">=</span> ((self<span style="color:#f92672">.</span>seed <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">16</span>) <span style="color:#f92672">^</span> (self<span style="color:#f92672">.</span>seed AND <span style="color:#ae81ff">0xffff</span>)) AND BASH_RAND_MAX
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Skip if same as last</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> result <span style="color:#f92672">==</span> self<span style="color:#f92672">.</span>last:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>next_16()
</span></span><span style="display:flex;"><span>    self<span style="color:#f92672">.</span>last <span style="color:#f92672">=</span> result
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> result
</span></span></code></pre></div><p>Có 2 phiên bản khác nhau:</p>
<ul>
<li>Từ bản Bash 5.0 trở xuống, ta chỉ lấy 15 bit thấp.</li>
<li>Bash 5.1 trở lên: XOR 2 giá trị 16 bit cao và 16 bit thấp của <code>seed</code> rồi trả về 15 bit cuối.</li>
</ul>
<p>Bên cạnh đó, nếu số mới giống số cũ, ta bỏ qua và tính số mới.</p>
<h3 id="khôi-phục-2">
<a class="header-anchor" href="#kh%c3%b4i-ph%e1%bb%a5c-2"></a>
Khôi phục
</h3><p>Vì ở đây, ta không có được trực tiếp $X_n$ mà chỉ lấy được giá trị của nó sau hàm <code>next_16</code> nên không thể truy ngược được Park-Miller LCG. Do đó, kỹ thuật mình có thể sử dụng ở đây để crack là brute-force.</p>
<p>Mặt khác <code>output</code> chỉ cho 15 bit, trong khi <code>state</code> có 31 bit, thế nên chắc chắn có rất nhiều <code>state</code> cho ra cùng 1 giá trị <code>output</code>. Để lọc được <code>state</code> phù hợp, ta cần nhiều giá trị <code>output</code> liên tiếp để chắc chắn tìm được duy nhất 1 <code>state.</code> Nếu không có nhiều <code>output</code> như vậy, ta có thể tìm những <code>state</code> phù hợp để thử và tìm ra kết quả cuối cùng.</p>
<p>Do <code>seed</code> có 32 bit, ta nên sử dụng nhiều luồng nhằm chia các khoảng của nó và chạy các task song song để giảm thời gian thực hiện và tối ưu hóa bộ nhớ. Ở đây, mình sử dụng Pool của thư viện multiprocessing trong Python để chia luồng, rồi thực hiện các task duyệt, so sánh với đầu ra cho trước và trả về <code>seed</code> nếu khớp.
Full code ở <a href="https://github.com/R1MURUN0PR0/Crack_random/blob/main/bash_random/crack.py">đây</a>&hellip;</p>
<h2 id="all-code-in-github">
<a class="header-anchor" href="#all-code-in-github"></a>
All code in Github
</h2><p><a href="https://github.com/R1MURUN0PR0/Crack_random/tree/main">https://github.com/R1MURUN0PR0/Crack_random/tree/main</a></p>
<h2 id="tài-liệu">
<a class="header-anchor" href="#t%c3%a0i-li%e1%bb%87u"></a>
Tài liệu
</h2><ol>
<li><a href="https://soon.haari.me/import-random/">https://soon.haari.me/import-random/</a></li>
<li><a href="https://rbtree.blog/posts/2021-05-18-breaking-python-random-module/">https://rbtree.blog/posts/2021-05-18-breaking-python-random-module/</a></li>
<li><a href="https://github.com/JorianWoltjer/BashRandomCracker?tab=readme-ov-file">https://github.com/JorianWoltjer/BashRandomCracker?tab=readme-ov-file</a></li>
<li><a href="https://en.wikipedia.org/wiki/Xorshift">https://en.wikipedia.org/wiki/Xorshift</a></li>
<li><a href="https://github.com/maple3142/gf2bv">https://github.com/maple3142/gf2bv</a></li>
<li><a href="https://www.mscs.dal.ca/~selinger/random/">https://www.mscs.dal.ca/~selinger/random/</a></li>
<li><a href="https://github.com/d0nutptr/v8_rand_buster">https://github.com/d0nutptr/v8_rand_buster</a></li>
</ol>
</div>
    <footer class="article-footer"><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item" data-aos="zoom-in">
      <a
        class="article-tag-list-link"
        href="/tags/ctf"
        rel="tag"
        >CTF</a
      >
    </li><li class="article-tag-list-item" data-aos="zoom-in">
      <a
        class="article-tag-list-link"
        href="/tags/cryptography"
        rel="tag"
        >CRYPTOGRAPHY</a
      >
    </li><li class="article-tag-list-item" data-aos="zoom-in">
      <a
        class="article-tag-list-link"
        href="/tags/research"
        rel="tag"
        >RESEARCH</a
      >
    </li></ul>
</footer>
  </div><nav
    id="article-nav"
    aria-label="Article navigation"
    data-aos="fade-up"
  ><div class="article-nav-link-wrap left"><img
            data-src="/images/imaginary.jpg"
            data-sizes="auto"
            alt="ImaginaryCTF 2025"
            class="lazyload"
          /><a
          href="/post/imaginaryctf2025/"
          aria-label="Prev:ImaginaryCTF 2025"
          title="Prev:ImaginaryCTF 2025"
        ></a>
        <div class="article-nav-caption">Prev</div>
        <h3 class="article-nav-title">ImaginaryCTF 2025</h3>
      </div><div class="article-nav-link-wrap right"><img
            data-src="/images/mctf.png"
            data-sizes="auto"
            alt="M*CTF Quals 2025"
            class="lazyload"
          /><a
          href="/post/mctfquals2025/"
          aria-label="Next:M*CTF Quals 2025"
          title="Next:M*CTF Quals 2025"
        ></a>
        <div class="article-nav-caption">Next</div>
        <h3 class="article-nav-title">M*CTF Quals 2025</h3>
      </div></nav></article></section>
        </div><footer id="footer" aria-label="Site footer">
  <div style="width: 100%; overflow: hidden">
    <div class="footer-line"></div>
  </div>
  <div id="footer-info"><div>
      <span class="icon-copyright"></span>2020-2025<span class="footer-info-sep rotate"></span>
      r1muru
    </div><div>
        Powered by&nbsp;<a
          href="https://gohugo.io/"
          target="_blank"
          rel="noopener nofollow noreferrer"
          >Hugo</a
        >&nbsp; Theme.<a
          href="https://github.com/D-Sketon/hugo-theme-reimu"
          target="_blank"
          rel="noopener nofollow noreferrer"
          >Reimu</a
        >
      </div><div>
        <span class="icon-brush"
          >&nbsp;23.8k</span
        >
        &nbsp;|&nbsp;
        <span class="icon-coffee">&nbsp;01:57</span>
      </div><div>
        <span class="icon-eye"></span>
        <span id="busuanzi_container_site_pv"
          >Number of visits&nbsp;<span
            id="busuanzi_value_site_pv"
          ></span
        ></span>
        &nbsp;|&nbsp;
        <span class="icon-user"></span>
        <span id="busuanzi_container_site_uv"
          >Number of visitors&nbsp;<span
            id="busuanzi_value_site_uv"
          ></span
        ></span>
      </div></div>
</footer>
<div class="sidebar-top">
            <div class="sidebar-top-taichi rotate"></div>
            <div class="arrow-up"></div>
          </div><div id="mask" class="hide"></div>
      </div><nav id="mobile-nav" aria-label="Mobile navigation">
  <div class="sidebar-wrap"><div class="sidebar-toc-sidebar"><h3 class="toc-title">Contents</h3>
<div class="sidebar-toc-wrapper toc-div-class">
  <nav id="TableOfContents">
  <ul>
    <li><a href="#1-python">1. Python</a>
      <ul>
        <li><a href="#mersenne-twister">Mersenne Twister</a></li>
        <li><a href="#khôi-phục-từ-đầu-ra-đầy-đủ-32-bit">Khôi phục từ đầu ra đầy đủ 32-bit</a></li>
      </ul>
    </li>
    <li><a href="#2-javascript">2. Javascript</a>
      <ul>
        <li><a href="#khôi-phục-trạng-thái-từ-một-lượng-giá-trị-ngẫu-nhiên-được-cho">Khôi phục trạng thái từ một lượng giá trị ngẫu nhiên được cho</a></li>
      </ul>
    </li>
    <li><a href="#3-cc">3. C/C++</a>
      <ul>
        <li><a href="#thuật-toán">Thuật toán</a></li>
        <li><a href="#khôi-phục">Khôi phục</a></li>
      </ul>
    </li>
    <li><a href="#4-golang">4. Golang</a>
      <ul>
        <li><a href="#thuật-toán-1">Thuật toán</a></li>
        <li><a href="#khôi-phục-1">Khôi phục</a></li>
      </ul>
    </li>
    <li><a href="#5-bash">5. Bash</a>
      <ul>
        <li><a href="#thuật-toán-2">Thuật toán</a></li>
        <li><a href="#khôi-phục-2">Khôi phục</a></li>
      </ul>
    </li>
    <li><a href="#all-code-in-github">All code in Github</a></li>
    <li><a href="#tài-liệu">Tài liệu</a></li>
  </ul>
</nav>
</div></div>
        <div class="sidebar-common-sidebar hidden"><div class="sidebar-author">
  <img
    data-src="/avatar/avatar.webp"
    data-sizes="auto"
    alt="r1muru"
    class="lazyload"
  />
  <div class="sidebar-author-name">r1muru</div>
  <div class="sidebar-description">Life is not fair, get used to it</div>
</div>
<div class="sidebar-state">
  <div class="sidebar-state-article">
    <div>Posts</div><div class="sidebar-state-number">9</div>
  </div>
  <a class="sidebar-state-category" href="/categories/" aria-label="sidebar-state-category-link">
    <div>Categories</div>
    <div class="sidebar-state-number">
      3
    </div>
  </a>
  <a class="sidebar-state-tag" href="/tags/" aria-label="sidebar-state-tag-link">
    <div>Tags</div>
    <div class="sidebar-state-number">7</div>
  </a>
</div>
<div class="sidebar-social"></div>
<div class="sidebar-menu"><div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/"
        aria-label="Home"
      ></a>
      <div class='sidebar-menu-icon icon rotate'>&#xe62b;</div>
      <div class="sidebar-menu-link">Home</div>
    </div><div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/archives"
        aria-label="Archives"
      ></a>
      <div class='sidebar-menu-icon icon rotate'>&#xe62b;</div>
      <div class="sidebar-menu-link">Archives</div>
    </div><div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/about"
        aria-label="About"
      ></a>
      <div class='sidebar-menu-icon icon rotate'>&#xe62b;</div>
      <div class="sidebar-menu-link">About</div>
    </div><div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/friend"
        aria-label="Friend"
      ></a>
      <div class='sidebar-menu-icon icon rotate'>&#xe62b;</div>
      <div class="sidebar-menu-link">Friend</div>
    </div></div>
</div></div><div class="sidebar-btn-wrapper">
        <div class="sidebar-toc-btn current"></div>
        <div class="sidebar-common-btn"></div>
      </div></nav>
</div><script
    src="https://npm.webcache.cn/lazysizes@5.3.2/lazysizes.min.js"
    integrity="sha384-3gT/vsepWkfz/ff7PpWNUeMzeWoH3cDhm/A8jM7ouoAK0/fP/9bcHHR5kHq2nf&#43;e" crossorigin="anonymous"></script><script
    src="https://npm.webcache.cn/clipboard@2.0.11/dist/clipboard.min.js"
    integrity="sha384-J08i8An/QeARD9ExYpvphB8BsyOj3Gh2TSh1aLINKO3L0cMSH2dN3E22zFoXEi0Q" crossorigin="anonymous"></script><script src="/js/main.js" ></script><script src="/js/aos.js" ></script><script>
    var aosInit = () => {
      AOS.init({
        duration: 1000,
        easing: "ease",
        once: true,
        offset: 50,
      });
    };
    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", aosInit);
    } else {
      aosInit();
    }
  </script><script src="/js/pjax_main.js" data-pjax></script><script
    src="https://npm.webcache.cn/mouse-firework@0.1.1/dist/index.umd.js"
    integrity="sha384-8LyaidD9GPxQQgLJO/WRw/O2h3BoNq/ApI/ecpvM6RsrCz2qP2ppBXUKihP4V/2d" crossorigin="anonymous"></script><script>
  if (! false  || !window.matchMedia('(max-width: 768px)').matches) {
    if (window.firework) {
      const options = JSON.parse("{\"excludeelements\":[\"a\",\"button\"],\"particles\":[{\"colors\":[\"var(--red-1)\",\"var(--red-2)\",\"var(--red-3)\",\"var(--red-4)\"],\"duration\":[1200,1800],\"easing\":\"easeOutExpo\",\"move\":[\"emit\"],\"number\":20,\"shape\":\"circle\",\"shapeOptions\":{\"alpha\":[0.3,0.5],\"radius\":[16,32]}},{\"colors\":[\"var(--red-0)\"],\"duration\":[1200,1800],\"easing\":\"easeOutExpo\",\"move\":[\"diffuse\"],\"number\":1,\"shape\":\"circle\",\"shapeOptions\":{\"alpha\":[0.2,0.5],\"lineWidth\":6,\"radius\":20}}]}");
      options.excludeElements = options.excludeelements;
      delete options.excludeelements;
      window.firework(options);
    }
  }
</script>

<div id="lazy-script">
  <div><script data-pjax>
        window.REIMU_POST = {
          author: "r1muru",
          title: "Crack Random Modules",
          url: "http:\/\/localhost:1313\/post\/crackrandommodule\/",
          description: "Bạn muốn thắng Vietlott, blog này là dành cho bạn...",
          cover: "http:\/\/localhost:1313\/images\/random.webp",
        };
      </script><script src="/js/insert_highlight.js" data-pjax></script><script src="/js/tabs.js" data-pjax></script><script type="module" data-pjax>const PhotoSwipeLightbox = (await safeImport("https:\/\/npm.webcache.cn\/photoswipe@5.4.4\/dist\/photoswipe-lightbox.esm.min.js", "sha384-DiL6M\/gG\u002bwmTxmCRZyD1zee6lIhawn5TGvED0FOh7fXcN9B0aZ9dexSF\/N6lrZi\/")).default;const initPswp = (gallery, children) => {
          if (_$$(`${gallery} ${children}`).length > 0) {
            new PhotoSwipeLightbox({
              gallery,
              children,pswpModule: () => safeImport("https:\/\/npm.webcache.cn\/photoswipe@5.4.4\/dist\/photoswipe.esm.min.js", "sha384-WkkO3GCmgkC3VQWpaV8DqhKJqpzpF9JoByxDmnV8\u002boTJ7m3DfYEWX1fu1scuS4\u002bs")}).init();
          }
        }
        const pswp = () => {
          initPswp('.article-entry', 'a.article-gallery-item');
          initPswp('.article-gallery', 'a.article-gallery-item');
          window.lightboxStatus = 'done';
          window.removeEventListener('lightbox:ready', pswp);
        }
        if(window.lightboxStatus === 'ready') {
          pswp()
        } else {
          window.addEventListener('lightbox:ready', pswp);
        }
      </script><script
    src="https://npm.webcache.cn/katex@0.16.24/dist/katex.min.js"
    data-pjaxintegrity="sha384-MWNUH0WmtsYGhn2cbH6ELRCbf9LG3QDqCC&#43;gqPB3IBNO35xjZK3Ejb6oONRpDbPg" crossorigin="anonymous"></script><script
    src="https://npm.webcache.cn/katex@0.16.24/dist/contrib/auto-render.min.js"
    data-pjaxintegrity="sha384-hCXGrW6PitJEwbkoStFjeJxv&#43;fSOOQKOPbJxSfM6G5sWZjAyWhXiTIIAmQqnlLlh" crossorigin="anonymous"></script><script data-pjax>
          var renderMath = () => {
            if (!window.renderMathInElement) return;
            window.renderMathInElement(_$("article"), {
              delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "\\[", right: "\\]", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
              ],
            });
          };
          if (document.readyState === "loading") {
            document.addEventListener("DOMContentLoaded", renderMath, { once: true });
          } else {
            renderMath();
          }
        </script></div>
</div><script
    src="https://npm.webcache.cn/busuanzi@2.3.0/bsz.pure.mini.js"
    asyncintegrity="sha384-0M75wtSkhjIInv4coYlaJU83&#43;OypaRCIq2SukQVQX04eGTCBXJDuWAbJet56id&#43;S" crossorigin="anonymous"></script><script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.getRegistrations().then((registrations) => {
        for (let registration of registrations) {
          registration.unregister();
        }
      });
    }
  </script><script>
  const reimuCopyright = String.raw`
   ______     ______     __     __    __     __  __    
  /\  == \   /\  ___\   /\ \   /\ "-./  \   /\ \/\ \   
  \ \  __<   \ \  __\   \ \ \  \ \ \-./\ \  \ \ \_\ \  
   \ \_\ \_\  \ \_____\  \ \_\  \ \_\ \ \_\  \ \_____\ 
    \/_/ /_/   \/_____/   \/_/   \/_/  \/_/   \/_____/ 
                                                    
  `;
  console.log(String.raw`%c ${reimuCopyright}`, "color: #ff5252;");
  console.log(
    "%c Theme.Reimu" + " %c https://github.com/D-Sketon/hugo-theme-reimu ",
    "color: white; background: #ff5252; padding:5px 0;",
    "padding:4px;border:1px solid #ff5252;",
  );
</script></body>
</html>
