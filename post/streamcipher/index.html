<!doctype html><html lang=en-us data-theme-mode=auto><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>Is stream encryption secure? | r1muru</title><meta name=description content="Today I will go over some stream ciphers and learn how they can be exploited by attackers."><script>window.siteConfig=JSON.parse('{"anchor_icon":null,"base":"https://r1muru2006.github.io/","clipboard":{"copyright":{"count":50,"enable":false,"license_type":"by-nc-sa"},"fail":{"en":"Copy failed (ﾟ⊿ﾟ)ﾂ","ja":"コピー失敗 (ﾟ⊿ﾟ)ﾂ","pt-br":"Falha ao copiar (ﾟ⊿ﾟ)ﾂ","zh-cn":"复制失败 (ﾟ⊿ﾟ)ﾂ","zh-tw":"複製失敗 (ﾟ⊿ﾟ)ﾂ"},"success":{"en":"Copy successfully (*^▽^*)","ja":"コピー成功 (*^▽^*)","pt-br":"Copiado com sucesso (*^▽^*)","zh-cn":"复制成功 (*^▽^*)","zh-tw":"複製成功 (*^▽^*)"}},"code_block":{"expand":true},"icon_font":false,"outdate":{"daysago":180,"enable":false,"message":{"en":"This article was last updated on {time}. Please note that the content may no longer be applicable.","ja":"この記事は最終更新日：{time}。記載内容が現在有効でない可能性がありますのでご注意ください。","pt-br":"Este artigo foi atualizado pela última vez em {time}. Observe que o conteúdo pode não ser mais aplicável.","zh-cn":"本文最后更新于 {time}，请注意文中内容可能已不适用。","zh-tw":"本文最後更新於 {time}，請注意文中內容可能已不適用。"}}}')</script><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7cNoto%20Serif%20SC:400,400italic,700,700italic%7c&amp;display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7cNoto%20Serif%20SC:400,400italic,700,700italic%7c&amp;display=swap" media=print onload='this.media="all"'><link rel=stylesheet href=https://npm.webcache.cn/@fortawesome/fontawesome-free@7.1.0/css/regular.min.css integrity=sha384-4qYppzjH8EiA+cGdaubu2vL7Rk8WGiqCSj7oRuP1uwtFWkfKNHD20lPfcrbQc8dU crossorigin=anonymous><link rel=stylesheet href=https://npm.webcache.cn/@fortawesome/fontawesome-free@7.1.0/css/solid.min.css integrity=sha384-wbMWab3UDSPm2kvIgVOn/d9KPTecgPU1+Nb3zoQrm/oVu0EkPL6IaKinjbwW0rum crossorigin=anonymous><link rel=preload as=style href=https://npm.webcache.cn/@fortawesome/fontawesome-free@7.1.0/css/brands.min.css integrity=sha384-KTGeC2hIMzpeQakhsmzB9bZfhCD5xZZCgI1iZH6f/O457SxzlkzTQg/WXFNoi3ih crossorigin=anonymous onload='this.onload=null,this.rel="stylesheet"'><link rel=preload as=style href=https://npm.webcache.cn/@fortawesome/fontawesome-free@7.1.0/css/v5-font-face.min.css integrity=sha384-nJ1ThfldViXoLpJ6jlKcP2beas8BMbYq26SG9Hi8cH89bZi4RZ644v7helMCqJxd crossorigin=anonymous onload='this.onload=null,this.rel="stylesheet"'><link rel=preload as=style href=https://npm.webcache.cn/@fortawesome/fontawesome-free@7.1.0/css/v4-font-face.min.css integrity=sha384-UlkrhOIvZxJFd4MElSUp7ow6/RUeYKi/orfCZIRRiOENFuQPIAA3T3HjYfmBRhNq crossorigin=anonymous onload='this.onload=null,this.rel="stylesheet"'><link rel=stylesheet href=/css/loader.min.ac746e154f756f8220326eeb52a719f142ab038be5a8ddf30ea5ef15ef2356ea.css><meta property="og:type" content="website"><meta property="og:title" content="Is stream encryption secure? | r1muru"><meta property="og:description" content="Today I will go over some stream ciphers and learn how they can be exploited by attackers."><meta property="og:url" content="https://r1muru2006.github.io/post/streamcipher/"><meta property="og:site_name" content="r1muru's blog"><meta property="og:image" content="/images/patriot/patriot.png"><meta property="article:author" content="r1muru"><meta property="article:published_time" content="2025-11-25T14:33:54+07:00"><meta property="article:modified_time" content="2025-11-25T14:33:54+07:00"><meta property="article:tag" content="ResearchCryptography"><meta name=twitter:card content="summary"><meta name=twitter:image content="/images/patriot/patriot.png"><link rel="shortcut icon" href=/favicon.ico><link rel=stylesheet href=/css/main.min.fea35ec1dbb9520d5824bd8fcc5533a29acc2b60c759cf3ea9f2c705d51073c8.css><link rel=preload as=style href=https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe.css integrity=sha384-IfxC36XL/toUyJ939C73PcgMuRzAZuIzZxE38drsmO5p6jD7ei+Zx/1oA/0l8ysE crossorigin=anonymous onload='this.onload=null,this.rel="stylesheet"'><link rel=preload as=style href=https://npm.webcache.cn/katex@0.16.24/dist/katex.min.css integrity=sha384-tTgKLjMYmJr94v8qu2PE5MUGSMbyN2xiH266JUB3gpm8vnnJywd1dWSOEfrFz+YI crossorigin=anonymous onload='this.onload=null,this.rel="stylesheet"'><script src=https://npm.webcache.cn/pace-js@1.2.4/pace.min.js integrity=sha384-k6YtvFUEIuEFBdrLKJ3YAUbBki333tj1CSUisai5Cswsg9wcLNaPzsTHDswp4Az8 crossorigin=anonymous></script><link rel=stylesheet href=https://npm.webcache.cn/@reimujs/aos@0.1.2/dist/aos.css integrity=sha384-GMRP93c6Hkz9JVKGAuRR3nTS7M07RwPgTFenXiosjq2VbVgvdDNcz1g6Mkj8AONa crossorigin=anonymous><link rel=stylesheet href=https://npm.webcache.cn/aplayer@1.10.1/dist/APlayer.min.css integrity=sha384-tLMkTWh2pfXNWGFlUS0w1TFtRG5xZ9lPWFOooj+vDDLIL+xBGQU/voDBY5XE2lVh crossorigin=anonymous></head><body><div id=loader><div class="loading-left-bg loading-bg"></div><div class="loading-right-bg loading-bg"></div><div class=spinner-box><div class="loading-taichi rotate"><img src=/images/loading.svg alt=loading></div><div class=loading-word>Loading...</div></div></div></div><script>var time=null,loaderEl=document.getElementById("loader"),startLoading=()=>{time=Date.now(),loaderEl.classList.remove("loading")},hideLoader=()=>{document.body.style.overflow="auto",loader.classList.add("loading")},endLoading=()=>{time?Date.now()-time>500?(time=null,hideLoader()):(setTimeout(endLoading,500-(Date.now()-time)),time=null):hideLoader()};window.addEventListener("DOMContentLoaded",endLoading),loaderEl.addEventListener("click",endLoading)</script><div id=copy-tooltip></div><div id=lang-tooltip>This article does not have a corresponding language version</div><div id=heatmap-tooltip></div><div id=container><div id=wrap><div id=header-nav><nav id=main-nav aria-label="Primary navigation"><a class=main-nav-link-wrap href=/><div class='main-nav-icon icon'>&#xf015;</div><span class=main-nav-link>Home</span>
</a><a class=main-nav-link-wrap href=/archives><div class='main-nav-icon icon'>&#xf187;</div><span class=main-nav-link>Archives</span>
</a><a class=main-nav-link-wrap href=/about><div class='main-nav-icon icon'>&#xf007;</div><span class=main-nav-link>About</span>
</a><a id=main-nav-toggle class=nav-icon aria-label="Toggle navigation" role=button></a></nav><nav id=sub-nav aria-label="Secondary navigation"><a id=nav-search-btn class="nav-icon popup-trigger" title=Search aria-label=Search></a></nav></div><header id=header aria-label="Site header"><picture></picture>
<img fetchpriority=high src=/images/patriot/patriot.png alt="Is stream encryption secure?"><div id=header-outer><div id=header-title><span id=logo><h1 data-aos=slide-up>Is stream encryption secure?</h1></span><h2 id=subtitle-wrap data-aos=slide-down></h2></div></div></header><div id=content aria-label="Page content" class=sidebar-left><aside id=sidebar aria-label=Sidebar><div class="sidebar-wrapper-container sticky"><meting-js theme=var(--color-link) id=8668604226 server=netease type=playlist fixed=false autoplay loop order=list preload=auto volume=0.7 list-folded=false></meting-js><div class=sidebar-wrapper><div class=sidebar-wrap data-aos=fade-up><div class=sidebar-toc-sidebar><h3 class=toc-title>Contents</h3><div class="sidebar-toc-wrapper toc-div-class"><nav id=TableOfContents><ul><li><a href=#algorithm>Algorithm</a></li></ul></nav></div></div><div class="sidebar-common-sidebar hidden"><div class=sidebar-author><img data-src=/avatar/avatar.png data-sizes=auto alt=r1muru class=lazyload><div class=sidebar-author-name>r1muru</div><div class=sidebar-description>Life is not fair, get used to it</div></div><div class=sidebar-state><div class=sidebar-state-article><div>Posts</div><div class=sidebar-state-number>11</div></div><a class=sidebar-state-category href=/categories/ aria-label=sidebar-state-category-link><div>Categories</div><div class=sidebar-state-number>3</div></a><a class=sidebar-state-tag href=/tags/ aria-label=sidebar-state-tag-link><div>Tags</div><div class=sidebar-state-number>8</div></a></div><div class=sidebar-social><div class="icon-discord sidebar-social-icon"><a href=https://discordapp.com/users/r1muru2006 itemprop=url target=_blank aria-label=discord rel="noopener nofollow noreferrer"></a></div><div class="icon-email sidebar-social-icon"><a href=cuongchu200@gmail.com itemprop=url target=_blank aria-label=email rel="noopener nofollow noreferrer"></a></div><div class="icon-facebook sidebar-social-icon"><a href=https://www.facebook.com/chu.cuong.732399 itemprop=url target=_blank aria-label=facebook rel="noopener nofollow noreferrer"></a></div><div class="icon-github sidebar-social-icon"><a href=https://github.com/r1muru2006 itemprop=url target=_blank aria-label=github rel="noopener nofollow noreferrer"></a></div><div class="icon-instagram sidebar-social-icon"><a href=https://www.instagram.com/r1murun0pr0 itemprop=url target=_blank aria-label=instagram rel="noopener nofollow noreferrer"></a></div></div><div class=sidebar-menu><div class=sidebar-menu-link-wrap><a class=sidebar-menu-link-dummy href=/ aria-label=Home></a><div class='sidebar-menu-icon icon'>&#xf015;</div><div class=sidebar-menu-link>Home</div></div><div class=sidebar-menu-link-wrap><a class=sidebar-menu-link-dummy href=/archives aria-label=Archives></a><div class='sidebar-menu-icon icon'>&#xf187;</div><div class=sidebar-menu-link>Archives</div></div><div class=sidebar-menu-link-wrap><a class=sidebar-menu-link-dummy href=/about aria-label=About></a><div class='sidebar-menu-icon icon'>&#xf007;</div><div class=sidebar-menu-link>About</div></div></div></div><div class=sidebar-btn-wrapper style=position:static><div class="sidebar-toc-btn current"></div><div class=sidebar-common-btn></div></div></div></div><div class=sidebar-widget></div></div></aside><section id=main aria-label="Main content"><article class="h-entry article" itemscope itemtype=https://schema.org/BlogPosting><div class=article-inner data-aos=fade-up><div class=article-meta><div class=article-date><span class="article-date-link icon-calendar" data-aos=zoom-in><time datetime="2025-11-25 14:33:54 +0700 +0700" itemprop=datePublished>2025-11-25</time>
<time style=display:none id=post-update-time>2025-11-25</time></span></div><div class=article-category><a class=article-category-link href=/categories/learning data-aos=zoom-in>LEARNING</a></div></div><div class=hr-line></div><div class="e-content article-entry" itemprop=articleBody><h1 id=chacha20-poly1305><a class=header-anchor href=#chacha20-poly1305></a>Chacha20-Poly1305</h1><h2 id=algorithm><a class=header-anchor href=#algorithm></a>Algorithm</h2><p>ChaCha20-Poly1305 architecture consists of two main components, the stream cipher ChaCha20 and the authentication mechanism Poly1305 by the same author D.J. Berstein.
The ChaCha20 algorithm uses ChaCha20 block functions to generate the encryption keystream.
<img src=/images/StreamCipher/encrypt.png alt=images></p><p>The input of the ChaCha20 block function is a 4x4 word matrix described as in this figure:
<img src=/images/StreamCipher/input.png alt=images></p><p>More details in figure a are 128 bit constant <em>C</em> (4-word), 256 bit key <em>K</em> (8-word), 32 bit counter parameter <em>Ctr</em> (1 word), 96 bit nonce <em>N</em> (3 words). Then perform 20 loops alternatingly executing the column round transformations according to figure b and the diagonal round transformations according to figure c.</p><p>These two circular shifts are implemented by a single QUARTERROUND transformation (cross or column shift based on the input index to the QUARTERROUND function) as shown in this:
<img src=/images/StreamCipher/quarterround.png alt=images></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>chacha20_quarter_round</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>b</span><span class=p>,</span><span class=n>c</span><span class=p>,</span><span class=n>d</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>a</span> <span class=o>=</span> <span class=p>(</span><span class=n>a</span> <span class=o>+</span> <span class=n>b</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0xFFFFFFFF</span>
</span></span><span class=line><span class=cl>    <span class=n>d</span> <span class=o>^=</span> <span class=n>a</span><span class=p>;</span> <span class=n>d</span> <span class=o>=</span> <span class=p>((</span><span class=n>d</span> <span class=o>&lt;&lt;</span> <span class=mi>16</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0xFFFFFFFF</span><span class=p>)</span> <span class=o>|</span> <span class=p>(</span><span class=n>d</span> <span class=o>&gt;&gt;</span> <span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>c</span> <span class=o>=</span> <span class=p>(</span><span class=n>c</span> <span class=o>+</span> <span class=n>d</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0xFFFFFFFF</span>
</span></span><span class=line><span class=cl>    <span class=n>b</span> <span class=o>^=</span> <span class=n>c</span><span class=p>;</span> <span class=n>b</span> <span class=o>=</span> <span class=p>((</span><span class=n>b</span> <span class=o>&lt;&lt;</span> <span class=mi>12</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0xFFFFFFFF</span><span class=p>)</span> <span class=o>|</span> <span class=p>(</span><span class=n>b</span> <span class=o>&gt;&gt;</span> <span class=mi>20</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>a</span> <span class=o>=</span> <span class=p>(</span><span class=n>a</span> <span class=o>+</span> <span class=n>b</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0xFFFFFFFF</span>
</span></span><span class=line><span class=cl>    <span class=n>d</span> <span class=o>^=</span> <span class=n>a</span><span class=p>;</span> <span class=n>d</span> <span class=o>=</span> <span class=p>((</span><span class=n>d</span> <span class=o>&lt;&lt;</span> <span class=mi>8</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0xFFFFFFFF</span><span class=p>)</span> <span class=o>|</span> <span class=p>(</span><span class=n>d</span> <span class=o>&gt;&gt;</span> <span class=mi>24</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>c</span> <span class=o>=</span> <span class=p>(</span><span class=n>c</span> <span class=o>+</span> <span class=n>d</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0xFFFFFFFF</span>
</span></span><span class=line><span class=cl>    <span class=n>b</span> <span class=o>^=</span> <span class=n>c</span><span class=p>;</span> <span class=n>b</span> <span class=o>=</span> <span class=p>((</span><span class=n>b</span> <span class=o>&lt;&lt;</span> <span class=mi>7</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0xFFFFFFFF</span><span class=p>)</span> <span class=o>|</span> <span class=p>(</span><span class=n>b</span> <span class=o>&gt;&gt;</span> <span class=mi>25</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>a</span><span class=p>,</span><span class=n>b</span><span class=p>,</span><span class=n>c</span><span class=p>,</span><span class=n>d</span>
</span></span></code></pre></div><p>In 20 loops, each loop performs 8 operations QUARTERROUND and the order is: QUARTERROUND from 1 to 4 performs column rotation, while QUARTERROUND from 5 to 8 performs cross rotation. The output of the 20-loop block is 16 words, which are added to the 16 input words modulo $2^{32}$ to generate 16 key words. The 16 key words are XORed with the 16 plaintext words to obtain 16 ciphertext words.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>chacha20_block</span><span class=p>(</span><span class=n>key32</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>,</span> <span class=n>counter</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>nonce12</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bytes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>u32</span><span class=p>(</span><span class=n>b</span><span class=p>):</span> <span class=k>return</span> <span class=n>struct</span><span class=o>.</span><span class=n>unpack</span><span class=p>(</span><span class=s2>&#34;&lt;I&#34;</span><span class=p>,</span> <span class=n>b</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>state</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=mh>0x61707865</span><span class=p>,</span> <span class=mh>0x3320646e</span><span class=p>,</span> <span class=mh>0x79622d32</span><span class=p>,</span> <span class=mh>0x6b206574</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>u32</span><span class=p>(</span><span class=n>key32</span><span class=p>[</span><span class=mi>0</span><span class=p>:</span><span class=mi>4</span><span class=p>]),</span> <span class=n>u32</span><span class=p>(</span><span class=n>key32</span><span class=p>[</span><span class=mi>4</span><span class=p>:</span><span class=mi>8</span><span class=p>]),</span> <span class=n>u32</span><span class=p>(</span><span class=n>key32</span><span class=p>[</span><span class=mi>8</span><span class=p>:</span><span class=mi>12</span><span class=p>]),</span> <span class=n>u32</span><span class=p>(</span><span class=n>key32</span><span class=p>[</span><span class=mi>12</span><span class=p>:</span><span class=mi>16</span><span class=p>]),</span>
</span></span><span class=line><span class=cl>        <span class=n>u32</span><span class=p>(</span><span class=n>key32</span><span class=p>[</span><span class=mi>16</span><span class=p>:</span><span class=mi>20</span><span class=p>]),</span> <span class=n>u32</span><span class=p>(</span><span class=n>key32</span><span class=p>[</span><span class=mi>20</span><span class=p>:</span><span class=mi>24</span><span class=p>]),</span> <span class=n>u32</span><span class=p>(</span><span class=n>key32</span><span class=p>[</span><span class=mi>24</span><span class=p>:</span><span class=mi>28</span><span class=p>]),</span> <span class=n>u32</span><span class=p>(</span><span class=n>key32</span><span class=p>[</span><span class=mi>28</span><span class=p>:</span><span class=mi>32</span><span class=p>]),</span>
</span></span><span class=line><span class=cl>        <span class=n>counter</span> <span class=o>&amp;</span> <span class=mh>0xFFFFFFFF</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>u32</span><span class=p>(</span><span class=n>nonce12</span><span class=p>[</span><span class=mi>0</span><span class=p>:</span><span class=mi>4</span><span class=p>]),</span> <span class=n>u32</span><span class=p>(</span><span class=n>nonce12</span><span class=p>[</span><span class=mi>4</span><span class=p>:</span><span class=mi>8</span><span class=p>]),</span> <span class=n>u32</span><span class=p>(</span><span class=n>nonce12</span><span class=p>[</span><span class=mi>8</span><span class=p>:</span><span class=mi>12</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>x</span> <span class=o>=</span> <span class=n>state</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>20</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># column rounds</span>
</span></span><span class=line><span class=cl>        <span class=n>x</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span><span class=n>x</span><span class=p>[</span><span class=mi>4</span><span class=p>],</span><span class=n>x</span><span class=p>[</span><span class=mi>8</span><span class=p>],</span><span class=n>x</span><span class=p>[</span><span class=mi>12</span><span class=p>]</span> <span class=o>=</span> <span class=n>chacha20_quarter_round</span><span class=p>(</span><span class=n>x</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span><span class=n>x</span><span class=p>[</span><span class=mi>4</span><span class=p>],</span><span class=n>x</span><span class=p>[</span><span class=mi>8</span><span class=p>],</span><span class=n>x</span><span class=p>[</span><span class=mi>12</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=n>x</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span><span class=n>x</span><span class=p>[</span><span class=mi>5</span><span class=p>],</span><span class=n>x</span><span class=p>[</span><span class=mi>9</span><span class=p>],</span><span class=n>x</span><span class=p>[</span><span class=mi>13</span><span class=p>]</span> <span class=o>=</span> <span class=n>chacha20_quarter_round</span><span class=p>(</span><span class=n>x</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span><span class=n>x</span><span class=p>[</span><span class=mi>5</span><span class=p>],</span><span class=n>x</span><span class=p>[</span><span class=mi>9</span><span class=p>],</span><span class=n>x</span><span class=p>[</span><span class=mi>13</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=n>x</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span><span class=n>x</span><span class=p>[</span><span class=mi>6</span><span class=p>],</span><span class=n>x</span><span class=p>[</span><span class=mi>10</span><span class=p>],</span><span class=n>x</span><span class=p>[</span><span class=mi>14</span><span class=p>]</span> <span class=o>=</span> <span class=n>chacha20_quarter_round</span><span class=p>(</span><span class=n>x</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span><span class=n>x</span><span class=p>[</span><span class=mi>6</span><span class=p>],</span><span class=n>x</span><span class=p>[</span><span class=mi>10</span><span class=p>],</span><span class=n>x</span><span class=p>[</span><span class=mi>14</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=n>x</span><span class=p>[</span><span class=mi>3</span><span class=p>],</span><span class=n>x</span><span class=p>[</span><span class=mi>7</span><span class=p>],</span><span class=n>x</span><span class=p>[</span><span class=mi>11</span><span class=p>],</span><span class=n>x</span><span class=p>[</span><span class=mi>15</span><span class=p>]</span> <span class=o>=</span> <span class=n>chacha20_quarter_round</span><span class=p>(</span><span class=n>x</span><span class=p>[</span><span class=mi>3</span><span class=p>],</span><span class=n>x</span><span class=p>[</span><span class=mi>7</span><span class=p>],</span><span class=n>x</span><span class=p>[</span><span class=mi>11</span><span class=p>],</span><span class=n>x</span><span class=p>[</span><span class=mi>15</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=c1># diagonal rounds</span>
</span></span><span class=line><span class=cl>        <span class=n>x</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span><span class=n>x</span><span class=p>[</span><span class=mi>5</span><span class=p>],</span><span class=n>x</span><span class=p>[</span><span class=mi>10</span><span class=p>],</span><span class=n>x</span><span class=p>[</span><span class=mi>15</span><span class=p>]</span> <span class=o>=</span> <span class=n>chacha20_quarter_round</span><span class=p>(</span><span class=n>x</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span><span class=n>x</span><span class=p>[</span><span class=mi>5</span><span class=p>],</span><span class=n>x</span><span class=p>[</span><span class=mi>10</span><span class=p>],</span><span class=n>x</span><span class=p>[</span><span class=mi>15</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=n>x</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span><span class=n>x</span><span class=p>[</span><span class=mi>6</span><span class=p>],</span><span class=n>x</span><span class=p>[</span><span class=mi>11</span><span class=p>],</span><span class=n>x</span><span class=p>[</span><span class=mi>12</span><span class=p>]</span> <span class=o>=</span> <span class=n>chacha20_quarter_round</span><span class=p>(</span><span class=n>x</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span><span class=n>x</span><span class=p>[</span><span class=mi>6</span><span class=p>],</span><span class=n>x</span><span class=p>[</span><span class=mi>11</span><span class=p>],</span><span class=n>x</span><span class=p>[</span><span class=mi>12</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=n>x</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span><span class=n>x</span><span class=p>[</span><span class=mi>7</span><span class=p>],</span><span class=n>x</span><span class=p>[</span><span class=mi>8</span><span class=p>],</span><span class=n>x</span><span class=p>[</span><span class=mi>13</span><span class=p>]</span> <span class=o>=</span> <span class=n>chacha20_quarter_round</span><span class=p>(</span><span class=n>x</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span><span class=n>x</span><span class=p>[</span><span class=mi>7</span><span class=p>],</span><span class=n>x</span><span class=p>[</span><span class=mi>8</span><span class=p>],</span><span class=n>x</span><span class=p>[</span><span class=mi>13</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=n>x</span><span class=p>[</span><span class=mi>3</span><span class=p>],</span><span class=n>x</span><span class=p>[</span><span class=mi>4</span><span class=p>],</span><span class=n>x</span><span class=p>[</span><span class=mi>9</span><span class=p>],</span><span class=n>x</span><span class=p>[</span><span class=mi>14</span><span class=p>]</span> <span class=o>=</span> <span class=n>chacha20_quarter_round</span><span class=p>(</span><span class=n>x</span><span class=p>[</span><span class=mi>3</span><span class=p>],</span><span class=n>x</span><span class=p>[</span><span class=mi>4</span><span class=p>],</span><span class=n>x</span><span class=p>[</span><span class=mi>9</span><span class=p>],</span><span class=n>x</span><span class=p>[</span><span class=mi>14</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>out</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;&#34;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>struct</span><span class=o>.</span><span class=n>pack</span><span class=p>(</span><span class=s2>&#34;&lt;I&#34;</span><span class=p>,</span> <span class=p>(</span><span class=n>x</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>+</span> <span class=n>state</span><span class=p>[</span><span class=n>i</span><span class=p>])</span> <span class=o>&amp;</span> <span class=mh>0xFFFFFFFF</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>16</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>out</span>
</span></span></code></pre></div></div><footer class=article-footer><blockquote class=article-copyright><p><strong><span class="icon-user icon"></span>Author: </strong>r1muru</p><p><strong><span class="icon-link icon"></span>Permalink: </strong><a href=https://r1muru2006.github.io/post/streamcipher/>https://r1muru2006.github.io/post/streamcipher/</a></p><p><strong><span class="icon-copyright icon"></span>License: </strong>All articles on this blog are licensed under the <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh rel="noopener nofollow noreferrer" target=_blank><span class=icon-creative-commons></span>BY-NC-SA</a> license agreement unless otherwise stated. Please indicate the source when reprinting!</p><span class="icon-creative-commons article-copyright-bg"></span></blockquote><ul class=article-tag-list itemprop=keywords><li class=article-tag-list-item data-aos=zoom-in><a class=article-tag-list-link href=/tags/research rel=tag>RESEARCH</a></li><li class=article-tag-list-item data-aos=zoom-in><a class=article-tag-list-link href=/tags/cryptography rel=tag>CRYPTOGRAPHY</a></li></ul></footer></div><nav id=article-nav aria-label="Article navigation" data-aos=fade-up><div class="article-nav-link-wrap left"><img data-src=/images/patriot/patriot.png data-sizes=auto alt="Patriot CTF 2025" class=lazyload><a href=/post/patriotctf2025/ aria-label="Prev:Patriot CTF 2025" title="Prev:Patriot CTF 2025"></a><div class=article-nav-caption>Prev</div><h3 class=article-nav-title>Patriot CTF 2025</h3></div></nav></article></section></div><footer id=footer aria-label="Site footer"><div style=width:100%;overflow:hidden><div class=footer-line></div></div><div id=footer-info><div><span class=icon-copyright></span>2024-2025<span class="footer-info-sep rotate"></span>
r1muru</div><div>Powered by&nbsp;<a href=https://gohugo.io/ target=_blank rel="noopener nofollow noreferrer">Hugo</a>&nbsp; Theme.<a href=https://github.com/D-Sketon/hugo-theme-reimu target=_blank rel="noopener nofollow noreferrer">Reimu</a></div><div><span class=icon-brush>&nbsp;28.4k</span>
&nbsp;|&nbsp;
<span class=icon-coffee>&nbsp;02:19</span></div><div><span class=icon-eye></span>
<span id=busuanzi_container_site_pv>Number of visits&nbsp;<span id=busuanzi_value_site_pv></span></span>
&nbsp;|&nbsp;
<span class=icon-user></span>
<span id=busuanzi_container_site_uv>Number of visitors&nbsp;<span id=busuanzi_value_site_uv></span></span></div></div></footer><div class=sidebar-top><div class="sidebar-top-taichi rotate"></div><div class=arrow-up></div></div><div id=mask class=hide></div></div><nav id=mobile-nav aria-label="Mobile navigation"><div class=sidebar-wrap><div class=sidebar-toc-sidebar><h3 class=toc-title>Contents</h3><div class="sidebar-toc-wrapper toc-div-class"><nav id=TableOfContents><ul><li><a href=#algorithm>Algorithm</a></li></ul></nav></div></div><div class="sidebar-common-sidebar hidden"><div class=sidebar-author><img data-src=/avatar/avatar.png data-sizes=auto alt=r1muru class=lazyload><div class=sidebar-author-name>r1muru</div><div class=sidebar-description>Life is not fair, get used to it</div></div><div class=sidebar-state><div class=sidebar-state-article><div>Posts</div><div class=sidebar-state-number>11</div></div><a class=sidebar-state-category href=/categories/ aria-label=sidebar-state-category-link><div>Categories</div><div class=sidebar-state-number>3</div></a><a class=sidebar-state-tag href=/tags/ aria-label=sidebar-state-tag-link><div>Tags</div><div class=sidebar-state-number>8</div></a></div><div class=sidebar-social><div class="icon-discord sidebar-social-icon"><a href=https://discordapp.com/users/r1muru2006 itemprop=url target=_blank aria-label=discord rel="noopener nofollow noreferrer"></a></div><div class="icon-email sidebar-social-icon"><a href=cuongchu200@gmail.com itemprop=url target=_blank aria-label=email rel="noopener nofollow noreferrer"></a></div><div class="icon-facebook sidebar-social-icon"><a href=https://www.facebook.com/chu.cuong.732399 itemprop=url target=_blank aria-label=facebook rel="noopener nofollow noreferrer"></a></div><div class="icon-github sidebar-social-icon"><a href=https://github.com/r1muru2006 itemprop=url target=_blank aria-label=github rel="noopener nofollow noreferrer"></a></div><div class="icon-instagram sidebar-social-icon"><a href=https://www.instagram.com/r1murun0pr0 itemprop=url target=_blank aria-label=instagram rel="noopener nofollow noreferrer"></a></div></div><div class=sidebar-menu><div class=sidebar-menu-link-wrap><a class=sidebar-menu-link-dummy href=/ aria-label=Home></a><div class='sidebar-menu-icon icon'>&#xf015;</div><div class=sidebar-menu-link>Home</div></div><div class=sidebar-menu-link-wrap><a class=sidebar-menu-link-dummy href=/archives aria-label=Archives></a><div class='sidebar-menu-icon icon'>&#xf187;</div><div class=sidebar-menu-link>Archives</div></div><div class=sidebar-menu-link-wrap><a class=sidebar-menu-link-dummy href=/about aria-label=About></a><div class='sidebar-menu-icon icon'>&#xf007;</div><div class=sidebar-menu-link>About</div></div></div></div></div><div class=sidebar-btn-wrapper><div class="sidebar-toc-btn current"></div><div class=sidebar-common-btn></div></div></nav></div><div class=site-search><div class="reimu-popup popup"><div class=reimu-search><div class=reimu-search-input-icon></div><div id=reimu-search-input></div><div class=popup-btn-close></div></div><div class=reimu-results><div id=reimu-stats></div><div id=reimu-hits></div><div id=reimu-pagination class=reimu-pagination></div></div><img class=reimu-bg src=/images/reimu.png></div></div><script src=https://npm.webcache.cn/lazysizes@5.3.2/lazysizes.min.js integrity=sha384-3gT/vsepWkfz/ff7PpWNUeMzeWoH3cDhm/A8jM7ouoAK0/fP/9bcHHR5kHq2nf+e crossorigin=anonymous></script><script src=https://npm.webcache.cn/clipboard@2.0.11/dist/clipboard.min.js integrity=sha384-J08i8An/QeARD9ExYpvphB8BsyOj3Gh2TSh1aLINKO3L0cMSH2dN3E22zFoXEi0Q crossorigin=anonymous></script><script src=/js/main.js integrity crossorigin=anonymous></script><script src=/js/aos.js integrity crossorigin=anonymous></script><script>var aosInit=()=>{AOS.init({duration:1e3,easing:"ease",once:!0,offset:50})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",aosInit):aosInit()</script><script src=/js/pjax_main.js integrity crossorigin=anonymous data-pjax></script><script>var ALGOLIA_CONFIG={logo:"/images/algolia_logo.svg",algolia:{applicationID:"RAY96S32HW",apiKey:"53e71efc7b6ca695cdb630e780aeae50",indexName:"my-blog",hits:{per_page:parseInt("10")},labels:{input_placeholder:"Search.....",hits_empty:"No results found for 「${query}」",hits_stats:"Found ${hits} results (in ${time} ms)"}}}</script><script src=https://npm.webcache.cn/algoliasearch@4.17.1/dist/algoliasearch-lite.umd.js deferintegrity=sha384-xvLS0jfKuoREs7pqkRI/OI8GcqohO5S+jQz7ZBtQXnsXmD+9jDOOY4cL6dCPzlrk crossorigin=anonymous></script><script src=https://npm.webcache.cn/@reimujs/instantsearch.js@4.57.0-beta.1/dist/instantsearch.production.min.js deferintegrity=sha384-aagKMe8nkqaP2DYQc8kkYOL5l+M5Q2WH/Uhr4teOh0Ybp0RZj0kUSDm45qPikMjK crossorigin=anonymous></script><script src=/js/algolia_search.js integrity crossorigin=anonymous></script><script src=https://npm.webcache.cn/mouse-firework@0.1.1/dist/index.umd.js integrity=sha384-8LyaidD9GPxQQgLJO/WRw/O2h3BoNq/ApI/ecpvM6RsrCz2qP2ppBXUKihP4V/2d crossorigin=anonymous></script><script>if((!!1||!window.matchMedia("(max-width: 768px)").matches)&&window.firework){const e=JSON.parse('{"excludeelements":["a","button"],"particles":[{"colors":["var(--red-1)","var(--red-2)","var(--red-3)","var(--red-4)"],"duration":[1200,1800],"easing":"easeOutExpo","move":["emit"],"number":20,"shape":"circle","shapeOptions":{"alpha":[0.3,0.5],"radius":[16,32]}},{"colors":["var(--red-0)"],"duration":[1200,1800],"easing":"easeOutExpo","move":["diffuse"],"number":1,"shape":"circle","shapeOptions":{"alpha":[0.2,0.5],"lineWidth":6,"radius":20}}]}');e.excludeElements=e.excludeelements,delete e.excludeelements,window.firework(e)}</script><script src=https://npm.webcache.cn/theme-shokax-pjax@0.0.3/dist/index.umd.js integrity=sha384-xneY1WY8hOfUzswrE4CrYq35N4BdVcxqxwHPr9zawE/jMSCxD+jAPU55x/jj3wlf crossorigin=anonymous></script><script src=/js/pjax.js integrity crossorigin=anonymous></script><div id=lazy-script><div><script data-pjax>window.REIMU_POST={author:"r1muru",title:"Is stream encryption secure?",url:"https://r1muru2006.github.io/post/streamcipher/",description:"Today I will go over some stream ciphers and learn how they can be exploited by attackers.",cover:"https://r1muru2006.github.io/images/patriot/patriot.png"}</script><script src=/js/insert_highlight.js integrity crossorigin=anonymous data-pjax></script><script src=/js/tabs.js integrity crossorigin=anonymous data-pjax></script><script type=module data-pjax>const PhotoSwipeLightbox = (await safeImport("https:\/\/npm.webcache.cn\/photoswipe@5.4.4\/dist\/photoswipe-lightbox.esm.min.js", "sha384-DiL6M\/gG\u002bwmTxmCRZyD1zee6lIhawn5TGvED0FOh7fXcN9B0aZ9dexSF\/N6lrZi\/")).default;const initPswp = (gallery, children) => {
          if (_$$(`${gallery} ${children}`).length > 0) {
            new PhotoSwipeLightbox({
              gallery,
              children,pswpModule: () => safeImport("https:\/\/npm.webcache.cn\/photoswipe@5.4.4\/dist\/photoswipe.esm.min.js", "sha384-WkkO3GCmgkC3VQWpaV8DqhKJqpzpF9JoByxDmnV8\u002boTJ7m3DfYEWX1fu1scuS4\u002bs")}).init();
          }
        }
        const pswp = () => {
          initPswp('.article-entry', 'a.article-gallery-item');
          initPswp('.article-gallery', 'a.article-gallery-item');
          window.lightboxStatus = 'done';
          window.removeEventListener('lightbox:ready', pswp);
        }
        if(window.lightboxStatus === 'ready') {
          pswp()
        } else {
          window.addEventListener('lightbox:ready', pswp);
        }
      </script><script src=https://npm.webcache.cn/katex@0.16.24/dist/katex.min.js data-pjaxintegrity=sha384-MWNUH0WmtsYGhn2cbH6ELRCbf9LG3QDqCC+gqPB3IBNO35xjZK3Ejb6oONRpDbPg crossorigin=anonymous></script><script src=https://npm.webcache.cn/katex@0.16.24/dist/contrib/auto-render.min.js data-pjaxintegrity=sha384-hCXGrW6PitJEwbkoStFjeJxv+fSOOQKOPbJxSfM6G5sWZjAyWhXiTIIAmQqnlLlh crossorigin=anonymous></script><script data-pjax>var renderMath=()=>{if(!window.renderMathInElement)return;window.renderMathInElement(_$("article"),{delimiters:[{left:"$$",right:"$$",display:!0},{left:"\\[",right:"\\]",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1}]})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",renderMath,{once:!0}):renderMath()</script></div></div><script src=https://npm.webcache.cn/busuanzi@2.3.0/bsz.pure.mini.js asyncintegrity=sha384-0M75wtSkhjIInv4coYlaJU83+OypaRCIq2SukQVQX04eGTCBXJDuWAbJet56id+S crossorigin=anonymous></script><script>"serviceWorker"in navigator&&navigator.serviceWorker.getRegistrations().then(e=>{for(let t of e)t.unregister()})</script><script>const reimuCopyright=String.raw`
   ______     ______     __     __    __     __  __    
  /\  == \   /\  ___\   /\ \   /\ "-./  \   /\ \/\ \   
  \ \  __<   \ \  __\   \ \ \  \ \ \-./\ \  \ \ \_\ \  
   \ \_\ \_\  \ \_____\  \ \_\  \ \_\ \ \_\  \ \_____\ 
    \/_/ /_/   \/_____/   \/_/   \/_/  \/_/   \/_____/ 
                                                    
  `;console.log(String.raw`%c ${reimuCopyright}`,"color: #ff5252;"),console.log("%c Theme.Reimu %c https://github.com/D-Sketon/hugo-theme-reimu ","color: white; background: #ff5252; padding:5px 0;","padding:4px;border:1px solid #ff5252;")</script><script src=https://npm.webcache.cn/aplayer@1.10.1/dist/APlayer.min.js integrity=sha384-gdGYZwHnfJM54evoZhpO0s6ZF5BQiybkiyW7VXr+h5UfruuRL/aORyw+5+HZoU6e crossorigin=anonymous></script><script>if(!!1||!window.matchMedia("(max-width: 768px)").matches){if(window.matchMedia("(max-width: 959px)").matches){const e=_$("meting-js");if(e){e.setAttribute("fixed","true");const t=e.parentNode?.parentNode;t?.tagName==="ASIDE"&&(e.parentNode.removeChild(e),document.body.appendChild(e))}}const e=document.createElement("script");e.src="https://npm.webcache.cn/meting@2.0.1/dist/Meting.min.js",e.integrity="sha384-ASVlpKF80A22OXTK3tfEjZm1EL6uFMKIC4p8+0maanw1S/IyB+Y4JG+ZDU7GpKE8",e.crossOrigin="anonymous",document.body.appendChild(e)}</script></body></html>