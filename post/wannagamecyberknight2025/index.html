<!doctype html><html lang=en-us data-theme-mode=auto><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>WannaGame Cyber Knight 2025 | r1muru</title><meta name=description content="Đây là giải đấu do câu lạc bộ Wanna.W1n tổ chức để tuyển thành viên vào câu lạc bộ."><script>window.siteConfig=JSON.parse('{"anchor_icon":null,"base":"https://r1muru2006.github.io/","clipboard":{"copyright":{"count":50,"enable":false,"license_type":"by-nc-sa"},"fail":{"en":"Copy failed (ﾟ⊿ﾟ)ﾂ","ja":"コピー失敗 (ﾟ⊿ﾟ)ﾂ","pt-br":"Falha ao copiar (ﾟ⊿ﾟ)ﾂ","zh-cn":"复制失败 (ﾟ⊿ﾟ)ﾂ","zh-tw":"複製失敗 (ﾟ⊿ﾟ)ﾂ"},"success":{"en":"Copy successfully (*^▽^*)","ja":"コピー成功 (*^▽^*)","pt-br":"Copiado com sucesso (*^▽^*)","zh-cn":"复制成功 (*^▽^*)","zh-tw":"複製成功 (*^▽^*)"}},"code_block":{"expand":true},"icon_font":"4552607_4k4bc36ef96","outdate":{"daysago":180,"enable":false,"message":{"en":"This article was last updated on {time}. Please note that the content may no longer be applicable.","ja":"この記事は最終更新日：{time}。記載内容が現在有効でない可能性がありますのでご注意ください。","pt-br":"Este artigo foi atualizado pela última vez em {time}. Observe que o conteúdo pode não ser mais aplicável.","zh-cn":"本文最后更新于 {time}，请注意文中内容可能已不适用。","zh-tw":"本文最後更新於 {time}，請注意文中內容可能已不適用。"}}}')</script><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7cNoto%20Serif%20SC:400,400italic,700,700italic%7c&amp;display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7cNoto%20Serif%20SC:400,400italic,700,700italic%7c&amp;display=swap" media=print onload='this.media="all"'><link rel=preload href=//at.alicdn.com/t/c/font_4552607_4k4bc36ef96.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=stylesheet href=/css/loader.min.ac746e154f756f8220326eeb52a719f142ab038be5a8ddf30ea5ef15ef2356ea.css><meta property="og:type" content="website"><meta property="og:title" content="WannaGame Cyber Knight 2025 | r1muru"><meta property="og:description" content="Đây là giải đấu do câu lạc bộ Wanna.W1n tổ chức để tuyển thành viên vào câu lạc bộ."><meta property="og:url" content="https://r1muru2006.github.io/post/wannagamecyberknight2025/"><meta property="og:site_name" content="r1muru's blog"><meta property="og:image" content="/images/w1cyber.png"><meta property="article:author" content="r1muru"><meta property="article:published_time" content="2025-05-16T14:13:38+07:00"><meta property="article:modified_time" content="2025-05-16T14:13:38+07:00"><meta property="article:tag" content="CTFCryptography"><meta name=twitter:card content="summary"><meta name=twitter:image content="/images/w1cyber.png"><link rel="shortcut icon" href=/favicon.ico><link rel=stylesheet href=/css/main.min.1ec99443efbe3fab99cb9865562dd3e2ea79fa96c6e31d7cefc6bd117860ed4f.css><link rel=preload as=style href=https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe.css integrity=sha384-IfxC36XL/toUyJ939C73PcgMuRzAZuIzZxE38drsmO5p6jD7ei+Zx/1oA/0l8ysE crossorigin=anonymous onload='this.onload=null,this.rel="stylesheet"'><link rel=preload as=style href=https://npm.webcache.cn/katex@0.16.24/dist/katex.min.css integrity=sha384-tTgKLjMYmJr94v8qu2PE5MUGSMbyN2xiH266JUB3gpm8vnnJywd1dWSOEfrFz+YI crossorigin=anonymous onload='this.onload=null,this.rel="stylesheet"'><script src=https://npm.webcache.cn/pace-js@1.2.4/pace.min.js integrity=sha384-k6YtvFUEIuEFBdrLKJ3YAUbBki333tj1CSUisai5Cswsg9wcLNaPzsTHDswp4Az8 crossorigin=anonymous></script><link rel=stylesheet href=https://npm.webcache.cn/@reimujs/aos@0.1.2/dist/aos.css integrity=sha384-GMRP93c6Hkz9JVKGAuRR3nTS7M07RwPgTFenXiosjq2VbVgvdDNcz1g6Mkj8AONa crossorigin=anonymous></head><body><div id=loader><div class="loading-left-bg loading-bg"></div><div class="loading-right-bg loading-bg"></div><div class=spinner-box><div class="loading-taichi rotate"><svg width="150" height="150" viewBox="0 0 1024 1024" class="icon" shape-rendering="geometricPrecision"><path d="M303.5 432a80 80 0 01-12 160 80 80 0 0112-160z" fill="var(--red-1, #ff5252)"/><path d="M512 65a447 447 0 010 894V929a417 417 0 000-834 417 417 0 000 834v30a447 447 0 010-894zm0 30A417 417 0 01929 512 208.5 208.5.0 01720.5 720.5V592a80 80 0 000-160 80 80 0 000 160V720.5A208.5 208.5.0 01512 512 208.5 208.5.0 00303.5 303.5 208.5 208.5.0 0095 512 417 417 0 01512 95z" fill="var(--red-1, #ff5252)"/></svg></div><div class=loading-word>Loading...</div></div></div></div><script>var time=null,loaderEl=document.getElementById("loader"),startLoading=()=>{time=Date.now(),loaderEl.classList.remove("loading")},hideLoader=()=>{document.body.style.overflow="auto",loader.classList.add("loading")},endLoading=()=>{time?Date.now()-time>500?(time=null,hideLoader()):(setTimeout(endLoading,500-(Date.now()-time)),time=null):hideLoader()};window.addEventListener("DOMContentLoaded",endLoading),loaderEl.addEventListener("click",endLoading)</script><div id=copy-tooltip></div><div id=lang-tooltip>This article does not have a corresponding language version</div><div id=heatmap-tooltip></div><div id=container><div id=wrap><div id=header-nav><nav id=main-nav aria-label="Primary navigation"><a class=main-nav-link-wrap href=/><div class='main-nav-icon icon rotate'>&#xe62b;</div><span class=main-nav-link>Home</span>
</a><a class=main-nav-link-wrap href=/archives><div class='main-nav-icon icon rotate'>&#xe62b;</div><span class=main-nav-link>Archives</span>
</a><a class=main-nav-link-wrap href=/about><div class='main-nav-icon icon rotate'>&#xe62b;</div><span class=main-nav-link>About</span>
</a><a id=main-nav-toggle class=nav-icon aria-label="Toggle navigation" role=button></a></nav><nav id=sub-nav aria-label="Secondary navigation"><a id=nav-search-btn class="nav-icon popup-trigger" title=Search aria-label=Search></a></nav></div><header id=header aria-label="Site header"><picture></picture>
<img fetchpriority=high src=/images/w1cyber.png alt="WannaGame Cyber Knight 2025"><div id=header-outer><div id=header-title><span id=logo><h1 data-aos=slide-up>WannaGame Cyber Knight 2025</h1></span><h2 id=subtitle-wrap data-aos=slide-down></h2></div></div></header><div id=content aria-label="Page content" class=sidebar-left><aside id=sidebar aria-label=Sidebar><div class="sidebar-wrapper-container sticky"><div class=sidebar-wrapper><div class=sidebar-wrap data-aos=fade-up><div class=sidebar-toc-sidebar><h3 class=toc-title>Contents</h3><div class="sidebar-toc-wrapper toc-div-class"><nav id=TableOfContents><ul><li><a href=#choose>Choose!</a><ul><li><a href=#phân-tích>Phân tích:</a></li><li><a href=#ý-tưởng>Ý tưởng:</a></li></ul></li><li><a href=#heartbreak>heartbreak</a><ul><li><a href=#part-1>Part 1:</a></li><li><a href=#part-2>Part 2:</a></li></ul></li></ul></nav></div></div><div class="sidebar-common-sidebar hidden"><div class=sidebar-author><img data-src=/avatar/avatar.png data-sizes=auto alt=r1muru class=lazyload><div class=sidebar-author-name>r1muru</div><div class=sidebar-description>Life is not fair, get used to it</div></div><div class=sidebar-state><div class=sidebar-state-article><div>Posts</div><div class=sidebar-state-number>9</div></div><a class=sidebar-state-category href=/categories/ aria-label=sidebar-state-category-link><div>Categories</div><div class=sidebar-state-number>3</div></a><a class=sidebar-state-tag href=/tags/ aria-label=sidebar-state-tag-link><div>Tags</div><div class=sidebar-state-number>7</div></a></div><div class=sidebar-social><div class="icon-discord sidebar-social-icon"><a href=https://discordapp.com/users/r1muru2006 itemprop=url target=_blank aria-label=discord rel="noopener nofollow noreferrer"></a></div><div class="icon-email sidebar-social-icon"><a href=cuongchu200@gmail.com itemprop=url target=_blank aria-label=email rel="noopener nofollow noreferrer"></a></div><div class="icon-facebook sidebar-social-icon"><a href=https://www.facebook.com/chu.cuong.732399 itemprop=url target=_blank aria-label=facebook rel="noopener nofollow noreferrer"></a></div><div class="icon-github sidebar-social-icon"><a href=https://github.com/r1muru2006 itemprop=url target=_blank aria-label=github rel="noopener nofollow noreferrer"></a></div><div class="icon-instagram sidebar-social-icon"><a href=https://www.instagram.com/r1murun0pr0 itemprop=url target=_blank aria-label=instagram rel="noopener nofollow noreferrer"></a></div></div><div class=sidebar-menu><div class=sidebar-menu-link-wrap><a class=sidebar-menu-link-dummy href=/ aria-label=Home></a><div class='sidebar-menu-icon icon rotate'>&#xe62b;</div><div class=sidebar-menu-link>Home</div></div><div class=sidebar-menu-link-wrap><a class=sidebar-menu-link-dummy href=/archives aria-label=Archives></a><div class='sidebar-menu-icon icon rotate'>&#xe62b;</div><div class=sidebar-menu-link>Archives</div></div><div class=sidebar-menu-link-wrap><a class=sidebar-menu-link-dummy href=/about aria-label=About></a><div class='sidebar-menu-icon icon rotate'>&#xe62b;</div><div class=sidebar-menu-link>About</div></div></div></div><div class=sidebar-btn-wrapper style=position:static><div class="sidebar-toc-btn current"></div><div class=sidebar-common-btn></div></div></div></div><div class=sidebar-widget></div></div></aside><section id=main aria-label="Main content"><article class="h-entry article" itemscope itemtype=https://schema.org/BlogPosting><div class=article-inner data-aos=fade-up><div class=article-meta><div class=article-date><span class="article-date-link icon-calendar" data-aos=zoom-in><time datetime="2025-05-16 14:13:38 +0700 +0700" itemprop=datePublished>2025-05-16</time>
<time style=display:none id=post-update-time>2025-05-16</time></span></div><div class=article-category><a class=article-category-link href=/categories/ctf-write-up data-aos=zoom-in>CTF WRITE-UP</a><a class=article-category-link href=/categories/wannagame data-aos=zoom-in>WANNAGAME</a></div></div><div class=hr-line></div><div class="e-content article-entry" itemprop=articleBody><blockquote><p>Trong giải đấu này, mình đã giải được 1 câu trong phần Cryptography và may mắn đứng thứ 8 trên bảng đến cuối (≧▽≦)
<img src=https://hackmd.io/_uploads/BkKat26egg.png alt=image>
Sau đây là bài mình giải được trong giải đấu và tiếp đó là những bài mà mình chưa làm được khi còn trong giải.</p></blockquote><h2 id=choose><a class=header-anchor href=#choose></a>Choose!</h2><p><img src=https://hackmd.io/_uploads/HkBEq3pexl.png alt=image></p><p>Link: <a href="https://www.youtube.com/watch?v=1lqe8eU48HI">https://www.youtube.com/watch?v=1lqe8eU48HI</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># aes.py</span>
</span></span><span class=line><span class=cl><span class=c1>#Implementation from https://github.com/boppreh/aes/blob/master/aes.py</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>s_box</span> <span class=o>=</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x63</span><span class=p>,</span> <span class=mh>0x7C</span><span class=p>,</span> <span class=mh>0x77</span><span class=p>,</span> <span class=mh>0x7B</span><span class=p>,</span> <span class=mh>0xF2</span><span class=p>,</span> <span class=mh>0x6B</span><span class=p>,</span> <span class=mh>0x6F</span><span class=p>,</span> <span class=mh>0xC5</span><span class=p>,</span> <span class=mh>0x30</span><span class=p>,</span> <span class=mh>0x01</span><span class=p>,</span> <span class=mh>0x67</span><span class=p>,</span> <span class=mh>0x2B</span><span class=p>,</span> <span class=mh>0xFE</span><span class=p>,</span> <span class=mh>0xD7</span><span class=p>,</span> <span class=mh>0xAB</span><span class=p>,</span> <span class=mh>0x76</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xCA</span><span class=p>,</span> <span class=mh>0x82</span><span class=p>,</span> <span class=mh>0xC9</span><span class=p>,</span> <span class=mh>0x7D</span><span class=p>,</span> <span class=mh>0xFA</span><span class=p>,</span> <span class=mh>0x59</span><span class=p>,</span> <span class=mh>0x47</span><span class=p>,</span> <span class=mh>0xF0</span><span class=p>,</span> <span class=mh>0xAD</span><span class=p>,</span> <span class=mh>0xD4</span><span class=p>,</span> <span class=mh>0xA2</span><span class=p>,</span> <span class=mh>0xAF</span><span class=p>,</span> <span class=mh>0x9C</span><span class=p>,</span> <span class=mh>0xA4</span><span class=p>,</span> <span class=mh>0x72</span><span class=p>,</span> <span class=mh>0xC0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xB7</span><span class=p>,</span> <span class=mh>0xFD</span><span class=p>,</span> <span class=mh>0x93</span><span class=p>,</span> <span class=mh>0x26</span><span class=p>,</span> <span class=mh>0x36</span><span class=p>,</span> <span class=mh>0x3F</span><span class=p>,</span> <span class=mh>0xF7</span><span class=p>,</span> <span class=mh>0xCC</span><span class=p>,</span> <span class=mh>0x34</span><span class=p>,</span> <span class=mh>0xA5</span><span class=p>,</span> <span class=mh>0xE5</span><span class=p>,</span> <span class=mh>0xF1</span><span class=p>,</span> <span class=mh>0x71</span><span class=p>,</span> <span class=mh>0xD8</span><span class=p>,</span> <span class=mh>0x31</span><span class=p>,</span> <span class=mh>0x15</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x04</span><span class=p>,</span> <span class=mh>0xC7</span><span class=p>,</span> <span class=mh>0x23</span><span class=p>,</span> <span class=mh>0xC3</span><span class=p>,</span> <span class=mh>0x18</span><span class=p>,</span> <span class=mh>0x96</span><span class=p>,</span> <span class=mh>0x05</span><span class=p>,</span> <span class=mh>0x9A</span><span class=p>,</span> <span class=mh>0x07</span><span class=p>,</span> <span class=mh>0x12</span><span class=p>,</span> <span class=mh>0x80</span><span class=p>,</span> <span class=mh>0xE2</span><span class=p>,</span> <span class=mh>0xEB</span><span class=p>,</span> <span class=mh>0x27</span><span class=p>,</span> <span class=mh>0xB2</span><span class=p>,</span> <span class=mh>0x75</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x09</span><span class=p>,</span> <span class=mh>0x83</span><span class=p>,</span> <span class=mh>0x2C</span><span class=p>,</span> <span class=mh>0x1A</span><span class=p>,</span> <span class=mh>0x1B</span><span class=p>,</span> <span class=mh>0x6E</span><span class=p>,</span> <span class=mh>0x5A</span><span class=p>,</span> <span class=mh>0xA0</span><span class=p>,</span> <span class=mh>0x52</span><span class=p>,</span> <span class=mh>0x3B</span><span class=p>,</span> <span class=mh>0xD6</span><span class=p>,</span> <span class=mh>0xB3</span><span class=p>,</span> <span class=mh>0x29</span><span class=p>,</span> <span class=mh>0xE3</span><span class=p>,</span> <span class=mh>0x2F</span><span class=p>,</span> <span class=mh>0x84</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x53</span><span class=p>,</span> <span class=mh>0xD1</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0xED</span><span class=p>,</span> <span class=mh>0x20</span><span class=p>,</span> <span class=mh>0xFC</span><span class=p>,</span> <span class=mh>0xB1</span><span class=p>,</span> <span class=mh>0x5B</span><span class=p>,</span> <span class=mh>0x6A</span><span class=p>,</span> <span class=mh>0xCB</span><span class=p>,</span> <span class=mh>0xBE</span><span class=p>,</span> <span class=mh>0x39</span><span class=p>,</span> <span class=mh>0x4A</span><span class=p>,</span> <span class=mh>0x4C</span><span class=p>,</span> <span class=mh>0x58</span><span class=p>,</span> <span class=mh>0xCF</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xD0</span><span class=p>,</span> <span class=mh>0xEF</span><span class=p>,</span> <span class=mh>0xAA</span><span class=p>,</span> <span class=mh>0xFB</span><span class=p>,</span> <span class=mh>0x43</span><span class=p>,</span> <span class=mh>0x4D</span><span class=p>,</span> <span class=mh>0x33</span><span class=p>,</span> <span class=mh>0x85</span><span class=p>,</span> <span class=mh>0x45</span><span class=p>,</span> <span class=mh>0xF9</span><span class=p>,</span> <span class=mh>0x02</span><span class=p>,</span> <span class=mh>0x7F</span><span class=p>,</span> <span class=mh>0x50</span><span class=p>,</span> <span class=mh>0x3C</span><span class=p>,</span> <span class=mh>0x9F</span><span class=p>,</span> <span class=mh>0xA8</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x51</span><span class=p>,</span> <span class=mh>0xA3</span><span class=p>,</span> <span class=mh>0x40</span><span class=p>,</span> <span class=mh>0x8F</span><span class=p>,</span> <span class=mh>0x92</span><span class=p>,</span> <span class=mh>0x9D</span><span class=p>,</span> <span class=mh>0x38</span><span class=p>,</span> <span class=mh>0xF5</span><span class=p>,</span> <span class=mh>0xBC</span><span class=p>,</span> <span class=mh>0xB6</span><span class=p>,</span> <span class=mh>0xDA</span><span class=p>,</span> <span class=mh>0x21</span><span class=p>,</span> <span class=mh>0x10</span><span class=p>,</span> <span class=mh>0xFF</span><span class=p>,</span> <span class=mh>0xF3</span><span class=p>,</span> <span class=mh>0xD2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xCD</span><span class=p>,</span> <span class=mh>0x0C</span><span class=p>,</span> <span class=mh>0x13</span><span class=p>,</span> <span class=mh>0xEC</span><span class=p>,</span> <span class=mh>0x5F</span><span class=p>,</span> <span class=mh>0x97</span><span class=p>,</span> <span class=mh>0x44</span><span class=p>,</span> <span class=mh>0x17</span><span class=p>,</span> <span class=mh>0xC4</span><span class=p>,</span> <span class=mh>0xA7</span><span class=p>,</span> <span class=mh>0x7E</span><span class=p>,</span> <span class=mh>0x3D</span><span class=p>,</span> <span class=mh>0x64</span><span class=p>,</span> <span class=mh>0x5D</span><span class=p>,</span> <span class=mh>0x19</span><span class=p>,</span> <span class=mh>0x73</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x60</span><span class=p>,</span> <span class=mh>0x81</span><span class=p>,</span> <span class=mh>0x4F</span><span class=p>,</span> <span class=mh>0xDC</span><span class=p>,</span> <span class=mh>0x22</span><span class=p>,</span> <span class=mh>0x2A</span><span class=p>,</span> <span class=mh>0x90</span><span class=p>,</span> <span class=mh>0x88</span><span class=p>,</span> <span class=mh>0x46</span><span class=p>,</span> <span class=mh>0xEE</span><span class=p>,</span> <span class=mh>0xB8</span><span class=p>,</span> <span class=mh>0x14</span><span class=p>,</span> <span class=mh>0xDE</span><span class=p>,</span> <span class=mh>0x5E</span><span class=p>,</span> <span class=mh>0x0B</span><span class=p>,</span> <span class=mh>0xDB</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xE0</span><span class=p>,</span> <span class=mh>0x32</span><span class=p>,</span> <span class=mh>0x3A</span><span class=p>,</span> <span class=mh>0x0A</span><span class=p>,</span> <span class=mh>0x49</span><span class=p>,</span> <span class=mh>0x06</span><span class=p>,</span> <span class=mh>0x24</span><span class=p>,</span> <span class=mh>0x5C</span><span class=p>,</span> <span class=mh>0xC2</span><span class=p>,</span> <span class=mh>0xD3</span><span class=p>,</span> <span class=mh>0xAC</span><span class=p>,</span> <span class=mh>0x62</span><span class=p>,</span> <span class=mh>0x91</span><span class=p>,</span> <span class=mh>0x95</span><span class=p>,</span> <span class=mh>0xE4</span><span class=p>,</span> <span class=mh>0x79</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xE7</span><span class=p>,</span> <span class=mh>0xC8</span><span class=p>,</span> <span class=mh>0x37</span><span class=p>,</span> <span class=mh>0x6D</span><span class=p>,</span> <span class=mh>0x8D</span><span class=p>,</span> <span class=mh>0xD5</span><span class=p>,</span> <span class=mh>0x4E</span><span class=p>,</span> <span class=mh>0xA9</span><span class=p>,</span> <span class=mh>0x6C</span><span class=p>,</span> <span class=mh>0x56</span><span class=p>,</span> <span class=mh>0xF4</span><span class=p>,</span> <span class=mh>0xEA</span><span class=p>,</span> <span class=mh>0x65</span><span class=p>,</span> <span class=mh>0x7A</span><span class=p>,</span> <span class=mh>0xAE</span><span class=p>,</span> <span class=mh>0x08</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xBA</span><span class=p>,</span> <span class=mh>0x78</span><span class=p>,</span> <span class=mh>0x25</span><span class=p>,</span> <span class=mh>0x2E</span><span class=p>,</span> <span class=mh>0x1C</span><span class=p>,</span> <span class=mh>0xA6</span><span class=p>,</span> <span class=mh>0xB4</span><span class=p>,</span> <span class=mh>0xC6</span><span class=p>,</span> <span class=mh>0xE8</span><span class=p>,</span> <span class=mh>0xDD</span><span class=p>,</span> <span class=mh>0x74</span><span class=p>,</span> <span class=mh>0x1F</span><span class=p>,</span> <span class=mh>0x4B</span><span class=p>,</span> <span class=mh>0xBD</span><span class=p>,</span> <span class=mh>0x8B</span><span class=p>,</span> <span class=mh>0x8A</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x70</span><span class=p>,</span> <span class=mh>0x3E</span><span class=p>,</span> <span class=mh>0xB5</span><span class=p>,</span> <span class=mh>0x66</span><span class=p>,</span> <span class=mh>0x48</span><span class=p>,</span> <span class=mh>0x03</span><span class=p>,</span> <span class=mh>0xF6</span><span class=p>,</span> <span class=mh>0x0E</span><span class=p>,</span> <span class=mh>0x61</span><span class=p>,</span> <span class=mh>0x35</span><span class=p>,</span> <span class=mh>0x57</span><span class=p>,</span> <span class=mh>0xB9</span><span class=p>,</span> <span class=mh>0x86</span><span class=p>,</span> <span class=mh>0xC1</span><span class=p>,</span> <span class=mh>0x1D</span><span class=p>,</span> <span class=mh>0x9E</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xE1</span><span class=p>,</span> <span class=mh>0xF8</span><span class=p>,</span> <span class=mh>0x98</span><span class=p>,</span> <span class=mh>0x11</span><span class=p>,</span> <span class=mh>0x69</span><span class=p>,</span> <span class=mh>0xD9</span><span class=p>,</span> <span class=mh>0x8E</span><span class=p>,</span> <span class=mh>0x94</span><span class=p>,</span> <span class=mh>0x9B</span><span class=p>,</span> <span class=mh>0x1E</span><span class=p>,</span> <span class=mh>0x87</span><span class=p>,</span> <span class=mh>0xE9</span><span class=p>,</span> <span class=mh>0xCE</span><span class=p>,</span> <span class=mh>0x55</span><span class=p>,</span> <span class=mh>0x28</span><span class=p>,</span> <span class=mh>0xDF</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x8C</span><span class=p>,</span> <span class=mh>0xA1</span><span class=p>,</span> <span class=mh>0x89</span><span class=p>,</span> <span class=mh>0x0D</span><span class=p>,</span> <span class=mh>0xBF</span><span class=p>,</span> <span class=mh>0xE6</span><span class=p>,</span> <span class=mh>0x42</span><span class=p>,</span> <span class=mh>0x68</span><span class=p>,</span> <span class=mh>0x41</span><span class=p>,</span> <span class=mh>0x99</span><span class=p>,</span> <span class=mh>0x2D</span><span class=p>,</span> <span class=mh>0x0F</span><span class=p>,</span> <span class=mh>0xB0</span><span class=p>,</span> <span class=mh>0x54</span><span class=p>,</span> <span class=mh>0xBB</span><span class=p>,</span> <span class=mh>0x16</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>inv_s_box</span> <span class=o>=</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x52</span><span class=p>,</span> <span class=mh>0x09</span><span class=p>,</span> <span class=mh>0x6A</span><span class=p>,</span> <span class=mh>0xD5</span><span class=p>,</span> <span class=mh>0x30</span><span class=p>,</span> <span class=mh>0x36</span><span class=p>,</span> <span class=mh>0xA5</span><span class=p>,</span> <span class=mh>0x38</span><span class=p>,</span> <span class=mh>0xBF</span><span class=p>,</span> <span class=mh>0x40</span><span class=p>,</span> <span class=mh>0xA3</span><span class=p>,</span> <span class=mh>0x9E</span><span class=p>,</span> <span class=mh>0x81</span><span class=p>,</span> <span class=mh>0xF3</span><span class=p>,</span> <span class=mh>0xD7</span><span class=p>,</span> <span class=mh>0xFB</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x7C</span><span class=p>,</span> <span class=mh>0xE3</span><span class=p>,</span> <span class=mh>0x39</span><span class=p>,</span> <span class=mh>0x82</span><span class=p>,</span> <span class=mh>0x9B</span><span class=p>,</span> <span class=mh>0x2F</span><span class=p>,</span> <span class=mh>0xFF</span><span class=p>,</span> <span class=mh>0x87</span><span class=p>,</span> <span class=mh>0x34</span><span class=p>,</span> <span class=mh>0x8E</span><span class=p>,</span> <span class=mh>0x43</span><span class=p>,</span> <span class=mh>0x44</span><span class=p>,</span> <span class=mh>0xC4</span><span class=p>,</span> <span class=mh>0xDE</span><span class=p>,</span> <span class=mh>0xE9</span><span class=p>,</span> <span class=mh>0xCB</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x54</span><span class=p>,</span> <span class=mh>0x7B</span><span class=p>,</span> <span class=mh>0x94</span><span class=p>,</span> <span class=mh>0x32</span><span class=p>,</span> <span class=mh>0xA6</span><span class=p>,</span> <span class=mh>0xC2</span><span class=p>,</span> <span class=mh>0x23</span><span class=p>,</span> <span class=mh>0x3D</span><span class=p>,</span> <span class=mh>0xEE</span><span class=p>,</span> <span class=mh>0x4C</span><span class=p>,</span> <span class=mh>0x95</span><span class=p>,</span> <span class=mh>0x0B</span><span class=p>,</span> <span class=mh>0x42</span><span class=p>,</span> <span class=mh>0xFA</span><span class=p>,</span> <span class=mh>0xC3</span><span class=p>,</span> <span class=mh>0x4E</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x08</span><span class=p>,</span> <span class=mh>0x2E</span><span class=p>,</span> <span class=mh>0xA1</span><span class=p>,</span> <span class=mh>0x66</span><span class=p>,</span> <span class=mh>0x28</span><span class=p>,</span> <span class=mh>0xD9</span><span class=p>,</span> <span class=mh>0x24</span><span class=p>,</span> <span class=mh>0xB2</span><span class=p>,</span> <span class=mh>0x76</span><span class=p>,</span> <span class=mh>0x5B</span><span class=p>,</span> <span class=mh>0xA2</span><span class=p>,</span> <span class=mh>0x49</span><span class=p>,</span> <span class=mh>0x6D</span><span class=p>,</span> <span class=mh>0x8B</span><span class=p>,</span> <span class=mh>0xD1</span><span class=p>,</span> <span class=mh>0x25</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x72</span><span class=p>,</span> <span class=mh>0xF8</span><span class=p>,</span> <span class=mh>0xF6</span><span class=p>,</span> <span class=mh>0x64</span><span class=p>,</span> <span class=mh>0x86</span><span class=p>,</span> <span class=mh>0x68</span><span class=p>,</span> <span class=mh>0x98</span><span class=p>,</span> <span class=mh>0x16</span><span class=p>,</span> <span class=mh>0xD4</span><span class=p>,</span> <span class=mh>0xA4</span><span class=p>,</span> <span class=mh>0x5C</span><span class=p>,</span> <span class=mh>0xCC</span><span class=p>,</span> <span class=mh>0x5D</span><span class=p>,</span> <span class=mh>0x65</span><span class=p>,</span> <span class=mh>0xB6</span><span class=p>,</span> <span class=mh>0x92</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x6C</span><span class=p>,</span> <span class=mh>0x70</span><span class=p>,</span> <span class=mh>0x48</span><span class=p>,</span> <span class=mh>0x50</span><span class=p>,</span> <span class=mh>0xFD</span><span class=p>,</span> <span class=mh>0xED</span><span class=p>,</span> <span class=mh>0xB9</span><span class=p>,</span> <span class=mh>0xDA</span><span class=p>,</span> <span class=mh>0x5E</span><span class=p>,</span> <span class=mh>0x15</span><span class=p>,</span> <span class=mh>0x46</span><span class=p>,</span> <span class=mh>0x57</span><span class=p>,</span> <span class=mh>0xA7</span><span class=p>,</span> <span class=mh>0x8D</span><span class=p>,</span> <span class=mh>0x9D</span><span class=p>,</span> <span class=mh>0x84</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x90</span><span class=p>,</span> <span class=mh>0xD8</span><span class=p>,</span> <span class=mh>0xAB</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x8C</span><span class=p>,</span> <span class=mh>0xBC</span><span class=p>,</span> <span class=mh>0xD3</span><span class=p>,</span> <span class=mh>0x0A</span><span class=p>,</span> <span class=mh>0xF7</span><span class=p>,</span> <span class=mh>0xE4</span><span class=p>,</span> <span class=mh>0x58</span><span class=p>,</span> <span class=mh>0x05</span><span class=p>,</span> <span class=mh>0xB8</span><span class=p>,</span> <span class=mh>0xB3</span><span class=p>,</span> <span class=mh>0x45</span><span class=p>,</span> <span class=mh>0x06</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xD0</span><span class=p>,</span> <span class=mh>0x2C</span><span class=p>,</span> <span class=mh>0x1E</span><span class=p>,</span> <span class=mh>0x8F</span><span class=p>,</span> <span class=mh>0xCA</span><span class=p>,</span> <span class=mh>0x3F</span><span class=p>,</span> <span class=mh>0x0F</span><span class=p>,</span> <span class=mh>0x02</span><span class=p>,</span> <span class=mh>0xC1</span><span class=p>,</span> <span class=mh>0xAF</span><span class=p>,</span> <span class=mh>0xBD</span><span class=p>,</span> <span class=mh>0x03</span><span class=p>,</span> <span class=mh>0x01</span><span class=p>,</span> <span class=mh>0x13</span><span class=p>,</span> <span class=mh>0x8A</span><span class=p>,</span> <span class=mh>0x6B</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x3A</span><span class=p>,</span> <span class=mh>0x91</span><span class=p>,</span> <span class=mh>0x11</span><span class=p>,</span> <span class=mh>0x41</span><span class=p>,</span> <span class=mh>0x4F</span><span class=p>,</span> <span class=mh>0x67</span><span class=p>,</span> <span class=mh>0xDC</span><span class=p>,</span> <span class=mh>0xEA</span><span class=p>,</span> <span class=mh>0x97</span><span class=p>,</span> <span class=mh>0xF2</span><span class=p>,</span> <span class=mh>0xCF</span><span class=p>,</span> <span class=mh>0xCE</span><span class=p>,</span> <span class=mh>0xF0</span><span class=p>,</span> <span class=mh>0xB4</span><span class=p>,</span> <span class=mh>0xE6</span><span class=p>,</span> <span class=mh>0x73</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x96</span><span class=p>,</span> <span class=mh>0xAC</span><span class=p>,</span> <span class=mh>0x74</span><span class=p>,</span> <span class=mh>0x22</span><span class=p>,</span> <span class=mh>0xE7</span><span class=p>,</span> <span class=mh>0xAD</span><span class=p>,</span> <span class=mh>0x35</span><span class=p>,</span> <span class=mh>0x85</span><span class=p>,</span> <span class=mh>0xE2</span><span class=p>,</span> <span class=mh>0xF9</span><span class=p>,</span> <span class=mh>0x37</span><span class=p>,</span> <span class=mh>0xE8</span><span class=p>,</span> <span class=mh>0x1C</span><span class=p>,</span> <span class=mh>0x75</span><span class=p>,</span> <span class=mh>0xDF</span><span class=p>,</span> <span class=mh>0x6E</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x47</span><span class=p>,</span> <span class=mh>0xF1</span><span class=p>,</span> <span class=mh>0x1A</span><span class=p>,</span> <span class=mh>0x71</span><span class=p>,</span> <span class=mh>0x1D</span><span class=p>,</span> <span class=mh>0x29</span><span class=p>,</span> <span class=mh>0xC5</span><span class=p>,</span> <span class=mh>0x89</span><span class=p>,</span> <span class=mh>0x6F</span><span class=p>,</span> <span class=mh>0xB7</span><span class=p>,</span> <span class=mh>0x62</span><span class=p>,</span> <span class=mh>0x0E</span><span class=p>,</span> <span class=mh>0xAA</span><span class=p>,</span> <span class=mh>0x18</span><span class=p>,</span> <span class=mh>0xBE</span><span class=p>,</span> <span class=mh>0x1B</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xFC</span><span class=p>,</span> <span class=mh>0x56</span><span class=p>,</span> <span class=mh>0x3E</span><span class=p>,</span> <span class=mh>0x4B</span><span class=p>,</span> <span class=mh>0xC6</span><span class=p>,</span> <span class=mh>0xD2</span><span class=p>,</span> <span class=mh>0x79</span><span class=p>,</span> <span class=mh>0x20</span><span class=p>,</span> <span class=mh>0x9A</span><span class=p>,</span> <span class=mh>0xDB</span><span class=p>,</span> <span class=mh>0xC0</span><span class=p>,</span> <span class=mh>0xFE</span><span class=p>,</span> <span class=mh>0x78</span><span class=p>,</span> <span class=mh>0xCD</span><span class=p>,</span> <span class=mh>0x5A</span><span class=p>,</span> <span class=mh>0xF4</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x1F</span><span class=p>,</span> <span class=mh>0xDD</span><span class=p>,</span> <span class=mh>0xA8</span><span class=p>,</span> <span class=mh>0x33</span><span class=p>,</span> <span class=mh>0x88</span><span class=p>,</span> <span class=mh>0x07</span><span class=p>,</span> <span class=mh>0xC7</span><span class=p>,</span> <span class=mh>0x31</span><span class=p>,</span> <span class=mh>0xB1</span><span class=p>,</span> <span class=mh>0x12</span><span class=p>,</span> <span class=mh>0x10</span><span class=p>,</span> <span class=mh>0x59</span><span class=p>,</span> <span class=mh>0x27</span><span class=p>,</span> <span class=mh>0x80</span><span class=p>,</span> <span class=mh>0xEC</span><span class=p>,</span> <span class=mh>0x5F</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x60</span><span class=p>,</span> <span class=mh>0x51</span><span class=p>,</span> <span class=mh>0x7F</span><span class=p>,</span> <span class=mh>0xA9</span><span class=p>,</span> <span class=mh>0x19</span><span class=p>,</span> <span class=mh>0xB5</span><span class=p>,</span> <span class=mh>0x4A</span><span class=p>,</span> <span class=mh>0x0D</span><span class=p>,</span> <span class=mh>0x2D</span><span class=p>,</span> <span class=mh>0xE5</span><span class=p>,</span> <span class=mh>0x7A</span><span class=p>,</span> <span class=mh>0x9F</span><span class=p>,</span> <span class=mh>0x93</span><span class=p>,</span> <span class=mh>0xC9</span><span class=p>,</span> <span class=mh>0x9C</span><span class=p>,</span> <span class=mh>0xEF</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xA0</span><span class=p>,</span> <span class=mh>0xE0</span><span class=p>,</span> <span class=mh>0x3B</span><span class=p>,</span> <span class=mh>0x4D</span><span class=p>,</span> <span class=mh>0xAE</span><span class=p>,</span> <span class=mh>0x2A</span><span class=p>,</span> <span class=mh>0xF5</span><span class=p>,</span> <span class=mh>0xB0</span><span class=p>,</span> <span class=mh>0xC8</span><span class=p>,</span> <span class=mh>0xEB</span><span class=p>,</span> <span class=mh>0xBB</span><span class=p>,</span> <span class=mh>0x3C</span><span class=p>,</span> <span class=mh>0x83</span><span class=p>,</span> <span class=mh>0x53</span><span class=p>,</span> <span class=mh>0x99</span><span class=p>,</span> <span class=mh>0x61</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x17</span><span class=p>,</span> <span class=mh>0x2B</span><span class=p>,</span> <span class=mh>0x04</span><span class=p>,</span> <span class=mh>0x7E</span><span class=p>,</span> <span class=mh>0xBA</span><span class=p>,</span> <span class=mh>0x77</span><span class=p>,</span> <span class=mh>0xD6</span><span class=p>,</span> <span class=mh>0x26</span><span class=p>,</span> <span class=mh>0xE1</span><span class=p>,</span> <span class=mh>0x69</span><span class=p>,</span> <span class=mh>0x14</span><span class=p>,</span> <span class=mh>0x63</span><span class=p>,</span> <span class=mh>0x55</span><span class=p>,</span> <span class=mh>0x21</span><span class=p>,</span> <span class=mh>0x0C</span><span class=p>,</span> <span class=mh>0x7D</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>sub_bytes</span><span class=p>(</span><span class=n>s</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>4</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>4</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=n>s_box</span><span class=p>[</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>inv_sub_bytes</span><span class=p>(</span><span class=n>s</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>4</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>4</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=n>inv_s_box</span><span class=p>[</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>shift_rows</span><span class=p>(</span><span class=n>s</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>2</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>3</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>s</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>2</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>3</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>2</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=mi>2</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>2</span><span class=p>][</span><span class=mi>2</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>3</span><span class=p>][</span><span class=mi>2</span><span class=p>]</span> <span class=o>=</span> <span class=n>s</span><span class=p>[</span><span class=mi>2</span><span class=p>][</span><span class=mi>2</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>3</span><span class=p>][</span><span class=mi>2</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>2</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=mi>2</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>3</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=mi>3</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>2</span><span class=p>][</span><span class=mi>3</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>3</span><span class=p>][</span><span class=mi>3</span><span class=p>]</span> <span class=o>=</span> <span class=n>s</span><span class=p>[</span><span class=mi>3</span><span class=p>][</span><span class=mi>3</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>3</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=mi>3</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>2</span><span class=p>][</span><span class=mi>3</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>inv_shift_rows</span><span class=p>(</span><span class=n>s</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>2</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>3</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>s</span><span class=p>[</span><span class=mi>3</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>2</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>2</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=mi>2</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>2</span><span class=p>][</span><span class=mi>2</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>3</span><span class=p>][</span><span class=mi>2</span><span class=p>]</span> <span class=o>=</span> <span class=n>s</span><span class=p>[</span><span class=mi>2</span><span class=p>][</span><span class=mi>2</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>3</span><span class=p>][</span><span class=mi>2</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>2</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=mi>2</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>3</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=mi>3</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>2</span><span class=p>][</span><span class=mi>3</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>3</span><span class=p>][</span><span class=mi>3</span><span class=p>]</span> <span class=o>=</span> <span class=n>s</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=mi>3</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>2</span><span class=p>][</span><span class=mi>3</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>3</span><span class=p>][</span><span class=mi>3</span><span class=p>],</span> <span class=n>s</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>3</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>add_round_key</span><span class=p>(</span><span class=n>s</span><span class=p>,</span> <span class=n>k</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>4</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>4</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span> <span class=o>^=</span> <span class=n>k</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># learned from https://web.archive.org/web/20100626212235/http://cs.ucsb.edu/~koc/cs178/projects/JT/aes.c</span>
</span></span><span class=line><span class=cl><span class=n>xtime</span> <span class=o>=</span> <span class=k>lambda</span> <span class=n>a</span><span class=p>:</span> <span class=p>(((</span><span class=n>a</span> <span class=o>&lt;&lt;</span> <span class=mi>1</span><span class=p>)</span> <span class=o>^</span> <span class=mh>0x1B</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0xFF</span><span class=p>)</span> <span class=k>if</span> <span class=p>(</span><span class=n>a</span> <span class=o>&amp;</span> <span class=mh>0x80</span><span class=p>)</span> <span class=k>else</span> <span class=p>(</span><span class=n>a</span> <span class=o>&lt;&lt;</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>mix_single_column</span><span class=p>(</span><span class=n>a</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># see Sec 4.1.2 in The Design of Rijndael</span>
</span></span><span class=line><span class=cl>    <span class=n>t</span> <span class=o>=</span> <span class=n>a</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>^</span> <span class=n>a</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>^</span> <span class=n>a</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>^</span> <span class=n>a</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>u</span> <span class=o>=</span> <span class=n>a</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>a</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>^=</span> <span class=n>t</span> <span class=o>^</span> <span class=n>xtime</span><span class=p>(</span><span class=n>a</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>^</span> <span class=n>a</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>a</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>^=</span> <span class=n>t</span> <span class=o>^</span> <span class=n>xtime</span><span class=p>(</span><span class=n>a</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>^</span> <span class=n>a</span><span class=p>[</span><span class=mi>2</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>a</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>^=</span> <span class=n>t</span> <span class=o>^</span> <span class=n>xtime</span><span class=p>(</span><span class=n>a</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>^</span> <span class=n>a</span><span class=p>[</span><span class=mi>3</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>a</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>^=</span> <span class=n>t</span> <span class=o>^</span> <span class=n>xtime</span><span class=p>(</span><span class=n>a</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>^</span> <span class=n>u</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>mix_columns</span><span class=p>(</span><span class=n>s</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>4</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>mix_single_column</span><span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>inv_mix_columns</span><span class=p>(</span><span class=n>s</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># see Sec 4.1.3 in The Design of Rijndael</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>4</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>u</span> <span class=o>=</span> <span class=n>xtime</span><span class=p>(</span><span class=n>xtime</span><span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span> <span class=o>^</span> <span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=mi>2</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>        <span class=n>v</span> <span class=o>=</span> <span class=n>xtime</span><span class=p>(</span><span class=n>xtime</span><span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span> <span class=o>^</span> <span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=mi>3</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>        <span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span> <span class=o>^=</span> <span class=n>u</span>
</span></span><span class=line><span class=cl>        <span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span> <span class=o>^=</span> <span class=n>v</span>
</span></span><span class=line><span class=cl>        <span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=mi>2</span><span class=p>]</span> <span class=o>^=</span> <span class=n>u</span>
</span></span><span class=line><span class=cl>        <span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=mi>3</span><span class=p>]</span> <span class=o>^=</span> <span class=n>v</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>mix_columns</span><span class=p>(</span><span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>r_con</span> <span class=o>=</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x01</span><span class=p>,</span> <span class=mh>0x02</span><span class=p>,</span> <span class=mh>0x04</span><span class=p>,</span> <span class=mh>0x08</span><span class=p>,</span> <span class=mh>0x10</span><span class=p>,</span> <span class=mh>0x20</span><span class=p>,</span> <span class=mh>0x40</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x80</span><span class=p>,</span> <span class=mh>0x1B</span><span class=p>,</span> <span class=mh>0x36</span><span class=p>,</span> <span class=mh>0x6C</span><span class=p>,</span> <span class=mh>0xD8</span><span class=p>,</span> <span class=mh>0xAB</span><span class=p>,</span> <span class=mh>0x4D</span><span class=p>,</span> <span class=mh>0x9A</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x2F</span><span class=p>,</span> <span class=mh>0x5E</span><span class=p>,</span> <span class=mh>0xBC</span><span class=p>,</span> <span class=mh>0x63</span><span class=p>,</span> <span class=mh>0xC6</span><span class=p>,</span> <span class=mh>0x97</span><span class=p>,</span> <span class=mh>0x35</span><span class=p>,</span> <span class=mh>0x6A</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xD4</span><span class=p>,</span> <span class=mh>0xB3</span><span class=p>,</span> <span class=mh>0x7D</span><span class=p>,</span> <span class=mh>0xFA</span><span class=p>,</span> <span class=mh>0xEF</span><span class=p>,</span> <span class=mh>0xC5</span><span class=p>,</span> <span class=mh>0x91</span><span class=p>,</span> <span class=mh>0x39</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>bytes2matrix</span><span class=p>(</span><span class=n>text</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Converts a 16-byte array into a 4x4 matrix.  &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>[</span><span class=nb>list</span><span class=p>(</span><span class=n>text</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span><span class=o>+</span><span class=mi>4</span><span class=p>])</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>text</span><span class=p>),</span> <span class=mi>4</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>matrix2bytes</span><span class=p>(</span><span class=n>matrix</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Converts a 4x4 matrix into a 16-byte array.  &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>bytes</span><span class=p>(</span><span class=nb>sum</span><span class=p>(</span><span class=n>matrix</span><span class=p>,</span> <span class=p>[]))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>xor_bytes</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Returns a new byte array with the elements xor&#39;ed. &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>i</span><span class=o>^</span><span class=n>j</span> <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>inc_bytes</span><span class=p>(</span><span class=n>a</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Returns a new byte array with the value increment by 1 &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>out</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>a</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>reversed</span><span class=p>(</span><span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>out</span><span class=p>))):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>out</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>==</span> <span class=mh>0xFF</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>out</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>out</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>out</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>pad</span><span class=p>(</span><span class=n>plaintext</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Pads the given plaintext with PKCS#7 padding to a multiple of 16 bytes.
</span></span></span><span class=line><span class=cl><span class=s2>    Note that if the plaintext size is a multiple of 16,
</span></span></span><span class=line><span class=cl><span class=s2>    a whole block will be added.
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>padding_len</span> <span class=o>=</span> <span class=mi>16</span> <span class=o>-</span> <span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>plaintext</span><span class=p>)</span> <span class=o>%</span> <span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>padding</span> <span class=o>=</span> <span class=nb>bytes</span><span class=p>([</span><span class=n>padding_len</span><span class=p>]</span> <span class=o>*</span> <span class=n>padding_len</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>plaintext</span> <span class=o>+</span> <span class=n>padding</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>unpad</span><span class=p>(</span><span class=n>plaintext</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Removes a PKCS#7 padding, returning the unpadded text and ensuring the
</span></span></span><span class=line><span class=cl><span class=s2>    padding was correct.
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>padding_len</span> <span class=o>=</span> <span class=n>plaintext</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>padding_len</span> <span class=o>&gt;</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=n>message</span><span class=p>,</span> <span class=n>padding</span> <span class=o>=</span> <span class=n>plaintext</span><span class=p>[:</span><span class=o>-</span><span class=n>padding_len</span><span class=p>],</span> <span class=n>plaintext</span><span class=p>[</span><span class=o>-</span><span class=n>padding_len</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>all</span><span class=p>(</span><span class=n>p</span> <span class=o>==</span> <span class=n>padding_len</span> <span class=k>for</span> <span class=n>p</span> <span class=ow>in</span> <span class=n>padding</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>message</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>split_blocks</span><span class=p>(</span><span class=n>message</span><span class=p>,</span> <span class=n>block_size</span><span class=o>=</span><span class=mi>16</span><span class=p>,</span> <span class=n>require_padding</span><span class=o>=</span><span class=kc>True</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>message</span><span class=p>)</span> <span class=o>%</span> <span class=n>block_size</span> <span class=o>==</span> <span class=mi>0</span> <span class=ow>or</span> <span class=ow>not</span> <span class=n>require_padding</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>[</span><span class=n>message</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span><span class=o>+</span><span class=mi>16</span><span class=p>]</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>message</span><span class=p>),</span> <span class=n>block_size</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>AES</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Class for AES-128 encryption with CBC mode and PKCS#7.
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    This is a raw implementation of AES, without key stretching or IV
</span></span></span><span class=line><span class=cl><span class=s2>    management. Unless you need that, please use `encrypt` and `decrypt`.
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>rounds_by_key_size</span> <span class=o>=</span> <span class=p>{</span><span class=mi>16</span><span class=p>:</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>24</span><span class=p>:</span> <span class=mi>12</span><span class=p>,</span> <span class=mi>32</span><span class=p>:</span> <span class=mi>14</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>master_key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        Initializes the object with a given key.
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>master_key</span><span class=p>)</span> <span class=ow>in</span> <span class=n>AES</span><span class=o>.</span><span class=n>rounds_by_key_size</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>n_rounds</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>rounds_by_key_size</span><span class=p>[</span><span class=nb>len</span><span class=p>(</span><span class=n>master_key</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_key_matrices</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_expand_key</span><span class=p>(</span><span class=n>master_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_expand_key</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>master_key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        Expands and returns a list of key matrices for the given master_key.
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># Initialize round keys with raw key material.</span>
</span></span><span class=line><span class=cl>        <span class=n>key_columns</span> <span class=o>=</span> <span class=n>bytes2matrix</span><span class=p>(</span><span class=n>master_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>iteration_size</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>master_key</span><span class=p>)</span> <span class=o>//</span> <span class=mi>4</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>i</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=nb>len</span><span class=p>(</span><span class=n>key_columns</span><span class=p>)</span> <span class=o>&lt;</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>n_rounds</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=mi>4</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># Copy previous word.</span>
</span></span><span class=line><span class=cl>            <span class=n>word</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>key_columns</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1># Perform schedule_core once every &#34;row&#34;.</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>key_columns</span><span class=p>)</span> <span class=o>%</span> <span class=n>iteration_size</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># Circular shift.</span>
</span></span><span class=line><span class=cl>                <span class=n>word</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>word</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=mi>0</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                <span class=c1># Map to S-BOX.</span>
</span></span><span class=line><span class=cl>                <span class=n>word</span> <span class=o>=</span> <span class=p>[</span><span class=n>s_box</span><span class=p>[</span><span class=n>b</span><span class=p>]</span> <span class=k>for</span> <span class=n>b</span> <span class=ow>in</span> <span class=n>word</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                <span class=c1># XOR with first byte of R-CON, since the others bytes of R-CON are 0.</span>
</span></span><span class=line><span class=cl>                <span class=n>word</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>^=</span> <span class=n>r_con</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                <span class=n>i</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            <span class=k>elif</span> <span class=nb>len</span><span class=p>(</span><span class=n>master_key</span><span class=p>)</span> <span class=o>==</span> <span class=mi>32</span> <span class=ow>and</span> <span class=nb>len</span><span class=p>(</span><span class=n>key_columns</span><span class=p>)</span> <span class=o>%</span> <span class=n>iteration_size</span> <span class=o>==</span> <span class=mi>4</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># Run word through S-box in the fourth iteration when using a</span>
</span></span><span class=line><span class=cl>                <span class=c1># 256-bit key.</span>
</span></span><span class=line><span class=cl>                <span class=n>word</span> <span class=o>=</span> <span class=p>[</span><span class=n>s_box</span><span class=p>[</span><span class=n>b</span><span class=p>]</span> <span class=k>for</span> <span class=n>b</span> <span class=ow>in</span> <span class=n>word</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1># XOR with equivalent word from previous iteration.</span>
</span></span><span class=line><span class=cl>            <span class=n>word</span> <span class=o>=</span> <span class=n>xor_bytes</span><span class=p>(</span><span class=n>word</span><span class=p>,</span> <span class=n>key_columns</span><span class=p>[</span><span class=o>-</span><span class=n>iteration_size</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            <span class=n>key_columns</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>word</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Group key words in 4x4 byte matrices.</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>[</span><span class=n>key_columns</span><span class=p>[</span><span class=mi>4</span><span class=o>*</span><span class=n>i</span> <span class=p>:</span> <span class=mi>4</span><span class=o>*</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>)]</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>key_columns</span><span class=p>)</span> <span class=o>//</span> <span class=mi>4</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>encrypt_block</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>plaintext</span><span class=p>,</span> <span class=n>step</span><span class=o>=</span><span class=p>[</span><span class=n>add_round_key</span><span class=p>,</span> <span class=n>sub_bytes</span><span class=p>,</span> <span class=n>shift_rows</span><span class=p>,</span> <span class=n>mix_columns</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        Encrypts a single block of 16 byte long plaintext.
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>plaintext</span><span class=p>)</span> <span class=o>==</span> <span class=mi>16</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>plain_state</span> <span class=o>=</span> <span class=n>bytes2matrix</span><span class=p>(</span><span class=n>plaintext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>step</span><span class=p>[</span><span class=mi>0</span><span class=p>](</span><span class=n>plain_state</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>_key_matrices</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>n_rounds</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>step</span><span class=p>[</span><span class=mi>1</span><span class=p>](</span><span class=n>plain_state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>step</span><span class=p>[</span><span class=mi>2</span><span class=p>](</span><span class=n>plain_state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>step</span><span class=p>[</span><span class=mi>3</span><span class=p>](</span><span class=n>plain_state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>step</span><span class=p>[</span><span class=mi>0</span><span class=p>](</span><span class=n>plain_state</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>_key_matrices</span><span class=p>[</span><span class=n>i</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>step</span><span class=p>[</span><span class=mi>1</span><span class=p>](</span><span class=n>plain_state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>step</span><span class=p>[</span><span class=mi>2</span><span class=p>](</span><span class=n>plain_state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>step</span><span class=p>[</span><span class=mi>0</span><span class=p>](</span><span class=n>plain_state</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>_key_matrices</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>matrix2bytes</span><span class=p>(</span><span class=n>plain_state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>encrypt</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>plaintext</span><span class=p>,</span> <span class=n>step</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>plaintext</span> <span class=o>=</span> <span class=n>pad</span><span class=p>(</span><span class=n>plaintext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>ciphertext</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>block</span> <span class=ow>in</span> <span class=n>split_blocks</span><span class=p>(</span><span class=n>plaintext</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>ciphertext_block</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>encrypt_block</span><span class=p>(</span><span class=n>block</span><span class=p>,</span> <span class=n>step</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>ciphertext</span> <span class=o>+=</span> <span class=n>ciphertext_block</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>ciphertext</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># chall.py</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>aes</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>dumb_step</span><span class=p>(</span><span class=n>s</span><span class=p>,</span> <span class=n>key</span> <span class=o>=</span> <span class=kc>None</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>key</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>urandom</span><span class=p>(</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=p>(</span><span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>init_step</span> <span class=o>=</span> <span class=p>[</span><span class=n>add_round_key</span><span class=p>,</span> <span class=n>sub_bytes</span><span class=p>,</span> <span class=n>shift_rows</span><span class=p>,</span> <span class=n>mix_columns</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=nb>round</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>50</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Round </span><span class=si>{</span><span class=nb>round</span> <span class=o>+</span> <span class=mi>1</span><span class=si>}</span><span class=s2>/50&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>plaintext</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=nb>input</span><span class=p>(</span><span class=s2>&#34;&gt;&gt;&gt; &#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>plaintext</span><span class=p>)</span> <span class=o>&lt;=</span> <span class=mi>16</span> <span class=o>*</span> <span class=mi>3</span><span class=p>,</span> <span class=s2>&#34;Too long!&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>step</span> <span class=o>=</span> <span class=n>init_step</span><span class=p>[:]</span>
</span></span><span class=line><span class=cl>        <span class=n>pos</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>step</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=n>pos</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>step</span><span class=o>.</span><span class=n>insert</span><span class=p>(</span><span class=n>pos</span><span class=p>,</span> <span class=n>dumb_step</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>bit</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>cipher</span><span class=o>.</span><span class=n>encrypt</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=p>[</span><span class=n>init_step</span><span class=p>,</span> <span class=n>step</span><span class=p>][</span><span class=n>bit</span><span class=p>])</span><span class=o>.</span><span class=n>hex</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>int</span><span class=p>(</span><span class=nb>input</span><span class=p>(</span><span class=s2>&#34;&gt;&gt;&gt; &#34;</span><span class=p>))</span> <span class=o>!=</span> <span class=n>bit</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Wrong!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Correct!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Here is your flag !&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=nb>open</span><span class=p>(</span><span class=s2>&#34;WannaGame_CyberKnight/choose/flag.txt&#34;</span><span class=p>,</span> <span class=s2>&#34;r&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>())</span>
</span></span></code></pre></div><blockquote><p>Bài này đơn giản là về phần mã hóa AES (<a href=https://vi.wikipedia.org/wiki/Advanced_Encryption_Standard>Advanced Encryption Standard</a>) và mình có xem lại cấu trúc của nó tại wikipedia và <a href=https://hackmd.io/@r1muru/HJmSbUld1x#Bringing-It-All-Together>đây</a> để tiếp cận.</p></blockquote><p><img src=https://hackmd.io/_uploads/rkcm02pxex.png alt=image></p><h3 id=phân-tích><a class=header-anchor href=#ph%c3%a2n-t%c3%adch></a>Phân tích:</h3><ul><li>Hàm <code>dumb_step</code> pass 1 phép biển đổi trong 4 phép cần thiết để mã hóa AES.</li><li>Server tạo 50 vòng, trong đó mỗi vòng thực thi nhiệm vụ sau:<ul><li>Nhập 1 đoạn tin có $length\le48$.</li><li>Random bỏ 1 trong 4 bước để tạo <code>step</code> mới chỉ còn 3 bước.</li><li>Random sử dụng <code>init_step</code> gồm 4 bước hay <code>step</code> để mã hóa.</li><li>In ra <code>ciphertext</code> tương ứng.</li><li>Yêu cầu nhập vào:<ul><li>0 nếu dùng <code>init_step</code> (4 bước)</li><li>1 nếu dùng <code>step</code> (3 bước)</li></ul></li></ul></li></ul><p>Bypass được 50 vòng thì ta sẽ nhận được flag.
Đề bài là vậy nên khi bắt tay vào làm và code thì mình đã giải thuật được cho 3 bước rồi nhưng còn bị kẹt lại ở phần <strong>Skip SubBytes</strong>, may sao trong lúc tìm tài liệu thì đã tìm thấy bài <a href=https://wrth.medium.com/cracking-aes-without-any-one-of-its-operations-c42cdfc0452f>này</a> và giải quyết được thử thách.</p><h3 id=ý-tưởng><a class=header-anchor href=#%c3%bd-t%c6%b0%e1%bb%9fng></a>Ý tưởng:</h3><ul><li>Chủ đích của ta là phải từ <code>plaintext</code> nhập vào và <code>ciphertext</code> tương ứng phải biết được nó đã được sử dụng bao nhiêu bước để trả về giá trị đúng trong 50 vòng.</li><li>Yêu cầu của <code>plaintext</code> là 48 bytes (tức 3 khối AES) nhưng nếu để ý kỹ thì nó được <code>padding</code> trước khi mã hóa nên nếu gửi đủ 48 bytes thì <code>plaintext</code> sẽ thêm khối thứ 4 là
<code>b'\x10' * 16</code> và đây cũng là dữ kiện quan trọng để giải bài này.</li><li>Để cho mạch suy nghĩ trôi chảy và dễ code thì ta chia nó làm 5 trường hợp chính và giải quyết như ngay sau đây:</li></ul><ol><li>Skip AddRoundKey
<img src=https://hackmd.io/_uploads/ByNj-Caele.png alt=image>
Đây là phần dễ nhất mà ta chỉ cần encrypt cái <code>plaintext</code> mà mình nhập vào với thuật aes chỉ có 3 bước còn lại vì nó không còn phụ thuộc vào key. Do đó, ta không có điều kiện gì với <code>plaintext</code> nhập vào. Sau đây là script phần này:</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>encrypt_block1</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=n>step</span><span class=o>=</span><span class=p>[</span><span class=n>sub_bytes</span><span class=p>,</span> <span class=n>shift_rows</span><span class=p>,</span> <span class=n>mix_columns</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>plaintext</span><span class=p>)</span> <span class=o>==</span> <span class=mi>16</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>plain_state</span> <span class=o>=</span> <span class=n>bytes2matrix</span><span class=p>(</span><span class=n>plaintext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>n_rounds</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>step</span><span class=p>[</span><span class=mi>0</span><span class=p>](</span><span class=n>plain_state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>step</span><span class=p>[</span><span class=mi>1</span><span class=p>](</span><span class=n>plain_state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>step</span><span class=p>[</span><span class=mi>2</span><span class=p>](</span><span class=n>plain_state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>step</span><span class=p>[</span><span class=mi>0</span><span class=p>](</span><span class=n>plain_state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>step</span><span class=p>[</span><span class=mi>1</span><span class=p>](</span><span class=n>plain_state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>matrix2bytes</span><span class=p>(</span><span class=n>plain_state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>encrypt1</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=n>step</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext</span> <span class=o>=</span> <span class=n>pad</span><span class=p>(</span><span class=n>plaintext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ciphertext</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>block</span> <span class=ow>in</span> <span class=n>split_blocks</span><span class=p>(</span><span class=n>plaintext</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>ciphertext_block</span> <span class=o>=</span> <span class=n>encrypt_block1</span><span class=p>(</span><span class=n>block</span><span class=p>,</span> <span class=n>step</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>ciphertext</span> <span class=o>+=</span> <span class=n>ciphertext_block</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>ciphertext</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=c1># Skip AddRoundKey make weakest</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decrypt1</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>step</span><span class=o>=</span><span class=p>[</span><span class=n>sub_bytes</span><span class=p>,</span> <span class=n>shift_rows</span><span class=p>,</span> <span class=n>mix_columns</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>encrypt1</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=n>step</span><span class=p>)</span> <span class=o>==</span> <span class=n>ciphertext</span><span class=p>:</span> <span class=k>return</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span>
</span></span></code></pre></div><ol start=2><li>Skip SubBytes
<img src=https://hackmd.io/_uploads/Hk9KbC6gxg.png alt=image>
Phần này đối với mình là thử thách nhất vì khi phân tích, mình thấy rằng bỏ <strong>SubBytes</strong> đi sẽ làm cho phần mã hóa với 3 bước còn lại trở thành các bước với chuyển đổi và ma trận khá phức tạp.
Như ta đã biết, nếu bỏ SubBytes đi thì các vòng của AES sẽ trở thành:</li></ol><p>Vòng 0: AddRoundKey</p><p>Vòng 1–9: ShiftRows, MixColumns, AddRoundKey</p><p>Vòng 10: ShiftRows, AddRoundKey</p><p>Để cho gọn thì ta đặt $S, M, k_i$ lần lượt là phép biển đổi ma trận bằng ShiftRows và MixColumns và AddRoundKey ở vòng thứ i. Sau đây là quá trình mã hóa <code>plaintext</code>($P$):</p><p>Vòng 0: $P + k_0$</p><p>Vòng 1: $M(S(P+k_0))+k_1$. Đơn giản hóa bằng cách tính $A =MS$.</p><p>Vòng 2-9: $...(A(A(A(P+k_0))+k_1)+k_2)+k_3+...$</p><p>Vòng 10: $S(...(A(A(A(P+k_0))+k_1)+k_2)+k_3+...)+k_{10}$</p><p>$=SA^9P+SA^8k_0+..Sk_9+k_{10}=SA^9P+K$</p><p>Ở cuối ta thấy là <code>plaintext</code> gắn với $SA^9=M^9S^{10}$ mà không phụ thuộc gì tới key.
Do đó, để tấn công thì ta có thể nghĩ rằng với cùng 1 key thì $K$ tính được ở trên sẽ như nhau tức là <code>ciphertext</code> đặt là $C$ sẽ cho ra 1 hằng số $K=C-SA^9P$.</p><p>Và để giải quyết phần này thì ta sẽ phải có 2 khối trong phần <code>plaintext</code> ngay trước mã hóa để chứng minh và tính $K$ bằng cách tìm được cả $SA^9$.
Với phần tính $SA^9$ thì không hề đơn giản và mình vẫn đang đọc và tìm hiểu qua bài <a href=https://crypto.stackexchange.com/questions/89596/linear-aes-expression-of-k-in-aesp-apk/89607#89607>này</a>. Còn thuật toán thì mình sẽ sử dụng 1 phần của implement trong <a href=https://wrth.medium.com/cracking-aes-without-any-one-of-its-operations-c42cdfc0452f>bài báo</a> cho trên.</p><p>Tiếp theo là phần 2 khối trong <code>plaintext</code> thì mình chọn khối 1 và khối 4 để sử dụng với khối 1 mình đưa vào là: <code>b'\x00' * 16</code> và khối 4 mặc định là: <code>b'\x10' * 16</code>.</p><p>Script:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Skip SubBytes</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>bytes2mat</span><span class=p>(</span><span class=n>b</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>a</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>b</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>tmp</span> <span class=o>=</span> <span class=nb>bin</span><span class=p>(</span><span class=n>i</span><span class=p>)[</span><span class=mi>2</span><span class=p>:]</span><span class=o>.</span><span class=n>zfill</span><span class=p>(</span><span class=mi>8</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=n>tmp</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>a</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>j</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>Matrix</span><span class=p>(</span><span class=n>GF</span><span class=p>(</span><span class=mi>2</span><span class=p>),</span> <span class=n>a</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>mat2bytes</span><span class=p>(</span><span class=n>m</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>a</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>128</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>a</span> <span class=o>+=</span> <span class=nb>str</span><span class=p>(</span><span class=n>m</span><span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=n>i</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>a</span> <span class=o>=</span> <span class=p>[</span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span><span class=o>+</span><span class=mi>8</span><span class=p>]</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>128</span><span class=p>,</span> <span class=mi>8</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    <span class=n>a</span> <span class=o>=</span> <span class=p>[</span><span class=nb>int</span><span class=p>(</span><span class=n>i</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>a</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>a</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decrypt2</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>I</span> <span class=o>=</span> <span class=n>identity_matrix</span><span class=p>(</span><span class=n>GF</span><span class=p>(</span><span class=mi>2</span><span class=p>),</span> <span class=mi>8</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>X</span> <span class=o>=</span> <span class=n>Matrix</span><span class=p>(</span><span class=n>GF</span><span class=p>(</span><span class=mi>2</span><span class=p>),</span> <span class=mi>8</span><span class=p>,</span> <span class=mi>8</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>7</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>X</span><span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=n>X</span><span class=p>[</span><span class=mi>3</span><span class=p>,</span> <span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=n>X</span><span class=p>[</span><span class=mi>4</span><span class=p>,</span> <span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=n>X</span><span class=p>[</span><span class=mi>6</span><span class=p>,</span> <span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=n>X</span><span class=p>[</span><span class=mi>7</span><span class=p>,</span> <span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>C</span> <span class=o>=</span> <span class=n>block_matrix</span><span class=p>([</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>X</span><span class=p>,</span> <span class=n>X</span><span class=o>+</span><span class=n>I</span><span class=p>,</span> <span class=n>I</span><span class=p>,</span> <span class=n>I</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>I</span><span class=p>,</span> <span class=n>X</span><span class=p>,</span> <span class=n>X</span><span class=o>+</span><span class=n>I</span><span class=p>,</span> <span class=n>I</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>I</span><span class=p>,</span> <span class=n>I</span><span class=p>,</span> <span class=n>X</span><span class=p>,</span> <span class=n>X</span><span class=o>+</span><span class=n>I</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>X</span><span class=o>+</span><span class=n>I</span><span class=p>,</span> <span class=n>I</span><span class=p>,</span> <span class=n>I</span><span class=p>,</span> <span class=n>X</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>zeros</span> <span class=o>=</span> <span class=n>Matrix</span><span class=p>(</span><span class=n>GF</span><span class=p>(</span><span class=mi>2</span><span class=p>),</span> <span class=mi>8</span><span class=p>,</span> <span class=mi>8</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>zeros2</span> <span class=o>=</span> <span class=n>Matrix</span><span class=p>(</span><span class=n>GF</span><span class=p>(</span><span class=mi>2</span><span class=p>),</span> <span class=mi>32</span><span class=p>,</span> <span class=mi>32</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>o0</span> <span class=o>=</span> <span class=n>block_matrix</span><span class=p>([</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>I</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>o1</span> <span class=o>=</span> <span class=n>block_matrix</span><span class=p>([</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>I</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>o2</span> <span class=o>=</span> <span class=n>block_matrix</span><span class=p>([</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>I</span><span class=p>,</span> <span class=n>zeros</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>o3</span> <span class=o>=</span> <span class=n>block_matrix</span><span class=p>([</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>I</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>S</span> <span class=o>=</span> <span class=n>block_matrix</span><span class=p>([</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>o0</span><span class=p>,</span> <span class=n>o1</span><span class=p>,</span> <span class=n>o2</span><span class=p>,</span> <span class=n>o3</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>o3</span><span class=p>,</span> <span class=n>o0</span><span class=p>,</span> <span class=n>o1</span><span class=p>,</span> <span class=n>o2</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>o2</span><span class=p>,</span> <span class=n>o3</span><span class=p>,</span> <span class=n>o0</span><span class=p>,</span> <span class=n>o1</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>o1</span><span class=p>,</span> <span class=n>o2</span><span class=p>,</span> <span class=n>o3</span><span class=p>,</span> <span class=n>o0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>M</span> <span class=o>=</span> <span class=n>block_matrix</span><span class=p>([</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>C</span><span class=p>,</span> <span class=n>zeros2</span><span class=p>,</span> <span class=n>zeros2</span><span class=p>,</span> <span class=n>zeros2</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros2</span><span class=p>,</span> <span class=n>C</span><span class=p>,</span> <span class=n>zeros2</span><span class=p>,</span> <span class=n>zeros2</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros2</span><span class=p>,</span> <span class=n>zeros2</span><span class=p>,</span> <span class=n>C</span><span class=p>,</span> <span class=n>zeros2</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros2</span><span class=p>,</span> <span class=n>zeros2</span><span class=p>,</span> <span class=n>zeros2</span><span class=p>,</span> <span class=n>C</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>R</span> <span class=o>=</span> <span class=n>M</span><span class=o>*</span><span class=n>S</span>
</span></span><span class=line><span class=cl>    <span class=n>A</span> <span class=o>=</span> <span class=n>S</span><span class=o>*</span><span class=p>(</span><span class=n>R</span><span class=o>**</span><span class=mi>9</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>pt1</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span> <span class=o>*</span> <span class=mi>16</span>
</span></span><span class=line><span class=cl>    <span class=n>ct1</span> <span class=o>=</span> <span class=n>ciphertext</span><span class=p>[:</span><span class=mi>16</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>pt2</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x10</span><span class=s1>&#39;</span> <span class=o>*</span> <span class=mi>16</span>
</span></span><span class=line><span class=cl>    <span class=n>ct2</span> <span class=o>=</span> <span class=n>ciphertext</span><span class=p>[</span><span class=mi>48</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>    <span class=n>pt2</span> <span class=o>=</span> <span class=n>bytes2mat</span><span class=p>(</span><span class=n>pt2</span><span class=p>)</span><span class=o>.</span><span class=n>transpose</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>ct2</span> <span class=o>=</span> <span class=n>bytes2mat</span><span class=p>(</span><span class=n>ct2</span><span class=p>)</span><span class=o>.</span><span class=n>transpose</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>K</span> <span class=o>=</span> <span class=n>ct2</span> <span class=o>-</span> <span class=n>A</span><span class=o>*</span><span class=n>pt2</span>
</span></span><span class=line><span class=cl>    <span class=n>recv</span> <span class=o>=</span> <span class=n>mat2bytes</span><span class=p>((</span><span class=n>A</span><span class=o>.</span><span class=n>inverse</span><span class=p>()</span> <span class=o>*</span> <span class=p>(</span><span class=n>bytes2mat</span><span class=p>(</span><span class=n>ct1</span><span class=p>)</span><span class=o>.</span><span class=n>transpose</span><span class=p>()</span> <span class=o>-</span> <span class=n>K</span><span class=p>))</span><span class=o>.</span><span class=n>transpose</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>recv</span> <span class=o>==</span> <span class=n>pt1</span><span class=p>:</span> <span class=k>return</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span>
</span></span></code></pre></div><ol start=3><li>Skip ShiftRows
<img src=https://hackmd.io/_uploads/BywObRpglx.png alt=image>
Khi bỏ phần này thì rõ ràng các cột sẽ luôn giữ nguyên vị trí vì khi thực hiện MixColumns xáo cột chỉ làm thay đổi được vị trí của nó chứ không phải những thành phần bên trong đó. Vì vậy ta sẽ chia 1 khối trong <code>plaintext</code> ra thành 4 block và so sánh, nghĩa là hai cặp <code>plaintext - ciphertext</code> ứng với 1 cặp block tương ứng giống nhau ở mỗi phần.
Ở đây, mình sử dụng khối 2 và khối 4 với dữ liệu là: <code>b'\x10' * 4 + b'\x30' * 12</code> và <code>b'\x10' * 16</code> rồi so sánh block đầu của <code>ciphertext</code>.
Script:</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Skip ShiftRows</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decrypt3</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>ciphertext</span><span class=p>[</span><span class=mi>16</span><span class=p>:</span><span class=mi>20</span><span class=p>]</span> <span class=o>==</span> <span class=n>ciphertext</span><span class=p>[</span><span class=mi>48</span><span class=p>:</span><span class=mi>52</span><span class=p>]:</span> <span class=k>return</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=c1># block2: b&#39;\x10&#39; * 4 + b&#39;\x30&#39; * 12</span>
</span></span><span class=line><span class=cl><span class=c1># block4: b&#39;\x10&#39; * 16</span>
</span></span></code></pre></div><ol start=4><li>Skip MixColumns
Ở bước này, nó không những chuyển vị các cột mà còn nhân với 1 hệ số cố định $c(x)$
<img src=https://hackmd.io/_uploads/rkXPbAaele.png alt=image>
Do đó, khi ta bỏ bước MixColumns thì 1 khối 16 byte sẽ được mã hóa theo 16 khối khác nhau ứng với từng byte và không phụ thuộc đôi một vào nhau.
Điều này nghĩa là tồn tại 1 song ánh ứng với 1 byte của <code>plaintext</code> với 1 byte của <code>ciphertext</code> và mình bypass phần này bằng cách xét chỉ 1 byte khác nhau của 2 khối ở <code>plaintext</code> và đếm số lượng khác nhau của chúng ở <code>ciphertext</code>
Ở bài này, mình sử dụng khối 3 và khối 4 với dữ liệu là: <code>b'\x00' + b'\x10' * 15</code> và <code>b'\x10' * 16</code> rồi so sánh count của chúng.
Script:</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Skip MixColumns</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decrypt4</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>ct1</span> <span class=o>=</span> <span class=n>ciphertext</span><span class=p>[</span><span class=mi>32</span><span class=p>:</span><span class=mi>48</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>ct2</span> <span class=o>=</span> <span class=n>ciphertext</span><span class=p>[</span><span class=mi>48</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>    <span class=n>diff_count</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span><span class=n>c1</span> <span class=o>!=</span> <span class=n>c2</span> <span class=k>for</span> <span class=n>c1</span><span class=p>,</span> <span class=n>c2</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span><span class=n>ct1</span><span class=p>,</span> <span class=n>ct2</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>diff_count</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span> <span class=k>return</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=c1># block3: b&#39;\x00&#39; + b&#39;\x10&#39; * 15</span>
</span></span><span class=line><span class=cl><span class=c1># block4: b&#39;\x10&#39; * 16</span>
</span></span></code></pre></div><p>Sau đây là script tổng hợp cả 4 phần và cũng là solution mà mình viết ra được cho chall:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># solution.py</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sage.all</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>aes</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>encrypt_block1</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=n>step</span><span class=o>=</span><span class=p>[</span><span class=n>sub_bytes</span><span class=p>,</span> <span class=n>shift_rows</span><span class=p>,</span> <span class=n>mix_columns</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>plaintext</span><span class=p>)</span> <span class=o>==</span> <span class=mi>16</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>plain_state</span> <span class=o>=</span> <span class=n>bytes2matrix</span><span class=p>(</span><span class=n>plaintext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>10</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>step</span><span class=p>[</span><span class=mi>0</span><span class=p>](</span><span class=n>plain_state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>step</span><span class=p>[</span><span class=mi>1</span><span class=p>](</span><span class=n>plain_state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>step</span><span class=p>[</span><span class=mi>2</span><span class=p>](</span><span class=n>plain_state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>step</span><span class=p>[</span><span class=mi>0</span><span class=p>](</span><span class=n>plain_state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>step</span><span class=p>[</span><span class=mi>1</span><span class=p>](</span><span class=n>plain_state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>matrix2bytes</span><span class=p>(</span><span class=n>plain_state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>encrypt1</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=n>step</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext</span> <span class=o>=</span> <span class=n>pad</span><span class=p>(</span><span class=n>plaintext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ciphertext</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>block</span> <span class=ow>in</span> <span class=n>split_blocks</span><span class=p>(</span><span class=n>plaintext</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>ciphertext_block</span> <span class=o>=</span> <span class=n>encrypt_block1</span><span class=p>(</span><span class=n>block</span><span class=p>,</span> <span class=n>step</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>ciphertext</span> <span class=o>+=</span> <span class=n>ciphertext_block</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>ciphertext</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=c1># Skip AddRoundKey make weakest</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decrypt1</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>step</span><span class=o>=</span><span class=p>[</span><span class=n>sub_bytes</span><span class=p>,</span> <span class=n>shift_rows</span><span class=p>,</span> <span class=n>mix_columns</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>encrypt1</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=n>step</span><span class=p>)</span> <span class=o>==</span> <span class=n>ciphertext</span><span class=p>:</span> <span class=k>return</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Skip SubBytes</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>bytes2mat</span><span class=p>(</span><span class=n>b</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>a</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>b</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>tmp</span> <span class=o>=</span> <span class=nb>bin</span><span class=p>(</span><span class=n>i</span><span class=p>)[</span><span class=mi>2</span><span class=p>:]</span><span class=o>.</span><span class=n>zfill</span><span class=p>(</span><span class=mi>8</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=n>tmp</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>a</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>j</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>Matrix</span><span class=p>(</span><span class=n>GF</span><span class=p>(</span><span class=mi>2</span><span class=p>),</span> <span class=n>a</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>mat2bytes</span><span class=p>(</span><span class=n>m</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>a</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>128</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>a</span> <span class=o>+=</span> <span class=nb>str</span><span class=p>(</span><span class=n>m</span><span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=n>i</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>a</span> <span class=o>=</span> <span class=p>[</span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span><span class=o>+</span><span class=mi>8</span><span class=p>]</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>128</span><span class=p>,</span> <span class=mi>8</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    <span class=n>a</span> <span class=o>=</span> <span class=p>[</span><span class=nb>int</span><span class=p>(</span><span class=n>i</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>a</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>a</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decrypt2</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>I</span> <span class=o>=</span> <span class=n>identity_matrix</span><span class=p>(</span><span class=n>GF</span><span class=p>(</span><span class=mi>2</span><span class=p>),</span> <span class=mi>8</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>X</span> <span class=o>=</span> <span class=n>Matrix</span><span class=p>(</span><span class=n>GF</span><span class=p>(</span><span class=mi>2</span><span class=p>),</span> <span class=mi>8</span><span class=p>,</span> <span class=mi>8</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>7</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>X</span><span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=n>X</span><span class=p>[</span><span class=mi>3</span><span class=p>,</span> <span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=n>X</span><span class=p>[</span><span class=mi>4</span><span class=p>,</span> <span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=n>X</span><span class=p>[</span><span class=mi>6</span><span class=p>,</span> <span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=n>X</span><span class=p>[</span><span class=mi>7</span><span class=p>,</span> <span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>C</span> <span class=o>=</span> <span class=n>block_matrix</span><span class=p>([</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>X</span><span class=p>,</span> <span class=n>X</span><span class=o>+</span><span class=n>I</span><span class=p>,</span> <span class=n>I</span><span class=p>,</span> <span class=n>I</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>I</span><span class=p>,</span> <span class=n>X</span><span class=p>,</span> <span class=n>X</span><span class=o>+</span><span class=n>I</span><span class=p>,</span> <span class=n>I</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>I</span><span class=p>,</span> <span class=n>I</span><span class=p>,</span> <span class=n>X</span><span class=p>,</span> <span class=n>X</span><span class=o>+</span><span class=n>I</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>X</span><span class=o>+</span><span class=n>I</span><span class=p>,</span> <span class=n>I</span><span class=p>,</span> <span class=n>I</span><span class=p>,</span> <span class=n>X</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>zeros</span> <span class=o>=</span> <span class=n>Matrix</span><span class=p>(</span><span class=n>GF</span><span class=p>(</span><span class=mi>2</span><span class=p>),</span> <span class=mi>8</span><span class=p>,</span> <span class=mi>8</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>zeros2</span> <span class=o>=</span> <span class=n>Matrix</span><span class=p>(</span><span class=n>GF</span><span class=p>(</span><span class=mi>2</span><span class=p>),</span> <span class=mi>32</span><span class=p>,</span> <span class=mi>32</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>o0</span> <span class=o>=</span> <span class=n>block_matrix</span><span class=p>([</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>I</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>o1</span> <span class=o>=</span> <span class=n>block_matrix</span><span class=p>([</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>I</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>o2</span> <span class=o>=</span> <span class=n>block_matrix</span><span class=p>([</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>I</span><span class=p>,</span> <span class=n>zeros</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>o3</span> <span class=o>=</span> <span class=n>block_matrix</span><span class=p>([</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>zeros</span><span class=p>,</span> <span class=n>I</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>S</span> <span class=o>=</span> <span class=n>block_matrix</span><span class=p>([</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>o0</span><span class=p>,</span> <span class=n>o1</span><span class=p>,</span> <span class=n>o2</span><span class=p>,</span> <span class=n>o3</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>o3</span><span class=p>,</span> <span class=n>o0</span><span class=p>,</span> <span class=n>o1</span><span class=p>,</span> <span class=n>o2</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>o2</span><span class=p>,</span> <span class=n>o3</span><span class=p>,</span> <span class=n>o0</span><span class=p>,</span> <span class=n>o1</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>o1</span><span class=p>,</span> <span class=n>o2</span><span class=p>,</span> <span class=n>o3</span><span class=p>,</span> <span class=n>o0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>M</span> <span class=o>=</span> <span class=n>block_matrix</span><span class=p>([</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>C</span><span class=p>,</span> <span class=n>zeros2</span><span class=p>,</span> <span class=n>zeros2</span><span class=p>,</span> <span class=n>zeros2</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros2</span><span class=p>,</span> <span class=n>C</span><span class=p>,</span> <span class=n>zeros2</span><span class=p>,</span> <span class=n>zeros2</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros2</span><span class=p>,</span> <span class=n>zeros2</span><span class=p>,</span> <span class=n>C</span><span class=p>,</span> <span class=n>zeros2</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>zeros2</span><span class=p>,</span> <span class=n>zeros2</span><span class=p>,</span> <span class=n>zeros2</span><span class=p>,</span> <span class=n>C</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>R</span> <span class=o>=</span> <span class=n>M</span><span class=o>*</span><span class=n>S</span>
</span></span><span class=line><span class=cl>    <span class=n>A</span> <span class=o>=</span> <span class=n>S</span><span class=o>*</span><span class=p>(</span><span class=n>R</span><span class=o>**</span><span class=mi>9</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>pt1</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span> <span class=o>*</span> <span class=mi>16</span>
</span></span><span class=line><span class=cl>    <span class=n>ct1</span> <span class=o>=</span> <span class=n>ciphertext</span><span class=p>[:</span><span class=mi>16</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>pt2</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x10</span><span class=s1>&#39;</span> <span class=o>*</span> <span class=mi>16</span>
</span></span><span class=line><span class=cl>    <span class=n>ct2</span> <span class=o>=</span> <span class=n>ciphertext</span><span class=p>[</span><span class=mi>48</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>    <span class=n>pt2</span> <span class=o>=</span> <span class=n>bytes2mat</span><span class=p>(</span><span class=n>pt2</span><span class=p>)</span><span class=o>.</span><span class=n>transpose</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>ct2</span> <span class=o>=</span> <span class=n>bytes2mat</span><span class=p>(</span><span class=n>ct2</span><span class=p>)</span><span class=o>.</span><span class=n>transpose</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>K</span> <span class=o>=</span> <span class=n>ct2</span> <span class=o>-</span> <span class=n>A</span><span class=o>*</span><span class=n>pt2</span>
</span></span><span class=line><span class=cl>    <span class=n>recv</span> <span class=o>=</span> <span class=n>mat2bytes</span><span class=p>((</span><span class=n>A</span><span class=o>.</span><span class=n>inverse</span><span class=p>()</span> <span class=o>*</span> <span class=p>(</span><span class=n>bytes2mat</span><span class=p>(</span><span class=n>ct1</span><span class=p>)</span><span class=o>.</span><span class=n>transpose</span><span class=p>()</span> <span class=o>-</span> <span class=n>K</span><span class=p>))</span><span class=o>.</span><span class=n>transpose</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>recv</span> <span class=o>==</span> <span class=n>pt1</span><span class=p>:</span> <span class=k>return</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Skip ShiftRows</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decrypt3</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>ciphertext</span><span class=p>[</span><span class=mi>16</span><span class=p>:</span><span class=mi>20</span><span class=p>]</span> <span class=o>==</span> <span class=n>ciphertext</span><span class=p>[</span><span class=mi>48</span><span class=p>:</span><span class=mi>52</span><span class=p>]:</span> <span class=k>return</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=c1># block2: b&#39;\x10&#39; * 4 + b&#39;\x30&#39; * 12</span>
</span></span><span class=line><span class=cl><span class=c1># block4: b&#39;\x10&#39; * 16</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Skip MixColumns</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decrypt4</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>ct1</span> <span class=o>=</span> <span class=n>ciphertext</span><span class=p>[</span><span class=mi>32</span><span class=p>:</span><span class=mi>48</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>ct2</span> <span class=o>=</span> <span class=n>ciphertext</span><span class=p>[</span><span class=mi>48</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>    <span class=n>diff_count</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span><span class=n>c1</span> <span class=o>!=</span> <span class=n>c2</span> <span class=k>for</span> <span class=n>c1</span><span class=p>,</span> <span class=n>c2</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span><span class=n>ct1</span><span class=p>,</span> <span class=n>ct2</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>diff_count</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span> <span class=k>return</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=c1># block3: b&#39;\x00&#39; + b&#39;\x10&#39; * 15</span>
</span></span><span class=line><span class=cl><span class=c1># block4: b&#39;\x10&#39; * 16</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decrypt</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>type1</span> <span class=o>=</span> <span class=n>decrypt1</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>type2</span> <span class=o>=</span> <span class=n>decrypt2</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>type3</span> <span class=o>=</span> <span class=n>decrypt3</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>type4</span> <span class=o>=</span> <span class=n>decrypt4</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>type1</span> <span class=o>|</span> <span class=n>type2</span> <span class=o>|</span> <span class=n>type3</span> <span class=o>|</span> <span class=n>type4</span> <span class=p>:</span> <span class=k>return</span> <span class=n>type1</span><span class=p>,</span> <span class=n>type2</span><span class=p>,</span> <span class=n>type3</span><span class=p>,</span> <span class=n>type4</span><span class=p>,</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>io</span> <span class=o>=</span> <span class=n>process</span><span class=p>([</span><span class=s2>&#34;python3&#34;</span><span class=p>,</span> <span class=s2>&#34;WannaGame_CyberKnight/choose/chall.py&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span> <span class=o>*</span> <span class=mi>16</span> <span class=o>+</span> <span class=p>(</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x10</span><span class=s1>&#39;</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x30</span><span class=s1>&#39;</span> <span class=o>*</span> <span class=mi>12</span><span class=p>)</span> <span class=o>+</span> <span class=p>(</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x10</span><span class=s1>&#39;</span> <span class=o>*</span> <span class=mi>15</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>50</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>recvline</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;&gt;&gt;&gt; &#34;</span><span class=p>,</span> <span class=n>data</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=n>ciphertext</span> <span class=o>=</span> <span class=n>io</span><span class=o>.</span><span class=n>recvline</span><span class=p>()</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>ct</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>type1</span><span class=p>,</span> <span class=n>type2</span><span class=p>,</span> <span class=n>type3</span><span class=p>,</span> <span class=n>type4</span><span class=p>,</span> <span class=n>bol</span> <span class=o>=</span> <span class=n>decrypt</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>ct</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>bol</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span> <span class=nb>print</span><span class=p>(</span><span class=n>type1</span><span class=p>,</span> <span class=n>type2</span><span class=p>,</span> <span class=n>type3</span><span class=p>,</span> <span class=n>type4</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;&gt;&gt;&gt; &#34;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>bol</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>recvline</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>io</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span></code></pre></div><pre><code>Flag: W1{aAESEEESaEsaAEaSesEEEsAaseseesaSSEaaASeAAESEESSSaASeAsSSAAAAeAsE_baCsDCbtqU}
</code></pre><h2 id=heartbreak><a class=header-anchor href=#heartbreak></a>heartbreak</h2><p><img src=https://hackmd.io/_uploads/HkKwhbQbll.png alt=image></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># chall.py</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.number</span> <span class=kn>import</span> <span class=n>getPrime</span><span class=p>,</span> <span class=n>bytes_to_long</span>
</span></span><span class=line><span class=cl><span class=n>FLAG</span> <span class=o>=</span> <span class=s2>&#34;W1{???}&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>FLAG_PART1</span><span class=p>,</span> <span class=n>FLAG_PART2</span> <span class=o>=</span> <span class=n>FLAG</span><span class=p>[:</span><span class=nb>len</span><span class=p>(</span><span class=n>FLAG</span><span class=p>)</span><span class=o>//</span><span class=mi>2</span><span class=p>],</span> <span class=n>FLAG</span><span class=p>[</span><span class=nb>len</span><span class=p>(</span><span class=n>FLAG</span><span class=p>)</span><span class=o>//</span><span class=mi>2</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>f</span> <span class=o>=</span>  <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;output.txt&#34;</span><span class=p>,</span> <span class=s2>&#34;w&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>part1</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span> <span class=o>=</span> <span class=n>getPrime</span><span class=p>(</span><span class=mi>2048</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>q</span> <span class=o>=</span> <span class=n>getPrime</span><span class=p>(</span><span class=mi>2048</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>e</span> <span class=o>=</span> <span class=mh>0x10001</span>
</span></span><span class=line><span class=cl>    <span class=n>n</span> <span class=o>=</span> <span class=n>p</span> <span class=o>*</span> <span class=n>q</span>
</span></span><span class=line><span class=cl>    <span class=n>d</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=n>e</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=p>(</span><span class=n>p</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=p>(</span><span class=n>q</span><span class=o>-</span><span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>m</span> <span class=o>=</span> <span class=n>bytes_to_long</span><span class=p>(</span><span class=n>FLAG_PART1</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>c</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=n>m</span><span class=p>,</span> <span class=n>e</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=s2>&#34;ct = &#34;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>c</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>hints</span> <span class=o>=</span> <span class=p>[</span><span class=n>p</span><span class=p>,</span> <span class=n>q</span><span class=p>,</span> <span class=n>e</span><span class=p>,</span> <span class=n>n</span><span class=p>,</span> <span class=n>d</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>hints</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>        <span class=n>hints</span><span class=p>[</span><span class=n>_</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>hints</span><span class=p>[</span><span class=n>_</span><span class=p>]</span> <span class=o>*</span> <span class=n>getPrime</span><span class=p>(</span><span class=mi>1024</span><span class=p>))</span> <span class=o>%</span> <span class=n>n</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>hints</span><span class=p>[</span><span class=n>_</span><span class=p>]</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span> <span class=n>hints</span><span class=p>[</span><span class=n>_</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>hints</span><span class=p>[</span><span class=n>_</span><span class=p>]</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>%</span> <span class=n>n</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>Hints = &#34;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>hints</span><span class=p>)</span> <span class=o>+</span> <span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>part2</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>e</span> <span class=o>=</span> <span class=n>getPrime</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span> <span class=o>=</span> <span class=n>getPrime</span><span class=p>(</span><span class=mi>256</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>q</span> <span class=o>=</span> <span class=n>getPrime</span><span class=p>(</span><span class=mi>256</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>n</span> <span class=o>=</span> <span class=n>p</span> <span class=o>*</span> <span class=n>q</span>
</span></span><span class=line><span class=cl>    <span class=c1># print(e)</span>
</span></span><span class=line><span class=cl>    <span class=n>m1</span> <span class=o>=</span> <span class=n>bytes_to_long</span><span class=p>(</span><span class=n>FLAG_PART2</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=n>m2</span> <span class=o>=</span> <span class=n>m1</span> <span class=o>&gt;&gt;</span> <span class=mi>8</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>c1</span><span class=p>,</span> <span class=n>c2</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=n>m1</span><span class=p>,</span> <span class=n>e</span><span class=p>,</span> <span class=n>n</span><span class=p>),</span> <span class=nb>pow</span><span class=p>(</span><span class=n>m2</span><span class=p>,</span> <span class=n>e</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;n = </span><span class=si>{</span><span class=n>n</span><span class=si>}</span><span class=se>\n</span><span class=s2>c1 = </span><span class=si>{</span><span class=n>c1</span><span class=si>}</span><span class=se>\n</span><span class=s2>c2 = </span><span class=si>{</span><span class=n>c2</span><span class=si>}</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>part1</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>part2</span><span class=p>()</span>
</span></span></code></pre></div><p>Flag của thử thách được chia làm 2 và mã hóa bằng 2 phần khác nhau.</p><h3 id=part-1><a class=header-anchor href=#part-1></a>Part 1:</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>part1</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span> <span class=o>=</span> <span class=n>getPrime</span><span class=p>(</span><span class=mi>2048</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>q</span> <span class=o>=</span> <span class=n>getPrime</span><span class=p>(</span><span class=mi>2048</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>e</span> <span class=o>=</span> <span class=mh>0x10001</span>
</span></span><span class=line><span class=cl>    <span class=n>n</span> <span class=o>=</span> <span class=n>p</span> <span class=o>*</span> <span class=n>q</span>
</span></span><span class=line><span class=cl>    <span class=n>d</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=n>e</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=p>(</span><span class=n>p</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=p>(</span><span class=n>q</span><span class=o>-</span><span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>m</span> <span class=o>=</span> <span class=n>bytes_to_long</span><span class=p>(</span><span class=n>FLAG_PART1</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>c</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=n>m</span><span class=p>,</span> <span class=n>e</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=s2>&#34;ct = &#34;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>c</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>hints</span> <span class=o>=</span> <span class=p>[</span><span class=n>p</span><span class=p>,</span> <span class=n>q</span><span class=p>,</span> <span class=n>e</span><span class=p>,</span> <span class=n>n</span><span class=p>,</span> <span class=n>d</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>hints</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>        <span class=n>hints</span><span class=p>[</span><span class=n>_</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>hints</span><span class=p>[</span><span class=n>_</span><span class=p>]</span> <span class=o>*</span> <span class=n>getPrime</span><span class=p>(</span><span class=mi>1024</span><span class=p>))</span> <span class=o>%</span> <span class=n>n</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>hints</span><span class=p>[</span><span class=n>_</span><span class=p>]</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span> <span class=n>hints</span><span class=p>[</span><span class=n>_</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>hints</span><span class=p>[</span><span class=n>_</span><span class=p>]</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>%</span> <span class=n>n</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>Hints = &#34;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>hints</span><span class=p>)</span> <span class=o>+</span> <span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></div><p>Bộ khóa RSA được gửi ra sau khi được nhân với 1 số nguyên tố 1024 bit ngẫu nhiên.</p><p>Chú ý điều kiện: <code>if hints[_] == 0: hints[_] = (hints[_] - 1) % n</code></p><p>=> Từ đây, ta có thể tính được ngay $n = hint(n) + 1$</p><p>Thêm nữa, ta có hệ phương trình:</p>$$
\begin{cases}
p = getPrime(2048) \\
q = getPrime(2048) \\
n = p * q \\
hint(p) = p * getPrime(1024)
\end{cases}
$$<p>Tức là $n$ có 4096 bit, còn <code>hint(p)</code> chỉ có 3072 bit và vì nó bé hơn $n$ nên khi lấy đồng dư thì nó sẽ không thay đổi.
Khi đó, ta hoàn toàn có thể lấy được $p$ bằng cách lấy GCD của <code>(n, hint(p))</code></p><p>Cuối cùng, ta khôi phục dữ liệu cần thiết của bộ khóa và giải mã được part 1.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>Part1</span><span class=p>():</span>
</span></span><span class=line><span class=cl>   <span class=n>e</span> <span class=o>=</span> <span class=mh>0x10001</span>
</span></span><span class=line><span class=cl>   <span class=n>ct</span> <span class=o>=</span> <span class=mi>239991743627005761506047553716973180857493049128968395824678613535924041735819278721655197652704368009118731671080782572692443257002266295841054097811995343407149181564647568019524547331554506022380795516159222363510661688595308307174873885160951837722610012918052195448795081291878933355634383798002056753336540546915811592763747343189324926404600658482137848658910189331650916354541907427173491308413908173314104508974384232290785538938623142120477030045742266779693627293755590884412082209151425384896460777577066084111556036719259982254175935197376972307183776259868229411302259648873045160120795060467866459055693698198316577983136619062944244317116994863470942099523485902299419458583301056211340627830237050622364646501838811516544340499168319955128200158195905283972429746772105746244910156671549456233908152186037286726530314472293814226978595268877619521165090870514287104577960355240428728213124348138646047728851553209042359051265045752603864312856768918350064549850618348693037041311112677351368226231458377933846664981185928405481697006968220556167073996713389716367133156065980195285148700027809062253416860922839857907535460170132744912543758918516134641462581544039400881675553681819294266618981791250077585566821053</span>
</span></span><span class=line><span class=cl>   <span class=n>Hints</span> <span class=o>=</span> <span class=p>[</span><span class=mi>1659380349228980310793195740551091998951133377142727433181233112954301485314646349955561783455759149036476737520702967988760310760312391176774501840210477308343796277178701715703164651184747756453236376960884981254635386807663657355175214655034193946682205904113897156938926175413312324159809831274187894029251371896829385517428693915588566248998565348483747234270329027561433356156355227738138379418717200316600111392671357267757409316691191187929104999221832963378673907868493499459459256894553552195468110517716115678897171373484791903085022119845347228569870830569321957438966030560930098761455953418479618027428739560761186901956751224602703471828674970337530768801203531827467185690264637238603523292728974955840936711823826949100349569805942227432262275344597592991937770320032450419910426614638156263968483514069904464463402987714698220412063100772910040673056263954301063853666792319306234733964442731206579494701823</span><span class=p>,</span> <span class=mi>2473062479389297534384652365580702456631745761133091301459488546735676124432184165907268360691972078275036508838070797476235444908532100862886958054816201240359777405719375503276188588243722655521225159899315126844306119104997283731460041142142861614319514182297180409656236066011186834375282437648078334082114411988739789392926471318552017202390239258487258487037639778148532362214152519137264282830808294108610004403460587358629486534247288993860831438267841520573973916758902637404855712721811250301202405252158590233975917681798839166192235032424495289048875626437256513981936177292903742966118351026329401662519672777610159422234703124064225710846129876359778079390437505753932101501472252131924073957349012610362952003934494293369977045255000415066563914471132856401071867358687200638320541179048296074882945411664474157308113874183763200469775985802906031999934356545932354932945475129644344782759659758587119586377699</span><span class=p>,</span> <span class=mi>10811389778781749507848369001995006527965136627134898173336798777178617924322548317218123003648199959431162146218350234488676047952720517043381973357960494027353001493321216082118308994614655309535481054291078777020047697030175144901965025751169815034274454689657181813765988172412194436669592236745329922983348687</span><span class=p>,</span> <span class=mi>302270795345262652787049603034608860428203534578338699389744017410286806560707153186173595970011317749221953776227374491075684575774328458397778789729965544452010822737225229627108698874874960910965283322537095645241316756015118860396297708799504427117968454341778975073542738740964812664233075630257595196115893498655587491091126391722042679460013562303363850840912825755508680428829444388842951146482726568654418889598972824414109879370032604627990857015975495697530048397401132619555923308480516678981072029040306410523264480829688927798146165580384683689546853438820269495274502502143436234210825345362323042888891473423488116618918996618482754420372481893339222050268599796400452566639228520072261554594477336671016198833620427171498256007475831231524217372147783123617237105584613811522861590112133798309937116024168109605161059186745904038968516182034441583819409524470833832445513001764653452246905494902592731421744692331296978104865554556383417129664683066891729999411036376957753554228948901872115141778394712481069999501808719302346670855531871069366050528261442730651167165455031776639195754458920584910014448480393554851269958179362536781346169282601003523441289868134223507188615919092337658908484201829621953970243126</span><span class=p>,</span> <span class=mi>292884935929549246643624576832991010496540593142708150947518571090956754050658797955786741707549303442499542376031718493862827439931968289137063776270385766876597819025272388601563339731026897291119786098658019861515084557432779618732711248671531045529170282246847559014298960824095511448557742476351035447816620523706582563446012744989424367197536652910056457067991830630881476241325631891896455745762634189112349619740103725259844111996043190764424736601828139403024375351372351763169837210283497390177391509068689722596094161210899552103572279045474893618035695053640281885367691987326728488743356438444158731410968935525788220429173044772188634219137052045984284351149340419125628533953328666109489959225736888258255952666488686965689900369280599239198825803111830614815595803322570878359992207842211026468967074229662081167123002174445268278747577520774432781623852071789431202030569577689851124794177654088403580945598530502231516822280930459410373890257129917535480957183190120541342731664708767982764672591340622307503858396934095635519503588136203556304925670734741505400274178108097309035870578129722954864083937813328351751442713938490297629659866083082398939022316220801556516785394083566880368038684968532814902807429836</span><span class=p>]</span>
</span></span><span class=line><span class=cl>   <span class=n>xp</span><span class=p>,</span> <span class=n>xn</span> <span class=o>=</span> <span class=n>Hints</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>Hints</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span>
</span></span><span class=line><span class=cl>   <span class=n>n</span> <span class=o>=</span> <span class=n>xn</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>   <span class=n>p</span> <span class=o>=</span> <span class=n>GCD</span><span class=p>(</span><span class=n>n</span><span class=p>,</span> <span class=n>xp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=n>q</span> <span class=o>=</span> <span class=n>n</span> <span class=o>//</span> <span class=n>p</span>
</span></span><span class=line><span class=cl>   <span class=n>PhiN</span> <span class=o>=</span> <span class=p>(</span><span class=n>p</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=p>(</span><span class=n>q</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=n>d</span> <span class=o>=</span> <span class=n>inverse_mod</span><span class=p>(</span><span class=n>e</span><span class=p>,</span> <span class=n>PhiN</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=n>pt</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=n>ct</span><span class=p>,</span> <span class=n>d</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=k>return</span> <span class=n>long_to_bytes</span><span class=p>(</span><span class=n>pt</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=part-2><a class=header-anchor href=#part-2></a>Part 2:</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>part2</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>e</span> <span class=o>=</span> <span class=n>getPrime</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span> <span class=o>=</span> <span class=n>getPrime</span><span class=p>(</span><span class=mi>256</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>q</span> <span class=o>=</span> <span class=n>getPrime</span><span class=p>(</span><span class=mi>256</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>n</span> <span class=o>=</span> <span class=n>p</span> <span class=o>*</span> <span class=n>q</span>
</span></span><span class=line><span class=cl>    <span class=c1># print(e)</span>
</span></span><span class=line><span class=cl>    <span class=n>m1</span> <span class=o>=</span> <span class=n>bytes_to_long</span><span class=p>(</span><span class=n>FLAG_PART2</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=n>m2</span> <span class=o>=</span> <span class=n>m1</span> <span class=o>&gt;&gt;</span> <span class=mi>8</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>c1</span><span class=p>,</span> <span class=n>c2</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=n>m1</span><span class=p>,</span> <span class=n>e</span><span class=p>,</span> <span class=n>n</span><span class=p>),</span> <span class=nb>pow</span><span class=p>(</span><span class=n>m2</span><span class=p>,</span> <span class=n>e</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;n = </span><span class=si>{</span><span class=n>n</span><span class=si>}</span><span class=se>\n</span><span class=s2>c1 = </span><span class=si>{</span><span class=n>c1</span><span class=si>}</span><span class=se>\n</span><span class=s2>c2 = </span><span class=si>{</span><span class=n>c2</span><span class=si>}</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></div><p>Với $e$ nhỏ, thì ta nghĩ ngay tới <code>Low public exponent attack</code> và khi tìm hiểu thì ta thấy bài này tương đồng với kiểu <a href=https://en.wikipedia.org/wiki/Coppersmith%27s_attack#Franklin%E2%80%93Reiter_related-message_attack>Franklin–Reiter related-message attack</a></p><p>Cụ thể hơn, $m_2 = m _1 >> 8 \Leftrightarrow m_1 = m_2 * (1 >> 8) + k$.
Mặt khác, ta biết rằng $m_1$ là Part2 của flag tức là phần tử cuối trong 8 bit của nó khi quy về bảng mã ASCII sẽ là <code>}</code> tương đương với giá trị <code>125</code></p><p>=> $m_1=256*m_2+125$</p><p>Sau đó, ta viết lại dưới dạng đa thức $f(x)$ và $g(x)$ là:</p>$$
\begin{cases}
f(x) = x^e-c_1, f(m_1) =0 \\
g(x) = x^e-c_2, f(m_2) =0
\end{cases}
\Leftrightarrow
\begin{cases}
f(x) = (256*x+125)^e-c_1, f(m_2) =0 \\
g(x) = x^e-c_2, g(m_2) =0
\end{cases}
$$<p>Hai đa thức này có nghiệm chung là $m_2$ nên khi lấy GCD của chúng và nếu nó tuyến tính thì ta sẽ lấy được $m_2$, tính $m_1$ và lấy được Part2 của flag.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>Part2</span><span class=p>():</span>
</span></span><span class=line><span class=cl>   <span class=n>n</span> <span class=o>=</span> <span class=mi>3942322022657678598973964668297464188690492529227912763243818849286024502988170927049337618748813366973108404930787214396933140242919629931061653981563183</span>
</span></span><span class=line><span class=cl>   <span class=n>c1</span> <span class=o>=</span> <span class=mi>711628464933911477721875076362382562533209928505813633932265201230108117662370018036520970813120568151605229871541865330790006742825947411425842775387464</span>
</span></span><span class=line><span class=cl>   <span class=n>c2</span> <span class=o>=</span> <span class=mi>199593868713063917388131306750677766968978918100656918000052209242691143624414286755644005020481267183225454134184719235765273635594459821952870709463733</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   <span class=k>def</span> <span class=nf>my_gcd</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>):</span> 
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=n>a</span><span class=o>.</span><span class=n>monic</span><span class=p>()</span> <span class=k>if</span> <span class=n>b</span> <span class=o>==</span> <span class=mi>0</span> <span class=k>else</span> <span class=n>my_gcd</span><span class=p>(</span><span class=n>b</span><span class=p>,</span> <span class=n>a</span> <span class=o>%</span> <span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   <span class=n>x</span> <span class=o>=</span> <span class=n>PolynomialRing</span><span class=p>(</span><span class=n>Zmod</span><span class=p>(</span><span class=n>n</span><span class=p>),</span> <span class=s1>&#39;x&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>gen</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   <span class=k>for</span> <span class=n>e</span> <span class=ow>in</span> <span class=n>trange</span><span class=p>(</span><span class=mi>2</span><span class=o>**</span><span class=mi>9</span><span class=p>,</span> <span class=mi>2</span><span class=o>**</span><span class=mi>10</span><span class=p>):</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=ow>not</span> <span class=n>is_prime</span><span class=p>(</span><span class=n>e</span><span class=p>)</span> <span class=ow>or</span> <span class=n>e</span><span class=o>.</span><span class=n>bit_length</span><span class=p>()</span> <span class=o>!=</span> <span class=mi>10</span><span class=p>:</span>
</span></span><span class=line><span class=cl>         <span class=k>continue</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=n>fx</span> <span class=o>=</span> <span class=p>(</span><span class=mi>256</span> <span class=o>*</span> <span class=n>x</span> <span class=o>+</span> <span class=mi>125</span><span class=p>)</span> <span class=o>**</span> <span class=n>e</span> <span class=o>-</span> <span class=n>c1</span>
</span></span><span class=line><span class=cl>      <span class=n>gx</span> <span class=o>=</span> <span class=n>x</span> <span class=o>**</span> <span class=n>e</span> <span class=o>-</span> <span class=n>c2</span>
</span></span><span class=line><span class=cl>      <span class=n>sol</span> <span class=o>=</span> <span class=n>my_gcd</span><span class=p>(</span><span class=n>fx</span><span class=p>,</span> <span class=n>gx</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=n>sol</span><span class=o>.</span><span class=n>degree</span><span class=p>()</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>         <span class=n>m2</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=o>-</span><span class=n>sol</span><span class=o>.</span><span class=n>coefficients</span><span class=p>()[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>         <span class=n>m1</span> <span class=o>=</span> <span class=mi>256</span> <span class=o>*</span> <span class=n>m2</span> <span class=o>+</span> <span class=mi>125</span>
</span></span><span class=line><span class=cl>         <span class=k>return</span> <span class=n>long_to_bytes</span><span class=p>(</span><span class=n>m1</span><span class=p>)</span>
</span></span></code></pre></div><p>Script:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># solution.py</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sage.all</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.number</span> <span class=kn>import</span> <span class=n>long_to_bytes</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>tqdm</span> <span class=kn>import</span> <span class=n>trange</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Part 1</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>Part1</span><span class=p>():</span>
</span></span><span class=line><span class=cl>   <span class=n>e</span> <span class=o>=</span> <span class=mh>0x10001</span>
</span></span><span class=line><span class=cl>   <span class=n>ct</span> <span class=o>=</span> <span class=mi>239991743627005761506047553716973180857493049128968395824678613535924041735819278721655197652704368009118731671080782572692443257002266295841054097811995343407149181564647568019524547331554506022380795516159222363510661688595308307174873885160951837722610012918052195448795081291878933355634383798002056753336540546915811592763747343189324926404600658482137848658910189331650916354541907427173491308413908173314104508974384232290785538938623142120477030045742266779693627293755590884412082209151425384896460777577066084111556036719259982254175935197376972307183776259868229411302259648873045160120795060467866459055693698198316577983136619062944244317116994863470942099523485902299419458583301056211340627830237050622364646501838811516544340499168319955128200158195905283972429746772105746244910156671549456233908152186037286726530314472293814226978595268877619521165090870514287104577960355240428728213124348138646047728851553209042359051265045752603864312856768918350064549850618348693037041311112677351368226231458377933846664981185928405481697006968220556167073996713389716367133156065980195285148700027809062253416860922839857907535460170132744912543758918516134641462581544039400881675553681819294266618981791250077585566821053</span>
</span></span><span class=line><span class=cl>   <span class=n>Hints</span> <span class=o>=</span> <span class=p>[</span><span class=mi>1659380349228980310793195740551091998951133377142727433181233112954301485314646349955561783455759149036476737520702967988760310760312391176774501840210477308343796277178701715703164651184747756453236376960884981254635386807663657355175214655034193946682205904113897156938926175413312324159809831274187894029251371896829385517428693915588566248998565348483747234270329027561433356156355227738138379418717200316600111392671357267757409316691191187929104999221832963378673907868493499459459256894553552195468110517716115678897171373484791903085022119845347228569870830569321957438966030560930098761455953418479618027428739560761186901956751224602703471828674970337530768801203531827467185690264637238603523292728974955840936711823826949100349569805942227432262275344597592991937770320032450419910426614638156263968483514069904464463402987714698220412063100772910040673056263954301063853666792319306234733964442731206579494701823</span><span class=p>,</span> <span class=mi>2473062479389297534384652365580702456631745761133091301459488546735676124432184165907268360691972078275036508838070797476235444908532100862886958054816201240359777405719375503276188588243722655521225159899315126844306119104997283731460041142142861614319514182297180409656236066011186834375282437648078334082114411988739789392926471318552017202390239258487258487037639778148532362214152519137264282830808294108610004403460587358629486534247288993860831438267841520573973916758902637404855712721811250301202405252158590233975917681798839166192235032424495289048875626437256513981936177292903742966118351026329401662519672777610159422234703124064225710846129876359778079390437505753932101501472252131924073957349012610362952003934494293369977045255000415066563914471132856401071867358687200638320541179048296074882945411664474157308113874183763200469775985802906031999934356545932354932945475129644344782759659758587119586377699</span><span class=p>,</span> <span class=mi>10811389778781749507848369001995006527965136627134898173336798777178617924322548317218123003648199959431162146218350234488676047952720517043381973357960494027353001493321216082118308994614655309535481054291078777020047697030175144901965025751169815034274454689657181813765988172412194436669592236745329922983348687</span><span class=p>,</span> <span class=mi>302270795345262652787049603034608860428203534578338699389744017410286806560707153186173595970011317749221953776227374491075684575774328458397778789729965544452010822737225229627108698874874960910965283322537095645241316756015118860396297708799504427117968454341778975073542738740964812664233075630257595196115893498655587491091126391722042679460013562303363850840912825755508680428829444388842951146482726568654418889598972824414109879370032604627990857015975495697530048397401132619555923308480516678981072029040306410523264480829688927798146165580384683689546853438820269495274502502143436234210825345362323042888891473423488116618918996618482754420372481893339222050268599796400452566639228520072261554594477336671016198833620427171498256007475831231524217372147783123617237105584613811522861590112133798309937116024168109605161059186745904038968516182034441583819409524470833832445513001764653452246905494902592731421744692331296978104865554556383417129664683066891729999411036376957753554228948901872115141778394712481069999501808719302346670855531871069366050528261442730651167165455031776639195754458920584910014448480393554851269958179362536781346169282601003523441289868134223507188615919092337658908484201829621953970243126</span><span class=p>,</span> <span class=mi>292884935929549246643624576832991010496540593142708150947518571090956754050658797955786741707549303442499542376031718493862827439931968289137063776270385766876597819025272388601563339731026897291119786098658019861515084557432779618732711248671531045529170282246847559014298960824095511448557742476351035447816620523706582563446012744989424367197536652910056457067991830630881476241325631891896455745762634189112349619740103725259844111996043190764424736601828139403024375351372351763169837210283497390177391509068689722596094161210899552103572279045474893618035695053640281885367691987326728488743356438444158731410968935525788220429173044772188634219137052045984284351149340419125628533953328666109489959225736888258255952666488686965689900369280599239198825803111830614815595803322570878359992207842211026468967074229662081167123002174445268278747577520774432781623852071789431202030569577689851124794177654088403580945598530502231516822280930459410373890257129917535480957183190120541342731664708767982764672591340622307503858396934095635519503588136203556304925670734741505400274178108097309035870578129722954864083937813328351751442713938490297629659866083082398939022316220801556516785394083566880368038684968532814902807429836</span><span class=p>]</span>
</span></span><span class=line><span class=cl>   <span class=n>xp</span><span class=p>,</span> <span class=n>xn</span> <span class=o>=</span> <span class=n>Hints</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>Hints</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span>
</span></span><span class=line><span class=cl>   <span class=n>n</span> <span class=o>=</span> <span class=n>xn</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>   <span class=n>p</span> <span class=o>=</span> <span class=n>GCD</span><span class=p>(</span><span class=n>n</span><span class=p>,</span> <span class=n>xp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=n>q</span> <span class=o>=</span> <span class=n>n</span> <span class=o>//</span> <span class=n>p</span>
</span></span><span class=line><span class=cl>   <span class=n>PhiN</span> <span class=o>=</span> <span class=p>(</span><span class=n>p</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=p>(</span><span class=n>q</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=n>d</span> <span class=o>=</span> <span class=n>inverse_mod</span><span class=p>(</span><span class=n>e</span><span class=p>,</span> <span class=n>PhiN</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=n>pt</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=n>ct</span><span class=p>,</span> <span class=n>d</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=k>return</span> <span class=n>long_to_bytes</span><span class=p>(</span><span class=n>pt</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#Part 2</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>Part2</span><span class=p>():</span>
</span></span><span class=line><span class=cl>   <span class=n>n</span> <span class=o>=</span> <span class=mi>3942322022657678598973964668297464188690492529227912763243818849286024502988170927049337618748813366973108404930787214396933140242919629931061653981563183</span>
</span></span><span class=line><span class=cl>   <span class=n>c1</span> <span class=o>=</span> <span class=mi>711628464933911477721875076362382562533209928505813633932265201230108117662370018036520970813120568151605229871541865330790006742825947411425842775387464</span>
</span></span><span class=line><span class=cl>   <span class=n>c2</span> <span class=o>=</span> <span class=mi>199593868713063917388131306750677766968978918100656918000052209242691143624414286755644005020481267183225454134184719235765273635594459821952870709463733</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   <span class=k>def</span> <span class=nf>my_gcd</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>):</span> 
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=n>a</span><span class=o>.</span><span class=n>monic</span><span class=p>()</span> <span class=k>if</span> <span class=n>b</span> <span class=o>==</span> <span class=mi>0</span> <span class=k>else</span> <span class=n>my_gcd</span><span class=p>(</span><span class=n>b</span><span class=p>,</span> <span class=n>a</span> <span class=o>%</span> <span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   <span class=n>x</span> <span class=o>=</span> <span class=n>PolynomialRing</span><span class=p>(</span><span class=n>Zmod</span><span class=p>(</span><span class=n>n</span><span class=p>),</span> <span class=s1>&#39;x&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>gen</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   <span class=k>for</span> <span class=n>e</span> <span class=ow>in</span> <span class=n>trange</span><span class=p>(</span><span class=mi>2</span><span class=o>**</span><span class=mi>9</span><span class=p>,</span> <span class=mi>2</span><span class=o>**</span><span class=mi>10</span><span class=p>):</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=ow>not</span> <span class=n>is_prime</span><span class=p>(</span><span class=n>e</span><span class=p>)</span> <span class=ow>or</span> <span class=n>e</span><span class=o>.</span><span class=n>bit_length</span><span class=p>()</span> <span class=o>!=</span> <span class=mi>10</span><span class=p>:</span>
</span></span><span class=line><span class=cl>         <span class=k>continue</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=n>fx</span> <span class=o>=</span> <span class=p>(</span><span class=mi>256</span> <span class=o>*</span> <span class=n>x</span> <span class=o>+</span> <span class=mi>125</span><span class=p>)</span> <span class=o>**</span> <span class=n>e</span> <span class=o>-</span> <span class=n>c1</span>
</span></span><span class=line><span class=cl>      <span class=n>gx</span> <span class=o>=</span> <span class=n>x</span> <span class=o>**</span> <span class=n>e</span> <span class=o>-</span> <span class=n>c2</span>
</span></span><span class=line><span class=cl>      <span class=n>sol</span> <span class=o>=</span> <span class=n>my_gcd</span><span class=p>(</span><span class=n>fx</span><span class=p>,</span> <span class=n>gx</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=n>sol</span><span class=o>.</span><span class=n>degree</span><span class=p>()</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>         <span class=n>m2</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=o>-</span><span class=n>sol</span><span class=o>.</span><span class=n>coefficients</span><span class=p>()[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>         <span class=n>m1</span> <span class=o>=</span> <span class=mi>256</span> <span class=o>*</span> <span class=n>m2</span> <span class=o>+</span> <span class=mi>125</span>
</span></span><span class=line><span class=cl>         <span class=k>return</span> <span class=n>long_to_bytes</span><span class=p>(</span><span class=n>m1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>   <span class=n>PART1</span> <span class=o>=</span> <span class=n>Part1</span><span class=p>()</span>
</span></span><span class=line><span class=cl>   <span class=n>PART2</span> <span class=o>=</span> <span class=n>Part2</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=n>PART1</span> <span class=o>+</span> <span class=n>PART2</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>flag</span><span class=o>.</span><span class=n>decode</span><span class=p>())</span>
</span></span></code></pre></div><pre><code>Flag: W1{https://www.youtube.com/results?search_query=p0lyn0m1als+9c4+is+good+isn%27t+it+?flag=tru4}
</code></pre></div><footer class=article-footer><ul class=article-tag-list itemprop=keywords><li class=article-tag-list-item data-aos=zoom-in><a class=article-tag-list-link href=/tags/ctf rel=tag>CTF</a></li><li class=article-tag-list-item data-aos=zoom-in><a class=article-tag-list-link href=/tags/cryptography rel=tag>CRYPTOGRAPHY</a></li></ul></footer></div><nav id=article-nav aria-label="Article navigation" data-aos=fade-up><div class="article-nav-link-wrap left"><img data-src=/images/WannaW1n.png data-sizes=auto alt="WannaGame NMLT" class=lazyload><a href=/post/wannagamenmlt/ aria-label="Prev:WannaGame NMLT" title="Prev:WannaGame NMLT"></a><div class=article-nav-caption>Prev</div><h3 class=article-nav-title>WannaGame NMLT</h3></div><div class="article-nav-link-wrap right"><img data-src=/images/Certificate.png data-sizes=auto alt="NahamCon CTF 2025" class=lazyload><a href=/post/nahamconctf2025/ aria-label="Next:NahamCon CTF 2025" title="Next:NahamCon CTF 2025"></a><div class=article-nav-caption>Next</div><h3 class=article-nav-title>NahamCon CTF 2025</h3></div></nav></article></section></div><footer id=footer aria-label="Site footer"><div style=width:100%;overflow:hidden><div class=footer-line></div></div><div id=footer-info><div><span class=icon-copyright></span>2024-2025<span class="footer-info-sep rotate"></span>
r1muru</div><div>Powered by&nbsp;<a href=https://gohugo.io/ target=_blank rel="noopener nofollow noreferrer">Hugo</a>&nbsp; Theme.<a href=https://github.com/D-Sketon/hugo-theme-reimu target=_blank rel="noopener nofollow noreferrer">Reimu</a></div><div><span class=icon-brush>&nbsp;23.7k</span>
&nbsp;|&nbsp;
<span class=icon-coffee>&nbsp;01:57</span></div><div><span class=icon-eye></span>
<span id=busuanzi_container_site_pv>Number of visits&nbsp;<span id=busuanzi_value_site_pv></span></span>
&nbsp;|&nbsp;
<span class=icon-user></span>
<span id=busuanzi_container_site_uv>Number of visitors&nbsp;<span id=busuanzi_value_site_uv></span></span></div></div></footer><div class=sidebar-top><div class="sidebar-top-taichi rotate"></div><div class=arrow-up></div></div><div id=mask class=hide></div></div><nav id=mobile-nav aria-label="Mobile navigation"><div class=sidebar-wrap><div class=sidebar-toc-sidebar><h3 class=toc-title>Contents</h3><div class="sidebar-toc-wrapper toc-div-class"><nav id=TableOfContents><ul><li><a href=#choose>Choose!</a><ul><li><a href=#phân-tích>Phân tích:</a></li><li><a href=#ý-tưởng>Ý tưởng:</a></li></ul></li><li><a href=#heartbreak>heartbreak</a><ul><li><a href=#part-1>Part 1:</a></li><li><a href=#part-2>Part 2:</a></li></ul></li></ul></nav></div></div><div class="sidebar-common-sidebar hidden"><div class=sidebar-author><img data-src=/avatar/avatar.png data-sizes=auto alt=r1muru class=lazyload><div class=sidebar-author-name>r1muru</div><div class=sidebar-description>Life is not fair, get used to it</div></div><div class=sidebar-state><div class=sidebar-state-article><div>Posts</div><div class=sidebar-state-number>9</div></div><a class=sidebar-state-category href=/categories/ aria-label=sidebar-state-category-link><div>Categories</div><div class=sidebar-state-number>3</div></a><a class=sidebar-state-tag href=/tags/ aria-label=sidebar-state-tag-link><div>Tags</div><div class=sidebar-state-number>7</div></a></div><div class=sidebar-social><div class="icon-discord sidebar-social-icon"><a href=https://discordapp.com/users/r1muru2006 itemprop=url target=_blank aria-label=discord rel="noopener nofollow noreferrer"></a></div><div class="icon-email sidebar-social-icon"><a href=cuongchu200@gmail.com itemprop=url target=_blank aria-label=email rel="noopener nofollow noreferrer"></a></div><div class="icon-facebook sidebar-social-icon"><a href=https://www.facebook.com/chu.cuong.732399 itemprop=url target=_blank aria-label=facebook rel="noopener nofollow noreferrer"></a></div><div class="icon-github sidebar-social-icon"><a href=https://github.com/r1muru2006 itemprop=url target=_blank aria-label=github rel="noopener nofollow noreferrer"></a></div><div class="icon-instagram sidebar-social-icon"><a href=https://www.instagram.com/r1murun0pr0 itemprop=url target=_blank aria-label=instagram rel="noopener nofollow noreferrer"></a></div></div><div class=sidebar-menu><div class=sidebar-menu-link-wrap><a class=sidebar-menu-link-dummy href=/ aria-label=Home></a><div class='sidebar-menu-icon icon rotate'>&#xe62b;</div><div class=sidebar-menu-link>Home</div></div><div class=sidebar-menu-link-wrap><a class=sidebar-menu-link-dummy href=/archives aria-label=Archives></a><div class='sidebar-menu-icon icon rotate'>&#xe62b;</div><div class=sidebar-menu-link>Archives</div></div><div class=sidebar-menu-link-wrap><a class=sidebar-menu-link-dummy href=/about aria-label=About></a><div class='sidebar-menu-icon icon rotate'>&#xe62b;</div><div class=sidebar-menu-link>About</div></div></div></div></div><div class=sidebar-btn-wrapper><div class="sidebar-toc-btn current"></div><div class=sidebar-common-btn></div></div></nav></div><div class=site-search><div class="reimu-popup popup"><div class=reimu-search><div class=reimu-search-input-icon></div><div id=reimu-search-input></div><div class=popup-btn-close></div></div><div class=reimu-results><div id=reimu-stats></div><div id=reimu-hits></div><div id=reimu-pagination class=reimu-pagination></div></div><img class=reimu-bg src=/images/reimu.png></div></div><script src=https://npm.webcache.cn/lazysizes@5.3.2/lazysizes.min.js integrity=sha384-3gT/vsepWkfz/ff7PpWNUeMzeWoH3cDhm/A8jM7ouoAK0/fP/9bcHHR5kHq2nf+e crossorigin=anonymous></script><script src=https://npm.webcache.cn/clipboard@2.0.11/dist/clipboard.min.js integrity=sha384-J08i8An/QeARD9ExYpvphB8BsyOj3Gh2TSh1aLINKO3L0cMSH2dN3E22zFoXEi0Q crossorigin=anonymous></script><script src=/js/main.js integrity crossorigin=anonymous></script><script src=/js/aos.js integrity crossorigin=anonymous></script><script>var aosInit=()=>{AOS.init({duration:1e3,easing:"ease",once:!0,offset:50})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",aosInit):aosInit()</script><script src=/js/pjax_main.js integrity crossorigin=anonymous data-pjax></script><script>var ALGOLIA_CONFIG={logo:"/images/algolia_logo.svg",algolia:{applicationID:"RAY96S32HW",apiKey:"53e71efc7b6ca695cdb630e780aeae50",indexName:"my-blog",hits:{per_page:parseInt("10")},labels:{input_placeholder:"Search.....",hits_empty:"No results found for 「${query}」",hits_stats:"Found ${hits} results (in ${time} ms)"}}}</script><script src=https://npm.webcache.cn/algoliasearch@4.17.1/dist/algoliasearch-lite.umd.js deferintegrity=sha384-xvLS0jfKuoREs7pqkRI/OI8GcqohO5S+jQz7ZBtQXnsXmD+9jDOOY4cL6dCPzlrk crossorigin=anonymous></script><script src=https://npm.webcache.cn/@reimujs/instantsearch.js@4.57.0-beta.1/dist/instantsearch.production.min.js deferintegrity=sha384-aagKMe8nkqaP2DYQc8kkYOL5l+M5Q2WH/Uhr4teOh0Ybp0RZj0kUSDm45qPikMjK crossorigin=anonymous></script><script src=/js/algolia_search.js integrity crossorigin=anonymous></script><script src=https://npm.webcache.cn/mouse-firework@0.1.1/dist/index.umd.js integrity=sha384-8LyaidD9GPxQQgLJO/WRw/O2h3BoNq/ApI/ecpvM6RsrCz2qP2ppBXUKihP4V/2d crossorigin=anonymous></script><script>if((!!1||!window.matchMedia("(max-width: 768px)").matches)&&window.firework){const e=JSON.parse('{"excludeelements":["a","button"],"particles":[{"colors":["var(--red-1)","var(--red-2)","var(--red-3)","var(--red-4)"],"duration":[1200,1800],"easing":"easeOutExpo","move":["emit"],"number":20,"shape":"circle","shapeOptions":{"alpha":[0.3,0.5],"radius":[16,32]}},{"colors":["var(--red-0)"],"duration":[1200,1800],"easing":"easeOutExpo","move":["diffuse"],"number":1,"shape":"circle","shapeOptions":{"alpha":[0.2,0.5],"lineWidth":6,"radius":20}}]}');e.excludeElements=e.excludeelements,delete e.excludeelements,window.firework(e)}</script><div id=lazy-script><div><script data-pjax>window.REIMU_POST={author:"r1muru",title:"WannaGame Cyber Knight 2025",url:"https://r1muru2006.github.io/post/wannagamecyberknight2025/",description:"Đây là giải đấu do câu lạc bộ Wanna.W1n tổ chức để tuyển thành viên vào câu lạc bộ.",cover:"https://r1muru2006.github.io/images/w1cyber.png"}</script><script src=/js/insert_highlight.js integrity crossorigin=anonymous data-pjax></script><script src=/js/tabs.js integrity crossorigin=anonymous data-pjax></script><script type=module data-pjax>const PhotoSwipeLightbox = (await safeImport("https:\/\/npm.webcache.cn\/photoswipe@5.4.4\/dist\/photoswipe-lightbox.esm.min.js", "sha384-DiL6M\/gG\u002bwmTxmCRZyD1zee6lIhawn5TGvED0FOh7fXcN9B0aZ9dexSF\/N6lrZi\/")).default;const initPswp = (gallery, children) => {
          if (_$$(`${gallery} ${children}`).length > 0) {
            new PhotoSwipeLightbox({
              gallery,
              children,pswpModule: () => safeImport("https:\/\/npm.webcache.cn\/photoswipe@5.4.4\/dist\/photoswipe.esm.min.js", "sha384-WkkO3GCmgkC3VQWpaV8DqhKJqpzpF9JoByxDmnV8\u002boTJ7m3DfYEWX1fu1scuS4\u002bs")}).init();
          }
        }
        const pswp = () => {
          initPswp('.article-entry', 'a.article-gallery-item');
          initPswp('.article-gallery', 'a.article-gallery-item');
          window.lightboxStatus = 'done';
          window.removeEventListener('lightbox:ready', pswp);
        }
        if(window.lightboxStatus === 'ready') {
          pswp()
        } else {
          window.addEventListener('lightbox:ready', pswp);
        }
      </script><script src=https://npm.webcache.cn/katex@0.16.24/dist/katex.min.js data-pjaxintegrity=sha384-MWNUH0WmtsYGhn2cbH6ELRCbf9LG3QDqCC+gqPB3IBNO35xjZK3Ejb6oONRpDbPg crossorigin=anonymous></script><script src=https://npm.webcache.cn/katex@0.16.24/dist/contrib/auto-render.min.js data-pjaxintegrity=sha384-hCXGrW6PitJEwbkoStFjeJxv+fSOOQKOPbJxSfM6G5sWZjAyWhXiTIIAmQqnlLlh crossorigin=anonymous></script><script data-pjax>var renderMath=()=>{if(!window.renderMathInElement)return;window.renderMathInElement(_$("article"),{delimiters:[{left:"$$",right:"$$",display:!0},{left:"\\[",right:"\\]",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1}]})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",renderMath,{once:!0}):renderMath()</script></div></div><script src=https://npm.webcache.cn/busuanzi@2.3.0/bsz.pure.mini.js asyncintegrity=sha384-0M75wtSkhjIInv4coYlaJU83+OypaRCIq2SukQVQX04eGTCBXJDuWAbJet56id+S crossorigin=anonymous></script><script>"serviceWorker"in navigator&&navigator.serviceWorker.getRegistrations().then(e=>{for(let t of e)t.unregister()})</script><script>const reimuCopyright=String.raw`
   ______     ______     __     __    __     __  __    
  /\  == \   /\  ___\   /\ \   /\ "-./  \   /\ \/\ \   
  \ \  __<   \ \  __\   \ \ \  \ \ \-./\ \  \ \ \_\ \  
   \ \_\ \_\  \ \_____\  \ \_\  \ \_\ \ \_\  \ \_____\ 
    \/_/ /_/   \/_____/   \/_/   \/_/  \/_/   \/_____/ 
                                                    
  `;console.log(String.raw`%c ${reimuCopyright}`,"color: #ff5252;"),console.log("%c Theme.Reimu %c https://github.com/D-Sketon/hugo-theme-reimu ","color: white; background: #ff5252; padding:5px 0;","padding:4px;border:1px solid #ff5252;")</script></body></html>